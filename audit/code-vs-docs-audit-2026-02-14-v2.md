# –ê—É–¥–∏—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∫–æ–¥–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ ‚Äî v2

**–î–∞—Ç–∞:** 2026-02-14
**–ê—É–¥–∏—Ç–æ—Ä:** –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–π –∞—É–¥–∏—Ç–æ—Ä (AI)
**–í–µ—Ä—Å–∏—è:** 2 (–ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∞—É–¥–∏—Ç –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –ö–†-1, –ö–†-2, –ö–†-3, –ù–†-7, –ù–†-8)

---

## Executive Summary

### –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞

–ü—Ä–æ–µ–∫—Ç Call Center AI –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç **–≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è** —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏. –í—Å–µ 4 —Ñ–∞–∑—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ –∫–æ–¥–µ, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è–º, –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∞—É–¥–∏—Ç–∞ —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã.

**–û–±—â–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è: ~89%**

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ | –°—Ç–∞—Ç—É—Å |
|-----------|-------------|--------|
| 3.1 –ö–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–µ tools | 85% | 2 tools –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ —Ä–æ—É—Ç–µ—Ä–µ |
| 3.2 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ | 95% | –ü–æ–ª–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ |
| 3.3 –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö | 90% | –ú–∏–≥—Ä–∞—Ü–∏—è 006 –Ω–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ |
| 3.4 Store API –∫–æ–Ω—Ç—Ä–∞–∫—Ç | 95% | –ü–æ–ª–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ |
| 3.5 NFR | 92% | –í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –∏ –∞–ª–µ—Ä—Ç—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã |
| 3.6 –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å | 90% | PII sanitizer, –∞—É–¥–∏–æ –Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è |
| 3.7 –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (Phase 4) | 88% | –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã |
| 3.8 Sequence Diagrams | 85% | 6 –∏–∑ 7 —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –ø–æ–∫—Ä—ã—Ç—ã |
| 3.9 Deployment/Docker | 80% | –†–∞–∑–ª–∏—á–∏—è –≤ compose –∏ docs |
| 3.10 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | 90% | –û–±—à–∏—Ä–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ |

### –°—Ç–∞—Ç—É—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∞—É–¥–∏—Ç–∞

| ID | –û–ø–∏—Å–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|----|----------|--------|
| –ö–†-1 | Pipeline –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ main.py | **–ò–°–ü–†–ê–í–õ–ï–ù–û** |
| –ö–†-2 | PII sanitizer –º–∞—Å–∫–∏—Ä—É–µ—Ç –∏–º–µ–Ω–∞ | **–ò–°–ü–†–ê–í–õ–ï–ù–û** |
| –ö–†-3 | CI/CD pipeline —Å–æ–∑–¥–∞–Ω | **–ò–°–ü–†–ê–í–õ–ï–ù–û** |
| –ù–†-7 | –ú–µ—Ç—Ä–∏–∫–∞ `audiosocket_to_stt_ms` –¥–æ–±–∞–≤–ª–µ–Ω–∞ | **–ò–°–ü–†–ê–í–õ–ï–ù–û** |
| –ù–†-8 | –ú–µ—Ç—Ä–∏–∫–∞ `tts_delivery_ms` –¥–æ–±–∞–≤–ª–µ–Ω–∞ | **–ò–°–ü–†–ê–í–õ–ï–ù–û** |

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è (–Ω–æ–≤—ã–µ)

| # | –û–ø–∏—Å–∞–Ω–∏–µ | –í–ª–∏—è–Ω–∏–µ |
|---|----------|---------|
| –ö–†-4 | `cancel_fitting` –∏ `get_fitting_price` –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ `tools.py`, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ `store_client`, –Ω–æ **–ù–ï –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã** –≤ `_build_tool_router()` –≤ `main.py` | LLM –ø–æ–ª—É—á–∏—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è tools, –Ω–æ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –ø–æ–ª—É—á–∏—Ç –æ—à–∏–±–∫—É ‚Äî tool –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Ä–æ—É—Ç–µ—Ä–µ |
| –ö–†-5 | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–µ—Ä–µ—á–∏—Å–ª—è–µ—Ç 5 –º–∏–≥—Ä–∞—Ü–∏–π (001‚Äì005), –≤ –∫–æ–¥–µ 6 (006_add_prompt_ab_tests.py) ‚Äî –Ω–µ–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è | –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏, —Ö–æ—Ç—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ |

---

## 3.1 –ö–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ tools

**–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** `doc/development/00-overview.md` (—Å–µ–∫—Ü–∏—è ¬´–ö–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ tools¬ª)
**–ò—Å—Ç–æ—á–Ω–∏–∫ –∫–æ–¥–∞:** `src/agent/tools.py`, `src/main.py` (`_build_tool_router()`), `src/store_client/client.py`

### –ö–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∞—è —Ç–∞–±–ª–∏—Ü–∞ (–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚Äî 13 tools)

| Tool | –°—Ç–∞—Ç—É—Å –≤ `tools.py` | –°—Ç–∞—Ç—É—Å –≤ `main.py` router | –°—Ç–∞—Ç—É—Å –≤ `store_client` | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------|---------------------|---------------------------|------------------------|-------------|
| `search_tires` | ‚úÖ | ‚úÖ `_store_client.search_tires` | ‚úÖ `search_tires()` | –ü–æ–ª–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ |
| `check_availability` | ‚úÖ | ‚úÖ `_store_client.check_availability` | ‚úÖ `check_availability()` | –ü–æ–ª–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ |
| `transfer_to_operator` | ‚úÖ | ‚úÖ inline lambda | N/A (Asterisk) | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–∞–∫ –∑–∞–º—ã–∫–∞–Ω–∏–µ –≤ `_build_tool_router()` |
| `get_order_status` | ‚úÖ | ‚úÖ `_store_client.search_orders` | ‚úÖ `search_orders()` | –ò–º—è –º–µ—Ç–æ–¥–∞ –≤ –∫–ª–∏–µ–Ω—Ç–µ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è (`search_orders` –≤–º–µ—Å—Ç–æ `get_order_status`), –Ω–æ –º–∞–ø–ø–∏–Ω–≥ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω |
| `create_order_draft` | ‚úÖ | ‚úÖ `_store_client.create_order` | ‚úÖ `create_order()` | –ò–º—è –≤ tools.py –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ (`create_order_draft`), –º–µ—Ç–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞ `create_order` ‚Äî –º–∞–ø–ø–∏–Ω–≥ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω |
| `update_order_delivery` | ‚úÖ | ‚úÖ `_store_client.update_delivery` | ‚úÖ `update_delivery()` | –ü–æ–ª–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ |
| `confirm_order` | ‚úÖ | ‚úÖ `_store_client.confirm_order` | ‚úÖ `confirm_order()` | –ü–æ–ª–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ, Idempotency-Key —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω |
| `get_fitting_stations` | ‚úÖ | ‚úÖ `_store_client.get_fitting_stations` | ‚úÖ `get_fitting_stations()` | –ü–æ–ª–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ |
| `get_fitting_slots` | ‚úÖ | ‚úÖ `_store_client.get_fitting_slots` | ‚úÖ `get_fitting_slots()` | –ü–æ–ª–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ |
| `book_fitting` | ‚úÖ | ‚úÖ `_store_client.book_fitting` | ‚úÖ `book_fitting()` | –ü–æ–ª–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ, Idempotency-Key —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω |
| `cancel_fitting` | ‚úÖ | ‚ùå **–ù–ï –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω** | ‚úÖ `cancel_fitting()` | **–ö–†-4**: –æ–ø—Ä–µ–¥–µ–ª—ë–Ω –≤ tools.py, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ –∫–ª–∏–µ–Ω—Ç–µ, –Ω–æ –ù–ï –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Ä–æ—É—Ç–µ—Ä |
| `get_fitting_price` | ‚úÖ | ‚ùå **–ù–ï –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω** | ‚úÖ `get_fitting_price()` | **–ö–†-4**: –æ–ø—Ä–µ–¥–µ–ª—ë–Ω –≤ tools.py, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ –∫–ª–∏–µ–Ω—Ç–µ, –Ω–æ –ù–ï –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Ä–æ—É—Ç–µ—Ä |
| `search_knowledge_base` | ‚úÖ | ‚úÖ `_store_client.search_knowledge_base` | ‚úÖ `search_knowledge_base()` | –ü–æ–ª–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ |

### –î–µ—Ç–∞–ª–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –ö–†-4

–í `src/agent/tools.py` (—Å—Ç—Ä–æ–∫–∞ 403):
```python
ALL_TOOLS = MVP_TOOLS + ORDER_TOOLS + FITTING_TOOLS
```

`FITTING_TOOLS` —Å–æ–¥–µ—Ä–∂–∏—Ç 6 tools: `get_fitting_stations`, `get_fitting_slots`, `book_fitting`, `cancel_fitting`, `get_fitting_price`, `search_knowledge_base`.

–í `src/main.py` (`_build_tool_router()`, —Å—Ç—Ä–æ–∫–∏ 141‚Äì163) –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ —Ç–æ–ª—å–∫–æ 11 tools. –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç:
- `cancel_fitting` ‚Äî –Ω–µ—Ç —Å—Ç—Ä–æ–∫–∏ `router.register("cancel_fitting", ...)`
- `get_fitting_price` ‚Äî –Ω–µ—Ç —Å—Ç—Ä–æ–∫–∏ `router.register("get_fitting_price", ...)`

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏–µ:** LLM Agent (`src/agent/agent.py`) –ø–µ—Ä–µ–¥–∞—ë—Ç –≤—Å–µ 13 tools –∏–∑ `ALL_TOOLS` –≤ Claude API. Claude –º–æ–∂–µ—Ç —Ä–µ—à–∏—Ç—å –≤—ã–∑–≤–∞—Ç—å `cancel_fitting` –∏–ª–∏ `get_fitting_price`, –Ω–æ `ToolRouter` –Ω–µ –Ω–∞–π–¥—ë—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫, —á—Ç–æ –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ –æ—à–∏–±–∫–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è tool call.

### –ò–º–µ–Ω–∞ tools ‚Äî –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è

| –ü—Ä–æ–≤–µ—Ä–∫–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|----------|-----------|
| `create_order_draft` (–Ω–µ `create_order`) | ‚úÖ –í `tools.py` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `create_order_draft` |
| –í—Å–µ –∏–º–µ–Ω–∞ –∏–∑ –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–æ–≥–æ —Å–ø–∏—Å–∫–∞ | ‚úÖ –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ |
| Input schema —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π | ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è–º —Ñ–∞–∑ 1‚Äì3 |

---

## 3.2 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

**–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** `doc/technical/architecture.md`
**–ò—Å—Ç–æ—á–Ω–∏–∫ –∫–æ–¥–∞:** `src/core/`, `src/agent/`, `src/config.py`

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å | –§–∞–π–ª | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------------|--------|------|-------------|
| AudioSocket –ø—Ä–æ—Ç–æ–∫–æ–ª (0x00=hangup, 0x01=UUID, 0x10=audio, 0xFF=error) | ‚úÖ | `src/core/audio_socket.py` | `PacketType` enum: HANGUP=0x00, UUID=0x01, AUDIO=0x10, ERROR=0xFF |
| –ê—É–¥–∏–æ-—Ñ—Ä–µ–π–º 20–º—Å (640 –±–∞–π—Ç) | ‚úÖ | `src/core/audio_socket.py` | `AUDIO_FRAME_BYTES = 640`, `AUDIO_FRAME_MS = 20` |
| Pipeline: AudioSocket ‚Üí STT ‚Üí LLM ‚Üí TTS ‚Üí AudioSocket | ‚úÖ | `src/core/pipeline.py` | `CallPipeline.run()` ‚Äî greeting ‚Üí listen ‚Üí STT ‚Üí LLM ‚Üí TTS loop |
| Pipeline –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ main.py | ‚úÖ | `src/main.py` —Å—Ç—Ä–æ–∫–∏ 96‚Äì114 | **–ö–†-1 –ò–°–ü–†–ê–í–õ–ï–ù–û**: `handle_call()` —Å–æ–∑–¥–∞—ë—Ç STT, agent, pipeline |
| Barge-in –ø–æ–¥–¥–µ—Ä–∂–∫–∞ | ‚úÖ | `src/core/pipeline.py` | `_barge_in_event = asyncio.Event()`, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤ `_speak_streaming()` |
| Session state –≤ Redis | ‚úÖ | `src/core/call_session.py` | `SessionStore(Redis)`, TTL=1800s |
| TTL 1800s | ‚úÖ | `src/core/call_session.py` | `SESSION_TTL = 1800` |
| Circuit breaker (aiobreaker, fail_max=5, timeout=30s) | ‚úÖ | `src/store_client/client.py` | `CircuitBreaker(fail_max=5, timeout_duration=30)` |
| –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON logging | ‚úÖ | `src/logging/structured_logger.py` | `JSONFormatter` —Å `call_id`, `request_id` |
| call_id + request_id —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ | ‚úÖ | `src/logging/structured_logger.py` | `CallIdFilter` –¥–æ–±–∞–≤–ª—è–µ—Ç `call_id` –≤ –∫–∞–∂–¥—É—é –∑–∞–ø–∏—Å—å |
| –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ (stateless) | ‚úÖ | `src/core/call_session.py`, `src/main.py` | –°–æ—Å—Ç–æ—è–Ω–∏–µ –≤ Redis, Call Processor stateless |
| Google STT streaming gRPC | ‚úÖ | `src/stt/google_stt.py` | `GoogleSTTEngine` —Å restart –ø–æ 5-–º–∏–Ω —Ç–∞–π–º–∞—É—Ç—É |
| Google TTS Neural2 | ‚úÖ | `src/tts/google_tts.py` | `GoogleTTSEngine` —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º —á–∞—Å—Ç—ã—Ö —Ñ—Ä–∞–∑ |
| Claude API tool calling | ‚úÖ | `src/agent/agent.py` | `LLMAgent` —Å `ToolRouter`, MAX_TOOL_CALLS_PER_TURN=5 |
| Whisper STT (Phase 4) | ‚úÖ | `src/stt/whisper_stt.py` | `WhisperSTTEngine` —Å Faster-Whisper |
| Model routing (Haiku/Sonnet) | ‚úÖ | `src/agent/model_router.py` | `ModelRouter` –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –ø–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–∞ |
| Feature flags | ‚úÖ | `src/config.py` | `FeatureFlagsConfig` —Å `use_whisper`, `use_model_routing`, `enable_ab_testing` |
| ARI –∫–ª–∏–µ–Ω—Ç | ‚úÖ | `src/core/asterisk_ari.py` | `ARIClient` –¥–ª—è CallerID –∏ transfer |

---

## 3.3 –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö

**–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** `doc/technical/data-model.md`
**–ò—Å—Ç–æ—á–Ω–∏–∫ –∫–æ–¥–∞:** `migrations/versions/001-006`

### –¢–∞–±–ª–∏—Ü—ã

| –¢–∞–±–ª–∏—Ü–∞ (–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è) | –°—Ç–∞—Ç—É—Å | –ú–∏–≥—Ä–∞—Ü–∏—è | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|----------------------|--------|----------|-------------|
| `customers` | ‚úÖ | 001 | UNIQUE INDEX –Ω–∞ `phone` |
| `calls` | ‚úÖ | 001 | Partitioned by `started_at`, 5 –º–µ—Å—è—á–Ω—ã—Ö –ø–∞—Ä—Ç–∏—Ü–∏–π |
| `call_turns` | ‚úÖ | 001 | Partitioned by `created_at` |
| `call_tool_calls` | ‚úÖ | 001 | Partitioned by `created_at` |
| `orders` | ‚úÖ | 002 | –° `idempotency_key` |
| `order_items` | ‚úÖ | 002 | FK –Ω–∞ `orders(id)` |
| `fitting_stations` | ‚úÖ | 003 | –í—Å–µ –∫–æ–ª–æ–Ω–∫–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å ERD |
| `fitting_bookings` | ‚úÖ | 003 | –í—Å–µ –∫–æ–ª–æ–Ω–∫–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å ERD |
| `knowledge_articles` | ‚úÖ | 004 | –° `active` —Ñ–ª–∞–≥–æ–º |
| `knowledge_embeddings` | ‚úÖ | 004 | pgvector VECTOR(1536), hnsw index |
| `daily_stats` | ‚úÖ | 005 | PK –Ω–∞ `stat_date`, jsonb –ø–æ–ª—è |
| `prompt_versions` | ‚úÖ | 006 | **–ù–ï –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ** –≤ data-model.md (–º–∏–≥—Ä–∞—Ü–∏–∏ 001‚Äì005) |
| `prompt_ab_tests` | ‚úÖ | 006 | **–ù–ï –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ** –≤ data-model.md (–º–∏–≥—Ä–∞—Ü–∏–∏ 001‚Äì005) |

### –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------------|--------|-------------|
| `calls` PARTITION BY RANGE (started_at) | ‚úÖ | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ 001, 5 –ø–∞—Ä—Ç–∏—Ü–∏–π (2026_01 ‚Äì 2026_05) |
| `call_turns` PARTITION BY RANGE (created_at) | ‚úÖ | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ 001 |
| `call_tool_calls` PARTITION BY RANGE (created_at) | ‚úÖ | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ 001 |

### –ò–Ω–¥–µ–∫—Å—ã

| –ò–Ω–¥–µ–∫—Å (–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è) | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|----------------------|--------|-------------|
| `idx_calls_caller_id` | ‚úÖ | –í 001 |
| `idx_calls_customer_id` | ‚úÖ | –í 001 |
| `idx_calls_started_at` | ‚úÖ | –í 001 |
| `idx_call_turns_call_id` | ‚úÖ | –í 001 |
| `idx_knowledge_embeddings_vector` (hnsw) | ‚úÖ | –í 004, `vector_cosine_ops` |
| `idx_customers_phone` (UNIQUE) | ‚úÖ | –í 001 |

### –†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –ö–†-5: –ù–µ–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è `doc/technical/data-model.md` (—Å—Ç—Ä–æ–∫–∏ 346‚Äì357) –ø–µ—Ä–µ—á–∏—Å–ª—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏:
```
001_initial_schema.py
002_add_orders.py
003_add_fitting.py
004_add_knowledge_base.py
005_add_analytics.py
```

–í –∫–æ–¥–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç 6-—è –º–∏–≥—Ä–∞—Ü–∏—è: `006_add_prompt_ab_tests.py`, —Å–æ–∑–¥–∞—é—â–∞—è —Ç–∞–±–ª–∏—Ü—ã `prompt_versions` –∏ `prompt_ab_tests`. –≠—Ç–∏ —Ç–∞–±–ª–∏—Ü—ã **–æ–ø–∏—Å–∞–Ω—ã –≤ ERD** (–≤ —Å–µ–∫—Ü–∏–∏ –¥–∏–∞–≥—Ä–∞–º–º—ã data-model.md), –Ω–æ –º–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –Ω–∏—Ö **–Ω–µ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∞** –≤ —Å–ø–∏—Å–∫–µ –º–∏–≥—Ä–∞—Ü–∏–π.

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∫–æ–ª–æ–Ω–∫–∞

| –†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|-------------|-------------|
| `calls.quality_details` (JSONB) | –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –º–∏–≥—Ä–∞—Ü–∏–∏ 005, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `analytics.py` –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—Ü–µ–Ω–∫–∏. –ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ ERD –∫–∞–∫ —á–∞—Å—Ç—å `quality_score`, –Ω–æ –æ—Ç–¥–µ–ª—å–Ω–∞—è –∫–æ–ª–æ–Ω–∫–∞ –Ω–µ –ø–æ–∫–∞–∑–∞–Ω–∞ –≤ ERD |

---

## 3.4 Store API –∫–æ–Ω—Ç—Ä–∞–∫—Ç

**–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** `doc/development/api-specification.md`
**–ò—Å—Ç–æ—á–Ω–∏–∫ –∫–æ–¥–∞:** `src/store_client/client.py`

| Endpoint (–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è) | HTTP Method | –°—Ç–∞—Ç—É—Å | –ú–µ—Ç–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------------------------|-------------|--------|---------------|-------------|
| `GET /api/v1/tires/search` | GET | ‚úÖ | `search_tires()` | + fallback –Ω–∞ `/vehicles/tires` –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –∞–≤—Ç–æ |
| `GET /api/v1/tires/{id}` | GET | ‚úÖ | `get_tire()` | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ (–Ω–µ tool) |
| `GET /api/v1/tires/{id}/availability` | GET | ‚úÖ | `check_availability()` | –° fallback –ø–æ query |
| `GET /api/v1/orders/search` | GET | ‚úÖ | `search_orders()` | –ü–æ phone |
| `GET /api/v1/orders/{id}` | GET | ‚úÖ | `search_orders()` | –ü–æ order_id |
| `POST /api/v1/orders` | POST | ‚úÖ | `create_order()` | **Idempotency-Key: ‚úÖ** |
| `PATCH /api/v1/orders/{id}/delivery` | PATCH | ‚úÖ | `update_delivery()` | –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–æ—Å—Ç–∞–≤–∫–∏ |
| `POST /api/v1/orders/{id}/confirm` | POST | ‚úÖ | `confirm_order()` | **Idempotency-Key: ‚úÖ** |
| `GET /api/v1/pickup-points` | GET | ‚úÖ | `get_pickup_points()` | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ |
| `GET /api/v1/delivery/calculate` | GET | ‚úÖ | `calculate_delivery()` | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ |
| `GET /api/v1/fitting/stations` | GET | ‚úÖ | `get_fitting_stations()` | –ü–æ –≥–æ—Ä–æ–¥—É |
| `GET /api/v1/fitting/stations/{id}/slots` | GET | ‚úÖ | `get_fitting_slots()` | –° —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –¥–∞—Ç—ã –∏ —Ç–∏–ø–∞ |
| `POST /api/v1/fitting/bookings` | POST | ‚úÖ | `book_fitting()` | **Idempotency-Key: ‚úÖ** |
| `DELETE /api/v1/fitting/bookings/{id}` | DELETE | ‚úÖ | `cancel_fitting()` | –î–ª—è action=cancel |
| `PATCH /api/v1/fitting/bookings/{id}` | PATCH | ‚úÖ | `cancel_fitting()` | –î–ª—è action=reschedule |
| `GET /api/v1/fitting/prices` | GET | ‚úÖ | `get_fitting_price()` | –ü–æ –¥–∏–∞–º–µ—Ç—Ä—É, —Å—Ç–∞–Ω—Ü–∏–∏, —Ç–∏–ø—É |
| `GET /api/v1/knowledge/search` | GET | ‚úÖ | `search_knowledge_base()` | –° category —Ñ–∏–ª—å—Ç—Ä–æ–º |

### –ú–µ—Ö–∞–Ω–∏–∑–º—ã –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------------|--------|-------------|
| Retry –¥–ª—è 429/503 | ‚úÖ | `_RETRYABLE_STATUSES = {429, 503}`, `_MAX_RETRIES = 2`, backoff 1s, 2s |
| Circuit breaker | ‚úÖ | `aiobreaker.CircuitBreaker(fail_max=5, timeout_duration=30)` |
| Idempotency-Key –¥–ª—è POST mutations | ‚úÖ | `uuid.uuid4()` –¥–ª—è `create_order`, `confirm_order`, `book_fitting` |
| X-Request-Id –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ | ‚úÖ | –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –≤ `_do_request()` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ |
| Timeout | ‚úÖ | `aiohttp.ClientTimeout(total=timeout)`, default=5s |
| Bearer token auth | ‚úÖ | `Authorization: Bearer {api_key}` –≤ headers —Å–µ—Å—Å–∏–∏ |

---

## 3.5 NFR (–Ω–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)

**–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** `doc/technical/nfr.md`
**–ò—Å—Ç–æ—á–Ω–∏–∫ –∫–æ–¥–∞:** `src/monitoring/metrics.py`, `prometheus/alerts.yml`, `src/core/pipeline.py`

### Latency Budget

| –≠—Ç–∞–ø (docs) | –ë—é–¥–∂–µ—Ç | –ú–µ—Ç—Ä–∏–∫–∞ | –ê–ª–µ—Ä—Ç –ø—Ä–∏ | –°—Ç–∞—Ç—É—Å –º–µ—Ç—Ä–∏–∫–∏ | –°—Ç–∞—Ç—É—Å –∞–ª–µ—Ä—Ç–∞ |
|-------------|--------|---------|-----------|----------------|---------------|
| AudioSocket ‚Üí STT | ‚â§ 50ms | `audiosocket_to_stt_ms` | > 100ms | ‚úÖ metrics.py:56 | ‚úÖ alerts.yml:89 |
| STT —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ | ‚â§ 500ms | `stt_latency_ms` | > 700ms | ‚úÖ metrics.py:32 | ‚úÖ alerts.yml:49 |
| LLM (TTFT) | ‚â§ 1000ms | `llm_latency_ms` | > 1500ms | ‚úÖ metrics.py:38 | ‚úÖ alerts.yml:63 |
| TTS —Å–∏–Ω—Ç–µ–∑ | ‚â§ 400ms | `tts_latency_ms` | > 600ms | ‚úÖ metrics.py:44 | ‚úÖ alerts.yml:75 |
| TTS ‚Üí AudioSocket | ‚â§ 50ms | `tts_delivery_ms` | > 100ms | ‚úÖ metrics.py:62 | ‚úÖ alerts.yml:101 |
| End-to-end | ‚â§ 2000ms | `total_response_latency_ms` | > 2500ms | ‚úÖ metrics.py:50 | ‚ö†Ô∏è alerts.yml:35 **> 3000ms** |

### –†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –≤ –ø–æ—Ä–æ–≥–µ end-to-end –∞–ª–µ—Ä—Ç–∞

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (`nfr.md` —Å—Ç—Ä–æ–∫–∞ 26) —É–∫–∞–∑—ã–≤–∞–µ—Ç –∞–ª–µ—Ä—Ç –ø—Ä–∏ `> 2500ms`, –∞ –≤ `alerts.yml` (—Å—Ç—Ä–æ–∫–∞ 39) –ø–æ—Ä–æ–≥ `> 3000` (HighResponseLatency). –≠—Ç–æ **–Ω–µ–∫—Ä–∏—Ç–∏—á–Ω–æ–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ** ‚Äî –ø–æ—Ä–æ–≥ –≤ –∞–ª–µ—Ä—Ç–µ –≤—ã—à–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –Ω–∞ 500ms.

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ pipeline

| –ú–µ—Ç—Ä–∏–∫–∞ | –ì–¥–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ | –°—Ç–∞—Ç—É—Å |
|---------|----------------------|--------|
| `audiosocket_to_stt_ms` | `pipeline.py:119-121` (–≤ `_audio_reader_loop`) | ‚úÖ **–ù–†-7 –ò–°–ü–†–ê–í–õ–ï–ù–û** |
| `tts_delivery_ms` | `pipeline.py:228,256` (–≤ `_speak`, `_speak_streaming`) | ‚úÖ **–ù–†-8 –ò–°–ü–†–ê–í–õ–ï–ù–û** |
| `stt_latency_ms` | `src/stt/google_stt.py` | ‚úÖ |
| `llm_latency_ms` | `src/agent/agent.py` | ‚úÖ |
| `tts_latency_ms` | `src/tts/google_tts.py` | ‚úÖ |

### –ü—Ä–æ—á–∏–µ NFR

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å | –§–∞–π–ª | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------------|--------|------|-------------|
| Session TTL 1800s | ‚úÖ | `call_session.py:24` | `SESSION_TTL = 1800` |
| Stateless Call Processor | ‚úÖ | `main.py`, `call_session.py` | –°–æ—Å—Ç–æ—è–Ω–∏–µ –≤ Redis |
| Graceful shutdown | ‚úÖ | `main.py:208-256` | SIGINT/SIGTERM ‚Üí stop AudioSocket ‚Üí close clients |
| Retry —Å exponential backoff | ‚úÖ | `store_client/client.py` | 1s, 2s –¥–ª—è 429/503 |
| Circuit breaker fallback | ‚úÖ | `store_client/client.py` | `CircuitBreakerError` ‚Üí `StoreAPIError(503)` |
| Health check endpoint | ‚úÖ | `main.py:56-71` | `GET /health` ‚Äî Redis, AudioSocket status |
| Prometheus metrics endpoint | ‚úÖ | `main.py:74-77` | `GET /metrics` |

### –ê–ª–µ—Ä—Ç—ã

| –ê–ª–µ—Ä—Ç (docs/nfr) | –°—Ç–∞—Ç—É—Å | –§–∞–π–ª | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|-------------------|--------|------|-------------|
| p95 latency > 3s (total) | ‚úÖ | alerts.yml:35 | `HighResponseLatency` |
| STT > 700ms | ‚úÖ | alerts.yml:49 | `HighSTTLatency` |
| LLM > 1500ms | ‚úÖ | alerts.yml:63 | `HighLLMLatency` |
| TTS > 600ms | ‚úÖ | alerts.yml:75 | `HighTTSLatency` |
| AudioSocket‚ÜíSTT > 100ms | ‚úÖ | alerts.yml:89 | `HighAudioSocketToSTTLatency` |
| TTS‚ÜíAudioSocket > 100ms | ‚úÖ | alerts.yml:101 | `HighTTSDeliveryLatency` |
| >5 –æ—à–∏–±–æ–∫ –∑–∞ 10 –º–∏–Ω | ‚úÖ | alerts.yml:22 | `PipelineErrorsHigh` |
| >50% –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–π –∑–∞ 1—á | ‚úÖ | alerts.yml:5 | `HighTransferRate` |
| Operator queue > 5 | ‚úÖ | alerts.yml:114 | `OperatorQueueOverflow` |
| Abnormal API spend | ‚úÖ | alerts.yml:127 | `AbnormalAPISpend` (>200% –æ—Ç 24h avg) |
| Suspicious tool calls | ‚úÖ | alerts.yml:142 | `SuspiciousToolCalls` (400 errors > 0.5/s) |
| Circuit breaker open | ‚úÖ | alerts.yml:155 | `CircuitBreakerOpen` |

---

## 3.6 –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** `doc/security/threat-model.md`, `doc/security/data-policy.md`, `doc/security/risk-matrix.md`
**–ò—Å—Ç–æ—á–Ω–∏–∫ –∫–æ–¥–∞:** `src/logging/pii_sanitizer.py`, `src/agent/prompts.py`, `src/core/pipeline.py`

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å | –§–∞–π–ª | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------------|--------|------|-------------|
| PII sanitizer: –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ | ‚úÖ | `pii_sanitizer.py:24-29` | `+380XXXXXXXXX ‚Üí +380XX***XX` |
| PII sanitizer: –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞ –∏–º—ë–Ω | ‚úÖ | `pii_sanitizer.py:32-37` | `–Ü–≤–∞–Ω –ü–µ—Ç—Ä–µ–Ω–∫–æ ‚Üí –Ü*** –ü***` **–ö–†-2 –ò–°–ü–†–ê–í–õ–ï–ù–û** |
| `sanitize_pii()` –≤—ã–∑—ã–≤–∞–µ—Ç –æ–±–∞ | ‚úÖ | `pii_sanitizer.py:40-44` | –¶–µ–ø–æ—á–∫–∞: phone ‚Üí name |
| PII sanitizer –ø–æ–¥–∫–ª—é—á—ë–Ω –∫ –ª–æ–≥–≥–µ—Ä—É | ‚úÖ | `structured_logger.py` | `JSONFormatter` –≤—ã–∑—ã–≤–∞–µ—Ç `sanitize_pii()` |
| –ê—É–¥–∏–æ –ù–ï –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è | ‚úÖ | `pipeline.py` | Streaming STT, –∞—É–¥–∏–æ –Ω–∏–≥–¥–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞ –¥–∏—Å–∫ |
| –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è 90 –¥–Ω–µ–π | ‚ö†Ô∏è | `data-policy.md` | –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ, –Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ –∫–æ–¥–µ (–Ω–µ—Ç cron/task –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è) |
| Bot –æ–±—ä—è–≤–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É | ‚úÖ | `prompts.py:GREETING_TEXT` | –í–∫–ª—é—á–∞–µ—Ç —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ |
| Prompt injection –∑–∞—â–∏—Ç–∞ (–≤ –ø—Ä–æ–º–ø—Ç–µ) | ‚úÖ | `prompts.py:SYSTEM_PROMPT` | –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø—Ä–æ—Ç–∏–≤ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è –ø—Ä–æ–º–ø—Ç–∞, —Å–º–µ–Ω—ã —Ä–æ–ª–∏ |
| Tool call validation (quantity < 100) | ‚úÖ | `prompts.py` | –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –≤ –ø—Ä–æ–º–ø—Ç–µ + –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ input_schema |
| MAX_TOOL_CALLS_PER_TURN | ‚úÖ | `agent.py` | `MAX_TOOL_CALLS_PER_TURN = 5` ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö loops |
| MAX_HISTORY_MESSAGES | ‚úÖ | `agent.py` | `MAX_HISTORY_MESSAGES = 40` ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ |
| AudioSocket —á–µ—Ä–µ–∑ WireGuard | ‚ö†Ô∏è | `deployment.md` | –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ —Å –ø—Ä–∏–º–µ—Ä–æ–º, –Ω–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è WireGuard –≤–Ω–µ scope –∫–æ–¥–∞ |
| JWT auth –¥–ª—è Admin API | ‚úÖ | `src/api/auth.py` | HS256 JWT, username/password login |
| Bearer token –¥–ª—è Store API | ‚úÖ | `store_client/client.py` | –í headers —Å–µ—Å—Å–∏–∏ |
| API keys –≤ env variables | ‚úÖ | `config.py` | Pydantic Settings, –≤—Å–µ –∫–ª—é—á–∏ –∏–∑ env |

---

## 3.7 –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (Phase 4)

**–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** `doc/development/phase-4-analytics.md`
**–ò—Å—Ç–æ—á–Ω–∏–∫ –∫–æ–¥–∞:** `src/tasks/`, `src/api/`, `src/monitoring/`, `src/agent/`, `grafana/`, `admin-ui/`

### Prometheus –º–µ—Ç—Ä–∏–∫–∏

| –ú–µ—Ç—Ä–∏–∫–∞ (docs) | –°—Ç–∞—Ç—É—Å | –§–∞–π–ª | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|----------------|--------|------|-------------|
| `active_calls` | ‚úÖ | metrics.py:13 | Gauge |
| `call_duration_seconds` | ‚úÖ | metrics.py:18 | Histogram |
| `calls_total` (–ø–æ status) | ‚úÖ | metrics.py:24 | Counter [status] |
| `stt_latency_ms` | ‚úÖ | metrics.py:32 | Histogram |
| `llm_latency_ms` | ‚úÖ | metrics.py:38 | Histogram |
| `tts_latency_ms` | ‚úÖ | metrics.py:44 | Histogram |
| `total_response_latency_ms` | ‚úÖ | metrics.py:50 | Histogram |
| `audiosocket_to_stt_ms` | ‚úÖ | metrics.py:56 | Histogram |
| `tts_delivery_ms` | ‚úÖ | metrics.py:62 | Histogram |
| `tool_call_duration_ms` | ‚úÖ | metrics.py:70 | Histogram [tool_name] |
| `store_api_errors_total` | ‚úÖ | metrics.py:79 | Counter [status_code] |
| `store_api_circuit_breaker_state` | ‚úÖ | metrics.py:85 | Gauge (0/1/2) |
| `transfers_to_operator_total` | ‚úÖ | metrics.py:92 | Counter [reason] |
| `calls_resolved_by_bot_total` | ‚úÖ | metrics.py:100 | Counter |
| `orders_created_total` | ‚úÖ | metrics.py:105 | Counter |
| `fittings_booked_total` | ‚úÖ | metrics.py:110 | Counter |
| `call_cost_usd` | ‚úÖ | metrics.py:115 | Histogram |
| `call_scenario_total` | ‚úÖ | metrics.py:123 | Counter [scenario] |
| `operator_queue_length` | ‚úÖ | metrics.py:131 | Gauge |
| `tts_cache_hits_total` | ‚úÖ | metrics.py:138 | Counter |
| `tts_cache_misses_total` | ‚úÖ | metrics.py:143 | Counter |

### Grafana –¥–∞—à–±–æ—Ä–¥—ã

| –î–∞—à–±–æ—Ä–¥ (docs) | –°—Ç–∞—Ç—É—Å | –§–∞–π–ª | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|----------------|--------|------|-------------|
| Realtime dashboard | ‚úÖ | `grafana/dashboards/realtime.json` | –ú–µ—Ç—Ä–∏–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ |
| Analytics dashboard | ‚úÖ | `grafana/dashboards/analytics.json` | –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ |
| Datasources provisioning | ‚úÖ | `grafana/provisioning/datasources/datasources.yml` | Prometheus + PostgreSQL |
| Dashboard provisioning | ‚úÖ | `grafana/provisioning/dashboards/dashboards.yml` | Auto-load dashboards |

### Quality Evaluation

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å | –§–∞–π–ª | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------------|--------|------|-------------|
| 8 –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –∫–∞—á–µ—Å—Ç–≤–∞ | ‚úÖ | `src/tasks/quality_evaluator.py` | 8 criteria: greeting, understanding, accuracy, completeness, language, tone, efficiency, resolution |
| Claude Haiku –¥–ª—è –æ—Ü–µ–Ω–∫–∏ | ‚úÖ | `src/tasks/quality_evaluator.py` | Celery task, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Haiku –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ü–µ–Ω–∫–∏ |
| –†–µ–∑—É–ª—å—Ç–∞—Ç 0‚Äì1 score | ‚úÖ | `src/tasks/quality_evaluator.py` | –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `calls.quality_score` –∏ `calls.quality_details` |

### A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å | –§–∞–π–ª | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------------|--------|------|-------------|
| A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤ | ‚úÖ | `src/agent/ab_testing.py` | `ABTestManager` —Å Z-test –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–æ–π –∑–Ω–∞—á–∏–º–æ—Å—Ç–∏ |
| –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏—è–º–∏ –ø—Ä–æ–º–ø—Ç–æ–≤ | ‚úÖ | `src/agent/prompt_manager.py` | `PromptManager` —Å PostgreSQL |
| API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞–º–∏ | ‚úÖ | `src/api/prompts.py` | CRUD endpoints –¥–ª—è prompt versions –∏ A/B tests |

### –ê–¥–º–∏–Ω-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å | –§–∞–π–ª | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------------|--------|------|-------------|
| –ñ—É—Ä–Ω–∞–ª –∑–≤–æ–Ω–∫–æ–≤ (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è) | ‚úÖ | `src/api/analytics.py` | `GET /analytics/calls` ‚Äî —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ quality, scenario, transferred, date, search |
| –î–µ—Ç–∞–ª–∏ –∑–≤–æ–Ω–∫–∞ (—Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è, tool calls) | ‚úÖ | `src/api/analytics.py` | `GET /analytics/calls/{call_id}` ‚Äî turns, tool_calls, quality |
| –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞–º–∏ | ‚úÖ | `src/api/prompts.py` | CRUD –¥–ª—è prompt_versions |
| –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ KB | ‚úÖ | `src/api/knowledge.py` | CRUD –¥–ª—è knowledge_articles |
| Admin UI (SPA) | ‚ö†Ô∏è | `admin-ui/index.html` | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è HTML-–æ–±–æ–ª–æ—á–∫–∞ (shell), –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π SPA –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω |

### Cost Optimization

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å | –§–∞–π–ª | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------------|--------|------|-------------|
| Cost tracking (STT + LLM + TTS) | ‚úÖ | `src/monitoring/cost_tracker.py` | `CostBreakdown` —Å pricing –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ |
| Whisper STT (self-hosted) | ‚úÖ | `src/stt/whisper_stt.py` | `WhisperSTTEngine` —Å Faster-Whisper |
| Model routing (Haiku/Sonnet) | ‚úÖ | `src/agent/model_router.py` | –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –ø–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–∞ |
| TTS cache | ‚úÖ | `src/tts/google_tts.py` | In-memory –∫—ç—à –¥–ª—è —á–∞—Å—Ç—ã—Ö —Ñ—Ä–∞–∑ |

### Celery –∑–∞–¥–∞—á–∏

| –ó–∞–¥–∞—á–∞ | –°—Ç–∞—Ç—É—Å | –§–∞–π–ª | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|--------|--------|------|-------------|
| Quality evaluation | ‚úÖ | `src/tasks/quality_evaluator.py` | Celery task —Å Claude Haiku |
| Daily stats aggregation | ‚úÖ | `src/tasks/daily_stats.py` | Celery beat, –µ–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è |

---

## 3.8 Sequence Diagrams

**–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** `doc/technical/sequence-diagrams.md`
**–ò—Å—Ç–æ—á–Ω–∏–∫ –∫–æ–¥–∞:** –≤–µ—Å—å `src/`

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —É–ø–æ–º–∏–Ω–∞–µ—Ç 7 —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤. –§–∞–π–ª `sequence-diagrams.md` —Å–æ–¥–µ—Ä–∂–∏—Ç 6 –¥–∏–∞–≥—Ä–∞–º–º.

| –°—Ü–µ–Ω–∞—Ä–∏–π (docs) | –î–∏–∞–≥—Ä–∞–º–º–∞ | –ö–æ–¥ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|-----------------|-----------|-----|-------------|
| 1. –ü–æ–∏—Å–∫ —à–∏–Ω | ‚úÖ | ‚úÖ `search_tires` –≤ tools.py + client.py | –ü–æ–ª–Ω—ã–π –ø–æ—Ç–æ–∫ AudioSocket‚ÜíSTT‚ÜíLLM‚Üítool‚ÜíTTS |
| 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è | ‚úÖ | ‚úÖ `check_availability` | –ü–æ–∫—Ä—ã—Ç –≤ sequence-diagrams.md |
| 3. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ | ‚úÖ | ‚úÖ `transfer_to_operator` –≤ main.py | –° CallerID —á–µ—Ä–µ–∑ ARI |
| 4. –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ | ‚ö†Ô∏è | ‚úÖ `get_order_status` / `search_orders` | –û—Ç–¥–µ–ª—å–Ω–æ–π –¥–∏–∞–≥—Ä–∞–º–º—ã –Ω–µ—Ç, –Ω–æ –ø–æ–∫—Ä—ã—Ç –≤ –æ–±—â–µ–º –ø–æ—Ç–æ–∫–µ |
| 5. –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ (draft‚Üídelivery‚Üíconfirm) | ‚úÖ | ‚úÖ `create_order_draft` ‚Üí `update_order_delivery` ‚Üí `confirm_order` | –ü–æ–ª–Ω—ã–π —Ç—Ä—ë—Ö—à–∞–≥–æ–≤—ã–π flow |
| 6. –ó–∞–ø–∏—Å—å –Ω–∞ —à–∏–Ω–æ–º–æ–Ω—Ç–∞–∂ | ‚úÖ | ‚úÖ `get_fitting_stations` ‚Üí `get_fitting_slots` ‚Üí `book_fitting` | –ü–æ–ª–Ω—ã–π flow |
| 7. –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è (RAG) | ‚ö†Ô∏è | ‚úÖ `search_knowledge_base` + `src/knowledge/search.py` | –ù–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–π –¥–∏–∞–≥—Ä–∞–º–º—ã –≤ sequence-diagrams.md |

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã –≤ –∫–æ–¥–µ:**
- Barge-in —Å—Ü–µ–Ω–∞—Ä–∏–π (–¥–∏–∞–≥—Ä–∞–º–º–∞ –≤ docs: ‚úÖ, –∫–æ–¥: ‚úÖ `_barge_in_event` –≤ pipeline.py)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (–¥–∏–∞–≥—Ä–∞–º–º–∞ –≤ docs: ‚úÖ, –∫–æ–¥: ‚úÖ try/except –≤ pipeline.py)

---

## 3.9 Deployment –∏ Docker

**–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** `doc/technical/deployment.md`
**–ò—Å—Ç–æ—á–Ω–∏–∫ –∫–æ–¥–∞:** `docker-compose.yml`

### –°–µ—Ä–≤–∏—Å—ã

| –°–µ—Ä–≤–∏—Å (docs) | –°—Ç–∞—Ç—É—Å –≤ docker-compose.yml | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|---------------|----------------------------|-------------|
| call-processor | ‚úÖ | –ü–æ—Ä—Ç—ã 9092 (AudioSocket), 8080 (API) |
| postgres (pgvector:pg16) | ‚úÖ | –° healthcheck |
| redis (7-alpine) | ‚úÖ | –° healthcheck |
| prometheus | ‚úÖ | prom/prometheus:v2.53.0 + alerts.yml |
| grafana | ‚úÖ | grafana/grafana:11.1.0 + provisioning |
| celery-worker | üîÑ **–ù–µ –≤ docs** | –í docker-compose.yml, –Ω–æ –ù–ï –æ–ø–∏—Å–∞–Ω –≤ deployment.md |
| celery-beat | üîÑ **–ù–µ –≤ docs** | –í docker-compose.yml, –Ω–æ –ù–ï –æ–ø–∏—Å–∞–Ω –≤ deployment.md |
| alertmanager | üîÑ **–ù–µ –≤ docs** | –í docker-compose.yml, –Ω–æ –ù–ï –æ–ø–∏—Å–∞–Ω –≤ deployment.md |

### –†–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É docs –∏ —Ä–µ–∞–ª—å–Ω—ã–º docker-compose.yml

| –ê—Å–ø–µ–∫—Ç | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (deployment.md) | –†–µ–∞–ª—å–Ω—ã–π docker-compose.yml |
|--------|-----------------------------|-----------------------------|
| –°–µ—Ä–≤–∏—Å—ã | 5 (call-processor, postgres, redis, prometheus, grafana) | 8 (+celery-worker, celery-beat, alertmanager) |
| Postgres user | `app` | `callcenter` |
| DATABASE_URL | `postgresql://app:secret@postgres:5432/callcenter` | `postgresql+asyncpg://callcenter:...` |
| Prometheus config path | `./monitoring/prometheus.yml` | `./prometheus/prometheus.yml` |
| Grafana dashboards path | `./monitoring/grafana/dashboards` | `./grafana/provisioning`, `./grafana/dashboards` |
| version –∫–ª—é—á | `"3.9"` | –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç (Docker Compose V2) |
| Resource limits | `cpus: "2.0"`, `memory: 4G` | –ù–µ —É–∫–∞–∑–∞–Ω—ã |
| `restart: unless-stopped` | –£–∫–∞–∑–∞–Ω –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ | –ù–µ —É–∫–∞–∑–∞–Ω |
| Redis volumes | `redisdata:/data` | –ù–µ —É–∫–∞–∑–∞–Ω |

### –ü–æ—Ä—Ç—ã

| –ü–æ—Ä—Ç (docs) | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|-------------|--------|-------------|
| 9092 (AudioSocket) | ‚úÖ | –°–æ–≤–ø–∞–¥–∞–µ—Ç |
| 8080 (REST API) | ‚úÖ | –°–æ–≤–ø–∞–¥–∞–µ—Ç |
| 5432 (PostgreSQL) | ‚ö†Ô∏è | Docs: `127.0.0.1:5432:5432`, code: –Ω–µ exposed |
| 6379 (Redis) | ‚ö†Ô∏è | Docs: `127.0.0.1:6379:6379`, code: –Ω–µ exposed |
| 9090 (Prometheus) | ‚úÖ | –°–æ–≤–ø–∞–¥–∞–µ—Ç |
| 3000 (Grafana) | ‚úÖ | –°–æ–≤–ø–∞–¥–∞–µ—Ç |
| 9093 (Alertmanager) | üîÑ | –í –∫–æ–¥–µ –µ—Å—Ç—å, –≤ docs –Ω–µ—Ç |

### Healthchecks

| –°–µ—Ä–≤–∏—Å | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | –ö–æ–¥ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|--------|-------------|-----|-------------|
| Call Processor `GET /health` | ‚úÖ | ‚úÖ | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç Redis, AudioSocket connections |
| Call Processor `GET /health/ready` | ‚ö†Ô∏è –û–ø–∏—Å–∞–Ω | ‚ùå –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω | Docs –æ–ø–∏—Å—ã–≤–∞—é—Ç readiness probe, –≤ –∫–æ–¥–µ —Ç–æ–ª—å–∫–æ `/health` |
| PostgreSQL `pg_isready` | ‚úÖ | ‚úÖ | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω |
| Redis `redis-cli ping` | ‚úÖ | ‚úÖ | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω |

---

## 3.10 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** `doc/development/00-overview.md` (—Å–µ–∫—Ü–∏—è ¬´–°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è¬ª)
**–ò—Å—Ç–æ—á–Ω–∏–∫ –∫–æ–¥–∞:** `tests/`

### Unit-—Ç–µ—Å—Ç—ã

| –ú–æ–¥—É–ª—å (docs) | –°—Ç–∞—Ç—É—Å | –§–∞–π–ª —Ç–µ—Å—Ç–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|---------------|--------|------------|-------------|
| `core/audio_socket.py` ‚Äî –ø–∞—Ä—Å–∏–Ω–≥ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ | ‚úÖ | `tests/unit/test_audio_socket.py` | UUID, audio, hangup –ø–∞–∫–µ—Ç—ã |
| `agent/tools.py` ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ | ‚úÖ | `tests/unit/test_fitting_tools.py`, `test_order_tools.py` | Tool schemas |
| `agent/agent.py` ‚Äî messages, tool_use | ‚úÖ | `tests/unit/test_agent.py` | –° mock Claude |
| `stt/google_stt.py` ‚Äî transcripts, restart | ‚úÖ | `tests/unit/test_stt.py` | –° mock gRPC |
| `tts/google_tts.py` ‚Äî –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è, –∫—ç—à | ‚úÖ | `tests/unit/test_tts.py` | –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ |
| `store_client/client.py` ‚Äî retry, circuit breaker | ‚úÖ | `tests/unit/test_store_client.py` | + `test_store_client_orders.py`, `test_store_client_fitting.py` |
| `call_session.py` ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏—è | ‚úÖ | `tests/unit/test_call_session.py` | State machine transitions |
| PII sanitizer | ‚úÖ | `tests/unit/test_pii_sanitizer.py` | –ú–∞—Å–∫–∏—Ä–æ–≤–∫–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ –∏ –∏–º—ë–Ω |
| CallerID strategy | ‚úÖ | `tests/unit/test_caller_id.py` | –ò–∑ phase-2 docs |
| A/B testing | ‚úÖ | `tests/unit/test_ab_testing.py` | Z-test |
| Quality evaluator | ‚úÖ | `tests/unit/test_quality_evaluator.py` | 8 criteria |
| Alerts | ‚úÖ | `tests/unit/test_alerts.py` | –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª –∞–ª–µ—Ä—Ç–æ–≤ |
| Cost optimization | ‚úÖ | `tests/unit/test_cost_optimization.py` | Model routing, cache |
| Knowledge base | ‚úÖ | `tests/unit/test_knowledge_base.py` | RAG search |

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

| –°—Ü–µ–Ω–∞—Ä–∏–π (docs) | –°—Ç–∞—Ç—É—Å | –§–∞–π–ª | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|-----------------|--------|------|-------------|
| Pipeline (STT‚ÜíLLM‚ÜíTTS) | ‚úÖ | `tests/integration/test_pipeline.py` | –° mock engines |
| Call Processor ‚Üí PostgreSQL | ‚úÖ | `tests/integration/test_postgres.py` | –ó–∞–ø–∏—Å—å –ª–æ–≥–æ–≤ |
| Call Processor ‚Üí Redis | ‚úÖ | `tests/integration/test_redis.py` | –°–µ—Å—Å–∏–∏, TTL |
| Analytics integration | ‚úÖ | `tests/integration/test_analytics.py` | Quality + daily stats |

### Adversarial-—Ç–µ—Å—Ç—ã

| –¢–µ—Å—Ç (docs) | –°—Ç–∞—Ç—É—Å | –§–∞–π–ª | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|-------------|--------|------|-------------|
| Prompt injection: —Å–º–µ–Ω–∞ —Ä–æ–ª–∏ | ‚úÖ | `tests/unit/test_agent.py` | –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ |
| –ê–±—Å—É—Ä–¥–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ | ‚úÖ | `tests/unit/test_adversarial_orders.py` | quantity validation |
| –°–ª–æ–∂–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ | ‚úÖ | `tests/unit/test_complex_scenarios.py` | Multi-tool flows |

### E2E —Ç–µ—Å—Ç—ã

| –°—Ü–µ–Ω–∞—Ä–∏–π (docs) | –°—Ç–∞—Ç—É—Å | –§–∞–π–ª | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|-----------------|--------|------|-------------|
| –ü–æ–¥–±–æ—Ä —à–∏–Ω | ‚úÖ | `tests/e2e/test_tire_search.py` | Flow-—Ç–µ—Å—Ç |
| –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ | ‚úÖ | `tests/e2e/test_orders.py` | –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª |

### –ù–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã

| –°—Ç–∞—Ç—É—Å | –§–∞–π–ª | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|--------|------|-------------|
| ‚úÖ | `tests/load/locustfile.py` | Locust config –¥–ª—è –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è |

### CI/CD Pipeline

| –°—Ç–∞–¥–∏—è (docs) | –°—Ç–∞—Ç—É—Å | –§–∞–π–ª | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|---------------|--------|------|-------------|
| Lint & Type Check (ruff, mypy) | ‚úÖ | `.github/workflows/ci.yml` jobs: lint | `ruff check src/`, `mypy src/ --strict` |
| Unit Tests (pytest + coverage) | ‚úÖ | `.github/workflows/ci.yml` jobs: test | `pytest tests/ --cov=src --cov-report=xml` + Codecov |
| Security Scan (pip-audit, safety) | ‚úÖ | `.github/workflows/ci.yml` jobs: security | `pip-audit --strict`, `safety check` |
| Build Docker Image | ‚úÖ | `.github/workflows/ci.yml` jobs: build | `docker/build-push-action@v5` |
| Deploy to Staging | ‚úÖ | `.github/workflows/ci.yml` jobs: deploy-staging | –ü—Ä–∏ push –≤ main |
| Integration tests –æ—Ç–¥–µ–ª—å–Ω—ã–º job | ‚ö†Ô∏è | ‚Äî | Docs –æ–ø–∏—Å—ã–≤–∞—é—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π —ç—Ç–∞–ø, –≤ CI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –∏–¥—É—Ç –≤–º–µ—Å—Ç–µ —Å unit |
| Deploy to Production | ‚ö†Ô∏è | ‚Äî | Docs –æ–ø–∏—Å—ã–≤–∞—é—Ç deploy –∏–∑ release/* —Å manual approval, –≤ CI –Ω–µ—Ç —ç—Ç–æ–≥–æ job |

**–ö–†-3 –ò–°–ü–†–ê–í–õ–ï–ù–û:** CI/CD pipeline —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∞–¥–∏–∏.

---

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è

| # | –û–ø–∏—Å–∞–Ω–∏–µ | –í–ª–∏—è–Ω–∏–µ | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|---|----------|---------|-------------|
| –ö–†-4 | `cancel_fitting` –∏ `get_fitting_price` –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ `_build_tool_router()` | LLM –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å —ç—Ç–∏ tools, –Ω–æ –ø–æ–ª—É—á–∏—Ç runtime error | –î–æ–±–∞–≤–∏—Ç—å 2 —Å—Ç—Ä–æ–∫–∏ –≤ `_build_tool_router()`: `router.register("cancel_fitting", _store_client.cancel_fitting)` –∏ `router.register("get_fitting_price", _store_client.get_fitting_price)` |
| –ö–†-5 | –ú–∏–≥—Ä–∞—Ü–∏—è 006 –Ω–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ –≤ data-model.md | –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ | –î–æ–±–∞–≤–∏—Ç—å `006_add_prompt_ab_tests.py` –≤ —Å–ø–∏—Å–æ–∫ –º–∏–≥—Ä–∞—Ü–∏–π –≤ data-model.md |

---

## –ù–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è

| # | –û–ø–∏—Å–∞–Ω–∏–µ | –í–ª–∏—è–Ω–∏–µ | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|---|----------|---------|-------------|
| –ù–†-1 | End-to-end –∞–ª–µ—Ä—Ç –ø–æ—Ä–æ–≥: docs = 2500ms, alerts.yml = 3000ms | –ú–µ–Ω–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –∞–ª–µ—Ä—Ç | –ü—Ä–∏–≤–µ—Å—Ç–∏ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ ‚Äî –≤—ã–±—Ä–∞—Ç—å –æ–¥–∏–Ω –ø–æ—Ä–æ–≥ |
| –ù–†-2 | Docker Compose –≤ docs (deployment.md) –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç celery-worker, celery-beat, alertmanager | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–µ–ø–æ–ª–Ω–∞—è | –û–±–Ω–æ–≤–∏—Ç—å deployment.md, –¥–æ–±–∞–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ 3 —Å–µ—Ä–≤–∏—Å–æ–≤ |
| –ù–†-3 | Docker Compose: Postgres user —Ä–∞–∑–ª–∏—á–∞–µ—Ç—Å—è (docs: `app`, code: `callcenter`) | –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –∏–∑ docs –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å | –û–±–Ω–æ–≤–∏—Ç—å docs |
| –ù–†-4 | `GET /health/ready` –æ–ø–∏—Å–∞–Ω –≤ docs, –Ω–æ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ –∫–æ–¥–µ | –ù–µ—Ç readiness probe –¥–ª—è k8s/orchestrator | –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å endpoint –∏–ª–∏ —É–±—Ä–∞—Ç—å –∏–∑ docs |
| –ù–†-5 | Admin UI ‚Äî —Ç–æ–ª—å–∫–æ HTML shell, –±–µ–∑ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ SPA | –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ API | –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π UI |
| –ù–†-6 | –ö–æ–ª–æ–Ω–∫–∞ `quality_details` (JSONB) –≤ —Ç–∞–±–ª–∏—Ü–µ `calls` –Ω–µ –æ—Ç—Ä–∞–∂–µ–Ω–∞ –≤ ERD | –ú–µ–ª–∫–æ–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ ERD | –û–±–Ω–æ–≤–∏—Ç—å ERD –≤ data-model.md |
| –ù–†-7 | Production deploy (release/*) –æ–ø–∏—Å–∞–Ω –≤ docs, –Ω–æ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ CI | –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ production deploy | –î–æ–±–∞–≤–∏—Ç—å job –≤ ci.yml –∏–ª–∏ —É–±—Ä–∞—Ç—å –∏–∑ docs |
| –ù–†-8 | `restart: unless-stopped` –≤ docs, –Ω–æ –Ω–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º docker-compose.yml | –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç—è—Ç—Å—è –ø–æ—Å–ª–µ —Å–±–æ—è | –î–æ–±–∞–≤–∏—Ç—å restart policy –≤ docker-compose.yml |
| –ù–†-9 | Resource limits (CPU/RAM) –≤ docs, –Ω–æ –Ω–µ –≤ docker-compose.yml | –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–∏—Ç—å –≤—Å–µ —Ä–µ—Å—É—Ä—Å—ã —Ö–æ—Å—Ç–∞ | –î–æ–±–∞–≤–∏—Ç—å deploy.resources.limits |
| –ù–†-10 | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞—Ä—à–µ 90 –¥–Ω–µ–π (retention) –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ | –î–∞–Ω–Ω—ã–µ –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ | –°–æ–∑–¥–∞—Ç—å Celery task –∏–ª–∏ cron –¥–ª—è `DROP PARTITION` |
| –ù–†-11 | Prometheus config path: docs `./monitoring/prometheus.yml`, code `./prometheus/prometheus.yml` | –ú–µ–ª–∫–æ–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ | –û–±–Ω–æ–≤–∏—Ç—å docs |

---

## –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–æ–ø–∏—Å–∞–Ω—ã –≤ docs, –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã)

| # | –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|---|-----------|-------------|-------------|
| 1 | `GET /health/ready` endpoint | deployment.md | Readiness probe —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π STT/Claude |
| 2 | Data retention automation | data-policy.md | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –ø–∞—Ä—Ç–∏—Ü–∏–π —Å—Ç–∞—Ä—à–µ 90 –¥–Ω–µ–π |
| 3 | Production deploy job | 00-overview.md CI/CD | `release/*` ‚Üí production —Å manual approval |
| 4 | Asterisk AMI exporter | nfr.md | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞–Ω–∞–ª–æ–≤ Asterisk |
| 5 | PII masking –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ LLM | data-policy.md (Phase 2) | –ó–∞–º–µ–Ω–∞ –∏–º—ë–Ω/–∞–¥—Ä–µ—Å–æ–≤ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞–º–∏ |

---

## –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã, –Ω–æ –Ω–µ –æ–ø–∏—Å–∞–Ω—ã –≤ docs)

| # | –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –§–∞–π–ª | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|---|-----------|------|-------------|
| 1 | –ú–∏–≥—Ä–∞—Ü–∏—è 006 (`prompt_ab_tests`) | `migrations/versions/006_add_prompt_ab_tests.py` | –¢–∞–±–ª–∏—Ü—ã –æ–ø–∏—Å–∞–Ω—ã –≤ ERD, –Ω–æ –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∞ |
| 2 | Celery-worker/beat –≤ docker-compose | `docker-compose.yml` | –°–µ—Ä–≤–∏—Å—ã –Ω–µ –æ–ø–∏—Å–∞–Ω—ã –≤ deployment.md |
| 3 | Alertmanager –≤ docker-compose | `docker-compose.yml` | –°–µ—Ä–≤–∏—Å –Ω–µ –æ–ø–∏—Å–∞–Ω –≤ deployment.md |
| 4 | `StoreClient.get_tire()` | `store_client/client.py` | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥, –Ω–µ —Å–≤—è–∑–∞–Ω —Å tool |
| 5 | `StoreClient.get_pickup_points()` | `store_client/client.py` | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥, –Ω–µ —Å–≤—è–∑–∞–Ω —Å tool |
| 6 | `StoreClient.calculate_delivery()` | `store_client/client.py` | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥, –Ω–µ —Å–≤—è–∑–∞–Ω —Å tool |
| 7 | `tts_cache_hits_total`, `tts_cache_misses_total` | `metrics.py` | –ú–µ—Ç—Ä–∏–∫–∏ –∫—ç—à–∞ TTS ‚Äî –ø–æ–ª–µ–∑–Ω—ã–µ, –Ω–æ –Ω–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ nfr.md |

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 ‚Äî –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ (–±–ª–æ–∫–∏—Ä—É—é—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª)

1. **–ö–†-4: –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å `cancel_fitting` –∏ `get_fitting_price` –≤ tool router.**

   –§–∞–π–ª: `src/main.py`, —Ñ—É–Ω–∫—Ü–∏—è `_build_tool_router()`.

   –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–¥ —Å—Ç—Ä–æ–∫–æ–π `router.register("search_knowledge_base", ...)`:
   ```python
   router.register("cancel_fitting", _store_client.cancel_fitting)
   router.register("get_fitting_price", _store_client.get_fitting_price)
   ```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 ‚Äî –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (–Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏)

2. **–ö–†-5: –î–æ–±–∞–≤–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é 006 –≤ `doc/technical/data-model.md`.**

   –í —Å–µ–∫—Ü–∏–∏ ¬´–ú–∏–≥—Ä–∞—Ü–∏–∏¬ª –¥–æ–±–∞–≤–∏—Ç—å:
   ```
   006_add_prompt_ab_tests.py
   ```

3. **–ù–†-2: –û–±–Ω–æ–≤–∏—Ç—å `doc/technical/deployment.md`.**

   –î–æ–±–∞–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤ celery-worker, celery-beat, alertmanager –≤ Docker Compose —Å–µ–∫—Ü–∏—é.

4. **–ù–†-3: –ò—Å–ø—Ä–∞–≤–∏—Ç—å Postgres user –≤ deployment.md** —Å `app` –Ω–∞ `callcenter`, DATABASE_URL –Ω–∞ `postgresql+asyncpg://`.

5. **–ù–†-11: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—É—Ç—å –∫ Prometheus config** –≤ deployment.md —Å `./monitoring/` –Ω–∞ `./prometheus/`.

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 ‚Äî –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (—É–ª—É—á—à–µ–Ω–∏—è)

6. **–ù–†-4: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `GET /health/ready`** –∏–ª–∏ —É–±—Ä–∞—Ç—å –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

7. **–ù–†-8/–ù–†-9: –î–æ–±–∞–≤–∏—Ç—å `restart: unless-stopped` –∏ resource limits** –≤ docker-compose.yml.

8. **–ù–†-10: –°–æ–∑–¥–∞—Ç—å Celery task –¥–ª—è data retention** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –ø–∞—Ä—Ç–∏—Ü–∏–π —Å—Ç–∞—Ä—à–µ 90 –¥–Ω–µ–π.

9. **–ù–†-1: –ü—Ä–∏–≤–µ—Å—Ç–∏ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ—Ä–æ–≥ –∞–ª–µ—Ä—Ç–∞** end-to-end latency (2500ms vs 3000ms).

10. **–ù–†-7: –î–æ–±–∞–≤–∏—Ç—å production deploy job** –≤ `.github/workflows/ci.yml` –¥–ª—è –≤–µ—Ç–∫–∏ `release/*`.

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –∑—Ä–µ–ª—É—é –∫–æ–¥–æ–≤—É—é –±–∞–∑—É, –ø–æ–∫—Ä—ã–≤–∞—é—â—É—é –≤—Å–µ 4 —Ñ–∞–∑—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∞—É–¥–∏—Ç–∞ (–ö–†-1, –ö–†-2, –ö–†-3, –ù–†-7, –ù–†-8) —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã.

–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ 2 –Ω–æ–≤—ã—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è (–ö–†-4: –Ω–µ–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ tools, –ö–†-5: –Ω–µ–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è) –∏ 11 –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π, –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –Ω–µ–ø–æ–ª–Ω—ã–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (Celery, Alertmanager, –º–∏–≥—Ä–∞—Ü–∏—è 006).

–û—Å–Ω–æ–≤–Ω–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ø—Ä–∏–≤–µ—Å—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é deployment.md –∏ data-model.md –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å —Ç–µ–∫—É—â–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∫–æ–¥–∞, –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å 2 –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö tool handler-–∞ –≤ main.py.
