# Фаза 4: Админ-интерфейс

## Статус
- [ ] Не начата
- [ ] В процессе
- [ ] Завершена

**Начата:** -
**Завершена:** -

## Цель фазы

Создать веб-интерфейс администратора: журнал звонков с поиском, детали звонка (транскрипция, метрики), управление промптами, CRUD базы знаний, настройки системы.

## Задачи

### 4.0 ОБЯЗАТЕЛЬНО: Анализ и планирование

#### A. Анализ существующего кода
- [ ] Проверить существующие API endpoints (FastAPI)
- [ ] Изучить требования к админке из `doc/development/phase-4-analytics.md`
- [ ] Определить стек фронтенда (React или Vue)

**Команды для поиска:**
```bash
grep -rn "app\.\|router\.\|APIRouter" src/api/
ls src/api/
```

#### B. Анализ зависимостей
- [ ] FastAPI backend уже есть
- [ ] Нужен фронтенд (React/Vue)
- [ ] JWT аутентификация для admin API
- [ ] Встроенный Grafana iframe для дашборда

**Новые абстракции:** Нет
**Новые env variables:** `ADMIN_JWT_SECRET`, `ADMIN_USERNAME`, `ADMIN_PASSWORD`
**Новые tools:** Нет
**Миграции БД:** Нет (данные уже в существующих таблицах)

**Референс-модуль:** `doc/development/phase-4-analytics.md` — секция 4.6

**Цель:** Определить функционал и архитектуру админки.

**Заметки для переиспользования:** -

---

### 4.1 Backend API для админки

- [ ] `GET /analytics/calls` — список звонков с фильтрами (дата, сценарий, quality, transferred)
- [ ] `GET /analytics/calls/{id}` — полная информация: транскрипция, tool calls, метрики, quality
- [ ] `GET /analytics/summary` — агрегированная статистика (period: day/week/month)
- [ ] JWT аутентификация: `POST /auth/login` → token
- [ ] Middleware: проверка JWT для admin endpoints

**Файлы:** `src/api/routes.py`, `src/api/auth.py`
**Заметки:** -

---

### 4.2 Журнал звонков

- [ ] Список звонков с пагинацией
- [ ] Фильтры: дата, сценарий, переключён на оператора, quality_score
- [ ] Поиск по транскрипции (full-text search)
- [ ] Сортировка: по дате, по качеству, по стоимости
- [ ] Цветовая индикация: зелёный (quality > 0.8), жёлтый (0.5-0.8), красный (< 0.5)

**Файлы:** Frontend component
**Заметки:** -

---

### 4.3 Детали звонка

- [ ] Полная транскрипция (speaker, text, timestamp)
- [ ] Tool calls с аргументами и результатами
- [ ] Метрики задержек (STT, LLM, TTS per turn)
- [ ] Оценка качества по критериям
- [ ] Стоимость звонка (breakdown: STT, LLM, TTS)
- [ ] Информация о клиенте (phone, name, previous calls)

**Файлы:** Frontend component
**Заметки:** -

---

### 4.4 Управление промптами (UI)

- [ ] Список версий промптов
- [ ] Создание новой версии (текстовый редактор)
- [ ] Активация/деактивация версии
- [ ] Создание A/B теста (выбор двух вариантов)
- [ ] Просмотр результатов A/B теста

**Файлы:** Frontend component
**Заметки:** -

---

### 4.5 CRUD базы знаний

- [ ] Список статей с фильтрами по категории
- [ ] Создание/редактирование статьи (markdown editor)
- [ ] Удаление/архивация статей
- [ ] Автоматическая перегенерация embeddings при изменении

**Файлы:** Frontend component, `src/api/routes.py` (CRUD endpoints)
**Заметки:** -

---

### 4.6 Настройки системы

- [ ] Рабочие часы бота (расписание)
- [ ] Лимит суммы заказа через бота
- [ ] Таймауты (тишина, максимальная длительность)
- [ ] Список операторов и их статус
- [ ] Встроенный Grafana iframe для real-time дашборда

**Файлы:** Frontend component
**Заметки:** -

---

## При завершении фазы

1. Убедись, что все задачи отмечены [x]
2. Измени статус фазы: [x] Завершена
3. Заполни дату "Завершена: YYYY-MM-DD"
4. Выполни коммит:
   ```bash
   git add .
   git commit -m "checklist(phase-4-analytics): phase-4 admin UI completed"
   ```
5. Обнови PROGRESS.md
6. Открой следующую фазу: `phase-05-cost-optimization.md`
