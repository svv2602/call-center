# Call Center AI — Обзор проекта

## Цель

Автоматизация обработки входящих телефонных звонков интернет-магазина шин (Украина) с помощью ИИ-агента. Агент ведёт диалог на украинском языке, понимает запросы клиентов, работает с каталогом товаров и оформляет заказы.

## Объём звонков

200–500 звонков в день (начальный этап).

## Сценарии обработки звонков

| # | Сценарий | Фаза |
|---|----------|------|
| 1 | Подбор шин по автомобилю / размеру / сезону | MVP |
| 2 | Проверка наличия товара | MVP |
| 3 | Переключение на живого оператора | MVP |
| 4 | Статус заказа | Фаза 2 |
| 5 | Оформление заказа | Фаза 2 |
| 6 | Запись на шиномонтаж | Фаза 3 |
| 7 | Консультация (подбор, сравнение, рекомендации) | Фаза 3 |

## Архитектура

```
                          ┌─────────────────────────────────────────┐
                          │            Call Processor (Python)       │
                          │                                         │
┌───────────┐  AudioSocket│  ┌─────────┐  ┌───────┐  ┌─────────┐  │  ┌──────────────┐
│           │◄────────────┼─►│ STT     │─►│ LLM   │─►│ TTS     │  │  │ Store API    │
│ Asterisk  │  TCP/16kHz  │  │ Engine  │  │ Agent │  │ Engine  │  │  │ (REST/JSON)  │
│ PBX v20   │  PCM audio  │  └─────────┘  └───┬───┘  └─────────┘  │  │              │
│           │             │                    │ tool calls         │  │ - каталог    │
└───────────┘             │                    ▼                   │  │ - заказы     │
      ▲                   │  ┌─────────────────────────────────┐   │  │ - наличие    │
      │ SIP               │  │ Tools (functions)               │   │  │ - клиенты    │
      │                   │  │ - search_tires()                │───┼─►│ - монтаж     │
┌─────┴─────┐             │  │ - check_availability()          │   │  └──────────────┘
│ SIP       │             │  │ - get_order_status()            │   │
│ Provider  │             │  │ - create_order()                │   │  ┌──────────────┐
│ (trunk)   │             │  │ - book_fitting()                │───┼─►│ PostgreSQL   │
└───────────┘             │  │ - transfer_to_operator()        │   │  │ (logs, calls │
                          │  └─────────────────────────────────┘   │  │  sessions)   │
                          └─────────────────────────────────────────┘  └──────────────┘
```

## Стек технологий

| Компонент | Технология | Обоснование |
|-----------|------------|-------------|
| **Язык** | Python 3.12+ | Лучшая экосистема для AI, async, интеграции с Asterisk |
| **Async framework** | asyncio + FastAPI | Обработка аудио-потоков и REST API для мониторинга |
| **Телефония** | Asterisk 20 + AudioSocket | Уже есть, AudioSocket — лучший способ для real-time аудио |
| **STT** | Google Cloud Speech-to-Text v2 | Streaming, отличное качество украинского, низкая задержка |
| **LLM** | Claude (Anthropic) | Отличное понимание украинского, tool calling, большой контекст |
| **TTS** | Google Cloud TTS (Neural2) | Качественные украинские голоса, низкая задержка |
| **База данных** | PostgreSQL | Логирование звонков, сессии, аналитика |
| **Очередь задач** | Redis + Celery | Фоновые задачи (отчёты, нотификации) |
| **Мониторинг** | Prometheus + Grafana | Метрики звонков, задержки, качество |

## Поток обработки звонка

```
1. Входящий звонок → Asterisk принимает
2. Dialplan → AudioSocket(host:port)
3. TCP-соединение → Call Processor получает аудио-поток (16kHz PCM)
4. Аудио → Google STT (streaming) → текст
5. Текст → LLM Agent (с историей диалога)
6. LLM решает:
   a) Ответить текстом → TTS → аудио → Asterisk → клиент
   b) Вызвать tool → получить данные → сформировать ответ → TTS
   c) Переключить на оператора → Asterisk transfer
7. Цикл повторяется до завершения звонка
8. После звонка: сохранить лог, транскрипцию, метрики
```

## Структура проекта

```
call_center/
├── doc/                     # Документация и планы
├── src/
│   ├── core/                # Ядро обработки звонков
│   │   ├── audio_socket.py  # AudioSocket сервер
│   │   ├── call_session.py  # Управление сессией звонка
│   │   └── pipeline.py      # STT → LLM → TTS pipeline
│   ├── stt/                 # Speech-to-Text модуль
│   │   ├── base.py          # Абстрактный интерфейс
│   │   └── google_stt.py    # Google Cloud STT реализация
│   ├── tts/                 # Text-to-Speech модуль
│   │   ├── base.py          # Абстрактный интерфейс
│   │   └── google_tts.py    # Google Cloud TTS реализация
│   ├── agent/               # LLM агент
│   │   ├── agent.py         # Основная логика агента
│   │   ├── prompts.py       # Системные промпты
│   │   └── tools.py         # Tool definitions для LLM
│   ├── api/                 # REST API (мониторинг, админка)
│   │   └── routes.py
│   ├── store_client/        # Клиент API магазина
│   │   └── client.py
│   └── config.py            # Конфигурация
├── asterisk/                # Конфигурация Asterisk
│   └── extensions.conf      # Dialplan
├── tests/
├── docker-compose.yml
├── pyproject.toml
└── README.md
```

## Фазы разработки

| Фаза | Название | Документ |
|------|----------|----------|
| 1 | MVP — подбор шин и наличие | [phase-1-mvp.md](./phase-1-mvp.md) |
| 2 | Заказы — статус и оформление | [phase-2-orders.md](./phase-2-orders.md) |
| 3 | Сервисы — шиномонтаж и консультации | [phase-3-services.md](./phase-3-services.md) |
| 4 | Аналитика и оптимизация | [phase-4-analytics.md](./phase-4-analytics.md) |

Детальное описание API магазина: [api-specification.md](./api-specification.md)
