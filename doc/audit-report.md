# Аудит-отчет по проекту "Call Center AI"

> **Статус:** Исторический документ (первоначальный аудит).
> Рекомендации из этого отчёта были реализованы и интегрированы в актуальную документацию.
> См. актуальное состояние: `security/threat-model.md`, `development/00-overview.md`, `technical/nfr.md`.

## 1. Общее впечатление

Проектная документация находится на высоком уровне. Она подробно описывает бизнес-цели, техническую архитектуру, модель безопасности и этапы разработки. Проект имеет четкие цели, сильное экономическое обоснование и хорошо продуманную архитектуру.

Данный отчет содержит рекомендации, направленные на дальнейшее улучшение проекта в области безопасности, архитектуры и процессов разработки.

## 2. Рекомендации по безопасности

Модель угроз (STRIDE) является хорошей основой, однако ее можно дополнить следующими пунктами:

### 2.1. Управление API-ключами и секретами
- **Проблема:** В документации упоминается хранение ключей в переменных окружения, что является хорошей практикой. Однако отсутствует план по их ротации.
- **Рекомендация:** Внедрить политику регулярной ротации API-ключей (например, каждые 90 дней). Рассмотреть использование централизованного хранилища секретов, такого как HashiCorp Vault или AWS Secrets Manager, для упрощения управления и ротации.

### 2.2. Мониторинг и защита от Prompt Injection
- **Проблема:** Защита от prompt injection хорошо продумана на уровне промпта и кода, но не включает в себя активный мониторинг.
- **Рекомендация:** Добавить в систему мониторинга (Prometheus/Grafana) дашборд для отслеживания аномальных запросов и паттернов, которые могут свидетельствовать о попытках prompt injection. Настроить алерты на срабатывание таких паттернов.

### 2.3. Безопасность зависимостей
- **Проблема:** В документации не упоминается сканирование зависимостей на наличие уязвимостей.
- **Рекомендация:** Интегрировать в CI/CD пайплайн инструменты для сканирования зависимостей, такие как `pip-audit` или `Snyk`. Это позволит автоматически выявлять и блокировать использование уязвимых библиотек.

### 2.4. Защита персональных данных (PII)
- **Проблема:** Упоминается маскирование PII в логах, но без конкретики.
- **Рекомендация:** Четко определить список PII (номер телефона, ФИО, адрес) и внедрить на уровне логгера механизм автоматического маскирования этих данных перед записью в PostgreSQL. Например, заменять часть номера телефона на `****`.

## 3. Рекомендации по архитектуре

Архитектура является гибкой и масштабируемой. Следующие рекомендации могут ее улучшить:

### 3.1. Уменьшение зависимости от вендоров
- **Проблема:** Проект сильно зависит от проприетарных API (Google, Claude). План по замене STT на Whisper является отличным шагом.
- **Рекомендация:** Рассмотреть open-source альтернативы и для TTS. Например, `Coqui-TTS` или `Piper`. Это позволит в будущем еще больше сократить расходы и зависимость от одного вендора.

### 3.2. Управление состоянием сессий
- **Проблема:** Управление состоянием сессий в Redis — это хорошее решение для масштабирования, но стоит предусмотреть механизм очистки.
- **Рекомендация:** Внедрить для ключей сессий в Redis механизм TTL (Time-To-Live), чтобы автоматически удалять устаревшие сессии. Это предотвратит утечки памяти и неконтролируемый рост базы данных Redis.

### 3.3. Отказоустойчивость Store Client
- **Проблема:** Упоминается Circuit Breaker, но без деталей реализации.
- **Рекомендация:** Использовать готовую и проверенную библиотеку, например `circuitbreaker-python`, для реализации паттерна Circuit Breaker. Это обеспечит корректную обработку сбоев в Store API и предотвратит каскадные отказы.

## 4. Рекомендации по процессу разработки

### 4.1. Стратегия тестирования
- **Проблема:** В документации отсутствует раздел, посвященный стратегии тестирования.
- **Рекомендация:** Добавить в `development/00-overview.md` раздел "Стратегия тестирования", описывающий подходы к:
    - **Unit-тестированию:** Покрытие ключевых модулей (пайплайн, обработка аудио, клиенты API).
    - **Интеграционному тестированию:** Тестирование взаимодействия `Call Processor` с `Asterisk`, `PostgreSQL` и внешними API (с использованием моков).
    - **End-to-end (E2E) тестированию:** Автоматизированные тестовые звонки, проверяющие весь сценарий от начала до конца.

### 4.2. CI/CD (Непрерывная интеграция и доставка)
- **Проблема:** Процессы CI/CD не упоминаются.
- **Рекомендация:** Настроить CI/CD пайплайн (например, с помощью GitHub Actions или GitLab CI), который будет автоматически:
    1. Запускать линтеры и статические анализаторы (`ruff`, `mypy`).
    2. Запускать все виды тестов.
    3. Сканировать зависимости на уязвимости.
    4. Собирать Docker-образ.
    5. Развертывать приложение в staging-окружении для тестирования.

## 5. Заключение

Проект "Call Center AI" обладает высоким потенциалом и хорошо продуманной основой. Реализация предложенных рекомендаций поможет повысить уровень безопасности, отказоустойчивости и эффективности процесса разработки, что в конечном итоге приведет к созданию более надежного и качественного продукта.
