(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function o(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(i){if(i.ep)return;i.ep=!0;const r=o(i);fetch(i.href,r)}})();const hn={success:4e3,info:5e3,warning:6e3,error:8e3},Qo=5,bn={success:"bg-emerald-600",info:"bg-blue-600",warning:"bg-amber-500",error:"bg-red-600"};function c(s,n="success"){const o=document.getElementById("toastContainer");if(!o)return;for(;o.children.length>=Qo;)o.firstChild.remove();const a=document.createElement("div"),i=bn[n]||bn.success;a.className=`toast px-4 py-2.5 rounded-lg text-sm text-white shadow-lg ${i} flex items-center gap-2`;const r=document.createElement("span");r.className="flex-1",r.textContent=s,a.appendChild(r);const l=document.createElement("button");l.className="ml-1 opacity-70 hover:opacity-100 focus:opacity-100 text-white font-bold leading-none cursor-pointer",l.setAttribute("aria-label","Close"),l.textContent="×",l.onclick=()=>vn(a),a.appendChild(l),o.appendChild(a);const p=hn[n]||hn.success;setTimeout(()=>vn(a),p)}function vn(s){s.parentNode&&(s.classList.add("toast-exit"),s.addEventListener("animationend",()=>s.remove(),{once:!0}),setTimeout(()=>s.remove(),400))}const Yo={"common.retry":"Повторить","common.save":"Сохранить","common.cancel":"Отмена","common.close":"Закрыть","common.add":"Добавить","common.create":"Создать","common.edit":"Редактировать","common.delete":"Удалить","common.filter":"Фильтровать","common.yes":"Да","common.no":"Нет","common.loading":"Загрузка...","common.failedToLoad":"Ошибка загрузки: {error}","common.activate":"Активировать","common.deactivate":"Деактивировать","common.select":"Выбрать","common.pageInfo":"Стр. {current} из {total}","common.all":"Все","common.allStatuses":"Все статусы","common.searchPlaceholder":"Поиск...","common.showing":"Показано: {shown} из {total}","common.filters":"Фильтры","common.actions":"Действия","common.seconds":"сек","common.skipToContent":"Перейти к содержимому","common.lastUpdated":"Обновлено:","common.unsavedChanges":"У вас есть несохранённые изменения. Покинуть страницу?","common.filtersActive":"{count} фильтр(ов) активно","common.resetFilters":"Сбросить фильтры","common.offline":"Нет подключения к сети","common.backOnline":"Подключение восстановлено","auth.sessionExpiringSoon":"Сессия скоро истечёт. Сохраните свою работу.","nav.ariaMainNav":"Главная навигация","nav.ariaExpandSidebar":"Развернуть/Свернуть боковую панель","nav.ariaToggleTheme":"Переключить тему","nav.ariaToggleLang":"Переключить язык","nav.ariaLogout":"Выйти из системы","nav.ariaWsStatus":"Статус подключения","nav.ariaOpenMenu":"Открыть меню","login.title":"Call Center AI","login.error":"Неверные учётные данные","login.username":"Имя пользователя","login.password":"Пароль","login.submit":"Войти","nav.dashboard":"Дашборд","nav.calls":"Журнал звонков","nav.training":"Обучение агента","nav.operators":"Операторы","nav.system":"Система","nav.users":"Пользователи","nav.prompts":"Промпты","nav.knowledge":"База знаний","nav.scenarios":"Сценарии","nav.tools":"Инструменты","nav.monitoring":"Мониторинг","nav.configuration":"Конфигурация","nav.tenants":"Сети","nav.notifications":"Уведомления","nav.audit":"Аудит","nav.logout":"Выход","theme.dark":"Тёмная","theme.light":"Светлая","ws.live":"Онлайн","ws.reconnecting":"Переподключение...","ws.offline":"Оффлайн","api.sessionExpired":"Сессия истекла. Пожалуйста, войдите снова.","api.unauthorized":"Не авторизован","api.requestTimeout":"Превышено время ожидания ответа сервера","api.networkError":"Нет соединения с сервером. Проверьте подключение.","api.badRequest":"Некорректный запрос","api.noAccess":"Нет доступа","api.notFound":"Не найдено","api.conflict":"Конфликт данных","api.validationError":"Ошибка валидации","api.tooManyRequests":"Слишком много запросов. Попробуйте позже.","api.serverError":"Серверная ошибка. Попробуйте позже.","dashboard.breadcrumb":"Дашборд","dashboard.title":"Дашборд","dashboard.calls":"Звонков","dashboard.callsToday":"Звонков сегодня","dashboard.resolvedByBot":"Решено ботом","dashboard.transferred":"Переведено","dashboard.avgQuality":"Средн. качество","dashboard.cost":"Стоимость","dashboard.costToday":"Стоимость сегодня","dashboard.periodToday":"Сегодня","dashboard.period7d":"7 дней","dashboard.period30d":"30 дней","dashboard.periodAll":"Всё время","dashboard.period":"Период:","dashboard.exportCSV":"Экспорт CSV","dashboard.downloadPDF":"Скачать PDF","dashboard.grafana":"Grafana в реальном времени","dashboard.csvExported":"CSV экспортирован","dashboard.exportFailed":"Ошибка экспорта: {error}","dashboard.pdfDownloaded":"PDF-отчёт скачан","dashboard.pdfFailed":"Ошибка скачивания PDF: {error}","dashboard.failedToLoad":"Не удалось загрузить дашборд: {error}","dashboard.filterByNetwork":"Сеть:","dashboard.allNetworks":"Все сети","dashboard.noAnalyticsAccess":"У вас нет доступа к аналитике. Перейдите в доступный раздел через меню навигации.","calls.breadcrumb":"Журнал звонков","calls.title":"Журнал звонков","calls.allScenarios":"Все сценарии","calls.tireSearch":"Поиск шин","calls.availability":"Наличие","calls.order":"Заказ","calls.fitting":"Шиномонтаж","calls.consultation":"Консультация","calls.all":"Все","calls.transferred":"Переведено","calls.resolvedByBot":"Решено ботом","calls.searchPlaceholder":"Поиск в транскрипции...","calls.qualityBelow":"Качество ниже","calls.exportCSV":"Экспорт CSV","calls.csvExported":"CSV экспортирован","calls.exportFailed":"Ошибка экспорта: {error}","calls.noCalls":"Звонки не найдены","calls.failedToLoad":"Не удалось загрузить звонки: {error}","calls.date":"Дата","calls.caller":"Звонящий","calls.scenario":"Сценарий","calls.duration":"Длительность","calls.quality":"Качество","calls.cost":"Стоимость","calls.status":"Статус","calls.statusTransferred":"Переведён","calls.statusResolved":"Решён","calls.detailTitle":"Детали звонка","calls.detailCaller":"Звонящий:","calls.detailScenario":"Сценарий:","calls.detailDuration":"Длительность:","calls.detailQuality":"Качество:","calls.detailCost":"Стоимость:","calls.detailPrompt":"Промпт:","calls.qualityBreakdown":"Разбивка качества","calls.transcription":"Транскрипция","calls.noTranscription":"Транскрипция недоступна","calls.customer":"Клиент","calls.bot":"Бот","calls.toolCalls":"Вызовы инструментов","calls.toolName":"Инструмент","calls.toolSuccess":"Успех","calls.toolDuration":"Длительность","calls.toolArgs":"Аргументы запроса","calls.toolResult":"Результат от 1С / API","calls.downloadTranscript":"Скачать расшифровку","calls.transcriptDownloaded":"Расшифровка скачана","calls.transcriptFailed":"Ошибка скачивания: {error}","calls.failedToLoadDetail":"Не удалось загрузить детали звонка: {error}","calls.openInSandbox":"Открыть в песочнице","calls.importingToSandbox":"Импорт...","calls.importedToSandbox":"Звонок импортирован в песочницу","calls.importFailed":"Ошибка импорта: {error}","calls.costBreakdownTitle":"Разбивка стоимости","calls.sttCost":"STT стоимость","calls.llmCost":"LLM стоимость","calls.ttsCost":"TTS стоимость","calls.totalCost":"Итого","calls.llmModel":"LLM модель","calls.llmInputTokens":"Входные токены","calls.llmOutputTokens":"Выходные токены","calls.llmInputPrice":"Цена входных (за 1M)","calls.llmOutputPrice":"Цена выходных (за 1M)","calls.sttProvider":"STT провайдер","calls.sttSeconds":"STT длительность (сек)","calls.ttsCharacters":"TTS символов","prompts.breadcrumb":"Промпты","prompts.title":"Управление промптами","prompts.versions":"Версии","prompts.abTests":"A/B-тесты","prompts.newVersion":"+ Новая версия","prompts.noVersions":"Версии промптов не найдены","prompts.name":"Название","prompts.active":"Активный","prompts.activeLabel":"Активен","prompts.created":"Создан","prompts.action":"Действие","prompts.activateBtn":"Активировать","prompts.failedToLoad":"Не удалось загрузить промпты: {error}","prompts.createTitle":"Создание новой версии промпта","prompts.nameLabel":"Название","prompts.namePlaceholder":"напр. v2.0-improved-search","prompts.systemPromptLabel":"Системный промпт","prompts.systemPromptPlaceholder":"Введите текст системного промпта...","prompts.nameRequired":"Название и системный промпт обязательны","prompts.created_toast":"Версия промпта создана","prompts.createFailed":"Не удалось создать промпт: {error}","prompts.activateConfirm":"Активировать эту версию промпта? Все звонки будут использовать её.","prompts.activated":"Версия промпта активирована","prompts.activateFailed":"Не удалось активировать промпт: {error}","prompts.noABTests":"A/B-тесты не найдены","prompts.testName":"Тест","prompts.variantA":"Вариант A","prompts.variantB":"Вариант B","prompts.callsAB":"Звонки A/B","prompts.qualityAB":"Качество A/B","prompts.abStatus":"Статус","prompts.abAction":"Действие","prompts.stopBtn":"Остановить","prompts.stopConfirm":"Остановить этот A/B-тест?","prompts.stopped":"A/B-тест остановлен","prompts.stopFailed":"Не удалось остановить тест: {error}","prompts.failedToLoadAB":"Не удалось загрузить A/B-тесты: {error}","prompts.newABTest":"+ Новый A/B-тест","prompts.createABTestTitle":"Создание A/B-теста","prompts.testNameLabel":"Название теста","prompts.testNameRequired":"Название теста обязательно","prompts.variantALabel":"Вариант A","prompts.variantBLabel":"Вариант B","prompts.trafficSplitLabel":"Разделение трафика (% вариант A)","prompts.variantsRequired":"Выберите оба варианта","prompts.variantsMustDiffer":"Варианты A и B должны различаться","prompts.abTestCreated":"A/B-тест создан","prompts.abTestCreateFailed":"Не удалось создать A/B-тест: {error}","prompts.deleteABTestConfirm":"Удалить A/B-тест «{name}»?","prompts.abTestDeleted":"A/B-тест удалён","prompts.abTestDeleteFailed":"Не удалось удалить A/B-тест: {error}","prompts.recommended":"Рекомендован: {variant}","prompts.noSignificance":"Нет значимой разницы","prompts.notEnoughData":"Мало данных","prompts.stoppedWithResult":"Тест остановлен. {result}","prompts.abReportTitle":"Отчёт A/B-теста","prompts.reportSummary":"Сводка","prompts.reportCriteria":"По критериям","prompts.reportScenarios":"По сценариям","prompts.reportDaily":"Динамика по дням","prompts.reportCalls":"Звонки","prompts.reportQuality":"Качество","prompts.reportAvgDuration":"Средн. длительность","prompts.reportTransferRate":"Перевод на оператора","prompts.reportCriterion":"Критерий","prompts.reportDelta":"Дельта","prompts.reportScenario":"Сценарий","prompts.exportCSV":"Экспорт CSV","prompts.csvExported":"CSV экспортирован","prompts.exportFailed":"Ошибка экспорта: {error}","prompts.reportFailedToLoad":"Не удалось загрузить отчёт: {error}","prompts.reportNoData":"Нет данных для отчёта","prompts.criterionGreeting":"Приветствие","prompts.criterionIntent":"Понимание намерения","prompts.criterionToolUsage":"Использование инструментов","prompts.criterionAccuracy":"Точность информации","prompts.criterionConfirmation":"Подтверждение действий","prompts.criterionConciseness":"Лаконичность","prompts.criterionResolution":"Решение без оператора","prompts.criterionSatisfaction":"Удовлетворённость клиента","prompts.viewTitle":"Просмотр промпта","prompts.loadDefault":"Загрузить системный","prompts.resetToDefault":"Сброс к заводским","prompts.resetConfirm":"Создать новую версию из заводского промпта и активировать?","prompts.resetDone":"Промпт сброшен к заводским настройкам","prompts.resetFailed":"Ошибка сброса: {error}","prompts.deleteConfirm":"Удалить промпт «{name}»?","prompts.deleted":"Промпт удалён","prompts.deleteFailed":"Не удалось удалить промпт: {error}","prompts.pronunciationRules":"Правила произношения","prompts.pronunciationRulesDesc":"Правила произношения для TTS — добавляются в конец системного промпта агента. Используйте для коррекции произношения размеров, брендов, моделей шин и т.д.","prompts.pronunciationRulesSave":"Сохранить","prompts.pronunciationRulesSaved":"Правила произношения сохранены","prompts.pronunciationRulesSaveFailed":"Ошибка сохранения: {error}","prompts.pronunciationRulesReset":"Сбросить к заводским","prompts.pronunciationRulesResetConfirm":"Сбросить правила произношения к заводским настройкам?","prompts.pronunciationRulesResetDone":"Правила произношения сброшены к заводским","prompts.pronunciationRulesSource":"Источник: {source}","prompts.pronunciationRulesSourceRedis":"Redis (пользовательские)","prompts.pronunciationRulesSourceDefault":"заводские (по умолчанию)","prompts.optimizer":"Оптимизатор промптов","prompts.optimizerRuns":"запусков","prompts.optimizerDesc":"Автоматический анализ неудачных звонков и рекомендации по улучшению промпта.","prompts.optimizerRun":"Запустить анализ","prompts.optimizerRunning":"Запуск...","prompts.optimizerStarted":"Анализ запущен (task: {taskId})","prompts.optimizerRunFailed":"Не удалось запустить: {error}","prompts.optimizerDate":"Дата","prompts.optimizerCalls":"Звонков","prompts.optimizerPatterns":"Паттернов","prompts.optimizerStatus":"Статус","prompts.optimizerTriggered":"Инициатор","prompts.optimizerCompleted":"Готово","prompts.optimizerError":"Ошибка","prompts.optimizerView":"Подробнее","prompts.optimizerNoResults":"Нет результатов анализа","prompts.optimizerLoadFailed":"Не удалось загрузить: {error}","prompts.optimizerDetailTitle":"Результаты анализа","prompts.optimizerRecommendation":"Рекомендация","prompts.optimizerPattern":"Паттерн","prompts.optimizerSeverity":"Важность","prompts.optimizerFrequency":"Частота","prompts.optimizerSuggestion":"Предложение","prompts.action":"Действия","knowledge.breadcrumb":"База знаний","knowledge.title":"База знаний","knowledge.allCategories":"Все категории","knowledge.searchPlaceholder":"Поиск...","knowledge.allActive":"Все","knowledge.activeOnly":"Активные","knowledge.inactiveOnly":"Неактивные","knowledge.newArticle":"+ Новая статья","knowledge.reindexAll":"Переиндексировать всё","knowledge.importDocuments":"Импорт документов","knowledge.noArticles":"Статьи не найдены","knowledge.articleTitle":"Название","knowledge.category":"Категория","knowledge.embedding":"Эмбеддинг","knowledge.activeCol":"Активен","knowledge.updated":"Обновлён","knowledge.expiresAt":"Срок действия","knowledge.expired":"Истёк","knowledge.expiresAtLabel":"Срок действия (необязательно)","knowledge.expiresAtHint":"Статья автоматически скроется после этой даты. Пусто = бессрочно.","knowledge.actions":"Действия","knowledge.editBtn":"Ред.","knowledge.reindexBtn":"Переиндекс.","knowledge.deleteBtn":"Удалить","knowledge.total":"Всего: {count} статей","knowledge.failedToLoad":"Не удалось загрузить статьи: {error}","knowledge.newArticleTitle":"Новая статья","knowledge.editArticleTitle":"Редактирование статьи","knowledge.titleLabel":"Название","knowledge.titlePlaceholder":"Название статьи","knowledge.categoryLabel":"Категория","knowledge.contentLabel":"Содержание (Markdown)","knowledge.contentPlaceholder":"Содержание статьи в формате Markdown...","knowledge.titleRequired":"Название и содержание обязательны","knowledge.articleUpdated":"Статья обновлена","knowledge.articleCreated":"Статья создана","knowledge.saveFailed":"Не удалось сохранить статью: {error}","knowledge.articleDeactivated":"Статья деактивирована","knowledge.articleActivated":"Статья активирована","knowledge.toggleFailed":"Не удалось обновить статью: {error}","knowledge.deleteConfirm":'Удалить статью "{title}"?',"knowledge.articleDeleted":"Статья удалена","knowledge.deleteFailed":"Не удалось удалить статью: {error}","knowledge.reindexQueued":"Переиндексация поставлена в очередь","knowledge.reindexFailed":"Ошибка переиндексации: {error}","knowledge.reindexAllConfirm":"Переиндексировать все статьи? Это может занять время.","knowledge.reindexAllDispatched":"Переиндексация всех статей запущена","knowledge.reindexAllFailed":"Ошибка переиндексации: {error}","knowledge.loadFailed":"Не удалось загрузить статью: {error}","knowledge.importTitle":"Импорт документов","knowledge.importFilesLabel":"Файлы (MD, PDF, DOCX)","knowledge.importCategoryLabel":"Категория (необязательно, авто-определение если пусто)","knowledge.importAutoDetect":"Авто-определение по имени файла","knowledge.importBtn":"Импортировать","knowledge.importNoFiles":"Пожалуйста, выберите файлы для импорта","knowledge.importResult":"Импортировано: {imported}","knowledge.importErrors":"Ошибки: {errors}","knowledge.importFailed":"Ошибка импорта: {error}","operators.breadcrumb":"Операторы","operators.title":"Операторы","operators.online":"Операторов онлайн","operators.transfers1h":"Переводов (1ч)","operators.queueUnavailable":"Статус очереди недоступен","operators.newOperator":"+ Новый оператор","operators.searchPlaceholder":"Поиск по имени/номеру...","operators.allStatuses":"Все статусы","operators.noOperators":"Операторы не найдены","operators.name":"Имя","operators.extension":"Внутр. номер","operators.status":"Статус","operators.skills":"Навыки","operators.shift":"Смена","operators.activeCol":"Активен","operators.actionsCol":"Действия","operators.statusSelect":"Статус...","operators.statusOnline":"Онлайн","operators.statusOffline":"Оффлайн","operators.statusBusy":"Занят","operators.statusBreak":"Перерыв","operators.editBtn":"Ред.","operators.deactivateBtn":"Деактив.","operators.failedToLoad":"Не удалось загрузить операторов: {error}","operators.newOperatorTitle":"Новый оператор","operators.editOperatorTitle":"Редактирование оператора","operators.nameLabel":"Имя","operators.namePlaceholder":"ФИО","operators.extensionLabel":"Внутр. номер (SIP)","operators.extensionPlaceholder":"напр. 101","operators.skillsLabel":"Навыки (через запятую)","operators.skillsPlaceholder":"шины, заказы, шиномонтаж","operators.shiftStartLabel":"Начало смены","operators.shiftEndLabel":"Конец смены","operators.nameRequired":"Имя и внутр. номер обязательны","operators.operatorUpdated":"Оператор обновлён","operators.operatorCreated":"Оператор создан","operators.saveFailed":"Не удалось сохранить оператора: {error}","operators.statusChanged":"Статус изменён на {status}","operators.statusFailed":"Не удалось изменить статус: {error}","operators.deactivateConfirm":'Деактивировать оператора "{name}"?',"operators.operatorDeactivated":"Оператор деактивирован","operators.deactivateFailed":"Не удалось деактивировать: {error}","operators.notFound":"Оператор не найден","operators.loadFailed":"Не удалось загрузить оператора: {error}","settings.breadcrumb":"Система","settings.title":"Статус системы","settings.healthCheck":"Проверка здоровья","settings.refresh":"Обновить","settings.extendedStatus":"Расширенный статус","settings.clickToLoad":"Нажмите для загрузки","settings.loadStatus":"Загрузить статус","settings.configuration":"Конфигурация","settings.configDescription":"Перезагрузить безопасные параметры конфигурации (качество, фича-флаги, логирование) без перезапуска.","settings.reloadConfig":"Перезагрузить конфиг","settings.externalTools":"Внешние инструменты","settings.openGrafana":"Открыть Grafana","settings.openPrometheus":"Открыть Prometheus","settings.openFlower":"Открыть Flower","settings.celeryTasks":"Задачи Celery (Flower)","settings.loadFlower":"Загрузить Flower","settings.appInfo":"Информация о приложении","settings.version":"Версия","settings.status":"Статус","settings.activeCalls":"Активные звонки","settings.redis":"Redis","settings.storeAPI":"Store API","settings.claudeAPI":"Claude API","settings.googleSTT":"Google STT","settings.ttsEngine":"TTS Engine","settings.failedToLoad":"Не удалось загрузить системную информацию: {error}","settings.extVersion":"Версия","settings.uptime":"Аптайм","settings.uptimeValue":"{hours}ч {minutes}м","settings.pgDbSize":"Размер БД PostgreSQL","settings.pgConnections":"Подключения PostgreSQL","settings.redisMemory":"Память Redis","settings.celeryWorkers":"Celery workers","settings.lastBackup":"Последний бэкап","settings.extFailed":"Ошибка: {error}","settings.reloadConfirm":"Перезагрузить конфигурацию из окружения?","settings.configReloaded":`Конфигурация перезагружена:
`,"settings.reloadFailed":"Ошибка перезагрузки: {error}","settings.llmRouting":"Маршрутизация LLM","settings.llmRoutingDesc":"Мультипровайдерный роутинг LLM: управление провайдерами, задачами и fallback-цепочками.","settings.llmLoadConfig":"Загрузить конфигурацию","settings.llmProvider":"Провайдер","settings.llmType":"Тип","settings.llmModel":"Модель","settings.llmApiKey":"API-ключ","settings.llmEnabled":"Включён","settings.llmHealth":"Здоровье","settings.llmActions":"Действия","settings.llmTest":"Тест","settings.llmTaskRouting":"Маршрутизация задач","settings.llmTask":"Задача","settings.llmPrimary":"Основной","settings.llmFallbacks":"Запасные","settings.llmAddProvider":"Добавить провайдер","settings.llmAddFillRequired":"Укажите модель","settings.llmProviderAdded":"Провайдер {key} добавлен","settings.llmModelUpdated":"{key}: модель изменена на {model}","settings.llmProviderToggled":"Провайдер {key}: {state}","settings.llmRouteUpdated":"Задача {task} → {provider}","settings.llmTaskDesc_agent":"Основной ИИ-агент: ведёт диалог с клиентом, вызывает инструменты (поиск шин, заказы, запись на шиномонтаж).","settings.llmTaskRec_agent":"Рекомендация: мощная модель (Sonnet, GPT-4o). Требуется tool calling, высокое качество диалога.","settings.llmTaskDesc_article_processor":"Обработка статей базы знаний: структурирование, очистка, извлечение ключевых фактов из импортированных документов.","settings.llmTaskRec_article_processor":"Рекомендация: быстрая/дешёвая модель (Haiku, GPT-4o-mini). Фоновая задача, не требует tool calling.","settings.llmTaskDesc_quality_scoring":"Оценка качества звонков: анализ транскрипции, выставление баллов по критериям (точность, вежливость, полнота).","settings.llmTaskRec_quality_scoring":"Рекомендация: быстрая/дешёвая модель (Haiku, GPT-4o-mini). Фоновая Celery-задача, пакетная обработка.","settings.llmTaskDesc_prompt_optimizer":"Оптимизация системного промпта: анализ результатов A/B-тестов, генерация улучшенных версий промпта.","settings.llmTaskRec_prompt_optimizer":"Рекомендация: быстрая/дешёвая модель (Haiku, GPT-4o-mini). Редкая фоновая задача.","settings.llmFbSelect":"Выбрать...","settings.llmFbMoveUp":"Переместить выше","settings.llmFbMoveDown":"Переместить ниже","settings.llmFallbacksUpdated":"Запасные для {task}: {count} шт.","settings.llmConfigFailed":"Ошибка сохранения конфигурации: {error}","settings.llmTesting":"Тестирование {key}...","settings.llmTestSuccess":"{key}: OK ({latency}ms)","settings.llmTestFailed":"{key}: ошибка — {error}","settings.llmLoadFailed":"Не удалось загрузить конфигурацию LLM: {error}","settings.llmEditProvider":"Редактировать","settings.llmDeleteProvider":"Удалить","settings.llmDeleteConfirm":"Удалить провайдер {key}? Это действие необратимо.","settings.llmProviderDeleted":"Провайдер {key} удалён","settings.llmProviderInUse":"Невозможно удалить: провайдер используется в задачах: {tasks}","settings.llmProviderUpdated":"Провайдер {key} обновлён","settings.llmBaseUrl":"Base URL","settings.llmApiKeyEnv":"Переменная API-ключа","settings.llmEditTitle":"Редактирование провайдера","settings.llmProviderKey":"Название (ключ)","settings.llmProviderRenamed":"Провайдер {oldKey} переименован в {newKey}","settings.sandboxDefaults":"Настройки Sandbox","settings.sandboxDefaultModel":"Модель по умолчанию","settings.sandboxAutoCustomerModel":"Модель авто-клиента","settings.sandboxDefaultsSaved":"Настройки sandbox сохранены","settings.sandboxDefaultsHint":"Выбранные модели будут использоваться по умолчанию для новых диалогов sandbox и авто-клиента.","settings.sandboxNoProviders":"Нет включённых провайдеров","settings.ttsTitle":"Голосовые настройки TTS","settings.ttsDesc":"Настройки голоса Google Cloud TTS: выбор голоса, скорость речи и тональность. Изменения применяются к новым звонкам без перезапуска.","settings.ttsLoadConfig":"Загрузить настройки TTS","settings.ttsSource":"Источник","settings.ttsVoice":"Голос","settings.ttsSpeakingRate":"Скорость речи","settings.ttsPitch":"Тональность","settings.ttsTest":"Тест голоса","settings.ttsReset":"Сброс к умолчаниям","settings.ttsResetConfirm":"Сбросить настройки TTS к значениям из переменных окружения?","settings.ttsSaved":"Настройки TTS сохранены","settings.ttsSaveFailed":"Ошибка сохранения TTS: {error}","settings.ttsResetDone":"Настройки TTS сброшены к умолчаниям","settings.ttsTesting":"Синтез тестовой фразы...","settings.ttsTestSuccess":"Синтез выполнен ({duration}мс)","settings.ttsTestFailed":"Ошибка синтеза: {error}","settings.ttsLoadFailed":"Не удалось загрузить настройки TTS: {error}","settings.ttsBreaksTitle":"Паузы на знаках препинания","settings.ttsBreaksDesc":"Длительность SSML-пауз после знаков препинания (мс). Влияет на ритм речи.","settings.ttsBreakComma":"Запятая","settings.ttsBreakPeriod":"Точка","settings.ttsBreakExclamation":"Вопрос/Восклицание","settings.ttsBreakColon":"Двоеточие","settings.ttsBreakSemicolon":"Точка с запятой","settings.ttsBreakEmDash":"Тире","settings.taskSchedules":"Расписания задач","settings.taskSchedulesDesc":"Настройка расписаний фоновых задач (синхронизация каталога, обновление STT-подсказок). Изменения применяются без перезапуска.","settings.taskLoadSchedules":"Загрузить расписания","settings.taskLoadFailed":"Не удалось загрузить расписания: {error}","settings.taskEnabled":"Включена","settings.taskDisabled":"Отключена","settings.taskFrequency":"Частота","settings.taskFreqDaily":"Ежедневно","settings.taskFreqWeekly":"Еженедельно","settings.taskHour":"Час запуска (Kyiv)","settings.taskDayOfWeek":"День недели","settings.taskRunNow":"Запустить сейчас","settings.taskRunQueued":"Задача {task} поставлена в очередь (ID: {id})","settings.taskRunFailed":"Ошибка запуска: {error}","settings.taskSaved":"Расписание сохранено","settings.taskSaveFailed":"Ошибка сохранения: {error}","settings.taskResetAll":"Сбросить всё к умолчаниям","settings.taskResetConfirm":"Сбросить все расписания к значениям по умолчанию?","settings.taskResetDone":"Расписания сброшены к умолчаниям","settings.taskDayMon":"Понедельник","settings.taskDayTue":"Вторник","settings.taskDayWed":"Среда","settings.taskDayThu":"Четверг","settings.taskDayFri":"Пятница","settings.taskDaySat":"Суббота","settings.taskDaySun":"Воскресенье","settings.taskLabel_catalog-full-sync":"Полная синхронизация каталога 1С","settings.taskLabel_refresh-stt-hints":"Обновление STT подсказок из каталога","settings.testPhones":"Тестовые номера","settings.testPhonesDesc":"Управление тестовыми номерами: включение/отключение истории звонков для тестирования поведения AI-агента.","settings.testPhonesLoad":"Загрузить","settings.testPhonesLoadFailed":"Не удалось загрузить: {error}","settings.testPhonesNumber":"Номер телефона","settings.testPhonesMode":"Режим","settings.testPhonesActions":"Действия","settings.testPhonesModeNoHistory":"Без истории","settings.testPhonesModeWithHistory":"С историей","settings.testPhonesClearHistory":"Очистить историю","settings.testPhonesEmpty":"Тестовые номера не настроены","settings.testPhonesAdded":"Номер {phone} добавлен","settings.testPhonesModeUpdated":"Режим для {phone} обновлён","settings.testPhonesSaveFailed":"Ошибка сохранения: {error}","settings.testPhonesRemoveConfirm":"Удалить номер {phone} из тестовых?","settings.testPhonesRemoved":"Номер {phone} удалён","settings.testPhonesClearConfirm":"Очистить ВСЮ историю звонков для {phone}? Это удалит звонки, реплики и вызовы инструментов из базы данных.","settings.testPhonesClearDone":"История {phone} очищена: {calls} звонков, {turns} реплик, {tools} вызовов инструментов","settings.testPhonesClearFailed":"Ошибка очистки: {error}","nav.pointHints":"Подсказки для точек","pointHints.title":"Подсказки для точек","pointHints.tabFitting":"Шиномонтаж","pointHints.tabPickup":"Точки выдачи","pointHints.name":"Название","pointHints.address":"Адрес","pointHints.city":"Город","pointHints.district":"Район","pointHints.landmarks":"Ориентиры","pointHints.description":"Описание","pointHints.actions":"Действия","pointHints.districtPh":"Правый берег","pointHints.landmarksPh":"рядом Пит Лайн","pointHints.descPh":"Доп. информация","pointHints.editHint":"Редактировать подсказку","pointHints.saved":"Подсказка сохранена","pointHints.deleted":"Подсказка удалена","pointHints.saveFailed":"Ошибка сохранения: {error}","pointHints.deleteFailed":"Ошибка удаления: {error}","pointHints.loadFailed":"Ошибка загрузки подсказок: {error}","pointHints.noStations":"Нет закешированных станций.","pointHints.noPoints":"Нет закешированных точек выдачи.","pointHints.refreshFromOnec":"Обновить из 1С","pointHints.refreshing":"Загрузка данных из 1С...","pointHints.refreshed":"Загружено {count} точек из 1С","pointHints.refreshFailed":"Ошибка загрузки из 1С: {error}","nav.sttHints":"Подсказки STT","sttHints.base":"Базовые","sttHints.auto":"Из каталога","sttHints.custom":"Пользовательские","sttHints.total":"Всего","sttHints.modified":"изменены","sttHints.lastSync":"Последняя синхронизация","sttHints.neverSynced":"не выполнялась","sttHints.tabBase":"Базовые","sttHints.tabAuto":"Каталог","sttHints.tabCustom":"Пользовательские","sttHints.searchPlaceholder":"Поиск фраз...","sttHints.addPhrasePlaceholder":"Новая фраза...","sttHints.noResults":"Нет совпадений","sttHints.duplicatePhrase":"Эта фраза уже добавлена","sttHints.customHint":"Максимум 1000 фраз, до 200 символов каждая. Кириллические варианты латинских слов наиболее эффективны.","sttHints.saveBase":"Сохранить базовые","sttHints.resetBase":"Сброс к умолчаниям","sttHints.devBannerTitle":"В разработке","sttHints.devBannerText":"Подсказки STT временно не применяются. Модель Google STT «latest_long» не поддерживает speech adaptation. Ожидаем обновление модели от Google. Управление подсказками доступно, но они не будут отправлены в STT до появления поддержки.","sttHints.resetBaseConfirm":"Сбросить базовые фразы к значениям по умолчанию?","sttHints.saveCustom":"Сохранить","sttHints.refreshCatalog":"Обновить из каталога","sttHints.baseSaved":"Базовые фразы сохранены ({count} шт.)","sttHints.customSaved":"Пользовательские фразы сохранены ({count} шт.)","sttHints.saveFailed":"Ошибка сохранения: {error}","sttHints.resetBaseDone":"Базовые фразы сброшены к умолчаниям","sttHints.refreshing":"Обновление подсказок из каталога...","sttHints.refreshed":"Подсказки обновлены из каталога","sttHints.refreshFailed":"Ошибка обновления: {error}","sttHints.loadFailed":"Не удалось загрузить подсказки STT: {error}","sttHints.tabOverrides":"Транслитерация","sttHints.overridesHint":"Переопределения целых слов при транслитерации латиницы в кириллицу. Ключ — английское слово (строчные), значение — кириллица.","sttHints.overrideLatin":"Английское слово","sttHints.overrideCyrillic":"Кириллица","sttHints.duplicateOverride":"Это слово уже переопределено","sttHints.overridesSaved":"Переопределения сохранены ({count} шт.)","sttHints.overridesResetDone":"Переопределения сброшены к умолчаниям","sttHints.overridesResetConfirm":"Сбросить переопределения к значениям по умолчанию?","sttHints.overridesSaveFailed":"Ошибка сохранения: {error}","sttHints.overridesLatinOnly":"Только латинские буквы (a-z)","settings.telegram":"Уведомления Telegram","settings.telegramDesc":"Настройка Telegram-бота для получения алертов от Alertmanager.","settings.telegramLoadConfig":"Загрузить","settings.telegramStatus":"Токен","settings.telegramTokenSet":"настроен","settings.telegramTokenMissing":"не настроен","settings.telegramBotToken":"Bot Token","settings.telegramBotTokenPlaceholder":"Новый токен (оставьте пустым чтобы не менять)","settings.telegramChatId":"Chat ID","settings.telegramChatIdPlaceholder":"Числовой ID чата или группы","settings.telegramTestBtn":"Тест","settings.telegramSaved":"Telegram-конфиг сохранён","settings.telegramSaveFailed":"Ошибка сохранения: {error}","settings.telegramFillFields":"Укажите хотя бы токен или chat_id","settings.telegramTesting":"Отправка тестового сообщения...","settings.telegramTestSuccess":"Тест OK ({latency}ms)","settings.telegramTestFailed":"Ошибка: {error}","settings.telegramLoadFailed":"Не удалось загрузить конфиг Telegram: {error}","users.breadcrumb":"Пользователи","users.title":"Управление пользователями","users.newUser":"+ Новый пользователь","users.noUsers":"Пользователи не найдены","users.username":"Имя пользователя","users.role":"Роль","users.activeCol":"Активен","users.lastLogin":"Последний вход","users.actionsCol":"Действия","users.changeRole":"Изменить роль...","users.roleAdmin":"Админ","users.roleAnalyst":"Аналитик","users.roleOperator":"Оператор","users.resetPwd":"Сброс пароля","users.failedToLoad":"Не удалось загрузить пользователей: {error}","users.createTitle":"Создание нового пользователя","users.usernameLabel":"Имя пользователя","users.usernamePlaceholder":"имя пользователя","users.passwordLabel":"Пароль","users.passwordPlaceholder":"пароль","users.roleLabel":"Роль","users.usernameRequired":"Имя пользователя и пароль обязательны","users.userCreated":"Пользователь создан","users.createFailed":"Не удалось создать пользователя: {error}","users.roleUpdated":"Роль обновлена","users.roleFailed":"Не удалось обновить роль: {error}","users.userDeactivated":"Пользователь деактивирован","users.userActivated":"Пользователь активирован","users.toggleFailed":"Не удалось обновить пользователя: {error}","users.newPasswordPrompt":"Новый пароль для {username}:","users.passwordReset":"Пароль сброшен","users.resetFailed":"Не удалось сбросить пароль: {error}","users.roleContentManager":"Контент-менеджер","users.permissions":"Права доступа","users.useRoleDefaults":"По умолчанию для роли","users.customPermissions":"Индивидуальные","users.editPermissions":"Права доступа...","users.permissionsUpdated":"Права доступа обновлены","users.permissionsFailed":"Не удалось обновить права: {error}","users.permGroup.sandbox":"Песочница","users.permGroup.knowledge":"База знаний","users.permGroup.scraper":"Скрапер","users.permGroup.training":"Обучение","users.permGroup.prompts":"Промпты","users.permGroup.users":"Пользователи","users.permGroup.audit":"Аудит","users.permGroup.tenants":"Тенанты","users.permGroup.operators":"Операторы","users.permGroup.analytics":"Аналитика","users.permGroup.llm_config":"LLM конфигурация","users.permGroup.notifications":"Уведомления","users.permGroup.configuration":"Конфигурация","users.permGroup.monitoring":"Мониторинг","users.permGroup.onec_data":"Данные 1С","users.permGroup.vehicles":"Автомобили","users.permGroup.pronunciation":"Произношение","users.permGroup.stt_hints":"Подсказки STT","users.permGroup.point_hints":"Подсказки для точек","users.permGroupHint.sandbox":"Песочница","users.permGroupHint.knowledge":"База знаний","users.permGroupHint.scraper":"Конфигурации, Скрапер, Отслеживаемые","users.permGroupHint.training":"Сценарии, Инструменты","users.permGroupHint.prompts":"Версии промптов","users.permGroupHint.users":"Пользователи","users.permGroupHint.audit":"Журнал аудита","users.permGroupHint.tenants":"Сети (тенанты)","users.permGroupHint.operators":"Операторы","users.permGroupHint.analytics":"Журнал звонков, Дашборд","users.permGroupHint.llm_config":"Настройки LLM-роутера","users.permGroupHint.notifications":"Telegram-уведомления","users.permGroupHint.configuration":"Перезагрузка конфигурации","users.permGroupHint.monitoring":"Статус системы","users.permGroupHint.onec_data":"Просмотр данных 1С","users.permGroupHint.vehicles":"База автомобилей","users.permGroupHint.pronunciation":"Словарь произношений","users.permGroupHint.stt_hints":"Подсказки распознавания речи","users.permGroupHint.point_hints":"Районы и ориентиры для станций/точек выдачи","training.breadcrumb":"Обучение агента","training.title":"Обучение агента","training.tabPrompts":"Промпты","training.tabKnowledge":"База знаний","training.tabTemplates":"Шаблоны ответов","training.tabDialogues":"Сценарии диалогов","training.tabSafety":"Правила безопасности","training.tabTools":"Инструменты","training.activeCol":"Активен","training.actions":"Действия","training.loadFailed":"Не удалось загрузить: {error}","training.saveFailed":"Не удалось сохранить: {error}","training.deleteFailed":"Не удалось удалить: {error}","training.deleteConfirm":'Удалить "{title}"?',"training.titleRequired":"Название обязательно","training.titleContentRequired":"Название и содержание обязательны","training.fieldsRequired":"Все обязательные поля должны быть заполнены","training.keyRequired":"Ключ шаблона обязателен","training.newTemplate":"+ Новый шаблон","training.editTemplate":"Редактирование шаблона","training.addVariantTitle":"Добавить вариант ответа","training.noTemplates":"Шаблоны не найдены","training.templateKey":"Ключ","training.templateTitle":"Название","training.content":"Содержание","training.description":"Описание","training.templateSaved":"Шаблон сохранён","training.addVariant":"+ Вариант","training.variantCount":"вар.","training.variantsHint":"Несколько вариантов на ключ — агент выбирает случайный при каждом звонке","training.deleteVariantConfirm":'Удалить вариант "{title}"?',"training.variantDeleted":"Вариант удалён","training.allTemplateKeys":"Все ключи","training.searchTemplates":"Поиск шаблонов...","training.filterScenario":"Сценарий","training.allScenarios":"Все сценарии","training.filterPhase":"Фаза","training.allPhases":"Все фазы","training.filterActive":"Статус","training.allActive":"Все","training.activeOnly":"Активные","training.inactiveOnly":"Неактивные","training.newDialogue":"+ Новый сценарий","training.editDialogue":"Редактирование сценария","training.noDialogues":"Сценарии не найдены","training.dialogueTitle":"Название","training.dialogueTitlePlaceholder":"Название сценария","training.scenario":"Сценарий","training.phase":"Фаза","training.tools":"Инструменты","training.dialogueJSON":"Диалог (JSON)","training.invalidJSON":"Некорректный JSON","training.dialogueSaved":"Сценарий сохранён","training.dialogueDeleted":"Сценарий удалён","training.filterRuleType":"Тип правила","training.allRuleTypes":"Все типы","training.filterSeverity":"Серьёзность","training.allSeverities":"Все","training.newSafetyRule":"+ Новое правило","training.editSafetyRule":"Редактирование правила","training.noSafetyRules":"Правила не найдены","training.ruleTitle":"Название","training.ruleType":"Тип правила","training.severity":"Серьёзность","training.triggerInput":"Триггер (ввод клиента)","training.expectedBehavior":"Ожидаемое поведение","training.safetyRuleSaved":"Правило сохранено","training.safetyRuleDeleted":"Правило удалено","training.regressionTest":"Тест правил","training.regressionRunning":"Тестирование...","training.regressionResults":"Результаты теста правил безопасности","training.regressionPassed":"Пройден","training.regressionFailed_label":"Не пройден","training.regressionFailed":"Ошибка теста: {error}","training.regressionPassedCount":"Пройдено: {count}","training.regressionFailedCount":"Не пройдено: {count}","training.regressionTotal":"Всего: {count}","training.regressionStatus":"Статус","training.regressionActual":"Ответ агента","training.regressionReason":"Причина","training.toolName":"Инструмент","training.override":"Переопределение","training.overridden":"Переопределён","training.default":"По умолчанию","training.editTool":"Редактирование инструмента","training.originalDescription":"Описание по умолчанию","training.overrideDescription":"Переопределённое описание","training.descriptionRequired":"Описание обязательно","training.toolOverrideSaved":"Переопределение сохранено","training.toolOverrideReset":"Переопределение сброшено","training.reset":"Сбросить","training.resetConfirm":"Сбросить переопределение для {name}?","training.resetFailed":"Не удалось сбросить: {error}","training.toolNotFound":"Инструмент не найден","training.tabSources":"Источники","sources.enabled":"Скрапер включён","sources.autoApprove":"Авто-публикация","sources.runNow":"Запустить сейчас","sources.schedule":"Расписание","sources.noSources":"Источники не найдены","sources.allStatuses":"Все статусы","sources.url":"URL","sources.originalTitle":"Оригинальное название","sources.status":"Статус","sources.date":"Дата","sources.actions":"Действия","sources.approve":"Одобрить","sources.reject":"Отклонить","sources.viewArticle":"Статья","sources.total":"Всего: {count}","sources.configUpdated":"Конфигурация обновлена","sources.configUpdateFailed":"Ошибка обновления: {error}","sources.configLoadFailed":"Ошибка загрузки конфигурации: {error}","sources.runDispatched":"Скрапер запущен","sources.runFailed":"Не удалось запустить скрапер: {error}","sources.approved":"Статья одобрена и активирована","sources.approveFailed":"Ошибка одобрения: {error}","sources.rejected":"Источник отклонён","sources.rejectFailed":"Ошибка отклонения: {error}","sources.rejectConfirm":"Отклонить этот источник?","sources.failedToLoad":"Не удалось загрузить источники: {error}","sources.minDate":"С даты","sources.minDateHint":"Пусто = последние 14 дней (авторежим)","sources.maxDate":"По дату","sources.maxDateHint":"Пусто = без ограничения (до сегодня)","sources.dedupLlmCheck":"LLM-проверка дубликатов","sources.dedupLlmCheckHint":"Использовать LLM для пограничных случаев (0.80–0.90 сходство)","sources.duplicate":"дубликат","sources.duplicateSuspect":"возможный дубликат","sources.watchedPagesTitle":"Отслеживаемые страницы","sources.watchedPagesHint":"Страницы сайта, которые периодически пересканируются для обновления базы знаний агента.","sources.addWatchedPage":"Добавить страницу","sources.noWatchedPages":"Отслеживаемые страницы не добавлены","sources.watchedUrl":"URL","sources.watchedCategory":"Категория","sources.watchedInterval":"Интервал (ч)","sources.watchedStatus":"Статус","sources.watchedLastScraped":"Последний скан","sources.watchedNextScrape":"Следующий скан","sources.watchedArticle":"Статья","sources.watchedActions":"Действия","sources.scrapeNow":"Сканировать","sources.deleteWatched":"Удалить","sources.watchedPageAdded":"Страница добавлена","sources.watchedPageAddFailed":"Ошибка добавления: {error}","sources.watchedPageDeleted":"Страница удалена","sources.watchedPageDeleteFailed":"Ошибка удаления: {error}","sources.watchedPageDeleteConfirm":"Удалить отслеживание этой страницы?","sources.watchedPageUpdated":"Настройки обновлены","sources.watchedPageUpdateFailed":"Ошибка обновления: {error}","sources.scrapeNowRunning":"Сканирование...","sources.scrapeNowDone":"Сканирование завершено: {status}","sources.scrapeNowUnchanged":"Контент не изменился","sources.scrapeNowDiscoveryDone":"Discovery: найдено {discovered} стр., создано {created}, обновлено {updated}","sources.scrapeNowFailed":"Ошибка сканирования: {error}","sources.watchedFailedToLoad":"Не удалось загрузить: {error}","sources.urlRequired":"Укажите URL страницы","sources.categoryRequired":"Выберите категорию","sources.intervalRequired":"Выберите интервал","sources.urlPlaceholder":"https://prokoleso.ua/ua/...","sources.neverScraped":"ещё не сканировалась","sources.filterByTenant":"Сеть:","sources.allTenants":"Все сети","sources.noTenant":"Без сети","sources.tenant":"Сеть","sources.discoveryLabel":"Страница-каталог","sources.discoveryBadge":"каталог","sources.discoveryHint":"Страница со списком ссылок (напр. акции). Автоматически находит все дочерние страницы и сканирует каждую отдельно.","sources.childCount":"{count} дочерних","sources.intervalHours.6":"Каждые 6 ч","sources.intervalHours.12":"Каждые 12 ч","sources.intervalHours.24":"Раз в сутки","sources.intervalHours.168":"Раз в неделю","sources.tabConfigs":"Конфигурации","sources.tabScraper":"Скрапер","sources.tabWatched":"Отслеживаемые","sources.sourceConfigsTitle":"Источники контента","sources.sourceConfigsHint":"Внешние сайты для сбора статей в базу знаний.","sources.scraperConfigTitle":"ProKoleso — ручной импорт","sources.addSource":"Добавить источник","sources.editSource":"Редактировать источник","sources.sourceName":"Название","sources.sourceType":"Тип","sources.sourceUrl":"URL","sources.sourceLanguage":"Язык","sources.maxArticles":"Макс. статей","sources.lastRun":"Последний запуск","sources.runSource":"Запустить","sources.deleteSource":"Удалить","sources.settingsJson":"Настройки (JSON)","sources.noSourceConfigs":"Источники контента не настроены","sources.sourceConfigSaved":"Источник сохранён","sources.sourceConfigSaveFailed":"Ошибка сохранения: {error}","sources.sourceConfigDeleted":"Источник удалён","sources.sourceConfigDeleteFailed":"Ошибка удаления: {error}","sources.deleteSourceConfirm":"Удалить источник «{name}»?","sources.nameUrlRequired":"Укажите название и URL","sources.invalidSettingsJson":"Некорректный JSON в настройках","sources.processed":"Обработано","sources.bulkImport":"Массовый импорт","sources.bulkImportTitle":"Массовый импорт отслеживаемых страниц","sources.bulkUrlsPlaceholder":"Введите URL-адреса (по одному на строку)...","sources.bulkImportResult":"Добавлено: {added}, пропущено: {skipped}","tenants.title":"Сети","tenants.newTenant":"+ Новая сеть","tenants.editTenant":"Редактирование сети","tenants.slug":"Slug","tenants.name":"Название","tenants.networkId":"Network ID","tenants.agentName":"Имя агента","tenants.greeting":"Приветствие","tenants.enabledTools":"Инструменты","tenants.promptSuffix":"Суффикс промпта","tenants.config":"Конфигурация (JSON)","tenants.statusCol":"Статус","tenants.actions":"Действия","tenants.active":"Активна","tenants.activeLabel":"Активна","tenants.inactive":"Неактивна","tenants.created":"Сеть создана","tenants.updated":"Сеть обновлена","tenants.deleted":"Сеть деактивирована","tenants.activated":"Сеть активирована","tenants.deactivated":"Сеть деактивирована","tenants.deleteConfirm":"Деактивировать сеть «{name}»?","tenants.saveFailed":"Не удалось сохранить: {error}","tenants.loadFailed":"Не удалось загрузить сети: {error}","tenants.noTenants":"Сети не найдены","tenants.nameRequired":"Название и Network ID обязательны","tenants.slugRequired":"Slug обязателен","tenants.invalidConfigJson":"Некорректный JSON в конфигурации","tenants.extensions":"Extensions (Asterisk)","tenants.extensionsHint":"Номера extensions Asterisk, через запятую","nav.onecData":"Данные 1С","nav.vehicles":"База авто","vehicles.breadcrumb":"База авто","vehicles.title":"База автомобилей","vehicles.searchPlaceholder":"Поиск по названию...","vehicles.brands":"Марки","vehicles.models":"Модели","vehicles.kits":"Комплектации","vehicles.tireSizes":"Размеры шин","vehicles.lastImport":"Последний импорт","vehicles.brand":"Марка","vehicles.model":"Модель","vehicles.year":"Год","vehicles.trim":"Комплектация","vehicles.pcd":"PCD","vehicles.bolts":"Болты","vehicles.dia":"DIA","vehicles.size":"Размер","vehicles.type":"Тип","vehicles.axle":"Ось","vehicles.stock":"Заводской","vehicles.tuning":"Тюнинг","vehicles.front":"Перед","vehicles.rear":"Зад","vehicles.all":"Все","vehicles.back":"← Назад","vehicles.noData":"Нет данных","vehicles.failedToLoad":"Не удалось загрузить: {error}","vehicles.neverImported":"Импорт не выполнялся","vehicles.importButton":"Обновить БД","vehicles.importTitle":"Обновление базы автомобилей","vehicles.importInstructions":"Разместите 4 CSV-файла в директории на сервере:","vehicles.importWarning":"Импорт удалит текущие данные и загрузит новые. Операция занимает ~30-60 секунд.","vehicles.importPathLabel":"Путь к директории с CSV","vehicles.importPathRequired":"Укажите путь к директории","vehicles.importBtn":"Импортировать","vehicles.importSuccess":"Импорт завершён: {brands} марок, {models} моделей, {kits} комплектаций, {tireSizes} размеров шин","vehicles.importFailed":"Ошибка импорта: {error}","common.search":"Поиск","audit.breadcrumb":"Аудит","audit.title":"Журнал аудита","audit.allActions":"Все действия","audit.noEntries":"Записи аудита не найдены","audit.date":"Дата","audit.user":"Пользователь","audit.action":"Действие","audit.resource":"Ресурс","audit.ip":"IP","audit.failedToLoad":"Не удалось загрузить журнал аудита: {error}","onec.title":"Данные 1С","onec.breadcrumb":"Данные 1С","onec.statusTitle":"Статус подключения","onec.status":"Статус","onec.connected":"Подключено","onec.disconnected":"Недоступно","onec.notConfigured":"Не настроено","onec.pickupPoints":"Пункты выдачи","onec.network":"Сеть","onec.city":"Город","onec.address":"Адрес","onec.type":"Тип","onec.filterCity":"Фильтр по городу","onec.refresh":"Обновить из 1С","onec.stockLookup":"Остатки по SKU","onec.sku":"Артикул","onec.skuPlaceholder":"Введите артикул для поиска","onec.search":"Найти","onec.price":"Цена","onec.quantity":"Количество","onec.country":"Страна","onec.year":"Год","onec.cacheAge":"Возраст кеша","onec.noData":"Нет данных","onec.notFound":"Не найдено","onec.soapStatus":"SOAP шиномонтаж","onec.restStatus":"REST API 1С","onec.aiOrders":"AI-заказов создано","onec.aiOrdersHint":"Через прямую интеграцию 1С","onec.soapTimeout":"Таймаут SOAP","nav.sandbox":"Песочница","sandbox.breadcrumb":"Песочница","sandbox.title":"Песочница агента","sandbox.tabChat":"Чат","sandbox.tabHistory":"История","sandbox.newConversation":"Новый диалог","sandbox.archiveConversation":"Архивировать","sandbox.sendMessage":"Отправить","sandbox.messagePlaceholder":"Введите сообщение клиента...","sandbox.noConversation":"Выберите или создайте диалог","sandbox.noConversations":"Нет диалогов","sandbox.noMessages":"Начните диалог — отправьте первое сообщение","sandbox.conversationTitle":"Название диалога","sandbox.promptVersion":"Версия промпта","sandbox.promptVersionDefault":"Активная версия","sandbox.toolMode":"Режим инструментов","sandbox.toolModeMock":"Мок (тестовые данные)","sandbox.toolModeLive":"Живой (Store API)","sandbox.scenarioType":"Тип сценария","sandbox.scenarioNone":"Без типа","sandbox.model":"Модель","sandbox.modelDefault":"По умолчанию","sandbox.changeModel":"Сменить модель","sandbox.modelChanged":"Модель изменена","sandbox.tags":"Теги (через запятую)","sandbox.createConversation":"Создать диалог","sandbox.created":"Диалог создан","sandbox.archived":"Диалог архивирован","sandbox.deleted":"Диалог удалён","sandbox.deleteConfirm":"Удалить диалог «{title}»? Все данные будут потеряны.","sandbox.deleteBlockedByRegression":"Диалог используется в regression-прогонах. Архивируйте его вместо удаления.","sandbox.ratingCommentPrompt":"Комментарий к оценке (необязательно):","sandbox.ratingSaved":"Оценка сохранена","sandbox.ratingFailed":"Не удалось сохранить оценку: {error}","sandbox.sendFailed":"Ошибка отправки: {error}","sandbox.llmError":"Ошибка LLM","sandbox.llmErrorHint":"LLM-вызов не выполнен (0 токенов). Проверьте API-ключ и логи сервера.","sandbox.loadFailed":"Ошибка загрузки: {error}","sandbox.customer":"Клиент","sandbox.agent":"Агент","sandbox.toolCalls":"Вызовы инструментов","sandbox.toolName":"Инструмент","sandbox.toolArgs":"Параметры","sandbox.toolResult":"Результат","sandbox.toolDuration":"Время","sandbox.mock":"мок","sandbox.live":"живой","sandbox.metrics":"{latency}мс | {input}→{output} токенов | {model}","sandbox.turnsCount":"Реплик","sandbox.avgRating":"Ср. оценка","sandbox.lastActivity":"Последняя активность","sandbox.status":"Статус","sandbox.active":"Активный","sandbox.archivedStatus":"Архив","sandbox.searchPlaceholder":"Поиск по названию...","sandbox.allScenarios":"Все сценарии","sandbox.rateComment":"Комментарий к оценке...","sandbox.branch":"Альтернатива","sandbox.branchFrom":"Ветвление от реплики #{turn}","sandbox.branchLabel":"Метка ветки","sandbox.autoCustomer":"Авто-клиент","sandbox.autoCustomerHint":"Сгенерировать ответ клиента через ИИ","sandbox.persona":"Персона","sandbox.personaNeutral":"Нейтральный","sandbox.personaImpatient":"Нетерпеливый","sandbox.personaConfused":"Растерянный","sandbox.personaAngry":"Злой","sandbox.personaExpert":"Эксперт","sandbox.personaRushed":"Спешит","sandbox.personaDetailed":"Дотошный","sandbox.contextHint":"Подсказка контекста","sandbox.starters":"Шаблоны старта","sandbox.newStarter":"Новый шаблон","sandbox.starterTitle":"Название шаблона","sandbox.firstMessage":"Первое сообщение","sandbox.starterSaved":"Шаблон сохранён","sandbox.starterDeleted":"Шаблон удалён","sandbox.useStarter":"Использовать","sandbox.generating":"Генерация...","sandbox.childBranches":"Ответвления","sandbox.tabRegression":"Регрессия","sandbox.regression":"Регрессионные тесты","sandbox.replay":"Воспроизвести","sandbox.replayHint":"Воспроизвести диалог с другим промптом","sandbox.selectPromptVersion":"Выберите версию промпта","sandbox.runRegression":"Запустить регрессию","sandbox.regressionStarted":"Регрессия запущена","sandbox.regressionFailed":"Ошибка регрессии: {error}","sandbox.noRegressions":"Нет регрессионных тестов","sandbox.turnsCompared":"Реплик сравнено","sandbox.sourceRating":"Ср. оценка (исходный)","sandbox.newRating":"Ср. оценка (новый)","sandbox.scoreDiff":"Разница","sandbox.sourceResponse":"Исходный ответ","sandbox.newResponse":"Новый ответ","sandbox.diffView":"Сравнение","sandbox.baseline":"Базовый","sandbox.markBaseline":"Отметить как базовый","sandbox.unmarkBaseline":"Снять отметку базовый","sandbox.pending":"Ожидание","sandbox.running":"Выполняется","sandbox.completed":"Завершено","sandbox.failed":"Ошибка","sandbox.exportDialogue":"Экспорт в обучение","sandbox.exported":"Экспортировано в обучающие данные","sandbox.markingMode":"Режим разметки","sandbox.createGroup":"Создать группу","sandbox.intentLabel":"Интент","sandbox.patternType":"Тип паттерна","sandbox.positive":"Положительный","sandbox.negative":"Отрицательный","sandbox.correction":"Исправление","sandbox.correctionHint":"Как агент должен был ответить...","sandbox.groupCreated":"Группа создана","sandbox.groupUpdated":"Группа обновлена","sandbox.groupDeleted":"Группа удалена","sandbox.turnGroups":"Группы реплик","sandbox.noGroups":"Нет групп","sandbox.turnsSelected":"{count} реплик выбрано","sandbox.exportToPatterns":"Экспорт в паттерны","sandbox.alreadyExported":"Экспортировано","sandbox.patterns":"Паттерны","sandbox.guidanceNote":"Инструкция для промпта","sandbox.guidanceHint":"Что именно инжектировать в system prompt агента...","sandbox.exportSuccess":"Паттерн экспортирован","sandbox.patternActive":"Активен","sandbox.patternInactive":"Неактивен","sandbox.timesUsed":"Использований","sandbox.testSearch":"Тест поиска","sandbox.testSearchHint":"Введите текст для поиска похожих паттернов...","sandbox.similarity":"Результаты","sandbox.noPatterns":"Нет паттернов","sandbox.customerMessages":"Сообщения клиента","sandbox.agentMessages":"Ответы агента","sandbox.sending":"Отправка...","sandbox.exitMarking":"Выйти из разметки","sandbox.markingHint":"Выберите ходы для создания группы","sandbox.error":"Ошибка","sandbox.openNewConversation":"Открыть новый диалог","sandbox.intentRequired":"Введите метку интента","sandbox.guidanceRequired":"Введите инструкцию для промпта","sandbox.generateGuidance":"✦ Сгенерировать ИИ","sandbox.generatingGuidance":"Генерация инструкции...","sandbox.generateGuidanceFailed":"Не удалось сгенерировать: {error}","sandbox.editPattern":"Редактирование паттерна","sandbox.patternSaved":"Паттерн сохранён","sandbox.titleRequired":"Введите название диалога","sandbox.ratingCommentPlaceholder":"Комментарий (Enter для сохранения)","sandbox.convInfo":"Параметры диалога","sandbox.routerModel":"router","sandbox.intentSelectPlaceholder":"— Выберите интент —","sandbox.intentGreeting":"Приветствие и начало диалога","sandbox.intentTireSearch":"Поиск шин по параметрам","sandbox.intentClarification":"Уточнение параметров у клиента","sandbox.intentRecommendation":"Рекомендация товара","sandbox.intentAvailabilityCheck":"Проверка наличия","sandbox.intentOrderCreation":"Оформление заказа","sandbox.intentOrderStatus":"Проверка статуса заказа","sandbox.intentFittingBooking":"Запись на шиномонтаж","sandbox.intentConsultation":"Консультация (общие вопросы)","sandbox.intentObjectionHandling":"Работа с возражениями","sandbox.intentUpsell":"Допродажа / кросс-продажа","sandbox.intentFarewell":"Завершение разговора","sandbox.intentOther":"Другой...","sandbox.intentCustomPlaceholder":"Введите свой интент...","sandbox.previewSelectedTurns":"Выбранные реплики ({count})","sandbox.positiveDesc":"Хороший пример ответа агента","sandbox.negativeDesc":"Пример, требующий исправления","sandbox.tabPhrases":"Фразы агента","sandbox.phrasesTitle":"Фразы агента (TTS без LLM)","sandbox.phrasesDescription":"Эти фразы озвучиваются TTS напрямую, без участия LLM. Шаблоны из БД имеют приоритет над захардкоженными — при каждом звонке выбирается случайный вариант.","sandbox.phrasesCategory":"Категория","sandbox.phrasesKey":"Контекст","sandbox.phrasesText":"Текст фразы","sandbox.phrasesSource":"Источник","sandbox.phrasesStatus":"Статус","sandbox.phrasesSourceCode":"код (prompts.py)","sandbox.phrasesSourceLLM":"LLM (генерация)","sandbox.phrasesActive":"активна","sandbox.phrasesOverridden":"переопределена из БД","sandbox.phrasesInactive":"выкл","sandbox.phrasesCatFixed":"Захардкоженные (fallback)","sandbox.phrasesCatWait":"Пулы ожидания (захардкоженные)","sandbox.phrasesPoolLabel":"пул ({count} вариантов, ротация)","sandbox.phrasesLoadFailed":"Не удалось загрузить фразы: {error}","sandbox.phrasesLlmNote":"Все остальные ответы агента генерируются LLM в реальном времени.","sandbox.phrasesDbTitle":"Шаблоны из БД (реально используются)","sandbox.phrasesDbDescription":"Эти фразы загружаются из таблицы response_templates и переопределяют захардкоженные. При каждом звонке случайно выбирается 1 активный вариант на ключ. Управление: Сценарии → Шаблоны.","sandbox.phrasesDbVariants":"{active} акт. из {total}","sandbox.branchMessage":"Сообщение для ветки","sandbox.branchFromTurn":"Ветка от хода {turn}","sandbox.submitBranch":"Отправить","sandbox.selectPromptForReplay":"Выберите версию промпта для регрессии","sandbox.submitReplay":"Запустить","sandbox.personaRushed":"Спешащий","sandbox.personaDetailed":"Дотошный","sandbox.tabStarters":"Шаблоны","sandbox.quickStart":"Быстрый старт","sandbox.manageStarters":"Управление шаблонами","sandbox.starterFirstMessage":"Первое сообщение","sandbox.starterDescription":"Описание","sandbox.starterPersona":"Персона","sandbox.noStarters":"Нет шаблонов старта","sandbox.deleteStarterConfirm":"Удалить шаблон «{title}»?","sandbox.starterTitleRequired":"Название и первое сообщение обязательны","sandbox.editStarter":"Редактирование шаблона","sandbox.searchStarters":"Поиск по шаблонам...","sandbox.allScenarios":"Все сценарии","sandbox.allStatuses":"Все статусы","sandbox.activeOnly":"Активные","sandbox.inactiveOnly":"Неактивные","sandbox.bulkMode":"Массовое удаление","sandbox.selectAll":"Выбрать все","sandbox.deselectAll":"Снять все","sandbox.bulkDelete":"Удалить выбранные ({count})","sandbox.bulkDeleted":"Удалено: {deleted}, пропущено: {skipped}","sandbox.bulkDeleteConfirm":"Удалить {count} диалогов? Данные будут потеряны.","sandbox.bulkSkipped":"Некоторые диалоги защищены regression-прогонами и не были удалены.","sandbox.importFromCall":"Из звонка","sandbox.importCallSearchPlaceholder":"Поиск по номеру...","sandbox.importCallsNone":"Звонки не найдены","sandbox.importBtn":"Импорт","sandbox.importingCall":"Импорт...","sandbox.importedCall":"Звонок импортирован в песочницу","sandbox.importCallFailed":"Ошибка импорта: {error}","sandbox.importCallPreview":"Расшифровка","sandbox.importCallSelectToPreview":"Выберите звонок для просмотра","sandbox.deleteRun":"Удалить","sandbox.deleteRunConfirm":"Удалить регрессионный прогон? Созданный диалог тоже будет удалён.","sandbox.runDeleted":"Прогон удалён","sandbox.verdict":"Вердикт","sandbox.pendingVerdict":"Ожидает","sandbox.approved":"Одобрен","sandbox.rejected":"Отклонён","sandbox.approve":"Одобрить","sandbox.reject":"Отклонить","sandbox.verdictSet":"Вердикт установлен","sandbox.filterVerdict":"Вердикт","sandbox.all":"Все","sandbox.batchReplay":"Пакетная регрессия","sandbox.selectBaselines":"Выберите базовые диалоги","sandbox.selectAllBaselines":"Выбрать все","sandbox.runBatchReplay":"Запустить пакетную регрессию","sandbox.batchSelectRequired":"Выберите хотя бы один диалог","sandbox.batchRunning":"Пакетная регрессия выполняется...","sandbox.batchCompleted":"Пакетная регрессия: {completed} завершено, {failed} ошибок","sandbox.batchFailed":"Ошибка пакетной регрессии: {error}","sandbox.noBaselines":"Нет базовых диалогов","sandbox.semanticSimilarity":"Семант. сходство","sandbox.avgSimilarity":"Ср. сходство","sandbox.rateNewResponse":"Оценить ответ","sandbox.ratingSaved":"Оценка сохранена","help.close":"Закрыть справку","help.tipsTitle":"Полезные советы","help.searchPlaceholder":"Поиск по справке...","help.dashboard.title":"Справка: Дашборд","help.dashboard.overview":"<p>Главная страница админ-панели — оперативная сводка по работе AI-агента за текущий день. Все метрики обновляются <strong>автоматически каждые 30 секунд</strong>.</p>","help.dashboard.stats.title":"Карточки статистики","help.dashboard.stats.content":"<p>Верхний ряд карточек показывает ключевые метрики за сегодня:</p><ul><li><strong>Звонки сегодня</strong> — общее количество входящих звонков</li><li><strong>Решено ботом</strong> — звонки, которые AI-агент обработал самостоятельно без перевода на оператора</li><li><strong>Переведено</strong> — звонки, переведённые на живого оператора</li><li><strong>Средн. качество</strong> — средняя оценка качества диалогов (0.0–1.0). Зелёный — хорошо (≥0.7), жёлтый — средне, красный — плохо (<0.4)</li><li><strong>Стоимость ($)</strong> — совокупные расходы на LLM API за сегодня</li></ul>","help.dashboard.filters.title":"Фильтр по сети","help.dashboard.filters.content":"<p>Если в системе несколько <strong>тенантов</strong> (торговых сетей), выпадающий список позволяет просмотреть статистику по конкретной сети или по всем сразу.</p><ul><li><strong>Все сети</strong> — суммарная статистика</li><li><strong>Конкретная сеть</strong> (напр. ProKoleso, Твоя Шина) — только звонки этой сети</li></ul>","help.dashboard.export.title":"Экспорт данных","help.dashboard.export.content":"<p>Доступны два формата выгрузки:</p><ul><li><strong>Экспорт CSV</strong> — табличный файл с ежедневной статистикой для импорта в Excel или Google Sheets</li><li><strong>Скачать PDF</strong> — отчёт за последние 7 дней с графиками и сводкой, готовый для отправки руководству</li></ul>","help.dashboard.export.steps":"Пошаговая инструкция: Экспорт","help.dashboard.export.stepsContent":"<p><strong>Экспорт CSV:</strong></p><ol><li>При необходимости выберите <strong>сеть</strong> в фильтре</li><li>Нажмите <strong>«Экспорт CSV»</strong></li><li>Файл скачается автоматически</li></ol><p><strong>PDF-отчёт:</strong></p><ol><li>Нажмите <strong>«Скачать PDF»</strong></li><li>Сформируется отчёт за последние 7 дней</li><li>Файл скачается автоматически</li></ol>","help.dashboard.tips":"<ul><li>Отслеживайте <strong>процент «Решено ботом»</strong> — это главный показатель эффективности AI-агента</li><li>Если <strong>средн. качество</strong> падает ниже 0.6 — проверьте последние изменения промпта</li><li>Используйте <strong>фильтр по сети</strong>, чтобы сравнивать эффективность агента для разных тенантов</li><li>PDF-отчёт удобен для <strong>еженедельных совещаний</strong> — отправляйте его руководству</li></ul>","help.calls.title":"Справка: Журнал звонков","help.calls.overview":"<p>Детальный журнал всех звонков, обработанных AI-агентом. Позволяет просмотреть транскрипцию каждого разговора, оценить качество, проанализировать использование инструментов и выявить проблемные диалоги.</p>","help.calls.table.title":"Таблица звонков","help.calls.table.content":'<p>Основная таблица содержит колонки:</p><ul><li><strong>Дата</strong> — дата и время звонка</li><li><strong>Звонящий</strong> — caller ID (номер телефона)</li><li><strong>Сценарий</strong> — тип диалога: поиск шин, заказ, шиномонтаж, консультация</li><li><strong>Длительность</strong> — продолжительность разговора</li><li><strong>Качество</strong> — автоматическая оценка (0.0–1.0) с цветовым бейджем:<ul><li><span style="color:#22c55e">●</span> ≥ 0.7 — хорошо</li><li><span style="color:#f59e0b">●</span> 0.4–0.69 — средне</li><li><span style="color:#ef4444">●</span> < 0.4 — плохо</li></ul></li><li><strong>Стоимость</strong> — расходы на LLM API для этого звонка</li><li><strong>Статус</strong> — результат: решено ботом / переведено на оператора</li></ul><p>Нажмите на строку, чтобы открыть <strong>детали звонка</strong>.</p>',"help.calls.filters.title":"Фильтры","help.calls.filters.content":"<p>Панель фильтров позволяет сузить выборку:</p><ul><li><strong>Дата с / по</strong> — диапазон дат</li><li><strong>Сценарий</strong> — тип диалога (все, поиск шин, наличие, заказ, шиномонтаж, консультация)</li><li><strong>Статус перевода</strong> — все / переведено на оператора / решено ботом</li><li><strong>Поиск</strong> — полнотекстовый поиск по транскрипции</li><li><strong>Качество ниже</strong> — показать только звонки с оценкой ниже порога (напр. 0.5)</li><li><strong>Сеть</strong> — фильтр по тенанту</li></ul>","help.calls.filters.steps":"Пошаговая инструкция: Фильтрация","help.calls.filters.stepsContent":"<p><strong>Поиск проблемных звонков:</strong></p><ol><li>Установите <strong>«Качество ниже»</strong> = 0.5</li><li>Нажмите <strong>«Фильтровать»</strong></li><li>Просмотрите звонки с низким качеством — откройте детали каждого</li><li>Проанализируйте, на каком этапе диалога возникли проблемы</li></ol><p><strong>Поиск по содержанию:</strong></p><ol><li>Введите ключевое слово в поле <strong>«Поиск в транскрипции»</strong> (напр. «рекламація» или «повернення»)</li><li>Нажмите <strong>Enter</strong> или кнопку «Фильтровать»</li></ol><p><strong>Экспорт в CSV:</strong></p><ol><li>Настройте нужные фильтры</li><li>Нажмите <strong>«Экспорт CSV»</strong> — выгрузятся только отфильтрованные звонки</li></ol>","help.calls.detail.title":"Детали звонка","help.calls.detail.content":"<p>Модальное окно с полной информацией о звонке содержит:</p><ul><li><strong>Метаданные</strong> — номер звонящего, сценарий, длительность, качество, стоимость, версия промпта</li><li><strong>Оценка качества</strong> — разбивка по критериям: приветствие, определение потребности, использование инструментов, завершение и т.д.</li><li><strong>Транскрипция</strong> — полный текст разговора с разделением на реплики клиента и агента</li><li><strong>Вызовы инструментов</strong> — таблица использованных инструментов с результатами (успех/ошибка) и временем выполнения</li></ul>","help.calls.detail.steps":"Пошаговая инструкция: Анализ звонка","help.calls.detail.stepsContent":"<p><strong>Полный анализ звонка:</strong></p><ol><li>Нажмите на <strong>строку звонка</strong> в таблице</li><li>Просмотрите <strong>общее качество</strong> и разбивку по критериям</li><li>Прочитайте <strong>транскрипцию</strong> — обратите внимание на проблемные моменты</li><li>Проверьте <strong>вызовы инструментов</strong> — были ли ошибки</li><li>Нажмите <strong>«Скачать расшифровку»</strong> для сохранения текста</li><li>Нажмите <strong>«Открыть в песочнице»</strong> для импорта диалога в Песочницу — оценка реплик, ответвления, разметка паттернов</li></ol>","help.calls.quality.title":"Система оценки качества","help.calls.quality.content":"<p>Качество каждого звонка оценивается автоматически по нескольким критериям:</p><ul><li><strong>Приветствие</strong> — правильно ли агент представился</li><li><strong>Определение намерения</strong> — понял ли агент, что нужно клиенту</li><li><strong>Использование инструментов</strong> — правильно ли подобраны инструменты</li><li><strong>Качество ответов</strong> — полнота и корректность информации</li><li><strong>Завершение</strong> — правильно ли агент завершил разговор</li></ul><p>Итоговая оценка — среднее по всем критериям (0.0–1.0).</p>","help.calls.import.title":"Импорт звонка в песочницу","help.calls.import.content":"<p>Кнопка <strong>«Открыть в песочнице»</strong> в деталях звонка позволяет скопировать весь диалог в Песочницу для глубокого анализа.</p><p><strong>Что импортируется:</strong></p><ul><li><strong>Все реплики</strong> — с сохранением порядка и привязки к говорящему (клиент / агент)</li><li><strong>Вызовы инструментов</strong> — привязаны к соответствующим репликам агента, помечены как реальные (не mock)</li><li><strong>Метаданные</strong> — ID исходного звонка, оценка качества, длительность, сценарий, тенант</li></ul><p><strong>Что можно делать с импортированным диалогом:</strong></p><ul><li>Просматривать полную историю переписки с tool calls</li><li>Оценивать отдельные реплики агента (звёздочки 1–5)</li><li>Создавать ответвления — попробовать альтернативные сообщения клиента</li><li>Размечать группы реплик и экспортировать в паттерны</li><li>Пометить как baseline для регрессионных тестов</li></ul>","help.calls.import.steps":"Пошаговая инструкция: Импорт в песочницу","help.calls.import.stepsContent":"<p><strong>Импорт звонка:</strong></p><ol><li>Откройте <strong>детали звонка</strong> — нажмите на строку в таблице</li><li>Нажмите кнопку <strong>«Открыть в песочнице»</strong> (рядом с «Скачать расшифровку»)</li><li>Дождитесь импорта — появится уведомление об успехе</li><li>Вы автоматически перейдёте в <strong>Песочницу</strong>, где откроется импортированный диалог</li></ol><p><strong>Анализ импортированного диалога:</strong></p><ol><li>Просмотрите реплики — обратите внимание на проблемные моменты</li><li>Оцените ответы агента звёздочками</li><li>Если нашли проблемный момент — нажмите <strong>«Branch»</strong> и попробуйте другое сообщение клиента</li><li>Сравните, как агент реагирует на альтернативные запросы</li><li>При необходимости разметьте группы для экспорта в паттерны</li></ol>","help.calls.costBreakdown.title":"Разбивка стоимости звонка","help.calls.costBreakdown.content":"<p>В деталях каждого звонка отображается <strong>таблица разбивки стоимости</strong>, если данные доступны:</p><ul><li><strong>STT</strong> — провайдер распознавания речи, длительность обработки, стоимость</li><li><strong>LLM</strong> — модель, количество входных/выходных токенов, тарифы за 1M токенов, итоговая стоимость</li><li><strong>TTS</strong> — количество символов, стоимость синтеза речи</li><li><strong>Итого</strong> — суммарная стоимость звонка</li></ul><p>Тарифы LLM берутся из таблицы <strong>«Ценообразование моделей»</strong> на странице «Анализ стоимости» и обновляются автоматически каждые 5 минут.</p>","help.calls.tips":"<ul><li>Регулярно просматривайте звонки с <strong>качеством ниже 0.5</strong> — они указывают на проблемы</li><li>Используйте <strong>поиск по транскрипции</strong> для поиска конкретных тем или проблем</li><li>Звонки со статусом <strong>«Переведено»</strong> — потенциальные зоны для улучшения промпта</li><li>Экспортируйте данные в <strong>CSV</strong> для построения графиков в Excel</li><li><strong>Скачайте расшифровку</strong> проблемного звонка и используйте её для создания нового диалога в разделе «Сценарии»</li><li>Нажмите <strong>«Открыть в песочнице»</strong> — импортируйте проблемный звонок для анализа, ответвлений и разметки паттернов</li></ul>","help.operators.title":"Справка: Операторы","help.operators.overview":"<p>Управление живыми операторами колл-центра. Когда AI-агент не может решить вопрос самостоятельно, он переводит звонок на оператора через инструмент <code>transfer_to_operator</code>. На этой странице вы ведёте реестр операторов, отслеживаете их статусы и управляете доступностью.</p>","help.operators.table.title":"Что отображается на странице","help.operators.table.content":'<p><strong>Верхняя панель</strong> показывает оперативные метрики:</p><ul><li><strong>Операторов онлайн</strong> — сколько операторов сейчас доступны для приёма звонков</li><li><strong>Переводов (1ч)</strong> — количество переводов от бота за последний час</li></ul><p><strong>Таблица операторов</strong> содержит колонки:</p><ul><li><strong>Имя</strong> — ФИО оператора</li><li><strong>Внутр. номер</strong> — SIP-extension (напр. 101, 102). Уникален для каждого оператора</li><li><strong>Статус</strong> — текущее состояние: <span style="color:#22c55e">●</span> Онлайн, <span style="color:#6b7280">●</span> Оффлайн, <span style="color:#f59e0b">●</span> Занят, <span style="color:#3b82f6">●</span> Перерыв</li><li><strong>Навыки</strong> — теги компетенций (шины, заказы, шиномонтаж и т.д.)</li><li><strong>Смена</strong> — рабочие часы (напр. 09:00–18:00)</li><li><strong>Активен</strong> — включён ли оператор в систему</li><li><strong>Действия</strong> — меню с быстрыми действиями (⋮)</li></ul><p>Данные обновляются <strong>автоматически каждые 10 секунд</strong>.</p>',"help.operators.creating.title":"Создание и редактирование оператора","help.operators.creating.content":"<p>Каждый оператор — это запись в системе, связанная с SIP-номером телефонии. Поля:</p><ul><li><strong>Имя</strong> — ФИО, отображается в таблице и аналитике</li><li><strong>Внутр. номер (SIP)</strong> — extension в Asterisk (напр. 101). Должен быть <strong>уникальным</strong></li><li><strong>Навыки</strong> — через запятую: <code>шины, заказы, шиномонтаж</code>. Используются для маршрутизации — бот передаёт звонок оператору с нужной компетенцией</li><li><strong>Начало / конец смены</strong> — рабочее время оператора (напр. 09:00–18:00)</li></ul>","help.operators.creating.steps":"Пошаговая инструкция: Создание оператора","help.operators.creating.stepsContent":"<p><strong>Добавление нового оператора:</strong></p><ol><li>Нажмите кнопку <strong>«+ Новый оператор»</strong></li><li>Введите <strong>ФИО</strong> оператора</li><li>Введите <strong>внутренний номер</strong> (SIP extension) — он должен совпадать с настройками в Asterisk</li><li>Перечислите <strong>навыки</strong> через запятую (напр. <code>шины, заказы</code>)</li><li>Укажите <strong>время смены</strong> — начало и конец рабочего дня</li><li>Нажмите <strong>«Сохранить»</strong></li></ol><p><strong>Редактирование:</strong></p><ol><li>Нажмите <strong>три точки (⋮)</strong> в строке оператора</li><li>Выберите <strong>«Ред.»</strong></li><li>Измените нужные поля</li><li>Нажмите <strong>«Сохранить»</strong></li></ol><p><strong>Деактивация:</strong></p><ol><li>Нажмите <strong>⋮ → «Деактив.»</strong></li><li>Подтвердите — оператор станет неактивным (не удаляется из системы)</li></ol>","help.operators.status.title":"Управление статусами","help.operators.status.content":"<p>Статус определяет, доступен ли оператор для приёма переведённых звонков:</p><ul><li><strong>Онлайн</strong> — оператор на рабочем месте, готов принять звонок</li><li><strong>Оффлайн</strong> — оператор не работает (по умолчанию при создании)</li><li><strong>Занят</strong> — оператор разговаривает с другим клиентом</li><li><strong>Перерыв</strong> — оператор временно недоступен (обед, пауза)</li></ul><p>Каждое изменение статуса <strong>логируется</strong> в историю — можно отслеживать, когда оператор вышел на смену, ушёл на перерыв и т.д.</p>","help.operators.status.steps":"Пошаговая инструкция: Смена статуса","help.operators.status.stepsContent":"<p><strong>Быстрая смена статуса:</strong></p><ol><li>Нажмите <strong>три точки (⋮)</strong> в строке оператора</li><li>В выпадающем меню выберите нужный статус: <strong>Онлайн / Оффлайн / Занят / Перерыв</strong></li><li>Статус изменится мгновенно, бейдж обновится</li></ol><p><strong>Типичный рабочий день:</strong></p><ol><li>Начало смены — установите статус <strong>«Онлайн»</strong></li><li>Обеденный перерыв — переключите на <strong>«Перерыв»</strong></li><li>После обеда — вернитесь в <strong>«Онлайн»</strong></li><li>Конец дня — переключите на <strong>«Оффлайн»</strong></li></ol>","help.operators.skills.title":"Навыки и маршрутизация","help.operators.skills.content":"<p>Навыки — ключевой элемент <strong>интеллектуальной маршрутизации</strong>. Когда AI-агент переводит звонок, система подбирает оператора с подходящими навыками.</p><p><strong>Рекомендуемые навыки:</strong></p><ul><li><code>шины</code> — консультации по подбору шин, размерам, брендам</li><li><code>заказы</code> — вопросы по заказам, оплате, возвратам</li><li><code>шиномонтаж</code> — запись на шиномонтаж, расписание, адреса</li><li><code>гарантия</code> — гарантийные случаи, рекламации</li><li><code>доставка</code> — сроки и условия доставки</li></ul><p>Оператор может иметь <strong>несколько навыков</strong> — чем больше, тем чаще он будет получать переводы.</p>","help.operators.transfer.title":"Как работает перевод от бота","help.operators.transfer.content":"<p>Процесс перевода звонка с AI-агента на живого оператора:</p><ol><li>Клиент просит оператора, или агент понимает, что не может помочь</li><li>Агент вызывает инструмент <code>transfer_to_operator</code> с указанием причины</li><li>Система ищет <strong>онлайн-оператора</strong> с подходящими навыками</li><li>Агент произносит фразу перевода (из шаблонов категории <code>transfer</code>)</li><li>Asterisk переключает звонок на SIP-extension оператора</li></ol><p><strong>Если нет доступных операторов:</strong> агент извинится и предложит перезвонить позже.</p>","help.operators.affects.title":"На что влияют изменения","help.operators.affects.content":'<div class="help-affects"><p><strong>Статус «Онлайн»</strong> — оператор доступен для переводов. Если все операторы оффлайн, бот не сможет перевести звонок и сообщит клиенту об этом.</p><p><strong>Навыки</strong> — определяют, какие звонки получит оператор. Если навыки не заполнены — оператор может не получать переводы.</p><p><strong>Деактивация</strong> — оператор полностью исключается из маршрутизации. Используйте для увольнений или длительных отпусков.</p><p><strong>Внутренний номер</strong> — должен совпадать с SIP-extension в Asterisk. При ошибке звонок не дойдёт до оператора.</p></div>',"help.operators.tips":"<ul><li>Следите за метрикой <strong>«Операторов онлайн»</strong> — если 0, бот не сможет переводить звонки</li><li>Назначайте каждому оператору хотя бы <strong>один навык</strong> — без навыков маршрутизация не работает</li><li>Используйте статус <strong>«Перерыв»</strong> вместо «Оффлайн» для коротких отлучек — это точнее для аналитики</li><li>Проверяйте, что <strong>внутренний номер</strong> совпадает с настройками в Asterisk</li><li>Деактивированного оператора можно активировать обратно — данные не удаляются</li></ul>","help.scenarios.title":"Справка: Обучение агента","help.scenarios.overview":"<p>Управление обучающими данными AI-агента. Здесь настраиваются <strong>шаблоны ответов</strong> (готовые фразы), <strong>примеры диалогов</strong> (few-shot обучение) и <strong>правила безопасности</strong> (ограничения). Все изменения применяются <strong>мгновенно</strong> — при следующем звонке агент будет использовать обновлённые данные.</p>","help.scenarios.templates.title":"Что такое шаблоны ответов","help.scenarios.templates.content":"<p>Шаблоны — готовые фразы на украинском языке, которые агент произносит в типичных ситуациях. Каждый шаблон принадлежит одной из категорий:</p><ul><li><strong>greeting</strong> — приветствие при начале разговора</li><li><strong>farewell</strong> — прощание в конце разговора</li><li><strong>silence_prompt</strong> — фраза при молчании клиента</li><li><strong>transfer</strong> — сообщение при переводе на оператора</li><li><strong>error</strong> — фраза при технической ошибке</li><li><strong>wait</strong> — просьба подождать</li><li><strong>order_cancelled</strong> — сообщение об отмене заказа</li></ul><p>У каждой категории может быть <strong>несколько вариантов</strong> — агент случайно выбирает один из активных, чтобы речь звучала естественнее.</p>","help.scenarios.templates.steps":"Пошаговая инструкция: Шаблоны","help.scenarios.templates.stepsContent":"<p><strong>Создание нового шаблона:</strong></p><ol><li>Нажмите кнопку <strong>«Новый шаблон»</strong></li><li>Выберите <strong>категорию</strong> (greeting, farewell и т.д.)</li><li>Введите <strong>название</strong> — для вашего удобства, клиент его не видит</li><li>Введите <strong>текст</strong> — фраза на украинском языке, которую агент будет произносить</li><li>Нажмите <strong>«Сохранить»</strong></li></ol><p><strong>Добавление варианта к существующей категории:</strong></p><ol><li>Найдите нужную категорию в таблице</li><li>Нажмите кнопку <strong>«Добавить вариант»</strong> рядом с названием категории</li><li>Заполните название и текст нового варианта</li><li>Сохраните — вариант сразу доступен агенту</li></ol><p><strong>Редактирование / удаление:</strong></p><ol><li>Нажмите <strong>три точки (⋮)</strong> справа от шаблона</li><li>Выберите <strong>«Редактировать»</strong> или <strong>«Удалить»</strong></li><li>Удаление доступно только если у категории больше одного варианта</li></ol>","help.scenarios.dialogues.title":"Что такое сценарии диалогов","help.scenarios.dialogues.content":'<p>Сценарии — это <strong>примеры разговоров</strong> клиента с агентом (few-shot). Агент анализирует текущий разговор и подбирает наиболее похожий пример для формирования ответа.</p><ul><li><strong>Тип сценария</strong> — подбор шин, заказ, шиномонтаж, консультация и т.д.</li><li><strong>Фаза</strong> — этап разработки (mvp, orders, services)</li><li><strong>Формат</strong> — JSON-массив реплик: <code>[{"role": "user", "text": "..."}, {"role": "assistant", "text": "..."}]</code></li><li>Инструменты извлекаются автоматически из поля <code>tool_calls</code> в репликах</li></ul>',"help.scenarios.dialogues.steps":"Пошаговая инструкция: Диалоги","help.scenarios.dialogues.stepsContent":'<p><strong>Создание нового диалога:</strong></p><ol><li>Нажмите <strong>«Новый диалог»</strong></li><li>Введите <strong>название</strong> — описание сценария (напр. «Клиент ищет зимние шины 205/55 R16»)</li><li>Выберите <strong>тип сценария</strong> (tire_search, order_creation и т.д.)</li><li>Выберите <strong>фазу</strong> (mvp, orders, services)</li><li>Отредактируйте <strong>JSON-диалог</strong> — чередуйте реплики <code>user</code> и <code>assistant</code></li><li>Нажмите <strong>«Сохранить»</strong></li></ol><p><strong>Формат JSON-реплики:</strong></p><ul><li><code>{"role": "user", "text": "Доброго дня, мені потрібні шини"}</code></li><li><code>{"role": "assistant", "text": "Добрий день! Допоможу підібрати. Який розмір шин вам потрібен?"}</code></li></ul><p><strong>Фильтрация:</strong> используйте выпадающие списки над таблицей для фильтрации по типу сценария, фазе и статусу активности.</p>',"help.scenarios.safety.title":"Что такое правила безопасности","help.scenarios.safety.content":"<p>Правила безопасности задают <strong>ограничения и запреты</strong> для агента. Они всегда включаются в системный промпт и имеют наивысший приоритет.</p><ul><li><strong>Тип правила</strong> — prompt_injection, data_validation, off_topic, language, behavioral, escalation</li><li><strong>Серьёзность</strong> — critical (красный), high (жёлтый), medium (синий), low (серый)</li><li><strong>Триггер</strong> — сообщение клиента, которое должно активировать правило</li><li><strong>Ожидаемое поведение</strong> — как агент должен ответить на триггер</li></ul>","help.scenarios.safety.severity.title":"Как работают уровни серьёзности","help.scenarios.safety.severity.content":'<p>Уровень серьёзности определяет <strong>приоритет выполнения</strong> правила агентом:</p><table class="help-table"><tr><th>Уровень</th><th>Поведение агента</th><th>Когда использовать</th></tr><tr><td><strong style="color:var(--danger)">CRITICAL</strong></td><td><strong>Немедленное действие</strong> — агент выполняет правило СРАЗУ, без поиска в базе знань и без дополнительных вопросов. Перекрывает все остальные инструкции.</td><td>Агрессия, угрозы, prompt-injection, утечка персональных данных</td></tr><tr><td><strong style="color:var(--warning)">HIGH</strong></td><td>Высокий приоритет — агент учитывает правило при формировании ответа</td><td>Валидация данных, порядок оформления заказа, форматирование ответов</td></tr><tr><td><strong style="color:var(--info)">MEDIUM</strong></td><td>Стандартный приоритет — агент следует правилу в обычном порядке</td><td>Предложение шиномонтажа, рекомендации по альтернативам</td></tr><tr><td><strong style="color:var(--secondary)">LOW</strong></td><td>Фоновый приоритет — рекомендация, но не обязательство</td><td>Обработка off-topic запросов (погода, анекдоты)</td></tr></table><p><strong>Важно:</strong> если правило должно вызывать немедленное действие (переключение на оператора, отказ) — ставьте <strong>CRITICAL</strong>. В поле «Ожидаемое поведение» указывайте конкретный инструмент: <code>transfer_to_operator</code>.</p>',"help.scenarios.safety.steps":"Пошаговая инструкция: Правила безопасности","help.scenarios.safety.stepsContent":"<p><strong>Создание правила:</strong></p><ol><li>Нажмите <strong>«Новое правило»</strong></li><li>Введите <strong>название</strong> (напр. «Запрет обсуждения конкурентов»)</li><li>Выберите <strong>тип</strong> и <strong>серьёзность</strong></li><li>В поле <strong>«Триггер»</strong> введите пример сообщения клиента, которое должно активировать правило</li><li>В поле <strong>«Ожидаемое поведение»</strong> опишите, как агент должен реагировать</li><li>Сохраните</li></ol><p><strong>Регрессионный тест:</strong></p><ol><li>Нажмите <strong>«Регрессионный тест»</strong> рядом с кнопкой создания</li><li>Система отправит триггеры всех активных правил агенту</li><li>В результатах увидите: прошёл / не прошёл, ожидаемое vs фактическое поведение</li><li>Исправьте правила, которые не прошли тест</li></ol>","help.scenarios.affects.title":"На что влияют изменения","help.scenarios.affects.content":'<div class="help-affects"><p><strong>Шаблоны ответов:</strong> влияют на <strong>конкретные фразы</strong> агента в стандартных ситуациях. Если вы измените шаблон приветствия — все новые звонки начнутся с нового текста.</p><p><strong>Сценарии диалогов:</strong> влияют на <strong>стиль ведения разговора</strong>. Агент ищет наиболее похожий пример и подражает ему. Больше хороших примеров = лучшее качество диалогов.</p><p><strong>Правила безопасности:</strong> влияют на <strong>запреты и ограничения</strong>. Критические правила агент не может нарушить. Если правило удалено — ограничение снято.</p></div><p><strong>Важно:</strong> все изменения применяются мгновенно. Рекомендуем сначала протестировать в <strong>Песочнице</strong>.</p>',"help.scenarios.tips":"<ul><li>Начните с просмотра существующих шаблонов и диалогов — они уже покрывают основные сценарии</li><li>Добавляйте по 2-3 варианта шаблонов для каждой категории — это делает речь агента естественнее</li><li>Новые диалоги <strong>мгновенно</strong> попадают в few-shot выборку агента</li><li>Перед важными изменениями запустите <strong>регрессионный тест</strong> правил безопасности</li><li>Правила <strong>CRITICAL</strong> выполняются немедленно — агент пропускает поиск в базе знань и сразу действует (напр. переключает на оператора)</li><li>В поле «Ожидаемое поведение» указывайте конкретное действие и инструмент: <code>transfer_to_operator</code>, а не общие фразы</li></ul>","help.knowledge.title":"Справка: База знаний","help.knowledge.overview":"<p>База знаний содержит статьи, по которым агент консультирует клиентов. Когда клиент задаёт вопрос о доставке, гарантии, возврате и т.д., агент ищет ответ в этих статьях через <strong>RAG-поиск</strong> (по смыслу, не по ключевым словам). Чем больше качественных статей — тем точнее консультации.</p>","help.knowledge.articles.title":"Что такое статьи","help.knowledge.articles.content":"<p>Статьи — основной контент базы знаний. Каждая статья имеет:</p><ul><li><strong>Категория</strong> — faq, guides, brands, comparisons, delivery, warranty, returns, policies, general и др.</li><li><strong>Контент</strong> — текст в формате Markdown (поддерживаются заголовки, списки, ссылки)</li><li><strong>Эмбеддинг</strong> — векторное представление для поиска по смыслу. Статус:<ul><li>Зелёный <strong>«indexed»</strong> — статья готова к поиску</li><li>Жёлтый <strong>«pending»</strong> — ожидает генерации (каждые 5 минут)</li><li>Красный <strong>«error»</strong> — ошибка, нужна переиндексация</li></ul></li><li><strong>Срок действия</strong> — можно установить дату, после которой статья автоматически скроется (полезно для акций)</li></ul>","help.knowledge.articles.steps":"Пошаговая инструкция: Статьи","help.knowledge.articles.stepsContent":"<p><strong>Создание статьи вручную:</strong></p><ol><li>Нажмите <strong>«+ Новая статья»</strong></li><li>Введите <strong>название</strong> — чёткое и описательное (напр. «Условия доставки по Украине»)</li><li>Выберите <strong>категорию</strong></li><li>Напишите <strong>контент</strong> в формате Markdown</li><li>При необходимости установите <strong>срок действия</strong></li><li>Нажмите <strong>«Сохранить»</strong> — через 5 минут статья будет проиндексирована</li></ol><p><strong>Импорт из файлов (быстрое пополнение):</strong></p><ol><li>Нажмите <strong>«Импорт документов»</strong></li><li>Выберите файлы (.md, .pdf, .docx) — можно несколько</li><li>При необходимости выберите категорию (если не выбрана — определится из имени файла)</li><li>Нажмите <strong>«Импортировать»</strong> — статьи создадутся автоматически</li></ol><p><strong>Переиндексация:</strong></p><ul><li><strong>Одна статья:</strong> меню ⋮ → «Переиндексировать»</li><li><strong>Все статьи:</strong> кнопка «Переиндексировать всё» (занимает время, используйте при массовых проблемах)</li></ul>","help.knowledge.sources.title":"Что такое конфигурации источников","help.knowledge.sources.content":"<p>Источники — внешние сайты, с которых система автоматически собирает статьи в базу знаний.</p><ul><li><strong>Тип</strong>:<ul><li><strong>HTML</strong> — обычные веб-страницы (извлечение текста через trafilatura)</li><li><strong>RSS</strong> — RSS/Atom-ленты (feedparser + trafilatura)</li><li><strong>ProKoleso</strong> — специализированный парсер для prokoleso.ua</li></ul></li><li><strong>Язык</strong> — язык источника (UK, DE, EN, FR). Контент на иностранном языке будет <strong>автоматически переведён</strong> на украинский через LLM</li><li><strong>Расписание</strong> — день и час автоматического запуска</li><li><strong>Auto-approve</strong> — если включено, статьи сразу активируются; если нет — требуют ручного одобрения</li></ul>","help.knowledge.sources.steps":"Пошаговая инструкция: Источники","help.knowledge.sources.stepsContent":"<p><strong>Добавление источника:</strong></p><ol><li>Перейдите на вкладку <strong>«Конфигурации»</strong></li><li>Нажмите <strong>«Добавить источник»</strong></li><li>Заполните:<ol><li><strong>Название</strong> — для вашего удобства</li><li><strong>Тип</strong> — HTML, RSS или ProKoleso</li><li><strong>Язык</strong> — язык источника (статьи будут переведены на украинский)</li><li><strong>URL</strong> — адрес сайта или RSS-ленты</li><li><strong>Макс. статей за запуск</strong> — ограничение на одну итерацию</li><li><strong>Расписание</strong> — день недели и час</li></ol></li><li>Нажмите <strong>«Сохранить»</strong></li></ol><p><strong>Ручной запуск:</strong> меню ⋮ → «Запустить» — немедленная загрузка статей из этого источника.</p><p><strong>Включение/выключение:</strong> переключатель в столбце «Enabled» — моментальное сохранение.</p>","help.knowledge.scraper.title":"Вкладка «Скрапер»","help.knowledge.scraper.content":"<p>Управление настройками скрапера и просмотр результатов загрузки.</p><p><strong>Настройки:</strong></p><ul><li><strong>Enabled</strong> — включить/выключить скрапер глобально</li><li><strong>Auto-approve</strong> — автоматически активировать загруженные статьи</li><li><strong>Dedup LLM check</strong> — проверка дубликатов через LLM (предотвращает повторные статьи)</li><li><strong>«Запустить»</strong> — немедленный запуск всех активных источников</li></ul><p><strong>Таблица результатов:</strong> показывает каждую загруженную страницу со статусом:</p><ul><li>Зелёный <strong>processed</strong> — успешно обработана</li><li>Жёлтый <strong>new</strong> — ещё не обработана</li><li>Серый <strong>skipped</strong> — пропущена (дубликат или нерелевантна)</li><li>Красный <strong>error</strong> — ошибка загрузки/обработки</li></ul><p>Для обработанных статей: меню ⋮ → «Просмотреть статью» или «Одобрить» / «Отклонить».</p>","help.knowledge.watched.title":"Что такое отслеживаемые страницы","help.knowledge.watched.content":"<p>Отслеживаемые страницы — URL, которые система периодически пересканирует. При обнаружении изменений контента статья <strong>автоматически обновляется</strong>.</p><ul><li><strong>Интервал</strong> — частота проверки: 6ч, 12ч, 24ч или 1 неделя</li><li><strong>Discovery</strong> — режим «обнаружения»: сканирует страницу на вложенные ссылки и автоматически добавляет дочерние страницы</li><li><strong>Массовый импорт</strong> — загрузка списка URL (по одному на строку)</li><li><strong>Привязка к тенанту</strong> — статьи могут принадлежать конкретной сети (ProKoleso / Твоя Шина)</li></ul>","help.knowledge.watched.steps":"Пошаговая инструкция: Отслеживаемые страницы","help.knowledge.watched.stepsContent":"<p><strong>Добавление страницы:</strong></p><ol><li>Перейдите на вкладку <strong>«Отслеживаемые»</strong></li><li>В поле <strong>URL</strong> введите адрес страницы</li><li>Выберите <strong>категорию</strong> и <strong>интервал</strong> проверки</li><li>При необходимости выберите <strong>тенант</strong></li><li>Отметьте <strong>Discovery</strong>, если хотите автоматически обнаружить дочерние страницы</li><li>Нажмите <strong>«Добавить»</strong></li></ol><p><strong>Массовый импорт:</strong></p><ol><li>Нажмите <strong>«Массовый импорт»</strong></li><li>Вставьте URL (по одному на строку)</li><li>Выберите категорию, интервал и тенант</li><li>Нажмите <strong>«Импортировать»</strong> — дубликаты автоматически пропускаются</li></ol><p><strong>Немедленное сканирование:</strong> меню ⋮ → «Сканировать сейчас». Результат: содержимое не изменилось / обновлено.</p>","help.knowledge.promotions.title":"Отслеживание акций","help.knowledge.promotions.content":"<p>Акции отслеживаются через <strong>Discovery-страницы</strong> — система автоматически обнаруживает и актуализирует все акционные предложения.</p><h4>Как это работает</h4><ol><li><strong>Добавляете главную страницу акций</strong> (напр. <code>/promotions/</code>) с флагом <strong>Discovery</strong></li><li>Система находит все ссылки на дочерние страницы (каждая акция = отдельная ссылка)</li><li>Каждая дочерняя страница скрапится, обрабатывается LLM и сохраняется как статья в базе знаний</li><li>Генерируются эмбеддинги — акция становится доступна агенту через <code>search_knowledge_base</code></li></ol><h4>Жизненный цикл акций</h4><ul><li><strong>Новая акция</strong> — при очередном скане discovery-страницы обнаруживается новая ссылка → автоматически создаётся дочерняя watched page → скрапится → статья добавляется в БЗ</li><li><strong>Изменение контента</strong> — при ресканировании сравнивается SHA-256 хэш контента. Если хэш изменился — статья <strong>обновляется</strong> (не дублируется), пересоздаются эмбеддинги</li><li><strong>Акция завершилась</strong> — если ссылка исчезла с главной страницы акций, статья <strong>автоматически деактивируется</strong> (active=false) и больше не попадает в RAG-поиск</li></ul><h4>Что видит агент</h4><p>Во время звонка агент вызывает инструмент <code>search_knowledge_base</code> с категорией <strong>«promotions»</strong>. Поиск по pgvector находит релевантные чанки статей и агент озвучивает клиенту актуальные акции.</p>","help.knowledge.promotions.steps":"Пошаговая инструкция: Настройка отслеживания акций","help.knowledge.promotions.stepsContent":"<p><strong>Настройка Discovery-страницы акций:</strong></p><ol><li>Перейдите на вкладку <strong>«Отслеживаемые»</strong></li><li>В поле URL введите главную страницу акций (напр. <code>https://prokoleso.ua/ua/promotions/</code>)</li><li>Выберите категорию <strong>«promotions»</strong></li><li>Установите интервал <strong>24 часа</strong> (оптимально для акций)</li><li>Обязательно отметьте <strong>☑ Discovery</strong></li><li>Выберите <strong>тенант</strong> (напр. ProKoleso)</li><li>Нажмите <strong>«Добавить»</strong></li></ol><p><strong>Первичное сканирование:</strong></p><ol><li>После добавления нажмите меню ⋮ → <strong>«Сканировать сейчас»</strong></li><li>Система найдёт все дочерние страницы акций</li><li>Каждая акция будет обработана LLM и проиндексирована</li><li>Проверьте результат: количество найденных дочерних страниц отображается в столбце <strong>«Дочерние»</strong></li></ol><p><strong>Далее система работает автоматически:</strong> новые акции добавляются, устаревшие скрываются, контент обновляется при изменении на сайте.</p>","help.knowledge.affects.title":"На что влияют изменения","help.knowledge.affects.content":'<div class="help-affects"><p><strong>Статьи</strong> — это контент, который агент цитирует при ответе на вопросы клиентов. Если статья удалена или деактивирована — агент <strong>не сможет ответить</strong> на связанные вопросы.</p><p><strong>Эмбеддинги</strong> — без них статья <strong>невидима</strong> для RAG-поиска. Новые статьи индексируются автоматически каждые 5 минут.</p><p><strong>Источники и отслеживаемые страницы</strong> — влияют на <strong>автоматическое обновление</strong> базы знаний. Если источник отключен — новые статьи с этого сайта не загружаются.</p></div>',"help.knowledge.tips":"<ul><li>Для быстрого пополнения используйте <strong>импорт .md файлов</strong> или <strong>массовый импорт URL</strong></li><li>Проверяйте столбец <strong>«Эмбеддинг»</strong> — статьи со статусом «pending» ещё не доступны для поиска</li><li>Устанавливайте <strong>срок действия</strong> для акционных статей — они автоматически скроются</li><li>Используйте режим <strong>Discovery</strong> для автоматического обнаружения новых страниц на сайте</li><li>Отслеживаемые страницы с интервалом <strong>24ч</strong> — оптимальный баланс между актуальностью и нагрузкой</li></ul>","help.prompts.title":"Справка: Промпты","help.prompts.overview":"<p>Промпт — это <strong>главная инструкция</strong> AI-агента: текст, определяющий его поведение, стиль общения, компетенции и ограничения. Промпт — самый влиятельный параметр: даже небольшое изменение может кардинально изменить качество диалогов.</p>","help.prompts.versions.title":"Что такое версии промптов","help.prompts.versions.content":"<p>Система хранит <strong>историю всех версий</strong> промпта. В каждый момент только одна версия <strong>активна</strong> (используется в реальных звонках). Остальные — черновики или архив.</p><ul><li><strong>Имя версии</strong> — уникальный идентификатор (напр. <code>v3.5-natural</code>)</li><li><strong>Статус Active</strong> — зелёный бейдж = используется прямо сейчас</li><li><strong>«Загрузить по умолчанию»</strong> — заполняет текстовое поле встроенным промптом (удобно как основа для новой версии)</li></ul>","help.prompts.versions.steps":"Пошаговая инструкция: Промпты","help.prompts.versions.stepsContent":"<p><strong>Создание новой версии:</strong></p><ol><li>Нажмите <strong>«Новая версия»</strong></li><li>Введите <strong>имя</strong> (напр. <code>v4.0-concise</code>)</li><li>Нажмите <strong>«Загрузить по умолчанию»</strong> если хотите начать с базового промпта</li><li>Отредактируйте <strong>текст промпта</strong> — это инструкция для агента на украинском языке</li><li>Нажмите <strong>«Создать»</strong></li></ol><p><strong>Активация версии:</strong></p><ol><li>Найдите нужную версию в таблице</li><li>Меню ⋮ → <strong>«Активировать»</strong></li><li>Подтвердите — <strong>все новые звонки</strong> сразу начнут использовать эту версию</li></ol><p><strong>Безопасный процесс обновления промпта:</strong></p><ol><li>Создайте новую версию</li><li>Протестируйте в <strong>Песочнице</strong> (выберите версию при создании разговора)</li><li>Убедитесь в качестве — проверьте несколько сценариев</li><li>Активируйте или запустите <strong>A/B тест</strong></li></ol>","help.prompts.ab.title":"Что такое A/B тесты","help.prompts.ab.content":"<p>A/B тест позволяет <strong>сравнить две версии промпта</strong> на реальном трафике. Звонки автоматически распределяются между вариантами, и система собирает метрики качества.</p><ul><li><strong>Распределение трафика</strong> — ползунок от 10% до 90% (рекомендуем начинать с 50/50)</li><li><strong>Метрики</strong> — качество, длительность, процент переводов на оператора</li><li><strong>Статистическая значимость</strong> — система рассчитывает p-value и z-score</li><li><strong>Отчёт</strong> — детальное сравнение по 8 критериям, разбивка по сценариям, дневная динамика</li></ul>","help.prompts.ab.steps":"Пошаговая инструкция: A/B тесты","help.prompts.ab.stepsContent":"<p><strong>Запуск A/B теста:</strong></p><ol><li>Убедитесь, что у вас есть <strong>минимум 2 версии</strong> промпта</li><li>Нажмите <strong>«Новый A/B тест»</strong></li><li>Введите <strong>название</strong> теста</li><li>Выберите <strong>вариант A</strong> и <strong>вариант B</strong></li><li>Настройте <strong>распределение трафика</strong> ползунком</li><li>Нажмите <strong>«Создать»</strong> — тест начнётся немедленно</li></ol><p><strong>Анализ результатов:</strong></p><ol><li>Нажмите на <strong>название теста</strong> в таблице для просмотра отчёта</li><li>Проверьте <strong>общие метрики</strong>: звонки, качество, длительность, переводы</li><li>Изучите <strong>разбивку по критериям</strong>: приветствие, определение намерения, использование инструментов и т.д.</li><li>Подождите статистической значимости (бейдж значимости)</li></ol><p><strong>Завершение теста:</strong></p><ol><li>Меню ⋮ → <strong>«Остановить»</strong></li><li>Активируйте версию-победителя через таблицу промптов</li></ol>","help.prompts.affects.title":"На что влияют изменения","help.prompts.affects.content":'<div class="help-affects"><p><strong>Активация промпта</strong> — мгновенно меняет поведение агента для <strong>всех новых звонков</strong>. Текущие звонки используют ту версию, с которой начались.</p><p><strong>A/B тест</strong> — разделяет трафик между двумя версиями. Во время теста агент может вести себя по-разному для разных клиентов.</p><p><strong>Промпт — самый влиятельный параметр.</strong> Небольшое изменение формулировки может кардинально изменить стиль общения, точность ответов и использование инструментов.</p></div>',"help.prompts.tips":"<ul><li><strong>Никогда</strong> не активируйте промпт без предварительного тестирования в Песочнице</li><li>Используйте A/B тесты для проверки гипотез — не меняйте промпт «на глаз»</li><li>Версионирование позволяет <strong>мгновенно откатиться</strong> к предыдущей версии при проблемах</li><li>Кнопка <strong>«Сбросить до стандартного»</strong> создаёт новую версию из встроенного промпта — полезно для отката</li><li>Экспортируйте отчёт A/B теста в CSV для детального анализа</li></ul>","help.sandbox.title":"Справка: Песочница","help.sandbox.overview":"<p>Песочница — среда для <strong>тестирования AI-агента</strong> без реальных звонков. Здесь можно вести диалог с агентом, оценивать качество ответов, запускать регрессионные тесты и экспортировать паттерны поведения. Это главный инструмент <strong>контроля качества</strong>.</p>","help.sandbox.chat.title":"Вкладка «Чат»","help.sandbox.chat.content":"<p>Интерактивный диалог с AI-агентом. Левая панель — список разговоров, правая — чат.</p><p><strong>Возможности:</strong></p><ul><li><strong>Режим инструментов:</strong> Mock (тестовые данные) или Live (реальные данные из Store API)</li><li><strong>Выбор промпта:</strong> можно тестировать любую версию, не только активную</li><li><strong>Выбор модели:</strong> разные LLM-модели (скорость / качество)</li><li><strong>Тип сценария:</strong> tire_search, order_creation, fitting_booking и др.</li><li><strong>Персона клиента:</strong> neutral, angry, confused, rushed, detailed — влияет на авто-генерацию сообщений</li><li><strong>Авто-клиент:</strong> кнопка «Auto customer» — LLM генерирует реалистичное сообщение клиента</li><li><strong>Оценка:</strong> звёздочки на каждом ответе агента (1-5) с комментарием</li><li><strong>Ветвление:</strong> кнопка «Branch» — попробовать альтернативное сообщение клиента с определённого момента</li></ul>","help.sandbox.chat.steps":"Пошаговая инструкция: Чат","help.sandbox.chat.stepsContent":"<p><strong>Начало тестирования:</strong></p><ol><li>Нажмите <strong>«+ Новый разговор»</strong></li><li>Если есть шаблоны быстрого старта — выберите один из них (разговор начнётся автоматически)</li><li>Или заполните вручную:<ol><li><strong>Название</strong> — для идентификации (напр. «Тест зимних шин»)</li><li><strong>Версия промпта</strong> — выберите нужную (активная отмечена *)</li><li><strong>Модель</strong> — LLM-модель</li><li><strong>Режим инструментов</strong> — Mock для тестов, Live для проверки с реальными данными</li><li><strong>Сценарий</strong> — тип диалога (необязательно)</li></ol></li><li>Нажмите <strong>«Создать»</strong></li></ol><p><strong>Оценка качества ответов:</strong></p><ol><li>Прочитайте ответ агента</li><li>Нажмите на <strong>звёздочки</strong> (1-5) для оценки</li><li>Добавьте <strong>комментарий</strong> — что хорошо / что нужно улучшить</li></ol><p><strong>Разметка групп реплик (для экспорта в паттерны):</strong></p><ol><li>Включите <strong>«Режим разметки»</strong> в шапке чата</li><li>Отметьте галочками реплики, которые хотите сгруппировать</li><li>Нажмите <strong>«Создать группу»</strong></li><li>Укажите <strong>интент</strong>, <strong>тип</strong> (позитивный/негативный) и <strong>оценку</strong></li><li>Для негативных групп укажите <strong>коррекцию</strong> — правильный ответ</li><li>Сохраните — группу можно экспортировать в паттерны</li></ol>","help.sandbox.regression.title":"Вкладка «Регрессия»","help.sandbox.regression.content":"<p>Автоматическое воспроизведение сохранённого разговора с новым промптом — для проверки, что изменения не ухудшили качество.</p><ul><li>Система берёт <strong>сообщения клиента</strong> из baseline-разговора</li><li>Отправляет их агенту с <strong>новой версией промпта</strong></li><li>Сравнивает ответы: <strong>исходный</strong> vs <strong>новый</strong> — показывает разницу</li></ul>","help.sandbox.regression.steps":"Пошаговая инструкция: Регрессия","help.sandbox.regression.stepsContent":"<p><strong>Подготовка:</strong></p><ol><li>Перейдите на вкладку <strong>«Чат»</strong></li><li>Создайте или найдите качественный разговор с оценками</li><li>Нажмите <strong>«Отметить как базовый»</strong> в шапке чата — появится значок <strong>[B]</strong></li></ol><p><strong>Запуск регрессионного теста:</strong></p><ol><li>Откройте baseline-разговор на вкладке <strong>«Чат»</strong></li><li>В панели кнопок нажмите <strong>«Воспроизвести»</strong> (кнопка видна только для baseline-разговоров)</li><li>Выберите <strong>версию промпта</strong> для тестирования</li><li>Нажмите <strong>«Запустить»</strong> — результат появится на вкладке «Регрессия»</li></ol><p><strong>Анализ результатов:</strong></p><ol><li>Перейдите на вкладку <strong>«Регрессия»</strong></li><li>Нажмите на строку в таблице для просмотра деталей</li><li>Сравните ответы <strong>попарно</strong>: исходный ответ слева, новый справа</li><li>Различия подсвечены — быстро видно, что изменилось</li><li>Если качество упало — не активируйте новый промпт</li></ol>","help.sandbox.patterns.title":"Вкладка «Паттерны»","help.sandbox.patterns.content":"<p>Паттерны — экспортированные группы реплик из чатов. Используются для автоматической оценки и обучения.</p><ul><li><strong>Создание:</strong> паттерны создаются через экспорт групп из вкладки «Чат» (не здесь)</li><li><strong>Поиск:</strong> семантический поиск по паттернам — введите запрос и нажмите «Тест поиска»</li><li><strong>Управление:</strong> активация/деактивация, удаление через меню ⋮</li></ul>","help.sandbox.phrases.title":"Вкладка «Фразы агента»","help.sandbox.phrases.content":"<p>Справочная вкладка (только просмотр) — показывает <strong>все фразы</strong>, которые агент может произнести.</p><ul><li><strong>Шаблоны из БД</strong> (фиолетовые) — переопределения из раздела «Сценарии → Шаблоны»</li><li><strong>Встроенные фразы</strong> — захардкоженные фразы-заглушки (используются если нет шаблонов)</li><li><strong>Пулы фраз</strong> — наборы вариантов для случайного выбора (ожидание, уточнение и т.д.)</li></ul><p>Для редактирования фраз перейдите в <strong>Сценарии → Шаблоны ответов</strong>.</p>","help.sandbox.starters.title":"Вкладка «Шаблоны старта»","help.sandbox.starters.content":"<p>Готовые сценарии для быстрого начала тестового разговора. Шаблоны отображаются как карточки при создании нового разговора.</p><ul><li><strong>Название</strong> — краткое описание сценария</li><li><strong>Первое сообщение</strong> — стартовая реплика клиента (отправляется автоматически)</li><li><strong>Сценарий</strong> — тип (tire_search, order_creation и т.д.)</li><li><strong>Персона</strong> — тип клиента (neutral, angry, confused, rushed, detailed)</li></ul><p>Создание: кнопка <strong>«Новый шаблон»</strong>. Редактирование / удаление через кнопки в строке таблицы.</p>","help.sandbox.import.title":"Импорт реальных звонков","help.sandbox.import.content":"<p>В Песочницу можно импортировать <strong>реальные звонки</strong> из Журнала звонков. Это позволяет анализировать проблемные диалоги в среде с полным набором инструментов.</p><p><strong>Способ 1 — из Песочницы:</strong> нажмите кнопку <strong>📞</strong> рядом с «Новый диалог» в боковой панели, найдите нужный звонок в таблице и нажмите <strong>«Импорт»</strong>.</p><p><strong>Способ 2 — из Журнала звонков:</strong> откройте детали звонка и нажмите кнопку <strong>«Открыть в песочнице»</strong>.</p><p><strong>Что импортируется:</strong></p><ul><li>Все реплики (клиент и агент) с исходным порядком</li><li>Вызовы инструментов с аргументами и результатами</li><li>Метаданные: сценарий, тенант, оценка качества, длительность</li></ul><p><strong>Импортированные разговоры отмечены тегами:</strong> <code>imported</code>, <code>call:{id}</code>.</p>","help.sandbox.import.steps":"Пошаговая инструкция: Работа с импортированным звонком","help.sandbox.import.stepsContent":"<p><strong>Быстрый импорт из Песочницы:</strong></p><ol><li>Нажмите кнопку <strong>📞</strong> рядом с «Новый диалог»</li><li>Найдите звонок по номеру телефона или дате</li><li>Нажмите <strong>«Импорт»</strong> — разговор откроется в чате</li></ol><p><strong>Работа с импортированным звонком:</strong></p><ol><li>Просмотрите диалог и <strong>оцените реплики</strong> агента</li><li>На проблемном месте нажмите <strong>«Branch»</strong> — попробуйте альтернативное сообщение</li><li>Сравните, как агент обрабатывает разные варианты запросов</li><li>Разметьте проблемные группы и <strong>экспортируйте в паттерны</strong></li><li>Используйте паттерны для <strong>улучшения промпта</strong></li></ol>","help.sandbox.regressionAdvanced.title":"Расширенные функции регрессии","help.sandbox.regressionAdvanced.content":"<p>Дополнительные возможности регрессионного тестирования:</p><ul><li><strong>Удаление прогонов</strong> — удалите ненужные регрессионные тесты вместе с созданными диалогами</li><li><strong>Оценка новых ответов</strong> — оцените каждый новый ответ агента по шкале 1-5, средняя оценка рассчитывается автоматически</li><li><strong>Вердикт (Approve/Reject)</strong> — одобрите или отклоните результат регрессии, фильтруйте по вердикту</li><li><strong>Семантическое сходство</strong> — автоматическое сравнение ответов через эмбеддинги (требуется OPENAI_API_KEY). Зелёный ≥85%, жёлтый ≥60%, красный &lt;60%</li><li><strong>Пакетная регрессия</strong> — запустите регрессию сразу для нескольких базовых диалогов одной кнопкой</li></ul>","help.sandbox.workflow.title":"Рекомендуемый рабочий процесс","help.sandbox.workflow.content":"<p>Полный цикл контроля качества промпта:</p><ol><li><strong>Создайте шаблоны старта</strong> для типичных сценариев (вкладка «Шаблоны»)</li><li><strong>Проведите серию тестовых диалогов</strong> со старым промптом, оцените ответы звёздочками</li><li><strong>Пометьте лучшие разговоры как baseline</strong> (кнопка в шапке чата)</li><li><strong>Создайте новую версию промпта</strong> (раздел «Промпты»)</li><li><strong>Запустите регрессионные тесты</strong> — сравните ответы нового промпта с baseline</li><li><strong>Проведите новые тестовые диалоги</strong> с новым промптом</li><li><strong>Если качество устраивает</strong> — активируйте промпт или запустите A/B тест</li></ol>","help.sandbox.tips":"<ul><li>Перед изменением промпта <strong>пометьте лучшие разговоры как baseline</strong> — это ваша точка отсчёта</li><li>Используйте <strong>«Auto customer»</strong> для быстрой генерации реалистичных сообщений клиента</li><li>Режим <strong>Live Tools</strong> даёт реальные данные — полезно для финальной проверки перед продакшеном</li><li><strong>Ветвление</strong> позволяет попробовать «а что если клиент спросил иначе?»</li><li>Экспортируйте <strong>негативные группы</strong> в паттерны — это улучшит автоматическую оценку</li><li><strong>Импортируйте реальные звонки</strong> из Журнала — анализируйте проблемные диалоги с инструментами Песочницы</li></ul>","help.tools.title":"Справка: Инструменты агента","help.tools.overview":"<p>Инструменты (tools) — это <strong>действия</strong>, которые AI-агент может выполнять во время разговора: искать шины, проверять наличие, оформлять заказ, записывать на шиномонтаж и т.д. Здесь вы можете <strong>изменить описание</strong> любого инструмента, чтобы повлиять на то, когда и как агент его использует.</p>","help.tools.overrides.title":"Что такое переопределения описаний","help.tools.overrides.content":"<p>Каждый инструмент имеет <strong>описание по умолчанию</strong> (захардкожено в коде). LLM читает это описание и решает, когда вызвать инструмент.</p><ul><li><strong>Переопределение</strong> — замена описания по умолчанию на кастомный текст</li><li>Бейдж <strong>«Overridden»</strong> (жёлтый) — описание изменено</li><li>Бейдж <strong>«Default»</strong> (серый) — используется стандартное описание</li><li><strong>Сброс</strong> — красная кнопка удаляет переопределение и возвращает стандартное описание</li></ul>","help.tools.overrides.steps":"Пошаговая инструкция: Изменение описания","help.tools.overrides.stepsContent":"<p><strong>Изменение описания инструмента:</strong></p><ol><li>Найдите нужный инструмент в таблице</li><li>Нажмите <strong>«Редактировать»</strong></li><li>В модальном окне вверху показано <strong>оригинальное описание</strong> (для справки)</li><li>В поле ниже отредактируйте <strong>текст описания</strong></li><li>Нажмите <strong>«Сохранить»</strong></li></ol><p><strong>Сброс к стандартному:</strong></p><ol><li>Нажмите красную кнопку <strong>«Сбросить»</strong> рядом с инструментом</li><li>Подтвердите — описание вернётся к стандартному из кода</li></ol><p><strong>Проверка изменений:</strong></p><ol><li>Перейдите в <strong>Песочницу</strong></li><li>Создайте тестовый разговор</li><li>Попросите агента выполнить действие, связанное с инструментом</li><li>Проверьте, что агент правильно выбирает инструмент</li></ol>","help.tools.list.title":"Список инструментов","help.tools.list.content":"<p>Доступные инструменты агента:</p><ul><li><code>get_vehicle_tire_sizes</code> — определение размера шин по марке/модели авто</li><li><code>search_tires</code> — поиск шин по параметрам (размер, бренд, сезон)</li><li><code>check_availability</code> — проверка наличия конкретной шины на складе</li><li><code>get_order_status</code> — проверка статуса заказа по номеру</li><li><code>create_order_draft</code> — создание черновика заказа</li><li><code>update_order_delivery</code> — выбор способа доставки</li><li><code>confirm_order</code> — подтверждение заказа</li><li><code>get_fitting_stations</code> — список станций шиномонтажа</li><li><code>get_fitting_slots</code> — свободные слоты для записи</li><li><code>book_fitting</code> — запись на шиномонтаж</li><li><code>get_pickup_points</code> — точки самовывоза</li><li><code>search_knowledge_base</code> — поиск по базе знаний (RAG)</li><li><code>transfer_to_operator</code> — перевод на живого оператора</li></ul>","help.tools.affects.title":"На что влияют изменения","help.tools.affects.content":'<div class="help-affects"><p><strong>Описание инструмента</strong> — это подсказка для LLM. Агент <strong>не знает</strong>, что делает инструмент — он полагается только на описание.</p><p>Если описание <strong>слишком расплывчатое</strong> — агент может вызывать инструмент в неподходящих ситуациях.</p><p>Если описание <strong>слишком узкое</strong> — агент может пропускать ситуации, когда инструмент нужен.</p><p><strong>Пример:</strong> если агент путает <code>search_tires</code> и <code>check_availability</code>, уточните в описании: «используй search_tires для подбора по параметрам, check_availability — только для проверки конкретного артикула».</p></div>',"help.tools.tips":"<ul><li>Изменяйте описания <strong>осторожно</strong> — они напрямую влияют на выбор инструмента агентом</li><li><strong>Всегда</strong> тестируйте изменения в Песочнице перед применением</li><li>Если агент путает два инструмента — добавьте в описание <strong>явное разграничение</strong></li><li>Описание пишите на <strong>английском языке</strong> — LLM лучше понимает инструкции на английском</li><li>Используйте кнопку <strong>«Сбросить»</strong> если изменение ухудшило качество</li></ul>","help.monitoring.title":"Справка: Мониторинг","help.monitoring.overview":"<p>Страница технического мониторинга системы. Показывает состояние всех компонентов: сервер, база данных, Redis, внешние API, фоновые задачи. Используется для диагностики проблем и контроля работоспособности.</p>","help.monitoring.health.title":"Проверка здоровья","help.monitoring.health.content":"<p>Карточка <strong>«Проверка здоровья»</strong> показывает базовый статус системы:</p><ul><li><strong>Статус</strong> — общее состояние сервера (OK / ошибка)</li><li><strong>Активных звонков</strong> — количество звонков, обрабатываемых прямо сейчас</li><li><strong>Redis</strong> — подключение к хранилищу сессий (Connected / Disconnected)</li><li><strong>Готовность сервисов</strong>:<ul><li>Store API — подключение к API магазина</li><li>Claude API — подключение к LLM</li><li>Google STT — распознавание речи</li><li>TTS — синтез речи</li></ul></li></ul><p>Зелёный бейдж = работает, красный = проблема, жёлтый = предупреждение.</p>","help.monitoring.extended.title":"Расширенный статус","help.monitoring.extended.content":"<p>Детальная информация о ресурсах системы (доступна только администратору):</p><ul><li><strong>Версия</strong> — текущая версия приложения</li><li><strong>Uptime</strong> — время работы сервера без перезапуска</li><li><strong>PostgreSQL</strong> — размер базы данных и количество подключений</li><li><strong>Redis</strong> — использование памяти</li><li><strong>Celery</strong> — количество активных воркеров для фоновых задач</li><li><strong>Бэкап</strong> — время последнего резервного копирования</li></ul><p>Нажмите <strong>«Загрузить статус»</strong> для получения данных (запрос может занять несколько секунд).</p>","help.monitoring.external.title":"Внешние инструменты","help.monitoring.external.content":"<p>Быстрые ссылки на внешние системы мониторинга:</p><ul><li><strong>Grafana</strong> — дашборды с графиками метрик в реальном времени (порт 3000)</li><li><strong>Prometheus</strong> — хранилище метрик, запросы PromQL (порт 9090)</li><li><strong>Flower</strong> — мониторинг очередей Celery (фоновые задачи: скрапинг, эмбеддинги, качество)</li></ul><p>Ссылки автоматически используют имя текущего хоста.</p>","help.monitoring.tips":"<ul><li>Если <strong>Redis</strong> показывает «Disconnected» — сессии звонков не будут работать</li><li>Проверяйте <strong>Celery workers</strong> — если 0, фоновые задачи (скрапинг, эмбеддинги, оценка качества) остановятся</li><li>Следите за <strong>размером БД</strong> — при быстром росте проверьте партиционирование таблиц</li><li>Используйте <strong>Grafana</strong> для детального анализа метрик во времени</li></ul>","help.configuration.title":"Справка: Конфигурация","help.configuration.overview":"<p>Управление техническими настройками системы: горячая перезагрузка конфигурации и маршрутизация LLM-запросов между провайдерами (Anthropic, OpenAI, DeepSeek, Gemini). Доступна только администраторам.</p>","help.configuration.reload.title":"Перезагрузка конфигурации","help.configuration.reload.content":"<p>Кнопка <strong>«Перезагрузить конфиг»</strong> применяет безопасные параметры конфигурации <strong>без перезапуска</strong> сервера:</p><ul><li>Фича-флаги (напр. включение/выключение маршрутизации LLM)</li><li>Параметры качества (пороги оценки)</li><li>Уровни логирования</li></ul><p>Критические параметры (порты, подключения к БД) требуют полного перезапуска.</p>","help.configuration.llm.title":"Маршрутизация LLM","help.configuration.llm.content":"<p>Мультипровайдерная маршрутизация позволяет распределять LLM-запросы между несколькими провайдерами:</p><ul><li><strong>Таблица провайдеров</strong> — все подключённые LLM-провайдеры с их статусом:<ul><li><strong>Модель</strong> — название модели (можно изменить)</li><li><strong>Enabled</strong> — включён/выключен</li><li><strong>Статус</strong> — OK (зелёный) / DOWN (красный) / не проверен (серый)</li><li><strong>API Key</strong> — наличие ключа в переменных окружения</li></ul></li><li><strong>Тест</strong> — кнопка проверки провайдера (отправляет тестовый запрос)</li></ul>","help.configuration.llm.steps":"Пошаговая инструкция: Настройка LLM","help.configuration.llm.stepsContent":"<p><strong>Проверка провайдеров:</strong></p><ol><li>Нажмите <strong>«Загрузить конфигурацию»</strong></li><li>Просмотрите таблицу провайдеров — проверьте статусы</li><li>Для проблемного провайдера нажмите <strong>«Тест»</strong></li><li>Если статус DOWN — проверьте API-ключ в переменных окружения</li></ol><p><strong>Изменение модели провайдера:</strong></p><ol><li>Измените название модели в поле <strong>«Модель»</strong></li><li>Нажмите <strong>Enter</strong> или кликните вне поля — изменение сохранится</li></ol><p><strong>Включение/выключение провайдера:</strong></p><ol><li>Переключите тогл в колонке <strong>«Enabled»</strong></li><li>Провайдер мгновенно включится/выключится</li></ol>","help.configuration.tasks.title":"Маршрутизация задач","help.configuration.tasks.content":"<p>Каждый тип LLM-задачи можно привязать к конкретному провайдеру с цепочкой фоллбэков:</p><ul><li><strong>agent</strong> — основной диалог с клиентом (самая важная задача)</li><li><strong>quality_scoring</strong> — оценка качества звонков</li><li><strong>article_processing</strong> — обработка статей из скрапера</li><li><strong>auto_customer</strong> — генерация сообщений клиента в песочнице</li></ul><p>Для каждой задачи задаётся <strong>основной провайдер</strong> и <strong>фоллбэк-цепочка</strong> (при отказе основного). Порядок фоллбэков определяет приоритет.</p>","help.configuration.schedules.title":"Расписания фоновых задач","help.configuration.schedules.content":"<p>Управление расписаниями Celery-задач без перезапуска:</p><ul><li><strong>Полная синхронизация каталога</strong> — ежедневная загрузка всех товаров из 1С (по умолчанию 08:00 Kyiv)</li><li><strong>Обновление STT подсказок</strong> — извлечение новых моделей/производителей из каталога для улучшения распознавания речи (по умолчанию еженедельно, воскресенье 10:00)</li></ul><p>Для каждой задачи можно настроить: частота (ежедневно/еженедельно), час запуска, день недели. Кнопка «Запустить сейчас» позволяет запустить задачу вручную вне расписания. «Сбросить всё к умолчаниям» возвращает значения по умолчанию.</p>","help.configuration.tts.title":"Голосовые настройки TTS","help.configuration.tts.content":"<p>Управление голосом Google Cloud TTS без перезапуска системы:</p><ul><li><strong>Голос</strong> — выбор из списка доступных голосов (Wavenet, Neural2, Chirp3-HD)</li><li><strong>Скорость речи</strong> — от 0.25 (очень медленно) до 4.0 (очень быстро), рекомендуется 0.85–1.0</li><li><strong>Тональность</strong> — от -20 до +20 полутонов; не все голоса поддерживают pitch</li></ul><p>Кнопка «Тест голоса» синтезирует тестовую фразу с текущими настройками.</p>","help.configuration.ttsBreaks.title":"Паузы на знаках препинания","help.configuration.ttsBreaks.content":"<p>Настройка длительности SSML-пауз (<code>&lt;break&gt;</code>) после знаков препинания. Влияет на ритм и естественность речи:</p><ul><li><strong>Запятая</strong> — пауза между частями предложения (по умолчанию 100мс)</li><li><strong>Точка</strong> — пауза между предложениями (200мс)</li><li><strong>Вопрос/Восклицание</strong> — эмоциональная пауза (250мс)</li><li><strong>Двоеточие</strong> — пауза перед пояснением (200мс)</li><li><strong>Точка с запятой</strong> — пауза между связанными предложениями (150мс)</li><li><strong>Тире</strong> — пауза при контрасте/уточнении (150мс)</li></ul><p>Значение 0 мс отключает паузу для данного знака. Допустимый диапазон: 0–1000 мс.</p>","help.pointHints.title":"Подсказки для точек","help.pointHints.overview":"Описания районов и ориентиров для станций шиномонтажа и точек выдачи. AI-агент использует их, чтобы подобрать подходящую точку по запросу клиента (например, «правый берег»).","help.pointHints.fitting.title":"Вкладка «Шиномонтаж»","help.pointHints.fitting.content":"<p>Подсказки для станций шиномонтажа:</p><ul><li><strong>Район</strong> — «Правий берег», «Лівий берег», «Центр»</li><li><strong>Ориентиры</strong> — «біля Піт Лайн», «за ТЦ Караван»</li><li><strong>Описание</strong> — дополнительная информация для агента</li></ul><p>Подсказки автоматически добавляются к результатам get_fitting_stations.</p>","help.pointHints.pickup.title":"Вкладка «Точки выдачи»","help.pointHints.pickup.content":"<p>Подсказки для точек самовывоза. Те же поля (район, ориентиры, описание) добавляются к результатам get_pickup_points.</p><p>Помогают агенту, когда клиент описывает местоположение приблизительно.</p>","help.pointHints.steps":"Пошаговая инструкция","help.pointHints.stepsContent":"<ol><li>Откройте нужную вкладку (Шиномонтаж или Точки выдачи)</li><li>Список точек загрузится автоматически из кэша Redis</li><li>Для нужной точки заполните поля: район, ориентиры, описание</li><li>Нажмите «Сохранить» рядом с точкой</li><li>Подсказки применяются к новым запросам инструментов немедленно</li></ol>","help.pointHints.affects.title":"Влияние на систему","help.pointHints.affects.content":"<p>Подсказки хранятся в PostgreSQL (основное) и Redis (кэш) и подмешиваются в ответы инструментов <code>get_fitting_stations</code> и <code>get_pickup_points</code>. Изменения применяются мгновенно без перезапуска.</p>","help.pointHints.tips":"Используйте украиноязычные описания — агент общается с клиентами на украинском.","help.sttHints.title":"Подсказки STT (Phrase Hints)","help.sttHints.overview":"Управление подсказками для улучшения распознавания речи Google Cloud STT. Три уровня фраз: базовые (бренды, термины), из каталога (автоизвлечение), пользовательские.","help.sttHints.levels.title":"Уровни подсказок","help.sttHints.levels.content":"<p>Система подсказок для улучшения распознавания речи Google STT. Три уровня:</p><ul><li><strong>Базовые</strong> — бренды шин с кириллическими произношениями (Michelin → Мішлен), шинные термины. Можно редактировать и сбрасывать к умолчаниям.</li><li><strong>Из каталога</strong> — автоматически извлекаются из БД шин (производители) с транслитерацией латиница→кириллица</li><li><strong>Пользовательские</strong> — вручную добавленные фразы</li></ul><p>Лимит Google API: 5000 фраз. Кириллические варианты наиболее эффективны.</p>","help.sttHints.base.title":"Вкладка «Базовые»","help.sttHints.base.content":"<p>Управление базовым словарём: бренды шин с произношениями, шинные термины, названия магазинов.</p><ul><li>Поиск по списку фраз</li><li>Добавление и удаление отдельных фраз</li><li><strong>Сохранить базовые</strong> — сохранить изменённый список (помечает как «изменены»)</li><li><strong>Сброс к умолчаниям</strong> — вернуть хардкодированный список по умолчанию</li></ul>","help.sttHints.catalog.title":"Вкладка «Каталог»","help.sttHints.catalog.content":"<p>Автоматически извлечённые из БД шин названия производителей с транслитерацией. Список только для чтения.</p><ul><li><strong>Обновить из каталога</strong> — перечитать производителей из БД и обновить транслитерации</li></ul>","help.sttHints.custom.title":"Вкладка «Пользовательские»","help.sttHints.custom.content":"<p>Ручной список фраз для подсказок STT. Максимум 1000 фраз, до 200 символов каждая.</p><ul><li>Поиск, добавление и удаление фраз</li><li><strong>Сохранить</strong> — отправить изменённый список на сервер</li></ul>","help.sttHints.overrides.title":"Вкладка «Транслитерация»","help.sttHints.overrides.content":"<p>Переопределения целых слов при транслитерации латиницы в кириллицу для STT подсказок. Например, «weather» → «везер» вместо побуквенной транслитерации.</p><ul><li>Поиск по ключу или значению</li><li>Добавление новых переопределений: ключ — латиница, значение — кириллица</li><li><strong>Сохранить</strong> — отправить изменённый набор на сервер</li><li><strong>Сброс к умолчаниям</strong> — вернуть стандартный набор переопределений</li></ul>","help.sttHints.tips":"<ul><li>Кириллические варианты наиболее эффективны (STT uk-UA выводит кириллицу)</li><li>Общий лимит 5000 фраз — следите за процентом заполнения</li><li>Подсказки применяются к новым звонкам автоматически</li></ul>","help.configuration.providerMgmt.title":"Управление провайдерами","help.configuration.providerMgmt.content":"<p>Каждый провайдер в таблице имеет кнопки <strong>«Edit»</strong> и <strong>«Delete»</strong>:</p><ul><li><strong>Edit</strong> — открывает диалог редактирования: тип, модель, Base URL, переменная API-ключа. Все поля можно изменить и сохранить.</li><li><strong>Delete</strong> — удаляет провайдера. Перед удалением система проверяет, не используется ли он как primary или fallback в задачах. Если используется — удаление невозможно (сначала переназначьте задачи).</li></ul>","help.configuration.testPhones.title":"Тестовые номера","help.configuration.testPhones.content":"<p>Секция <strong>«Тестовые номера»</strong> позволяет управлять поведением AI-агента для определённых телефонных номеров:</p><ul><li><strong>Без истории</strong> — агент не получает историю предыдущих звонков. Звонок обрабатывается как первый (стандартное приветствие).</li><li><strong>С историей</strong> — обычное поведение, агент видит предыдущие звонки клиента.</li><li><strong>Очистить историю</strong> — удаляет все записи о звонках из базы данных (звонки, реплики, вызовы инструментов) и сбрасывает счётчик звонков клиента.</li></ul>","help.configuration.affects.title":"На что влияют изменения","help.configuration.affects.content":'<div class="help-affects"><p><strong>Отключение провайдера</strong> — если он единственный для задачи и нет фоллбэков, задача перестанет работать.</p><p><strong>Смена модели</strong> — мгновенно влияет на все новые запросы. Более мощная модель = лучше качество, но дороже и медленнее.</p><p><strong>Маршрутизация задач</strong> — позволяет использовать дешёвые модели для некритичных задач (качество, скрапинг) и мощные — для диалогов с клиентами.</p><p><strong>Настройки TTS</strong> — новый голос/скорость/тональность применяются к новым звонкам; текущие звонки продолжают со старым голосом.</p><p><strong>Подсказки станций</strong> — район/ориентиры применяются к следующему вызову get_fitting_stations немедленно.</p></div>',"help.configuration.tips":"<ul><li>Используйте <strong>фоллбэки</strong> для критичных задач (agent) — это защитит от сбоя одного провайдера</li><li>Для задач <strong>quality_scoring</strong> и <strong>article_processing</strong> можно использовать более дешёвые модели</li><li>После изменения провайдера нажмите <strong>«Тест»</strong>, чтобы убедиться в работоспособности</li><li><strong>Перезагрузка конфига</strong> не прерывает текущие звонки — изменения применяются к новым запросам</li></ul>","help.notifications.title":"Справка: Уведомления","help.notifications.overview":"<p>Настройка Telegram-уведомлений для получения алертов о критических событиях системы: сбои компонентов, высокая нагрузка, ошибки API. Алерты отправляются через Alertmanager.</p>","help.notifications.telegram.title":"Настройка Telegram-бота","help.notifications.telegram.content":"<p>Для получения уведомлений нужно настроить Telegram-бота:</p><ul><li><strong>Bot Token</strong> — токен бота, полученный от @BotFather в Telegram</li><li><strong>Chat ID</strong> — ID чата или группы, куда будут приходить уведомления</li><li><strong>Источник данных</strong> — откуда взяты текущие настройки: Redis (настроено через UI), ENV (переменные окружения), или «—» (не настроено)</li></ul>","help.notifications.telegram.steps":"Пошаговая инструкция: Настройка","help.notifications.telegram.stepsContent":"<p><strong>Создание Telegram-бота:</strong></p><ol><li>Откройте <strong>@BotFather</strong> в Telegram</li><li>Отправьте <code>/newbot</code> и следуйте инструкциям</li><li>Скопируйте <strong>Bot Token</strong></li></ol><p><strong>Получение Chat ID:</strong></p><ol><li>Добавьте бота в <strong>группу</strong>, куда хотите получать алерты</li><li>Отправьте любое сообщение в группу</li><li>Откройте <code>https://api.telegram.org/bot&lt;TOKEN&gt;/getUpdates</code></li><li>Найдите <code>chat.id</code> в ответе (число, может быть отрицательным для групп)</li></ol><p><strong>Сохранение настроек:</strong></p><ol><li>Вставьте <strong>Bot Token</strong> в соответствующее поле</li><li>Вставьте <strong>Chat ID</strong></li><li>Нажмите <strong>«Сохранить»</strong></li><li>Нажмите <strong>«Тест»</strong> — в чат придёт тестовое сообщение</li></ol>","help.notifications.affects.title":"На что влияют изменения","help.notifications.affects.content":'<div class="help-affects"><p><strong>Без настроенного бота</strong> — вы не будете получать алерты о сбоях. Проблемы могут остаться незамеченными.</p><p><strong>Настройки сохраняются в Redis</strong> и имеют приоритет над переменными окружения. Также автоматически обновляется конфигурация Alertmanager.</p></div>',"help.notifications.tips":"<ul><li>Обязательно нажмите <strong>«Тест»</strong> после сохранения — убедитесь, что сообщение приходит</li><li>Создайте <strong>отдельную группу</strong> в Telegram для алертов — не смешивайте с рабочими чатами</li><li>Если тест не проходит — проверьте, что бот <strong>добавлен в группу</strong> и имеет права на отправку сообщений</li></ul>","help.tenants.title":"Справка: Сети","help.tenants.overview":"<p>Управление тенантами (торговыми сетями). Каждый тенант — это отдельная торговая сеть (напр. ProKoleso, Твоя Шина) с собственными настройками AI-агента: именем, приветствием, набором инструментов и дополнениями к промпту. Звонки автоматически привязываются к тенанту по данным из АТС.</p>","help.tenants.table.title":"Таблица сетей","help.tenants.table.content":"<p>Таблица содержит все зарегистрированные торговые сети:</p><ul><li><strong>Slug</strong> — уникальный идентификатор (латиница, напр. <code>prokoleso</code>). Задаётся при создании и <strong>не может быть изменён</strong></li><li><strong>Название</strong> — отображаемое имя сети (напр. «ProKoleso»)</li><li><strong>Network ID</strong> — идентификатор для интеграции с 1C и Store API</li><li><strong>Имя агента</strong> — как представляется AI-агент при звонке (напр. «Олена»)</li><li><strong>Инструменты</strong> — количество активированных инструментов из 15 доступных</li><li><strong>Активен</strong> — включена ли сеть в систему</li></ul>","help.tenants.creating.title":"Создание и редактирование сети","help.tenants.creating.content":"<p>Каждая сеть имеет набор настроек для персонализации AI-агента:</p><ul><li><strong>Slug</strong> — уникальный ID (напр. <code>tvoya-shina</code>). Используется в URL и API</li><li><strong>Network ID</strong> — идентификатор торговой сети в 1C. Используется для запросов к Store API и получения точек самовывоза</li><li><strong>Имя агента</strong> — имя, которым агент представляется (по умолчанию «Олена»)</li><li><strong>Приветствие</strong> — персонализированное приветствие при начале звонка. Поддерживает переменную <code>{agent_name}</code></li><li><strong>Суффикс промпта</strong> — дополнительный текст, добавляемый к системному промпту агента. Позволяет задать специфику поведения для конкретной сети</li><li><strong>Конфигурация (JSON)</strong> — дополнительные параметры в формате JSON (напр. URL Store API)</li></ul>","help.tenants.creating.steps":"Пошаговая инструкция: Создание сети","help.tenants.creating.stepsContent":"<p><strong>Создание новой сети:</strong></p><ol><li>Нажмите <strong>«+ Новая сеть»</strong></li><li>Введите <strong>Slug</strong> — латиницей, без пробелов (напр. <code>nova-shina</code>)</li><li>Введите <strong>название</strong> — отображаемое имя</li><li>Введите <strong>Network ID</strong> — идентификатор из 1C</li><li>При необходимости измените <strong>имя агента</strong></li><li>Напишите <strong>приветствие</strong> на украинском языке</li><li>Выберите <strong>инструменты</strong>, доступные агенту для этой сети</li><li>Нажмите <strong>«Сохранить»</strong></li></ol><p><strong>Редактирование:</strong> нажмите <strong>⋮ → «Редактировать»</strong>. Все поля доступны, кроме Slug.</p><p><strong>Удаление:</strong> нажмите <strong>⋮ → «Удалить»</strong>. Звонки, привязанные к удалённой сети, сохранят <code>tenant_id = NULL</code>.</p>","help.tenants.tools.title":"Управление инструментами сети","help.tenants.tools.content":"<p>Каждая сеть может иметь <strong>свой набор инструментов</strong>. Это позволяет ограничить возможности агента для конкретной сети:</p><ul><li>Если сеть <strong>не предлагает шиномонтаж</strong> — отключите <code>get_fitting_stations</code>, <code>get_fitting_slots</code>, <code>book_fitting</code></li><li>Если сеть <strong>не принимает заказы через бота</strong> — отключите <code>create_order_draft</code>, <code>update_order_delivery</code>, <code>confirm_order</code></li><li>Инструмент <code>transfer_to_operator</code> рекомендуется оставить <strong>всегда включённым</strong></li></ul><p>При создании сети по умолчанию включены все инструменты.</p>","help.tenants.affects.title":"На что влияют изменения","help.tenants.affects.content":'<div class="help-affects"><p><strong>Приветствие и имя агента</strong> — мгновенно меняют первую фразу при новых звонках.</p><p><strong>Суффикс промпта</strong> — добавляется к основному промпту, позволяя задать специфическое поведение без создания отдельной версии промпта.</p><p><strong>Набор инструментов</strong> — определяет, какие действия доступны агенту. Отключённый инструмент агент не сможет вызвать даже при явном запросе клиента.</p><p><strong>Деактивация сети</strong> — звонки от этой сети будут обрабатываться с настройками по умолчанию (первая активная сеть).</p></div>',"help.tenants.tips":"<ul><li>Используйте <strong>суффикс промпта</strong> для сетевых особенностей (напр. «Ця мережа не надає гарантію на б/у шини»)</li><li>При добавлении новой сети начните с <strong>полного набора инструментов</strong> и отключите ненужные</li><li>Проверьте <strong>Network ID</strong> — он должен совпадать с идентификатором в 1C для корректной работы Store API</li><li>Протестируйте приветствие в <strong>Песочнице</strong> перед активацией</li></ul>","help.users.title":"Справка: Пользователи","help.users.overview":"<p>Управление учётными записями администраторов, аналитиков, операторов и контент-менеджеров. Гранулярная система прав позволяет точно настроить доступ каждого пользователя к разделам и действиям в админ-панели.</p>","help.users.table.title":"Таблица пользователей","help.users.table.content":"<p>Список всех пользователей системы:</p><ul><li><strong>Логин</strong> — имя для входа (уникально)</li><li><strong>Роль</strong> — базовая роль, определяющая набор прав по умолчанию</li><li><strong>Права</strong> — статус: <strong>«По роли»</strong> (используются права роли) или <strong>«Кастомные»</strong> (индивидуальный набор прав)</li><li><strong>Активен</strong> — включена ли учётная запись</li><li><strong>Посл. вход</strong> — дата последнего входа в систему</li></ul>","help.users.creating.title":"Создание пользователя","help.users.creating.content":"<p>Для создания нового пользователя нужно указать:</p><ul><li><strong>Логин</strong> — уникальное имя пользователя (латиница)</li><li><strong>Пароль</strong> — начальный пароль (пользователь может сменить позже)</li><li><strong>Роль</strong> — выбирается из 4 доступных ролей (см. раздел «Роли»)</li></ul>","help.users.creating.steps":"Пошаговая инструкция: Создание пользователя","help.users.creating.stepsContent":"<p><strong>Добавление нового пользователя:</strong></p><ol><li>Нажмите <strong>«+ Новый пользователь»</strong></li><li>Введите <strong>логин</strong> (латиница, без пробелов)</li><li>Введите <strong>пароль</strong></li><li>Выберите <strong>роль</strong></li><li>Нажмите <strong>«Создать»</strong></li></ol><p><strong>Смена роли:</strong></p><ol><li>Нажмите <strong>⋮</strong> в строке пользователя</li><li>Выберите новую роль из списка</li><li>Роль сменится мгновенно</li></ol><p><strong>Сброс пароля:</strong></p><ol><li>Нажмите <strong>⋮ → «Сбросить пароль»</strong></li><li>Введите новый пароль</li><li>Подтвердите</li></ol>","help.users.roles.title":"Роли и их права","help.users.roles.content":"<p>В системе 4 роли с предустановленными наборами прав:</p><ul><li><strong>admin</strong> — полный доступ ко всем разделам и действиям (wildcard <code>*</code>)</li><li><strong>analyst</strong> — просмотр аналитики, экспорт данных, чтение звонков. Без права изменения настроек</li><li><strong>operator</strong> — только просмотр списка операторов. Минимальные права</li><li><strong>content_manager</strong> — управление контентом: база знаний, скрапер, обучение, промпты, песочница. Без доступа к системным настройкам</li></ul><p>Роль определяет <strong>набор прав по умолчанию</strong>. Для любого пользователя можно задать <strong>кастомный набор прав</strong>, который переопределит права роли.</p>","help.users.permissions.title":"Гранулярные права доступа","help.users.permissions.content":"<p>Система прав разделена на <strong>группы</strong>, каждая с набором действий:</p><ul><li><strong>Группы</strong>: sandbox, knowledge, scraper, training, prompts, users, audit, tenants, operators, analytics, llm_config, notifications, configuration, monitoring, onec_data, vehicles, pronunciation</li><li><strong>Действия</strong>: чтение (r), запись (w), удаление (d), выполнение (x)</li></ul><p><strong>Режимы:</strong></p><ul><li><strong>По роли</strong> — используются стандартные права роли (переключатель «Использовать права роли» включён)</li><li><strong>Кастомные</strong> — индивидуальный набор чекбоксов. Пустой набор = нет доступа ни к чему</li></ul>","help.users.permissions.groups.title":"Таблица групп прав","help.users.permissions.groups.content":'<table style="width:100%;border-collapse:collapse;font-size:0.92em"><thead><tr style="border-bottom:2px solid #e5e7eb"><th style="text-align:left;padding:4px 8px">Группа</th><th style="text-align:left;padding:4px 8px">Страницы / функции</th><th style="text-align:left;padding:4px 8px">Действия</th></tr></thead><tbody><tr><td style="padding:4px 8px"><strong>Песочница</strong></td><td style="padding:4px 8px">Песочница</td><td style="padding:4px 8px">r, w, d</td></tr><tr><td style="padding:4px 8px"><strong>База знаний</strong></td><td style="padding:4px 8px">База знаний</td><td style="padding:4px 8px">r, w, d</td></tr><tr><td style="padding:4px 8px"><strong>Скрапер</strong></td><td style="padding:4px 8px">Конфигурации, Скрапер, Отслеживаемые</td><td style="padding:4px 8px">r, w, d, x</td></tr><tr><td style="padding:4px 8px"><strong>Обучение</strong></td><td style="padding:4px 8px">Сценарии, Инструменты</td><td style="padding:4px 8px">r, w, d, x</td></tr><tr><td style="padding:4px 8px"><strong>Промпты</strong></td><td style="padding:4px 8px">Версии промптов</td><td style="padding:4px 8px">r, w, d</td></tr><tr><td style="padding:4px 8px"><strong>Пользователи</strong></td><td style="padding:4px 8px">Пользователи</td><td style="padding:4px 8px">r, w</td></tr><tr><td style="padding:4px 8px"><strong>Аудит</strong></td><td style="padding:4px 8px">Журнал аудита</td><td style="padding:4px 8px">r</td></tr><tr><td style="padding:4px 8px"><strong>Тенанты</strong></td><td style="padding:4px 8px">Сети (тенанты)</td><td style="padding:4px 8px">r, w, d</td></tr><tr><td style="padding:4px 8px"><strong>Операторы</strong></td><td style="padding:4px 8px">Операторы</td><td style="padding:4px 8px">r, w</td></tr><tr><td style="padding:4px 8px"><strong>Аналитика</strong></td><td style="padding:4px 8px">Журнал звонков, Дашборд</td><td style="padding:4px 8px">r, export</td></tr><tr><td style="padding:4px 8px"><strong>LLM конфигурация</strong></td><td style="padding:4px 8px">Настройки LLM-роутера</td><td style="padding:4px 8px">r, w</td></tr><tr><td style="padding:4px 8px"><strong>Уведомления</strong></td><td style="padding:4px 8px">Telegram-уведомления</td><td style="padding:4px 8px">r, w</td></tr><tr><td style="padding:4px 8px"><strong>Конфигурация</strong></td><td style="padding:4px 8px">Перезагрузка конфигурации</td><td style="padding:4px 8px">r, w</td></tr><tr><td style="padding:4px 8px"><strong>Мониторинг</strong></td><td style="padding:4px 8px">Статус системы</td><td style="padding:4px 8px">r</td></tr><tr><td style="padding:4px 8px"><strong>Данные 1С</strong></td><td style="padding:4px 8px">Просмотр данных 1С</td><td style="padding:4px 8px">r</td></tr><tr><td style="padding:4px 8px"><strong>Автомобили</strong></td><td style="padding:4px 8px">База автомобилей</td><td style="padding:4px 8px">r, w</td></tr><tr><td style="padding:4px 8px"><strong>Произношение</strong></td><td style="padding:4px 8px">Словарь произношений</td><td style="padding:4px 8px">r, w</td></tr></tbody></table>',"help.users.permissions.steps":"Пошаговая инструкция: Настройка прав","help.users.permissions.stepsContent":"<p><strong>Настройка кастомных прав:</strong></p><ol><li>Нажмите <strong>⋮ → «Права»</strong> в строке пользователя</li><li>Откроется модальное окно с таблицей прав</li><li>Отключите переключатель <strong>«Использовать права роли»</strong></li><li>Отметьте <strong>чекбоксы</strong> для нужных групп и действий</li><li>Нажмите <strong>«Сохранить»</strong></li></ol><p><strong>Возврат к правам роли:</strong></p><ol><li>Откройте окно прав пользователя</li><li>Включите переключатель <strong>«Использовать права роли»</strong></li><li>Сохраните — пользователь получит стандартные права своей роли</li></ol>","help.users.tips":"<ul><li>Для нового аналитика используйте роль <strong>analyst</strong> — она даёт только чтение, без возможности изменений</li><li><strong>content_manager</strong> — идеальная роль для SEO-специалиста или контент-менеджера</li><li>Используйте <strong>кастомные права</strong> только для нестандартных случаев — права роли покрывают 90% потребностей</li><li>Деактивированный пользователь <strong>не может войти</strong>, но его данные сохраняются в системе</li><li>Проверяйте <strong>аудит-лог</strong> — он фиксирует все действия пользователей</li></ul>","help.audit.title":"Справка: Журнал аудита","help.audit.overview":"<p>Журнал аудита фиксирует все изменяющие действия в системе: создание, редактирование и удаление объектов. Используется для контроля безопасности, отслеживания изменений и расследования инцидентов. Записи аудита <strong>нельзя удалить или изменить</strong> — это неизменяемый лог.</p>","help.audit.table.title":"Таблица аудита","help.audit.table.content":"<p>Каждая запись содержит:</p><ul><li><strong>Дата</strong> — точное время действия</li><li><strong>Пользователь</strong> — кто выполнил действие</li><li><strong>Действие</strong> — тип HTTP-метода: POST (создание), PATCH (изменение), DELETE (удаление)</li><li><strong>Ресурс</strong> — тип объекта (промпт, статья, оператор и т.д.) и его ID</li><li><strong>IP-адрес</strong> — откуда было выполнено действие</li></ul><p>Сортировка по любой колонке — нажмите на заголовок.</p>","help.audit.filters.title":"Фильтрация записей","help.audit.filters.content":"<p>Доступные фильтры:</p><ul><li><strong>Дата с / по</strong> — диапазон дат</li><li><strong>Действие</strong> — POST, PATCH или DELETE</li></ul>","help.audit.filters.steps":"Пошаговая инструкция: Поиск действий","help.audit.filters.stepsContent":"<p><strong>Поиск конкретных изменений:</strong></p><ol><li>Установите <strong>диапазон дат</strong>, в котором произошли изменения</li><li>При необходимости выберите <strong>тип действия</strong> (напр. DELETE для поиска удалений)</li><li>Нажмите <strong>«Фильтровать»</strong></li><li>Просмотрите результаты — обратите внимание на пользователя и ресурс</li></ol><p><strong>Типичные сценарии использования:</strong></p><ul><li>«Кто удалил статью X?» — фильтр DELETE + диапазон дат</li><li>«Что изменялось за последнюю неделю?» — установите даты</li><li>«Какие действия выполнял пользователь Y?» — просмотрите лог (фильтр по пользователю в разработке)</li></ul>","help.audit.tips":"<ul><li>Проверяйте аудит-лог после <strong>неожиданных изменений</strong> — он покажет, кто и когда их сделал</li><li>Используйте аудит для <strong>контроля работы контент-менеджеров</strong> — какие статьи создают, какие удаляют</li><li>Лог <strong>неизменяем</strong> — никто не может скрыть свои действия</li><li>При расследовании инцидента начните с <strong>фильтра по дате</strong> — сузьте диапазон до минимума</li></ul>","help.vehicles.title":"Справка: База автомобилей","help.vehicles.overview":"<p>Справочник автомобилей и их размеров шин. Используется инструментом <code>get_vehicle_tire_sizes</code> — когда клиент называет марку и модель авто, агент находит подходящие размеры шин в этой базе. Данные импортируются из CSV-файлов.</p>","help.vehicles.navigation.title":"Навигация по базе","help.vehicles.navigation.content":"<p>База организована в три уровня:</p><ol><li><strong>Марки</strong> — список автомобильных брендов (Toyota, BMW, Hyundai...) с количеством моделей</li><li><strong>Модели</strong> — список моделей выбранной марки (Camry, Corolla...) с количеством комплектаций</li><li><strong>Комплектации</strong> — конкретные конфигурации с параметрами:<ul><li><strong>Год</strong> — год выпуска</li><li><strong>Модификация</strong> — название комплектации</li><li><strong>PCD</strong> — разболтовка (напр. 5×114.3)</li><li><strong>DIA</strong> — центральное отверстие</li><li><strong>Размеры шин</strong> — раскрывающийся список всех подходящих размеров (штатные и тюнинговые)</li></ul></li></ol>","help.vehicles.navigation.steps":"Пошаговая инструкция: Поиск размеров","help.vehicles.navigation.stepsContent":"<p><strong>Поиск размеров шин для автомобиля:</strong></p><ol><li>Введите <strong>название марки</strong> в поле поиска (напр. «Toyota»)</li><li>Нажмите <strong>«Поиск»</strong> или <strong>Enter</strong></li><li>Нажмите на <strong>марку</strong> в таблице — откроется список моделей</li><li>Нажмите на <strong>модель</strong> — откроется список комплектаций</li><li>Нажмите <strong>«Развернуть» (↕)</strong> рядом с комплектацией — увидите все размеры шин</li></ol><p>Для возврата используйте <strong>хлебные крошки</strong> вверху или кнопку <strong>«Назад»</strong>.</p>","help.vehicles.import.title":"Импорт данных","help.vehicles.import.content":"<p>База автомобилей заполняется через <strong>импорт CSV-файлов</strong>. Формат CSV определён в скрипте <code>scripts/import_vehicle_db.py</code>.</p><ul><li><strong>Обновить БД</strong> — кнопка открывает модальное окно импорта</li><li>В поле указывается <strong>путь к директории</strong> с CSV-файлами на сервере</li><li>Импорт <strong>мерджит данные</strong> — существующие записи обновляются, новые добавляются</li></ul>","help.vehicles.import.steps":"Пошаговая инструкция: Импорт CSV","help.vehicles.import.stepsContent":"<p><strong>Обновление базы автомобилей:</strong></p><ol><li>Загрузите CSV-файлы на сервер (напр. через <code>docker cp</code>)</li><li>Нажмите <strong>«Обновить БД»</strong></li><li>Введите <strong>путь к директории</strong> с CSV-файлами (напр. <code>/tmp/vehicle_csv</code>)</li><li>Нажмите <strong>«Импортировать»</strong></li><li>Дождитесь завершения — статистика обновится автоматически</li></ol>","help.vehicles.affects.title":"На что влияют изменения","help.vehicles.affects.content":'<div class="help-affects"><p><strong>База автомобилей</strong> используется инструментом <code>get_vehicle_tire_sizes</code>. Если клиент называет марку/модель — агент ищет размеры здесь.</p><p><strong>Неполная база</strong> — агент не сможет подобрать размеры для отсутствующих автомобилей и попросит клиента назвать размер вручную.</p><p><strong>Импорт безопасен</strong> — он обновляет существующие записи и добавляет новые, не удаляя старые.</p></div>',"help.vehicles.tips":"<ul><li>Регулярно <strong>обновляйте базу</strong> при появлении новых моделей автомобилей</li><li>Проверяйте <strong>карточки статистики</strong> после импорта — количество марок, моделей и размеров должно вырасти</li><li>Если клиенты часто спрашивают про авто, которых нет в базе — это сигнал для обновления</li><li>Используйте <strong>поиск</strong> для быстрой проверки наличия конкретной марки</li></ul>","nav.costAnalysis":"Анализ стоимости","costs.title":"Анализ стоимости LLM","costs.pricing":"Прайс-лист моделей","costs.comparison":"Сравнение стоимости","costs.provider":"Провайдер","costs.model":"Модель","costs.displayName":"Название","costs.inputPrice":"Input $/1M","costs.outputPrice":"Output $/1M","costs.system":"Системная","costs.actions":"Действия","costs.addModel":"Добавить модель","costs.syncSystem":"Синхронизировать","costs.edit":"Редактировать","costs.delete":"Удалить","costs.confirmDelete":"Удалить эту модель из прайс-листа?","costs.taskType":"Тип задачи","costs.period":"Период","costs.dateFrom":"Дата от","costs.dateTo":"Дата до","costs.apply":"Применить","costs.callCount":"Кол-во вызовов","costs.totalInputTokens":"Input токенов","costs.totalOutputTokens":"Output токенов","costs.avgLatency":"Сред. латенция (мс)","costs.totalCost":"Стоимость ($)","costs.cost":"Стоимость ($)","costs.difference":"Разница","costs.actual":"текущая","costs.noData":"Нет данных за выбранный период","costs.allTasks":"Все задачи","costs.allTenants":"Все сети","costs.summary":"Сводка по использованию","costs.synced":"Синхронизировано","costs.created":"Создано","costs.updated":"Обновлено","costs.deleted":"Удалено","costs.providerKey":"Ключ провайдера","costs.modelName":"Имя модели","costs.save":"Сохранить","costs.cancel":"Отмена","costs.myModels":"Мои модели","costs.providerCatalog":"Каталог провайдеров","costs.newModelsFound":"Обнаружено {count} новых моделей","costs.viewCatalog":"Перейти в каталог","costs.updateCatalog":"Обновить каталог","costs.lastSync":"Последнее обновление","costs.searchModels":"Поиск моделей...","costs.allProviders":"Все провайдеры","costs.maxTokens":"Max токенов","costs.status":"Статус","costs.added":"Добавлена","costs.new":"Новая","costs.addToPricing":"Добавить","costs.dismiss":"Отклонить","costs.includeInComparison":"В сравнении","costs.catalogSyncStarted":"Синхронизация каталога запущена","costs.modelAdded":"Модель добавлена в прайс-лист","costs.modelsDismissed":"Модели отклонены","costs.providerKeyHint":"Уникальный ключ для привязки к LLM-роутеру","costs.neverSynced":"Каталог ещё не синхронизирован","costs.hide":"Скрыть","costs.unhide":"Показать","costs.hidden":"Скрыта","costs.modelsHidden":"Модели скрыты","costs.modelUnhidden":"Модель восстановлена","costs.showHidden":"Показать скрытые","help.costAnalysis.title":"Анализ стоимости LLM","help.costAnalysis.overview":"Управление ценами на LLM-модели, каталог провайдеров и сравнение стоимости использования.","help.costAnalysis.pricing.title":"Прайс-лист моделей","help.costAnalysis.pricing.content":"Вкладка «Мои модели» содержит список моделей, используемых в системе. Для каждой модели указаны цены за 1M input/output токенов. Чекбокс «В сравнении» определяет, участвует ли модель в блоке сравнения стоимости.","help.costAnalysis.catalog.title":"Каталог провайдеров","help.costAnalysis.catalog.content":"Вкладка «Каталог провайдеров» показывает все доступные модели из базы LiteLLM. Каталог обновляется автоматически каждый день. Новые модели помечены синим. Можно добавить модель из каталога в свой прайс-лист или отклонить пометку «Новая».","help.costAnalysis.catalog.steps":"Добавление модели из каталога","help.costAnalysis.catalog.stepsContent":`1. Перейдите на вкладку «Каталог провайдеров»
2. Найдите нужную модель через поиск или фильтр по провайдеру
3. Нажмите «Добавить» → укажите provider_key
4. Модель появится в «Мои модели» с актуальными ценами`,"help.costAnalysis.comparison.title":"Сравнение стоимости","help.costAnalysis.comparison.content":"Блок сравнения берёт реальное потребление токенов за период и пересчитывает стоимость на всех моделях с включённым флагом «В сравнении». Показывает разницу в $ и % относительно текущей модели.","help.costAnalysis.tips":"Совет: Обновляйте каталог вручную кнопкой «Обновить каталог», если нужно увидеть свежие цены до ежедневной автосинхронизации.","nav.customers":"Клиенты","customers.title":"Клиенты","customers.breadcrumb":"Клиенты","customers.searchPlaceholder":"Поиск по телефону или имени...","customers.phone":"Телефон","customers.name":"Имя","customers.city":"Город","customers.vehicles":"Авто","customers.totalCalls":"Звонков","customers.lastCall":"Последний звонок","customers.firstCall":"Первый звонок","customers.deliveryAddress":"Адрес доставки","customers.noCustomers":"Клиенты не найдены","customers.loadFailed":"Ошибка загрузки: {error}","customers.detailTitle":"Профиль клиента","customers.recentCalls":"Последние звонки","customers.noRecentCalls":"Нет звонков","customers.callDate":"Дата","customers.callDuration":"Длительность","customers.callScenario":"Сценарий","customers.callTransferred":"Переведён","customers.vehiclePlate":"Номер","customers.vehicleModel":"Марка","customers.vehicleTires":"Шины","customers.noVehicles":"Нет авто","customers.noAddress":"Не указан","help.customers.title":"Клиенты","help.customers.overview":"Страница отображает профили клиентов, созданные автоматически ИИ-агентом во время звонков. Данные обновляются через tool <code>update_customer_profile</code>.","help.customers.table.title":"Таблица клиентов","help.customers.table.content":"Таблица показывает телефон, имя, город, количество автомобилей, общее число звонков и дату последнего звонка. Колонки можно сортировать щелчком по заголовку.","help.customers.search.title":"Поиск","help.customers.search.content":"Поиск по номеру телефона или имени клиента. Введите запрос и нажмите Enter или кнопку поиска.","help.customers.detail.title":"Детали клиента","help.customers.detail.content":"Кликните по строке в таблице чтобы открыть модальное окно с полным профилем: контакты, адрес доставки, список автомобилей (номер, марка, размер шин) и таблица последних 20 звонков.","help.customers.tips":"<ul><li>Профили создаются <strong>автоматически</strong> — ИИ-агент собирает информацию во время звонка</li><li>Страница <strong>только для чтения</strong> — редактирование не предусмотрено</li><li>Используйте поиск по <strong>телефону</strong> для быстрого нахождения клиента</li></ul>","help.onecData.title":"Данные 1С","help.onecData.overview":"Просмотр данных, полученных из системы 1С: точки самовывоза, станции шиномонтажа, заказы.","help.onecData.viewer.title":"Просмотр данных","help.onecData.viewer.content":"Таблица показывает данные, кэшированные из 1С API. Данные обновляются автоматически по расписанию. Используйте вкладки для переключения между типами данных.","help.onecData.refresh.title":"Обновление данных","help.onecData.refresh.content":"Нажмите кнопку «Обновить» для принудительного обновления данных из 1С. Кэш обновится для выбранной торговой сети.","help.onecData.tips":"<ul><li>Данные кэшируются в Redis с TTL <strong>1 час</strong></li><li>Точки самовывоза группируются по <strong>торговой сети</strong></li><li>При ошибках 1С используется fallback на Store API</li></ul>"},Xo={"common.retry":"Retry","common.save":"Save","common.cancel":"Cancel","common.close":"Close","common.add":"Add","common.create":"Create","common.edit":"Edit","common.delete":"Delete","common.filter":"Filter","common.yes":"Yes","common.no":"No","common.loading":"Loading...","common.failedToLoad":"Failed to load: {error}","common.activate":"Activate","common.deactivate":"Deactivate","common.select":"Select","common.pageInfo":"Page {current} of {total}","common.all":"All","common.allStatuses":"All statuses","common.searchPlaceholder":"Search...","common.showing":"Showing: {shown} of {total}","common.filters":"Filters","common.actions":"Actions","common.seconds":"sec","common.skipToContent":"Skip to content","common.lastUpdated":"Updated:","common.unsavedChanges":"You have unsaved changes. Leave page?","common.filtersActive":"{count} filter(s) active","common.resetFilters":"Reset filters","common.offline":"No network connection","common.backOnline":"Connection restored","auth.sessionExpiringSoon":"Session expiring soon. Save your work.","nav.ariaMainNav":"Main navigation","nav.ariaExpandSidebar":"Expand/Collapse sidebar","nav.ariaToggleTheme":"Toggle theme","nav.ariaToggleLang":"Toggle language","nav.ariaLogout":"Log out","nav.ariaWsStatus":"Connection status","nav.ariaOpenMenu":"Open menu","login.title":"Call Center AI","login.error":"Invalid credentials","login.username":"Username","login.password":"Password","login.submit":"Login","nav.dashboard":"Dashboard","nav.calls":"Call Journal","nav.training":"Agent Training","nav.operators":"Operators","nav.system":"System","nav.users":"Users","nav.prompts":"Prompts","nav.knowledge":"Knowledge Base","nav.scenarios":"Scenarios","nav.tools":"Tools","nav.monitoring":"Monitoring","nav.configuration":"Configuration","nav.tenants":"Networks","nav.notifications":"Notifications","nav.audit":"Audit Log","nav.logout":"Logout","theme.dark":"Dark","theme.light":"Light","ws.live":"Live","ws.reconnecting":"Reconnecting...","ws.offline":"Offline","api.sessionExpired":"Session expired. Please login again.","api.unauthorized":"Unauthorized","api.requestTimeout":"Server response timed out","api.networkError":"Unable to connect to server. Check your connection.","api.badRequest":"Bad request","api.noAccess":"Access denied","api.notFound":"Not found","api.conflict":"Data conflict","api.validationError":"Validation error","api.tooManyRequests":"Too many requests. Try again later.","api.serverError":"Server error. Try again later.","dashboard.breadcrumb":"Dashboard","dashboard.title":"Dashboard","dashboard.calls":"Calls","dashboard.callsToday":"Calls today","dashboard.resolvedByBot":"Resolved by bot","dashboard.transferred":"Transferred","dashboard.avgQuality":"Avg quality","dashboard.cost":"Cost","dashboard.costToday":"Cost today","dashboard.periodToday":"Today","dashboard.period7d":"7 days","dashboard.period30d":"30 days","dashboard.periodAll":"All time","dashboard.period":"Period:","dashboard.exportCSV":"Export Stats CSV","dashboard.downloadPDF":"Download PDF","dashboard.grafana":"Grafana Real-time","dashboard.csvExported":"CSV exported","dashboard.exportFailed":"Export failed: {error}","dashboard.pdfDownloaded":"PDF report downloaded","dashboard.pdfFailed":"PDF download failed: {error}","dashboard.failedToLoad":"Failed to load dashboard: {error}","dashboard.filterByNetwork":"Network:","dashboard.allNetworks":"All networks","dashboard.noAnalyticsAccess":"You do not have access to analytics. Use the navigation menu to go to an available section.","calls.breadcrumb":"Call Journal","calls.title":"Call Journal","calls.allScenarios":"All scenarios","calls.tireSearch":"Tire search","calls.availability":"Availability","calls.order":"Order","calls.fitting":"Fitting","calls.consultation":"Consultation","calls.all":"All","calls.transferred":"Transferred","calls.resolvedByBot":"Resolved by bot","calls.searchPlaceholder":"Search transcription...","calls.qualityBelow":"Quality below","calls.exportCSV":"Export CSV","calls.csvExported":"CSV exported","calls.exportFailed":"Export failed: {error}","calls.noCalls":"No calls found","calls.failedToLoad":"Failed to load calls: {error}","calls.date":"Date","calls.caller":"Caller","calls.scenario":"Scenario","calls.duration":"Duration","calls.quality":"Quality","calls.cost":"Cost","calls.status":"Status","calls.statusTransferred":"Transferred","calls.statusResolved":"Resolved","calls.detailTitle":"Call Details","calls.detailCaller":"Caller:","calls.detailScenario":"Scenario:","calls.detailDuration":"Duration:","calls.detailQuality":"Quality:","calls.detailCost":"Cost:","calls.detailPrompt":"Prompt:","calls.qualityBreakdown":"Quality Breakdown","calls.transcription":"Transcription","calls.noTranscription":"No transcription available","calls.customer":"Customer","calls.bot":"Bot","calls.toolCalls":"Tool Calls","calls.toolName":"Tool","calls.toolSuccess":"Success","calls.toolDuration":"Duration","calls.toolArgs":"Request arguments","calls.toolResult":"Result from 1C / API","calls.downloadTranscript":"Download transcript","calls.transcriptDownloaded":"Transcript downloaded","calls.transcriptFailed":"Download failed: {error}","calls.failedToLoadDetail":"Failed to load call details: {error}","calls.openInSandbox":"Open in Sandbox","calls.importingToSandbox":"Importing...","calls.importedToSandbox":"Call imported to sandbox","calls.importFailed":"Import failed: {error}","calls.costBreakdownTitle":"Cost Breakdown","calls.sttCost":"STT cost","calls.llmCost":"LLM cost","calls.ttsCost":"TTS cost","calls.totalCost":"Total","calls.llmModel":"LLM model","calls.llmInputTokens":"Input tokens","calls.llmOutputTokens":"Output tokens","calls.llmInputPrice":"Input price (per 1M)","calls.llmOutputPrice":"Output price (per 1M)","calls.sttProvider":"STT provider","calls.sttSeconds":"STT duration (sec)","calls.ttsCharacters":"TTS characters","prompts.breadcrumb":"Prompts","prompts.title":"Prompt Management","prompts.versions":"Versions","prompts.abTests":"A/B Tests","prompts.newVersion":"+ New Version","prompts.noVersions":"No prompt versions found","prompts.name":"Name","prompts.active":"Active","prompts.activeLabel":"Active","prompts.created":"Created","prompts.action":"Action","prompts.activateBtn":"Activate","prompts.failedToLoad":"Failed to load prompts: {error}","prompts.createTitle":"Create New Prompt Version","prompts.nameLabel":"Name","prompts.namePlaceholder":"e.g. v2.0-improved-search","prompts.systemPromptLabel":"System Prompt","prompts.systemPromptPlaceholder":"Enter system prompt text...","prompts.nameRequired":"Name and system prompt are required","prompts.created_toast":"Prompt version created","prompts.createFailed":"Failed to create prompt: {error}","prompts.activateConfirm":"Activate this prompt version? All calls will use it.","prompts.activated":"Prompt version activated","prompts.activateFailed":"Failed to activate prompt: {error}","prompts.noABTests":"No A/B tests found","prompts.testName":"Test","prompts.variantA":"Variant A","prompts.variantB":"Variant B","prompts.callsAB":"Calls A/B","prompts.qualityAB":"Quality A/B","prompts.abStatus":"Status","prompts.abAction":"Action","prompts.stopBtn":"Stop","prompts.stopConfirm":"Stop this A/B test?","prompts.stopped":"A/B test stopped","prompts.stopFailed":"Failed to stop test: {error}","prompts.failedToLoadAB":"Failed to load A/B tests: {error}","prompts.newABTest":"+ New A/B Test","prompts.createABTestTitle":"Create A/B Test","prompts.testNameLabel":"Test name","prompts.testNameRequired":"Test name is required","prompts.variantALabel":"Variant A","prompts.variantBLabel":"Variant B","prompts.trafficSplitLabel":"Traffic split (% variant A)","prompts.variantsRequired":"Select both variants","prompts.variantsMustDiffer":"Variants A and B must be different","prompts.abTestCreated":"A/B test created","prompts.abTestCreateFailed":"Failed to create A/B test: {error}","prompts.deleteABTestConfirm":'Delete A/B test "{name}"?',"prompts.abTestDeleted":"A/B test deleted","prompts.abTestDeleteFailed":"Failed to delete A/B test: {error}","prompts.recommended":"Recommended: {variant}","prompts.noSignificance":"No significant difference","prompts.notEnoughData":"Not enough data","prompts.stoppedWithResult":"Test stopped. {result}","prompts.abReportTitle":"A/B Test Report","prompts.reportSummary":"Summary","prompts.reportCriteria":"By Criteria","prompts.reportScenarios":"By Scenario","prompts.reportDaily":"Daily Dynamics","prompts.reportCalls":"Calls","prompts.reportQuality":"Quality","prompts.reportAvgDuration":"Avg Duration","prompts.reportTransferRate":"Transfer Rate","prompts.reportCriterion":"Criterion","prompts.reportDelta":"Delta","prompts.reportScenario":"Scenario","prompts.exportCSV":"Export CSV","prompts.csvExported":"CSV exported","prompts.exportFailed":"Export failed: {error}","prompts.reportFailedToLoad":"Failed to load report: {error}","prompts.reportNoData":"No data for report","prompts.criterionGreeting":"Greeting","prompts.criterionIntent":"Intent Understanding","prompts.criterionToolUsage":"Tool Usage","prompts.criterionAccuracy":"Information Accuracy","prompts.criterionConfirmation":"Action Confirmation","prompts.criterionConciseness":"Conciseness","prompts.criterionResolution":"Resolution Without Operator","prompts.criterionSatisfaction":"Customer Satisfaction","prompts.viewTitle":"View Prompt","prompts.loadDefault":"Load default","prompts.resetToDefault":"Reset to factory","prompts.resetConfirm":"Create a new version from the factory prompt and activate it?","prompts.resetDone":"Prompt reset to factory defaults","prompts.resetFailed":"Reset failed: {error}","prompts.deleteConfirm":'Delete prompt "{name}"?',"prompts.deleted":"Prompt deleted","prompts.deleteFailed":"Failed to delete prompt: {error}","prompts.pronunciationRules":"Pronunciation Rules","prompts.pronunciationRulesDesc":"TTS pronunciation rules — appended to the agent system prompt. Use to correct pronunciation of tire sizes, brands, models, etc.","prompts.pronunciationRulesSave":"Save","prompts.pronunciationRulesSaved":"Pronunciation rules saved","prompts.pronunciationRulesSaveFailed":"Save failed: {error}","prompts.pronunciationRulesReset":"Reset to defaults","prompts.pronunciationRulesResetConfirm":"Reset pronunciation rules to factory defaults?","prompts.pronunciationRulesResetDone":"Pronunciation rules reset to defaults","prompts.pronunciationRulesSource":"Source: {source}","prompts.pronunciationRulesSourceRedis":"Redis (custom)","prompts.pronunciationRulesSourceDefault":"factory defaults","prompts.optimizer":"Prompt Optimizer","prompts.optimizerRuns":"runs","prompts.optimizerDesc":"Automatic analysis of failed calls with recommendations for prompt improvement.","prompts.optimizerRun":"Run Analysis","prompts.optimizerRunning":"Running...","prompts.optimizerStarted":"Analysis started (task: {taskId})","prompts.optimizerRunFailed":"Failed to start: {error}","prompts.optimizerDate":"Date","prompts.optimizerCalls":"Calls","prompts.optimizerPatterns":"Patterns","prompts.optimizerStatus":"Status","prompts.optimizerTriggered":"Triggered By","prompts.optimizerCompleted":"Completed","prompts.optimizerError":"Error","prompts.optimizerView":"Details","prompts.optimizerNoResults":"No analysis results yet","prompts.optimizerLoadFailed":"Failed to load: {error}","prompts.optimizerDetailTitle":"Analysis Results","prompts.optimizerRecommendation":"Recommendation","prompts.optimizerPattern":"Pattern","prompts.optimizerSeverity":"Severity","prompts.optimizerFrequency":"Frequency","prompts.optimizerSuggestion":"Suggestion","prompts.action":"Actions","knowledge.breadcrumb":"Knowledge Base","knowledge.title":"Knowledge Base","knowledge.allCategories":"All categories","knowledge.searchPlaceholder":"Search...","knowledge.allActive":"All","knowledge.activeOnly":"Active only","knowledge.inactiveOnly":"Inactive only","knowledge.newArticle":"+ New Article","knowledge.reindexAll":"Reindex All","knowledge.importDocuments":"Import Documents","knowledge.noArticles":"No articles found","knowledge.articleTitle":"Title","knowledge.category":"Category","knowledge.embedding":"Embedding","knowledge.activeCol":"Active","knowledge.updated":"Updated","knowledge.expiresAt":"Expires","knowledge.expired":"Expired","knowledge.expiresAtLabel":"Expires at (optional)","knowledge.expiresAtHint":"Article will auto-hide after this date. Empty = no expiration.","knowledge.actions":"Actions","knowledge.editBtn":"Edit","knowledge.reindexBtn":"Reindex","knowledge.deleteBtn":"Delete","knowledge.total":"Total: {count} articles","knowledge.failedToLoad":"Failed to load articles: {error}","knowledge.newArticleTitle":"New Article","knowledge.editArticleTitle":"Edit Article","knowledge.titleLabel":"Title","knowledge.titlePlaceholder":"Article title","knowledge.categoryLabel":"Category","knowledge.contentLabel":"Content (Markdown)","knowledge.contentPlaceholder":"Article content in Markdown...","knowledge.titleRequired":"Title and content are required","knowledge.articleUpdated":"Article updated","knowledge.articleCreated":"Article created","knowledge.saveFailed":"Failed to save article: {error}","knowledge.articleDeactivated":"Article deactivated","knowledge.articleActivated":"Article activated","knowledge.toggleFailed":"Failed to update article: {error}","knowledge.deleteConfirm":'Delete article "{title}"?',"knowledge.articleDeleted":"Article deleted","knowledge.deleteFailed":"Failed to delete article: {error}","knowledge.reindexQueued":"Reindex queued","knowledge.reindexFailed":"Reindex failed: {error}","knowledge.reindexAllConfirm":"Reindex all articles? This may take a while.","knowledge.reindexAllDispatched":"Reindex-all dispatched","knowledge.reindexAllFailed":"Reindex-all failed: {error}","knowledge.loadFailed":"Failed to load article: {error}","knowledge.importTitle":"Import Documents","knowledge.importFilesLabel":"Files (MD, PDF, DOCX)","knowledge.importCategoryLabel":"Category (optional, auto-detect if empty)","knowledge.importAutoDetect":"Auto-detect from filename","knowledge.importBtn":"Import","knowledge.importNoFiles":"Please select files to import","knowledge.importResult":"Imported: {imported}","knowledge.importErrors":"Errors: {errors}","knowledge.importFailed":"Import failed: {error}","operators.breadcrumb":"Operators","operators.title":"Operators","operators.online":"Operators Online","operators.transfers1h":"Transfers (1h)","operators.queueUnavailable":"Queue status unavailable","operators.newOperator":"+ New Operator","operators.searchPlaceholder":"Search by name/extension...","operators.allStatuses":"All statuses","operators.noOperators":"No operators found","operators.name":"Name","operators.extension":"Extension","operators.status":"Status","operators.skills":"Skills","operators.shift":"Shift","operators.activeCol":"Active","operators.actionsCol":"Actions","operators.statusSelect":"Status...","operators.statusOnline":"Online","operators.statusOffline":"Offline","operators.statusBusy":"Busy","operators.statusBreak":"Break","operators.editBtn":"Edit","operators.deactivateBtn":"Deactivate","operators.failedToLoad":"Failed to load operators: {error}","operators.newOperatorTitle":"New Operator","operators.editOperatorTitle":"Edit Operator","operators.nameLabel":"Name","operators.namePlaceholder":"Full name","operators.extensionLabel":"Extension (SIP)","operators.extensionPlaceholder":"e.g. 101","operators.skillsLabel":"Skills (comma-separated)","operators.skillsPlaceholder":"tires, orders, fitting","operators.shiftStartLabel":"Shift Start","operators.shiftEndLabel":"Shift End","operators.nameRequired":"Name and extension are required","operators.operatorUpdated":"Operator updated","operators.operatorCreated":"Operator created","operators.saveFailed":"Failed to save operator: {error}","operators.statusChanged":"Status changed to {status}","operators.statusFailed":"Failed to change status: {error}","operators.deactivateConfirm":'Deactivate operator "{name}"?',"operators.operatorDeactivated":"Operator deactivated","operators.deactivateFailed":"Failed to deactivate: {error}","operators.notFound":"Operator not found","operators.loadFailed":"Failed to load operator: {error}","settings.breadcrumb":"System","settings.title":"System Status","settings.healthCheck":"Health Check","settings.refresh":"Refresh","settings.extendedStatus":"Extended Status","settings.clickToLoad":"Click to load","settings.loadStatus":"Load Status","settings.configuration":"Configuration","settings.configDescription":"Reload safe config parameters (quality, feature flags, logging) without restart.","settings.reloadConfig":"Reload Config","settings.externalTools":"External Tools","settings.openGrafana":"Open Grafana","settings.openPrometheus":"Open Prometheus","settings.openFlower":"Open Flower","settings.celeryTasks":"Celery Tasks (Flower)","settings.loadFlower":"Load Flower","settings.appInfo":"Application Info","settings.version":"Version","settings.status":"Status","settings.activeCalls":"Active calls","settings.redis":"Redis","settings.storeAPI":"Store API","settings.claudeAPI":"Claude API","settings.googleSTT":"Google STT","settings.ttsEngine":"TTS Engine","settings.failedToLoad":"Failed to load system info: {error}","settings.extVersion":"Version","settings.uptime":"Uptime","settings.uptimeValue":"{hours}h {minutes}m","settings.pgDbSize":"PostgreSQL DB size","settings.pgConnections":"PostgreSQL connections","settings.redisMemory":"Redis memory","settings.celeryWorkers":"Celery workers","settings.lastBackup":"Last backup","settings.extFailed":"Failed: {error}","settings.reloadConfirm":"Reload configuration from environment?","settings.configReloaded":`Config reloaded:
`,"settings.reloadFailed":"Reload failed: {error}","settings.llmRouting":"LLM Routing","settings.llmRoutingDesc":"Multi-provider LLM routing: manage providers, tasks, and fallback chains.","settings.llmLoadConfig":"Load Configuration","settings.llmProvider":"Provider","settings.llmType":"Type","settings.llmModel":"Model","settings.llmApiKey":"API Key","settings.llmEnabled":"Enabled","settings.llmHealth":"Health","settings.llmActions":"Actions","settings.llmTest":"Test","settings.llmTaskRouting":"Task Routing","settings.llmTask":"Task","settings.llmPrimary":"Primary","settings.llmFallbacks":"Fallbacks","settings.llmAddProvider":"Add provider","settings.llmAddFillRequired":"Model name is required","settings.llmProviderAdded":"Provider {key} added","settings.llmModelUpdated":"{key}: model changed to {model}","settings.llmProviderToggled":"Provider {key}: {state}","settings.llmRouteUpdated":"Task {task} → {provider}","settings.llmTaskDesc_agent":"Main AI agent: handles customer dialogue, calls tools (tire search, orders, fitting booking).","settings.llmTaskRec_agent":"Recommendation: powerful model (Sonnet, GPT-4o). Requires tool calling, high dialogue quality.","settings.llmTaskDesc_article_processor":"Knowledge base article processing: structuring, cleanup, key fact extraction from imported documents.","settings.llmTaskRec_article_processor":"Recommendation: fast/cheap model (Haiku, GPT-4o-mini). Background task, no tool calling needed.","settings.llmTaskDesc_quality_scoring":"Call quality scoring: transcription analysis, rating by criteria (accuracy, politeness, completeness).","settings.llmTaskRec_quality_scoring":"Recommendation: fast/cheap model (Haiku, GPT-4o-mini). Background Celery task, batch processing.","settings.llmTaskDesc_prompt_optimizer":"System prompt optimization: A/B test results analysis, improved prompt version generation.","settings.llmTaskRec_prompt_optimizer":"Recommendation: fast/cheap model (Haiku, GPT-4o-mini). Rare background task.","settings.llmFbSelect":"Select...","settings.llmFbMoveUp":"Move up","settings.llmFbMoveDown":"Move down","settings.llmFallbacksUpdated":"Fallbacks for {task}: {count}","settings.llmConfigFailed":"Config save failed: {error}","settings.llmTesting":"Testing {key}...","settings.llmTestSuccess":"{key}: OK ({latency}ms)","settings.llmTestFailed":"{key}: failed — {error}","settings.llmLoadFailed":"Failed to load LLM config: {error}","settings.llmEditProvider":"Edit","settings.llmDeleteProvider":"Delete","settings.llmDeleteConfirm":"Delete provider {key}? This cannot be undone.","settings.llmProviderDeleted":"Provider {key} deleted","settings.llmProviderInUse":"Cannot delete: provider is used in tasks: {tasks}","settings.llmProviderUpdated":"Provider {key} updated","settings.llmBaseUrl":"Base URL","settings.llmApiKeyEnv":"API Key Env Var","settings.llmEditTitle":"Edit Provider","settings.llmProviderKey":"Name (key)","settings.llmProviderRenamed":"Provider {oldKey} renamed to {newKey}","settings.sandboxDefaults":"Sandbox Defaults","settings.sandboxDefaultModel":"Default Model","settings.sandboxAutoCustomerModel":"Auto-Customer Model","settings.sandboxDefaultsSaved":"Sandbox defaults saved","settings.sandboxDefaultsHint":"Selected models will be used by default for new sandbox conversations and auto-customer.","settings.sandboxNoProviders":"No enabled providers","settings.ttsTitle":"TTS Voice Settings","settings.ttsDesc":"Google Cloud TTS voice settings: voice selection, speaking rate, and pitch. Changes apply to new calls without restart.","settings.ttsLoadConfig":"Load TTS Settings","settings.ttsSource":"Source","settings.ttsVoice":"Voice","settings.ttsSpeakingRate":"Speaking Rate","settings.ttsPitch":"Pitch","settings.ttsTest":"Test Voice","settings.ttsReset":"Reset to Defaults","settings.ttsResetConfirm":"Reset TTS settings to environment variable defaults?","settings.ttsSaved":"TTS settings saved","settings.ttsSaveFailed":"TTS save failed: {error}","settings.ttsResetDone":"TTS settings reset to defaults","settings.ttsTesting":"Synthesizing test phrase...","settings.ttsTestSuccess":"Synthesis completed ({duration}ms)","settings.ttsTestFailed":"Synthesis failed: {error}","settings.ttsLoadFailed":"Failed to load TTS settings: {error}","settings.ttsBreaksTitle":"Punctuation Break Durations","settings.ttsBreaksDesc":"SSML break durations after punctuation marks (ms). Affects speech rhythm.","settings.ttsBreakComma":"Comma","settings.ttsBreakPeriod":"Period","settings.ttsBreakExclamation":"Question/Exclamation","settings.ttsBreakColon":"Colon","settings.ttsBreakSemicolon":"Semicolon","settings.ttsBreakEmDash":"Em Dash","settings.taskSchedules":"Task Schedules","settings.taskSchedulesDesc":"Configure background task schedules (catalog sync, STT hints refresh). Changes apply without restart.","settings.taskLoadSchedules":"Load Schedules","settings.taskLoadFailed":"Failed to load schedules: {error}","settings.taskEnabled":"Enabled","settings.taskDisabled":"Disabled","settings.taskFrequency":"Frequency","settings.taskFreqDaily":"Daily","settings.taskFreqWeekly":"Weekly","settings.taskHour":"Hour (Kyiv)","settings.taskDayOfWeek":"Day of week","settings.taskRunNow":"Run Now","settings.taskRunQueued":"Task {task} queued (ID: {id})","settings.taskRunFailed":"Run failed: {error}","settings.taskSaved":"Schedule saved","settings.taskSaveFailed":"Save failed: {error}","settings.taskResetAll":"Reset All to Defaults","settings.taskResetConfirm":"Reset all schedules to defaults?","settings.taskResetDone":"Schedules reset to defaults","settings.taskDayMon":"Monday","settings.taskDayTue":"Tuesday","settings.taskDayWed":"Wednesday","settings.taskDayThu":"Thursday","settings.taskDayFri":"Friday","settings.taskDaySat":"Saturday","settings.taskDaySun":"Sunday","settings.taskLabel_catalog-full-sync":"Full 1C Catalog Sync","settings.taskLabel_refresh-stt-hints":"STT Hints Refresh from Catalog","settings.testPhones":"Test Phones","settings.testPhonesDesc":"Manage test phone numbers: enable/disable call history to test AI agent behavior.","settings.testPhonesLoad":"Load","settings.testPhonesLoadFailed":"Failed to load: {error}","settings.testPhonesNumber":"Phone Number","settings.testPhonesMode":"Mode","settings.testPhonesActions":"Actions","settings.testPhonesModeNoHistory":"No History","settings.testPhonesModeWithHistory":"With History","settings.testPhonesClearHistory":"Clear History","settings.testPhonesEmpty":"No test phones configured","settings.testPhonesAdded":"Phone {phone} added","settings.testPhonesModeUpdated":"Mode for {phone} updated","settings.testPhonesSaveFailed":"Save failed: {error}","settings.testPhonesRemoveConfirm":"Remove {phone} from test phones?","settings.testPhonesRemoved":"Phone {phone} removed","settings.testPhonesClearConfirm":"Clear ALL call history for {phone}? This deletes calls, turns and tool calls from the database.","settings.testPhonesClearDone":"History for {phone} cleared: {calls} calls, {turns} turns, {tools} tool calls","settings.testPhonesClearFailed":"Clear failed: {error}","nav.pointHints":"Point Hints","pointHints.title":"Point Hints","pointHints.tabFitting":"Fitting","pointHints.tabPickup":"Pickup Points","pointHints.name":"Name","pointHints.address":"Address","pointHints.city":"City","pointHints.district":"District","pointHints.landmarks":"Landmarks","pointHints.description":"Description","pointHints.actions":"Actions","pointHints.districtPh":"Right bank","pointHints.landmarksPh":"near Pit Line","pointHints.descPh":"Additional info","pointHints.editHint":"Edit Hint","pointHints.saved":"Hint saved","pointHints.deleted":"Hint deleted","pointHints.saveFailed":"Save failed: {error}","pointHints.deleteFailed":"Delete failed: {error}","pointHints.loadFailed":"Failed to load hints: {error}","pointHints.noStations":"No cached stations found.","pointHints.noPoints":"No cached pickup points found.","pointHints.refreshFromOnec":"Refresh from 1C","pointHints.refreshing":"Loading data from 1C...","pointHints.refreshed":"Loaded {count} points from 1C","pointHints.refreshFailed":"Failed to load from 1C: {error}","nav.sttHints":"STT Hints","sttHints.base":"Base","sttHints.auto":"From catalog","sttHints.custom":"Custom","sttHints.total":"Total","sttHints.modified":"modified","sttHints.lastSync":"Last sync","sttHints.neverSynced":"never","sttHints.tabBase":"Base","sttHints.tabAuto":"Catalog","sttHints.tabCustom":"Custom","sttHints.searchPlaceholder":"Search phrases...","sttHints.addPhrasePlaceholder":"New phrase...","sttHints.noResults":"No matches","sttHints.duplicatePhrase":"This phrase already exists","sttHints.customHint":"Max 1000 phrases, up to 200 chars each. Cyrillic variants of Latin words are most effective.","sttHints.saveBase":"Save base","sttHints.resetBase":"Reset to defaults","sttHints.devBannerTitle":"In Development","sttHints.devBannerText":'STT phrase hints are temporarily inactive. Google STT model "latest_long" does not support speech adaptation. Waiting for a model update from Google. Hint management is available, but hints will not be sent to STT until support is added.',"sttHints.resetBaseConfirm":"Reset base phrases to defaults?","sttHints.saveCustom":"Save","sttHints.refreshCatalog":"Refresh from catalog","sttHints.baseSaved":"Base phrases saved ({count})","sttHints.customSaved":"Custom phrases saved ({count})","sttHints.saveFailed":"Save failed: {error}","sttHints.resetBaseDone":"Base phrases reset to defaults","sttHints.refreshing":"Refreshing hints from catalog...","sttHints.refreshed":"Hints refreshed from catalog","sttHints.refreshFailed":"Refresh failed: {error}","sttHints.loadFailed":"Failed to load STT hints: {error}","sttHints.tabOverrides":"Transliteration","sttHints.overridesHint":"Whole-word overrides for Latin-to-Cyrillic transliteration. Key — English word (lowercase), value — Cyrillic.","sttHints.overrideLatin":"English word","sttHints.overrideCyrillic":"Cyrillic","sttHints.duplicateOverride":"This word is already overridden","sttHints.overridesSaved":"Overrides saved ({count})","sttHints.overridesResetDone":"Overrides reset to defaults","sttHints.overridesResetConfirm":"Reset overrides to defaults?","sttHints.overridesSaveFailed":"Save failed: {error}","sttHints.overridesLatinOnly":"Latin letters only (a-z)","settings.telegram":"Telegram Notifications","settings.telegramDesc":"Configure Telegram bot for receiving Alertmanager alerts.","settings.telegramLoadConfig":"Load","settings.telegramStatus":"Token","settings.telegramTokenSet":"configured","settings.telegramTokenMissing":"not configured","settings.telegramBotToken":"Bot Token","settings.telegramBotTokenPlaceholder":"New token (leave empty to keep current)","settings.telegramChatId":"Chat ID","settings.telegramChatIdPlaceholder":"Numeric chat or group ID","settings.telegramTestBtn":"Test","settings.telegramSaved":"Telegram config saved","settings.telegramSaveFailed":"Save failed: {error}","settings.telegramFillFields":"Enter at least token or chat_id","settings.telegramTesting":"Sending test message...","settings.telegramTestSuccess":"Test OK ({latency}ms)","settings.telegramTestFailed":"Error: {error}","settings.telegramLoadFailed":"Failed to load Telegram config: {error}","users.breadcrumb":"Users","users.title":"User Management","users.newUser":"+ New User","users.noUsers":"No users found","users.username":"Username","users.role":"Role","users.activeCol":"Active","users.lastLogin":"Last Login","users.actionsCol":"Actions","users.changeRole":"Change role...","users.roleAdmin":"Admin","users.roleAnalyst":"Analyst","users.roleOperator":"Operator","users.resetPwd":"Reset pwd","users.failedToLoad":"Failed to load users: {error}","users.createTitle":"Create New User","users.usernameLabel":"Username","users.usernamePlaceholder":"username","users.passwordLabel":"Password","users.passwordPlaceholder":"password","users.roleLabel":"Role","users.usernameRequired":"Username and password are required","users.userCreated":"User created","users.createFailed":"Failed to create user: {error}","users.roleUpdated":"Role updated","users.roleFailed":"Failed to update role: {error}","users.userDeactivated":"User deactivated","users.userActivated":"User activated","users.toggleFailed":"Failed to update user: {error}","users.newPasswordPrompt":"New password for {username}:","users.passwordReset":"Password reset","users.resetFailed":"Failed to reset password: {error}","users.roleContentManager":"Content Manager","users.permissions":"Permissions","users.useRoleDefaults":"Role defaults","users.customPermissions":"Custom","users.editPermissions":"Permissions...","users.permissionsUpdated":"Permissions updated","users.permissionsFailed":"Failed to update permissions: {error}","users.permGroup.sandbox":"Sandbox","users.permGroup.knowledge":"Knowledge Base","users.permGroup.scraper":"Scraper","users.permGroup.training":"Training","users.permGroup.prompts":"Prompts","users.permGroup.users":"Users","users.permGroup.audit":"Audit","users.permGroup.tenants":"Tenants","users.permGroup.operators":"Operators","users.permGroup.analytics":"Analytics","users.permGroup.llm_config":"LLM Configuration","users.permGroup.notifications":"Notifications","users.permGroup.configuration":"Configuration","users.permGroup.monitoring":"Monitoring","users.permGroup.onec_data":"1C Data","users.permGroup.vehicles":"Vehicles","users.permGroup.pronunciation":"Pronunciation","users.permGroup.stt_hints":"STT Hints","users.permGroup.point_hints":"Point Hints","users.permGroupHint.sandbox":"Sandbox","users.permGroupHint.knowledge":"Knowledge Base","users.permGroupHint.scraper":"Source Configs, Scraper, Watched Pages","users.permGroupHint.training":"Scenarios, Tools","users.permGroupHint.prompts":"Prompt Versions","users.permGroupHint.users":"Users","users.permGroupHint.audit":"Audit Log","users.permGroupHint.tenants":"Networks (Tenants)","users.permGroupHint.operators":"Operators","users.permGroupHint.analytics":"Call Log, Dashboard","users.permGroupHint.llm_config":"LLM Router Settings","users.permGroupHint.notifications":"Telegram Notifications","users.permGroupHint.configuration":"Config Reload","users.permGroupHint.monitoring":"System Status","users.permGroupHint.onec_data":"1C Data Viewer","users.permGroupHint.vehicles":"Vehicle Database","users.permGroupHint.pronunciation":"Pronunciation Dictionary","users.permGroupHint.stt_hints":"Speech Recognition Hints","users.permGroupHint.point_hints":"District & landmarks for stations/pickup points","training.breadcrumb":"Agent Training","training.title":"Agent Training","training.tabPrompts":"Prompts","training.tabKnowledge":"Knowledge Base","training.tabTemplates":"Response Templates","training.tabDialogues":"Dialogue Scenarios","training.tabSafety":"Safety Rules","training.tabTools":"Tools","training.activeCol":"Active","training.actions":"Actions","training.loadFailed":"Failed to load: {error}","training.saveFailed":"Failed to save: {error}","training.deleteFailed":"Failed to delete: {error}","training.deleteConfirm":'Delete "{title}"?',"training.titleRequired":"Title is required","training.titleContentRequired":"Title and content are required","training.fieldsRequired":"All required fields must be filled","training.keyRequired":"Template key is required","training.newTemplate":"+ New Template","training.editTemplate":"Edit Template","training.addVariantTitle":"Add Response Variant","training.noTemplates":"No templates found","training.templateKey":"Key","training.templateTitle":"Title","training.content":"Content","training.description":"Description","training.templateSaved":"Template saved","training.addVariant":"+ Variant","training.variantCount":"var.","training.variantsHint":"Multiple variants per key — agent randomly picks one for each call","training.deleteVariantConfirm":'Delete variant "{title}"?',"training.variantDeleted":"Variant deleted","training.allTemplateKeys":"All keys","training.searchTemplates":"Search templates...","training.filterScenario":"Scenario","training.allScenarios":"All scenarios","training.filterPhase":"Phase","training.allPhases":"All phases","training.filterActive":"Status","training.allActive":"All","training.activeOnly":"Active","training.inactiveOnly":"Inactive","training.newDialogue":"+ New Scenario","training.editDialogue":"Edit Scenario","training.noDialogues":"No scenarios found","training.dialogueTitle":"Title","training.dialogueTitlePlaceholder":"Scenario title","training.scenario":"Scenario","training.phase":"Phase","training.tools":"Tools","training.dialogueJSON":"Dialogue (JSON)","training.invalidJSON":"Invalid JSON","training.dialogueSaved":"Scenario saved","training.dialogueDeleted":"Scenario deleted","training.filterRuleType":"Rule type","training.allRuleTypes":"All types","training.filterSeverity":"Severity","training.allSeverities":"All","training.newSafetyRule":"+ New Rule","training.editSafetyRule":"Edit Safety Rule","training.noSafetyRules":"No safety rules found","training.ruleTitle":"Title","training.ruleType":"Rule Type","training.severity":"Severity","training.triggerInput":"Trigger (customer input)","training.expectedBehavior":"Expected Behavior","training.safetyRuleSaved":"Safety rule saved","training.safetyRuleDeleted":"Safety rule deleted","training.regressionTest":"Test Rules","training.regressionRunning":"Testing...","training.regressionResults":"Safety Rules Test Results","training.regressionPassed":"Passed","training.regressionFailed_label":"Failed","training.regressionFailed":"Test failed: {error}","training.regressionPassedCount":"Passed: {count}","training.regressionFailedCount":"Failed: {count}","training.regressionTotal":"Total: {count}","training.regressionStatus":"Status","training.regressionActual":"Agent response","training.regressionReason":"Reason","training.toolName":"Tool","training.override":"Override","training.overridden":"Overridden","training.default":"Default","training.editTool":"Edit Tool","training.originalDescription":"Default Description","training.overrideDescription":"Override Description","training.descriptionRequired":"Description is required","training.toolOverrideSaved":"Tool override saved","training.toolOverrideReset":"Tool override reset","training.reset":"Reset","training.resetConfirm":"Reset override for {name}?","training.resetFailed":"Failed to reset: {error}","training.toolNotFound":"Tool not found","training.tabSources":"Sources","sources.enabled":"Scraper enabled","sources.autoApprove":"Auto-publish","sources.runNow":"Run now","sources.schedule":"Schedule","sources.noSources":"No sources found","sources.allStatuses":"All statuses","sources.url":"URL","sources.originalTitle":"Original title","sources.status":"Status","sources.date":"Date","sources.actions":"Actions","sources.approve":"Approve","sources.reject":"Reject","sources.viewArticle":"Article","sources.total":"Total: {count}","sources.configUpdated":"Config updated","sources.configUpdateFailed":"Config update failed: {error}","sources.configLoadFailed":"Failed to load config: {error}","sources.runDispatched":"Scraper run dispatched","sources.runFailed":"Failed to start scraper: {error}","sources.approved":"Article approved and activated","sources.approveFailed":"Approval failed: {error}","sources.rejected":"Source rejected","sources.rejectFailed":"Rejection failed: {error}","sources.rejectConfirm":"Reject this source?","sources.failedToLoad":"Failed to load sources: {error}","sources.minDate":"From date","sources.minDateHint":"Empty = last 14 days (auto mode)","sources.maxDate":"To date","sources.maxDateHint":"Empty = no limit (up to today)","sources.dedupLlmCheck":"LLM dedup check","sources.dedupLlmCheckHint":"Use LLM for borderline duplicates (0.80–0.90 similarity)","sources.duplicate":"duplicate","sources.duplicateSuspect":"possible duplicate","sources.watchedPagesTitle":"Watched Pages","sources.watchedPagesHint":"Website pages that are periodically re-scraped to keep the agent's knowledge base up to date.","sources.addWatchedPage":"Add page","sources.noWatchedPages":"No watched pages added","sources.watchedUrl":"URL","sources.watchedCategory":"Category","sources.watchedInterval":"Interval (h)","sources.watchedStatus":"Status","sources.watchedLastScraped":"Last scraped","sources.watchedNextScrape":"Next scrape","sources.watchedArticle":"Article","sources.watchedActions":"Actions","sources.scrapeNow":"Scrape now","sources.deleteWatched":"Delete","sources.watchedPageAdded":"Page added","sources.watchedPageAddFailed":"Failed to add: {error}","sources.watchedPageDeleted":"Page removed","sources.watchedPageDeleteFailed":"Failed to remove: {error}","sources.watchedPageDeleteConfirm":"Remove this watched page?","sources.watchedPageUpdated":"Settings updated","sources.watchedPageUpdateFailed":"Failed to update: {error}","sources.scrapeNowRunning":"Scraping...","sources.scrapeNowDone":"Scrape completed: {status}","sources.scrapeNowUnchanged":"Content has not changed","sources.scrapeNowDiscoveryDone":"Discovery: found {discovered} pages, created {created}, updated {updated}","sources.scrapeNowFailed":"Scrape failed: {error}","sources.watchedFailedToLoad":"Failed to load: {error}","sources.urlRequired":"Enter a page URL","sources.categoryRequired":"Select a category","sources.intervalRequired":"Select an interval","sources.urlPlaceholder":"https://prokoleso.ua/ua/...","sources.neverScraped":"not scraped yet","sources.filterByTenant":"Network:","sources.allTenants":"All networks","sources.noTenant":"No network","sources.tenant":"Network","sources.discoveryLabel":"Catalog page","sources.discoveryBadge":"catalog","sources.discoveryHint":"A page with a list of links (e.g. promotions). Automatically discovers all child pages and scrapes each one separately.","sources.childCount":"{count} children","sources.intervalHours.6":"Every 6h","sources.intervalHours.12":"Every 12h","sources.intervalHours.24":"Daily","sources.intervalHours.168":"Weekly","sources.tabConfigs":"Configurations","sources.tabScraper":"Scraper","sources.tabWatched":"Watched Pages","sources.sourceConfigsTitle":"Content Sources","sources.sourceConfigsHint":"External sites for collecting articles into the knowledge base.","sources.scraperConfigTitle":"ProKoleso — manual import","sources.addSource":"Add source","sources.editSource":"Edit source","sources.sourceName":"Name","sources.sourceType":"Type","sources.sourceUrl":"URL","sources.sourceLanguage":"Language","sources.maxArticles":"Max articles","sources.lastRun":"Last run","sources.runSource":"Run","sources.deleteSource":"Delete","sources.settingsJson":"Settings (JSON)","sources.noSourceConfigs":"No content sources configured","sources.sourceConfigSaved":"Source saved","sources.sourceConfigSaveFailed":"Failed to save: {error}","sources.sourceConfigDeleted":"Source deleted","sources.sourceConfigDeleteFailed":"Failed to delete: {error}","sources.deleteSourceConfirm":'Delete source "{name}"?',"sources.nameUrlRequired":"Name and URL are required","sources.invalidSettingsJson":"Invalid JSON in settings","sources.processed":"Processed","sources.bulkImport":"Bulk Import","sources.bulkImportTitle":"Bulk Import Watched Pages","sources.bulkUrlsPlaceholder":"Enter URLs (one per line)...","sources.bulkImportResult":"Added: {added}, skipped: {skipped}","tenants.title":"Networks","tenants.newTenant":"+ New Network","tenants.editTenant":"Edit Network","tenants.slug":"Slug","tenants.name":"Name","tenants.networkId":"Network ID","tenants.agentName":"Agent Name","tenants.greeting":"Greeting","tenants.enabledTools":"Enabled Tools","tenants.promptSuffix":"Prompt Suffix","tenants.config":"Configuration (JSON)","tenants.statusCol":"Status","tenants.actions":"Actions","tenants.active":"Active","tenants.activeLabel":"Active","tenants.inactive":"Inactive","tenants.created":"Network created","tenants.updated":"Network updated","tenants.deleted":"Network deactivated","tenants.activated":"Network activated","tenants.deactivated":"Network deactivated","tenants.deleteConfirm":'Deactivate network "{name}"?',"tenants.saveFailed":"Failed to save network: {error}","tenants.loadFailed":"Failed to load networks: {error}","tenants.noTenants":"No networks found","tenants.nameRequired":"Name and Network ID are required","tenants.slugRequired":"Slug is required","tenants.invalidConfigJson":"Invalid JSON in configuration","tenants.extensions":"Extensions (Asterisk)","tenants.extensionsHint":"Asterisk extensions, comma-separated","nav.onecData":"1C Data","nav.vehicles":"Vehicles","vehicles.breadcrumb":"Vehicles","vehicles.title":"Vehicle Database","vehicles.searchPlaceholder":"Search by name...","vehicles.brands":"Brands","vehicles.models":"Models","vehicles.kits":"Kits","vehicles.tireSizes":"Tire Sizes","vehicles.lastImport":"Last Import","vehicles.brand":"Brand","vehicles.model":"Model","vehicles.year":"Year","vehicles.trim":"Trim","vehicles.pcd":"PCD","vehicles.bolts":"Bolts","vehicles.dia":"DIA","vehicles.size":"Size","vehicles.type":"Type","vehicles.axle":"Axle","vehicles.stock":"Stock","vehicles.tuning":"Tuning","vehicles.front":"Front","vehicles.rear":"Rear","vehicles.all":"All","vehicles.back":"← Back","vehicles.noData":"No data","vehicles.failedToLoad":"Failed to load: {error}","vehicles.neverImported":"Never imported","vehicles.importButton":"Update DB","vehicles.importTitle":"Update Vehicle Database","vehicles.importInstructions":"Place 4 CSV files in a directory on the server:","vehicles.importWarning":"Import will delete current data and load new. Operation takes ~30-60 seconds.","vehicles.importPathLabel":"Path to CSV directory","vehicles.importPathRequired":"Please enter the directory path","vehicles.importBtn":"Import","vehicles.importSuccess":"Import complete: {brands} brands, {models} models, {kits} kits, {tireSizes} tire sizes","vehicles.importFailed":"Import failed: {error}","common.search":"Search","audit.breadcrumb":"Audit Log","audit.title":"Audit Log","audit.allActions":"All actions","audit.noEntries":"No audit entries found","audit.date":"Date","audit.user":"User","audit.action":"Action","audit.resource":"Resource","audit.ip":"IP","audit.failedToLoad":"Failed to load audit log: {error}","onec.title":"1C Data","onec.breadcrumb":"1C Data","onec.statusTitle":"Connection Status","onec.status":"Status","onec.connected":"Connected","onec.disconnected":"Unreachable","onec.notConfigured":"Not Configured","onec.pickupPoints":"Pickup Points","onec.network":"Network","onec.city":"City","onec.address":"Address","onec.type":"Type","onec.filterCity":"Filter by city","onec.refresh":"Refresh from 1C","onec.stockLookup":"Stock Lookup by SKU","onec.sku":"SKU","onec.skuPlaceholder":"Enter SKU to search","onec.search":"Search","onec.price":"Price","onec.quantity":"Quantity","onec.country":"Country","onec.year":"Year","onec.cacheAge":"Cache age","onec.noData":"No data","onec.notFound":"Not found","onec.soapStatus":"SOAP Tire Fitting","onec.restStatus":"1C REST API","onec.aiOrders":"AI Orders Created","onec.aiOrdersHint":"Via direct 1C integration","onec.soapTimeout":"SOAP Timeout","nav.sandbox":"Sandbox","sandbox.breadcrumb":"Sandbox","sandbox.title":"Agent Sandbox","sandbox.tabChat":"Chat","sandbox.tabHistory":"History","sandbox.newConversation":"New Conversation","sandbox.archiveConversation":"Archive","sandbox.sendMessage":"Send","sandbox.messagePlaceholder":"Type a customer message...","sandbox.noConversation":"Select or create a conversation","sandbox.noConversations":"No conversations","sandbox.noMessages":"Start a conversation — send the first message","sandbox.conversationTitle":"Conversation title","sandbox.promptVersion":"Prompt version","sandbox.promptVersionDefault":"Active version","sandbox.toolMode":"Tool mode","sandbox.toolModeMock":"Mock (test data)","sandbox.toolModeLive":"Live (Store API)","sandbox.scenarioType":"Scenario type","sandbox.scenarioNone":"No type","sandbox.model":"Model","sandbox.modelDefault":"Default","sandbox.changeModel":"Change model","sandbox.modelChanged":"Model changed","sandbox.tags":"Tags (comma-separated)","sandbox.createConversation":"Create Conversation","sandbox.created":"Conversation created","sandbox.archived":"Conversation archived","sandbox.deleted":"Conversation deleted","sandbox.deleteConfirm":'Delete conversation "{title}"? All data will be lost.',"sandbox.deleteBlockedByRegression":"Conversation is referenced by regression runs. Archive it instead.","sandbox.ratingCommentPrompt":"Rating comment (optional):","sandbox.ratingSaved":"Rating saved","sandbox.ratingFailed":"Failed to save rating: {error}","sandbox.sendFailed":"Send failed: {error}","sandbox.llmError":"LLM error","sandbox.llmErrorHint":"LLM call failed (0 tokens). Check API key and server logs.","sandbox.loadFailed":"Failed to load: {error}","sandbox.customer":"Customer","sandbox.agent":"Agent","sandbox.toolCalls":"Tool Calls","sandbox.toolName":"Tool","sandbox.toolArgs":"Arguments","sandbox.toolResult":"Result","sandbox.toolDuration":"Duration","sandbox.mock":"mock","sandbox.live":"live","sandbox.metrics":"{latency}ms | {input}→{output} tokens | {model}","sandbox.turnsCount":"Turns","sandbox.avgRating":"Avg Rating","sandbox.lastActivity":"Last Activity","sandbox.status":"Status","sandbox.active":"Active","sandbox.archivedStatus":"Archived","sandbox.searchPlaceholder":"Search by title...","sandbox.allScenarios":"All scenarios","sandbox.rateComment":"Rating comment...","sandbox.branch":"Branch","sandbox.branchFrom":"Branch from turn #{turn}","sandbox.branchLabel":"Branch label","sandbox.autoCustomer":"Auto-customer","sandbox.autoCustomerHint":"Generate customer reply with AI","sandbox.persona":"Persona","sandbox.personaNeutral":"Neutral","sandbox.personaImpatient":"Impatient","sandbox.personaConfused":"Confused","sandbox.personaAngry":"Angry","sandbox.personaExpert":"Expert","sandbox.personaRushed":"Rushed","sandbox.personaDetailed":"Detailed","sandbox.contextHint":"Context hint","sandbox.starters":"Starter Templates","sandbox.newStarter":"New Starter","sandbox.starterTitle":"Starter title","sandbox.firstMessage":"First message","sandbox.starterSaved":"Starter saved","sandbox.starterDeleted":"Starter deleted","sandbox.useStarter":"Use","sandbox.generating":"Generating...","sandbox.childBranches":"Branches","sandbox.tabRegression":"Regression","sandbox.regression":"Regression Tests","sandbox.replay":"Replay","sandbox.replayHint":"Replay conversation with a different prompt","sandbox.selectPromptVersion":"Select prompt version","sandbox.runRegression":"Run Regression","sandbox.regressionStarted":"Regression started","sandbox.regressionFailed":"Regression failed: {error}","sandbox.noRegressions":"No regression tests","sandbox.turnsCompared":"Turns compared","sandbox.sourceRating":"Avg rating (source)","sandbox.newRating":"Avg rating (new)","sandbox.scoreDiff":"Difference","sandbox.sourceResponse":"Source response","sandbox.newResponse":"New response","sandbox.diffView":"Comparison","sandbox.baseline":"Baseline","sandbox.markBaseline":"Mark as baseline","sandbox.unmarkBaseline":"Unmark baseline","sandbox.pending":"Pending","sandbox.running":"Running","sandbox.completed":"Completed","sandbox.failed":"Failed","sandbox.exportDialogue":"Export to training","sandbox.exported":"Exported to training data","sandbox.markingMode":"Marking mode","sandbox.createGroup":"Create group","sandbox.intentLabel":"Intent","sandbox.patternType":"Pattern type","sandbox.positive":"Positive","sandbox.negative":"Negative","sandbox.correction":"Correction","sandbox.correctionHint":"How the agent should have responded...","sandbox.groupCreated":"Group created","sandbox.groupUpdated":"Group updated","sandbox.groupDeleted":"Group deleted","sandbox.turnGroups":"Turn groups","sandbox.noGroups":"No groups","sandbox.turnsSelected":"{count} turns selected","sandbox.exportToPatterns":"Export to patterns","sandbox.alreadyExported":"Exported","sandbox.patterns":"Patterns","sandbox.guidanceNote":"Guidance note","sandbox.guidanceHint":"What to inject into the agent system prompt...","sandbox.exportSuccess":"Pattern exported","sandbox.patternActive":"Active","sandbox.patternInactive":"Inactive","sandbox.timesUsed":"Times used","sandbox.testSearch":"Test search","sandbox.testSearchHint":"Enter text to search for similar patterns...","sandbox.similarity":"Results","sandbox.noPatterns":"No patterns","sandbox.customerMessages":"Customer messages","sandbox.agentMessages":"Agent messages","sandbox.sending":"Sending...","sandbox.exitMarking":"Exit marking","sandbox.markingHint":"Select turns to create a group","sandbox.error":"Error","sandbox.openNewConversation":"Open new conversation","sandbox.intentRequired":"Enter an intent label","sandbox.guidanceRequired":"Enter a guidance note","sandbox.generateGuidance":"✦ Generate with AI","sandbox.generatingGuidance":"Generating guidance...","sandbox.generateGuidanceFailed":"Failed to generate: {error}","sandbox.editPattern":"Edit pattern","sandbox.patternSaved":"Pattern saved","sandbox.titleRequired":"Enter a conversation title","sandbox.ratingCommentPlaceholder":"Comment (Enter to save)","sandbox.convInfo":"Conversation details","sandbox.routerModel":"router","sandbox.intentSelectPlaceholder":"— Select intent —","sandbox.intentGreeting":"Greeting and conversation start","sandbox.intentTireSearch":"Tire search by parameters","sandbox.intentClarification":"Clarifying parameters with customer","sandbox.intentRecommendation":"Product recommendation","sandbox.intentAvailabilityCheck":"Availability check","sandbox.intentOrderCreation":"Order creation","sandbox.intentOrderStatus":"Order status check","sandbox.intentFittingBooking":"Fitting booking","sandbox.intentConsultation":"Consultation (general questions)","sandbox.intentObjectionHandling":"Objection handling","sandbox.intentUpsell":"Upsell / cross-sell","sandbox.intentFarewell":"Conversation farewell","sandbox.intentOther":"Other...","sandbox.intentCustomPlaceholder":"Enter custom intent...","sandbox.previewSelectedTurns":"Selected turns ({count})","sandbox.positiveDesc":"Good example of agent response","sandbox.negativeDesc":"Example needing correction","sandbox.tabPhrases":"Agent Phrases","sandbox.phrasesTitle":"Agent Phrases (TTS, no LLM)","sandbox.phrasesDescription":"These phrases are spoken by TTS directly, bypassing the LLM. DB templates override hardcoded ones — a random variant is picked per call.","sandbox.phrasesCategory":"Category","sandbox.phrasesKey":"Context","sandbox.phrasesText":"Phrase text","sandbox.phrasesSource":"Source","sandbox.phrasesStatus":"Status","sandbox.phrasesSourceCode":"code (prompts.py)","sandbox.phrasesSourceLLM":"LLM (generated)","sandbox.phrasesActive":"active","sandbox.phrasesOverridden":"overridden by DB","sandbox.phrasesInactive":"off","sandbox.phrasesCatFixed":"Hardcoded (fallback)","sandbox.phrasesCatWait":"Wait pools (hardcoded)","sandbox.phrasesPoolLabel":"pool ({count} variants, rotation)","sandbox.phrasesLoadFailed":"Failed to load phrases: {error}","sandbox.phrasesLlmNote":"All other agent responses are generated by the LLM in real time.","sandbox.phrasesDbTitle":"DB Templates (actually used)","sandbox.phrasesDbDescription":"These phrases are loaded from response_templates table and override hardcoded ones. A random active variant is picked per key on each call. Manage in: Scenarios → Templates.","sandbox.phrasesDbVariants":"{active} active of {total}","sandbox.branchMessage":"Branch message","sandbox.branchFromTurn":"Branch from turn {turn}","sandbox.submitBranch":"Send","sandbox.selectPromptForReplay":"Select prompt version for replay","sandbox.submitReplay":"Run","sandbox.personaRushed":"Rushed","sandbox.personaDetailed":"Detailed","sandbox.tabStarters":"Starters","sandbox.quickStart":"Quick Start","sandbox.manageStarters":"Manage Starters","sandbox.starterFirstMessage":"First message","sandbox.starterDescription":"Description","sandbox.starterPersona":"Persona","sandbox.noStarters":"No starter templates","sandbox.deleteStarterConfirm":'Delete starter "{title}"?',"sandbox.starterTitleRequired":"Title and first message are required","sandbox.editStarter":"Edit Starter","sandbox.searchStarters":"Search starters...","sandbox.allScenarios":"All scenarios","sandbox.allStatuses":"All statuses","sandbox.activeOnly":"Active","sandbox.inactiveOnly":"Inactive","sandbox.bulkMode":"Bulk delete","sandbox.selectAll":"Select all","sandbox.deselectAll":"Deselect all","sandbox.bulkDelete":"Delete selected ({count})","sandbox.bulkDeleted":"Deleted: {deleted}, skipped: {skipped}","sandbox.bulkDeleteConfirm":"Delete {count} conversations? All data will be lost.","sandbox.bulkSkipped":"Some conversations are protected by regression runs and were not deleted.","sandbox.importFromCall":"From call","sandbox.importCallSearchPlaceholder":"Search by number...","sandbox.importCallsNone":"No calls found","sandbox.importBtn":"Import","sandbox.importingCall":"Importing...","sandbox.importedCall":"Call imported to sandbox","sandbox.importCallFailed":"Import error: {error}","sandbox.importCallPreview":"Transcript","sandbox.importCallSelectToPreview":"Select a call to preview","sandbox.deleteRun":"Delete","sandbox.deleteRunConfirm":"Delete regression run? The generated conversation will also be deleted.","sandbox.runDeleted":"Run deleted","sandbox.verdict":"Verdict","sandbox.pendingVerdict":"Pending","sandbox.approved":"Approved","sandbox.rejected":"Rejected","sandbox.approve":"Approve","sandbox.reject":"Reject","sandbox.verdictSet":"Verdict set","sandbox.filterVerdict":"Verdict","sandbox.all":"All","sandbox.batchReplay":"Batch Replay","sandbox.selectBaselines":"Select baseline conversations","sandbox.selectAllBaselines":"Select all","sandbox.runBatchReplay":"Run Batch Replay","sandbox.batchSelectRequired":"Select at least one conversation","sandbox.batchRunning":"Batch replay running...","sandbox.batchCompleted":"Batch replay: {completed} completed, {failed} failed","sandbox.batchFailed":"Batch replay failed: {error}","sandbox.noBaselines":"No baseline conversations","sandbox.semanticSimilarity":"Semantic similarity","sandbox.avgSimilarity":"Avg similarity","sandbox.rateNewResponse":"Rate response","sandbox.ratingSaved":"Rating saved","help.close":"Close help","help.tipsTitle":"Useful tips","help.searchPlaceholder":"Search help...","help.dashboard.title":"Help: Dashboard","help.dashboard.overview":"<p>The admin panel's main page — an operational summary of AI agent performance for the current day. All metrics refresh <strong>automatically every 30 seconds</strong>.</p>","help.dashboard.stats.title":"Statistics cards","help.dashboard.stats.content":"<p>Top row cards show key metrics for today:</p><ul><li><strong>Calls today</strong> — total incoming calls</li><li><strong>Resolved by bot</strong> — calls the AI agent handled without transferring to an operator</li><li><strong>Transferred</strong> — calls transferred to a live operator</li><li><strong>Avg quality</strong> — average dialogue quality score (0.0–1.0). Green — good (≥0.7), yellow — average, red — poor (<0.4)</li><li><strong>Cost ($)</strong> — total LLM API expenses for today</li></ul>","help.dashboard.filters.title":"Network filter","help.dashboard.filters.content":"<p>If the system has multiple <strong>tenants</strong> (retail networks), the dropdown lets you view stats for a specific network or all at once.</p><ul><li><strong>All networks</strong> — aggregated statistics</li><li><strong>Specific network</strong> (e.g., ProKoleso, Tvoya Shina) — only that network's calls</li></ul>","help.dashboard.export.title":"Data export","help.dashboard.export.content":"<p>Two export formats available:</p><ul><li><strong>Export CSV</strong> — spreadsheet file with daily statistics for Excel or Google Sheets</li><li><strong>Download PDF</strong> — 7-day report with charts and summary, ready to send to management</li></ul>","help.dashboard.export.steps":"Step-by-step: Export","help.dashboard.export.stepsContent":'<p><strong>CSV export:</strong></p><ol><li>Optionally select a <strong>network</strong> in the filter</li><li>Click <strong>"Export CSV"</strong></li><li>File downloads automatically</li></ol><p><strong>PDF report:</strong></p><ol><li>Click <strong>"Download PDF"</strong></li><li>A 7-day report will be generated</li><li>File downloads automatically</li></ol>',"help.dashboard.tips":'<ul><li>Track the <strong>"Resolved by bot" percentage</strong> — this is the main AI agent effectiveness indicator</li><li>If <strong>avg quality</strong> drops below 0.6 — check recent prompt changes</li><li>Use the <strong>network filter</strong> to compare agent effectiveness across tenants</li><li>The PDF report is great for <strong>weekly meetings</strong> — send it to management</li></ul>',"help.calls.title":"Help: Call Log","help.calls.overview":"<p>Detailed log of all calls processed by the AI agent. View transcriptions, assess quality, analyze tool usage, and identify problematic dialogues.</p>","help.calls.table.title":"Calls table","help.calls.table.content":'<p>Main table columns:</p><ul><li><strong>Date</strong> — call date and time</li><li><strong>Caller</strong> — caller ID (phone number)</li><li><strong>Scenario</strong> — dialogue type: tire search, order, fitting, consultation</li><li><strong>Duration</strong> — call duration</li><li><strong>Quality</strong> — automatic score (0.0–1.0) with color badge:<ul><li><span style="color:#22c55e">●</span> ≥ 0.7 — good</li><li><span style="color:#f59e0b">●</span> 0.4–0.69 — average</li><li><span style="color:#ef4444">●</span> < 0.4 — poor</li></ul></li><li><strong>Cost</strong> — LLM API expenses for this call</li><li><strong>Status</strong> — result: resolved by bot / transferred to operator</li></ul><p>Click a row to open <strong>call details</strong>.</p>',"help.calls.filters.title":"Filters","help.calls.filters.content":"<p>Filter panel options:</p><ul><li><strong>Date from / to</strong> — date range</li><li><strong>Scenario</strong> — dialogue type (all, tire search, availability, order, fitting, consultation)</li><li><strong>Transfer status</strong> — all / transferred to operator / resolved by bot</li><li><strong>Search</strong> — full-text search in transcriptions</li><li><strong>Quality below</strong> — show only calls with score below threshold (e.g., 0.5)</li><li><strong>Network</strong> — tenant filter</li></ul>","help.calls.filters.steps":"Step-by-step: Filtering","help.calls.filters.stepsContent":'<p><strong>Finding problematic calls:</strong></p><ol><li>Set <strong>"Quality below"</strong> = 0.5</li><li>Click <strong>"Filter"</strong></li><li>Review low-quality calls — open details for each</li><li>Analyze at which point the dialogue went wrong</li></ol><p><strong>Content search:</strong></p><ol><li>Enter a keyword in the <strong>"Search in transcription"</strong> field (e.g., "warranty" or "return")</li><li>Press <strong>Enter</strong> or click "Filter"</li></ol><p><strong>CSV export:</strong></p><ol><li>Set the desired filters</li><li>Click <strong>"Export CSV"</strong> — only filtered calls are exported</li></ol>',"help.calls.detail.title":"Call details","help.calls.detail.content":"<p>Modal with full call information:</p><ul><li><strong>Metadata</strong> — caller number, scenario, duration, quality, cost, prompt version</li><li><strong>Quality assessment</strong> — breakdown by criteria: greeting, intent detection, tool usage, closing, etc.</li><li><strong>Transcription</strong> — full conversation text with customer/agent speaker labels</li><li><strong>Tool calls</strong> — table of tools used with results (success/error) and execution time</li></ul>","help.calls.detail.steps":"Step-by-step: Call analysis","help.calls.detail.stepsContent":'<p><strong>Full call analysis:</strong></p><ol><li>Click a <strong>call row</strong> in the table</li><li>Review the <strong>overall quality</strong> and criteria breakdown</li><li>Read the <strong>transcription</strong> — note any problematic moments</li><li>Check <strong>tool calls</strong> — were there any errors?</li><li>Click <strong>"Download transcript"</strong> to save the text</li><li>Click <strong>"Open in Sandbox"</strong> to import the dialogue into the Sandbox — rate responses, branch, mark patterns</li></ol>',"help.calls.quality.title":"Quality scoring system","help.calls.quality.content":"<p>Each call's quality is automatically assessed on several criteria:</p><ul><li><strong>Greeting</strong> — did the agent introduce itself correctly</li><li><strong>Intent detection</strong> — did the agent understand what the customer needs</li><li><strong>Tool usage</strong> — were the right tools selected</li><li><strong>Response quality</strong> — completeness and accuracy of information</li><li><strong>Closing</strong> — did the agent end the conversation properly</li></ul><p>Final score is the average across all criteria (0.0–1.0).</p>","help.calls.import.title":"Import call to Sandbox","help.calls.import.content":'<p>The <strong>"Open in Sandbox"</strong> button in call details lets you copy the entire dialogue into the Sandbox for deep analysis.</p><p><strong>What gets imported:</strong></p><ul><li><strong>All turns</strong> — preserving order and speaker mapping (customer / agent)</li><li><strong>Tool calls</strong> — linked to the corresponding agent turns, marked as real (not mock)</li><li><strong>Metadata</strong> — source call ID, quality score, duration, scenario, tenant</li></ul><p><strong>What you can do with imported dialogues:</strong></p><ul><li>View complete conversation history with tool calls</li><li>Rate individual agent responses (1–5 stars)</li><li>Create branches — try alternative customer messages</li><li>Mark turn groups and export to patterns</li><li>Mark as baseline for regression tests</li></ul>',"help.calls.import.steps":"Step-by-step: Import to Sandbox","help.calls.import.stepsContent":`<p><strong>Importing a call:</strong></p><ol><li>Open <strong>call details</strong> — click a row in the table</li><li>Click the <strong>"Open in Sandbox"</strong> button (next to "Download transcript")</li><li>Wait for the import — a success notification will appear</li><li>You'll be automatically redirected to the <strong>Sandbox</strong> where the imported dialogue opens</li></ol><p><strong>Analyzing the imported dialogue:</strong></p><ol><li>Review the turns — note any problematic moments</li><li>Rate agent responses with stars</li><li>If you find a problematic moment — click <strong>"Branch"</strong> and try a different customer message</li><li>Compare how the agent reacts to alternative requests</li><li>If needed, mark turn groups for pattern export</li></ol>`,"help.calls.costBreakdown.title":"Call cost breakdown","help.calls.costBreakdown.content":`<p>Each call's detail view includes a <strong>cost breakdown table</strong> when data is available:</p><ul><li><strong>STT</strong> — speech recognition provider, processing duration, cost</li><li><strong>LLM</strong> — model, input/output token counts, per-1M pricing rates, total cost</li><li><strong>TTS</strong> — character count, speech synthesis cost</li><li><strong>Total</strong> — overall call cost</li></ul><p>LLM pricing is sourced from the <strong>"Model Pricing"</strong> table on the Cost Analysis page and refreshes automatically every 5 minutes.</p>`,"help.calls.tips":'<ul><li>Regularly review calls with <strong>quality below 0.5</strong> — they indicate problems</li><li>Use <strong>transcription search</strong> to find specific topics or issues</li><li>Calls with <strong>"Transferred"</strong> status — potential areas for prompt improvement</li><li>Export data to <strong>CSV</strong> for building charts in Excel</li><li><strong>Download the transcript</strong> of a problematic call and use it to create a new dialogue in "Scenarios"</li><li>Click <strong>"Open in Sandbox"</strong> — import a problematic call for analysis, branching, and pattern marking</li></ul>',"help.operators.title":"Help: Operators","help.operators.overview":"<p>Manage live call center operators. When the AI agent cannot resolve an issue on its own, it transfers the call to an operator via the <code>transfer_to_operator</code> tool. On this page you maintain the operator registry, track their statuses, and manage availability.</p>","help.operators.table.title":"What is displayed on the page","help.operators.table.content":`<p><strong>Top panel</strong> shows operational metrics:</p><ul><li><strong>Operators online</strong> — how many operators are currently available to take calls</li><li><strong>Transfers (1h)</strong> — number of bot-to-operator transfers in the last hour</li></ul><p><strong>Operators table</strong> columns:</p><ul><li><strong>Name</strong> — operator's full name</li><li><strong>Extension</strong> — SIP extension (e.g., 101, 102). Unique per operator</li><li><strong>Status</strong> — current state: <span style="color:#22c55e">●</span> Online, <span style="color:#6b7280">●</span> Offline, <span style="color:#f59e0b">●</span> Busy, <span style="color:#3b82f6">●</span> Break</li><li><strong>Skills</strong> — competency tags (tires, orders, fitting, etc.)</li><li><strong>Shift</strong> — working hours (e.g., 09:00–18:00)</li><li><strong>Active</strong> — whether the operator is enabled in the system</li><li><strong>Actions</strong> — quick actions menu (⋮)</li></ul><p>Data refreshes <strong>automatically every 10 seconds</strong>.</p>`,"help.operators.creating.title":"Creating and editing an operator","help.operators.creating.content":"<p>Each operator is a system record linked to a SIP phone extension. Fields:</p><ul><li><strong>Name</strong> — full name, shown in the table and analytics</li><li><strong>Extension (SIP)</strong> — Asterisk extension (e.g., 101). Must be <strong>unique</strong></li><li><strong>Skills</strong> — comma-separated: <code>tires, orders, fitting</code>. Used for routing — the bot transfers calls to an operator with the matching competency</li><li><strong>Shift start / end</strong> — operator's working hours (e.g., 09:00–18:00)</li></ul>","help.operators.creating.steps":"Step-by-step: Creating an operator","help.operators.creating.stepsContent":`<p><strong>Adding a new operator:</strong></p><ol><li>Click <strong>"+ New operator"</strong></li><li>Enter the operator's <strong>full name</strong></li><li>Enter the <strong>extension</strong> (SIP extension) — must match the Asterisk configuration</li><li>List <strong>skills</strong> separated by commas (e.g., <code>tires, orders</code>)</li><li>Set <strong>shift times</strong> — start and end of the working day</li><li>Click <strong>"Save"</strong></li></ol><p><strong>Editing:</strong></p><ol><li>Click the <strong>three dots (⋮)</strong> in the operator's row</li><li>Select <strong>"Edit"</strong></li><li>Change the needed fields</li><li>Click <strong>"Save"</strong></li></ol><p><strong>Deactivation:</strong></p><ol><li>Click <strong>⋮ → "Deactivate"</strong></li><li>Confirm — the operator becomes inactive (not deleted from the system)</li></ol>`,"help.operators.status.title":"Managing statuses","help.operators.status.content":"<p>Status determines whether an operator is available to receive transferred calls:</p><ul><li><strong>Online</strong> — operator is at their workstation, ready to take a call</li><li><strong>Offline</strong> — operator is not working (default when created)</li><li><strong>Busy</strong> — operator is talking to another customer</li><li><strong>Break</strong> — operator is temporarily unavailable (lunch, pause)</li></ul><p>Every status change is <strong>logged</strong> to history — you can track when an operator started their shift, went on break, etc.</p>","help.operators.status.steps":"Step-by-step: Changing status","help.operators.status.stepsContent":`<p><strong>Quick status change:</strong></p><ol><li>Click the <strong>three dots (⋮)</strong> in the operator's row</li><li>In the dropdown menu, select the desired status: <strong>Online / Offline / Busy / Break</strong></li><li>Status changes instantly, the badge updates</li></ol><p><strong>Typical workday:</strong></p><ol><li>Shift start — set status to <strong>"Online"</strong></li><li>Lunch break — switch to <strong>"Break"</strong></li><li>After lunch — return to <strong>"Online"</strong></li><li>End of day — switch to <strong>"Offline"</strong></li></ol>`,"help.operators.skills.title":"Skills and routing","help.operators.skills.content":"<p>Skills are a key element of <strong>intelligent routing</strong>. When the AI agent transfers a call, the system selects an operator with matching skills.</p><p><strong>Recommended skills:</strong></p><ul><li><code>tires</code> — tire selection advice, sizes, brands</li><li><code>orders</code> — order questions, payments, returns</li><li><code>fitting</code> — tire fitting bookings, schedule, locations</li><li><code>warranty</code> — warranty cases, claims</li><li><code>delivery</code> — delivery terms and conditions</li></ul><p>An operator can have <strong>multiple skills</strong> — the more skills, the more transfers they'll receive.</p>","help.operators.transfer.title":"How bot-to-operator transfer works","help.operators.transfer.content":"<p>The call transfer process from AI agent to a live operator:</p><ol><li>The customer asks for an operator, or the agent determines it cannot help</li><li>The agent invokes the <code>transfer_to_operator</code> tool with a reason</li><li>The system looks for an <strong>online operator</strong> with matching skills</li><li>The agent speaks a transfer phrase (from <code>transfer</code> category templates)</li><li>Asterisk switches the call to the operator's SIP extension</li></ol><p><strong>If no operators are available:</strong> the agent will apologize and suggest calling back later.</p>","help.operators.affects.title":"What changes affect","help.operators.affects.content":`<div class="help-affects"><p><strong>"Online" status</strong> — operator is available for transfers. If all operators are offline, the bot cannot transfer calls and will inform the customer.</p><p><strong>Skills</strong> — determine which calls the operator receives. If skills are empty — the operator may not receive any transfers.</p><p><strong>Deactivation</strong> — operator is completely excluded from routing. Use for departures or extended leaves.</p><p><strong>Extension</strong> — must match the SIP extension in Asterisk. If incorrect, the call won't reach the operator.</p></div>`,"help.operators.tips":`<ul><li>Monitor the <strong>"Operators online"</strong> metric — if 0, the bot cannot transfer calls</li><li>Assign at least <strong>one skill</strong> to each operator — routing doesn't work without skills</li><li>Use <strong>"Break"</strong> status instead of "Offline" for short absences — it's more accurate for analytics</li><li>Verify that the <strong>extension</strong> matches the Asterisk configuration</li><li>A deactivated operator can be reactivated — data is not deleted</li></ul>`,"help.scenarios.title":"Help: Agent Training","help.scenarios.overview":"<p>Manage the AI agent's training data. Configure <strong>response templates</strong> (ready-made phrases), <strong>example dialogues</strong> (few-shot learning), and <strong>safety rules</strong> (restrictions). All changes apply <strong>instantly</strong> — the agent uses updated data on the next call.</p>","help.scenarios.templates.title":"What are response templates","help.scenarios.templates.content":"<p>Templates are ready-made Ukrainian phrases the agent uses in common situations. Each template belongs to a category:</p><ul><li><strong>greeting</strong> — greeting at call start</li><li><strong>farewell</strong> — goodbye at call end</li><li><strong>silence_prompt</strong> — phrase when customer is silent</li><li><strong>transfer</strong> — message when transferring to operator</li><li><strong>error</strong> — phrase on technical error</li><li><strong>wait</strong> — asking customer to wait</li><li><strong>order_cancelled</strong> — order cancellation message</li></ul><p>Each category can have <strong>multiple variants</strong> — the agent randomly picks one of the active variants for natural-sounding speech.</p>","help.scenarios.templates.steps":"Step-by-step: Templates","help.scenarios.templates.stepsContent":`<p><strong>Creating a new template:</strong></p><ol><li>Click <strong>"New template"</strong></li><li>Select a <strong>category</strong> (greeting, farewell, etc.)</li><li>Enter a <strong>title</strong> — for your reference, customers don't see it</li><li>Enter the <strong>text</strong> — the Ukrainian phrase the agent will speak</li><li>Click <strong>"Save"</strong></li></ol><p><strong>Adding a variant to an existing category:</strong></p><ol><li>Find the category in the table</li><li>Click <strong>"Add variant"</strong> next to the category name</li><li>Fill in the title and text for the new variant</li><li>Save — the variant is immediately available to the agent</li></ol><p><strong>Editing / deleting:</strong></p><ol><li>Click the <strong>three dots (⋮)</strong> to the right of a template</li><li>Select <strong>"Edit"</strong> or <strong>"Delete"</strong></li><li>Deletion is only available if the category has more than one variant</li></ol>`,"help.scenarios.dialogues.title":"What are dialogue scenarios","help.scenarios.dialogues.content":'<p>Scenarios are <strong>example conversations</strong> between customer and agent (few-shot). The agent analyzes the current conversation and picks the most similar example to shape its response.</p><ul><li><strong>Scenario type</strong> — tire search, order, fitting, consultation, etc.</li><li><strong>Phase</strong> — development stage (mvp, orders, services)</li><li><strong>Format</strong> — JSON array of turns: <code>[{"role": "user", "text": "..."}, {"role": "assistant", "text": "..."}]</code></li><li>Tools are auto-extracted from <code>tool_calls</code> fields in turns</li></ul>',"help.scenarios.dialogues.steps":"Step-by-step: Dialogues","help.scenarios.dialogues.stepsContent":`<p><strong>Creating a new dialogue:</strong></p><ol><li>Click <strong>"New dialogue"</strong></li><li>Enter a <strong>title</strong> — describe the scenario (e.g., "Customer looking for winter tires 205/55 R16")</li><li>Select <strong>scenario type</strong> (tire_search, order_creation, etc.)</li><li>Select <strong>phase</strong> (mvp, orders, services)</li><li>Edit the <strong>JSON dialogue</strong> — alternate <code>user</code> and <code>assistant</code> turns</li><li>Click <strong>"Save"</strong></li></ol><p><strong>JSON turn format:</strong></p><ul><li><code>{"role": "user", "text": "Hello, I need tires"}</code></li><li><code>{"role": "assistant", "text": "Good day! I'll help you choose. What tire size do you need?"}</code></li></ul><p><strong>Filtering:</strong> use the dropdowns above the table to filter by scenario type, phase, and active status.</p>`,"help.scenarios.safety.title":"What are safety rules","help.scenarios.safety.content":"<p>Safety rules define <strong>restrictions and boundaries</strong> for the agent. They are always included in the system prompt and have the highest priority.</p><ul><li><strong>Rule type</strong> — prompt_injection, data_validation, off_topic, language, behavioral, escalation</li><li><strong>Severity</strong> — critical (red), high (yellow), medium (blue), low (gray)</li><li><strong>Trigger</strong> — a customer message that should activate the rule</li><li><strong>Expected behavior</strong> — how the agent should respond to the trigger</li></ul>","help.scenarios.safety.severity.title":"How severity levels work","help.scenarios.safety.severity.content":'<p>The severity level determines the <strong>execution priority</strong> of a rule by the agent:</p><table class="help-table"><tr><th>Level</th><th>Agent behavior</th><th>When to use</th></tr><tr><td><strong style="color:var(--danger)">CRITICAL</strong></td><td><strong>Immediate action</strong> — the agent executes the rule IMMEDIATELY, without searching the knowledge base or asking additional questions. Overrides all other instructions.</td><td>Aggression, threats, prompt injection, personal data leaks</td></tr><tr><td><strong style="color:var(--warning)">HIGH</strong></td><td>High priority — the agent considers the rule when forming a response</td><td>Data validation, order procedure, response formatting</td></tr><tr><td><strong style="color:var(--info)">MEDIUM</strong></td><td>Standard priority — the agent follows the rule in normal order</td><td>Fitting suggestions, alternative recommendations</td></tr><tr><td><strong style="color:var(--secondary)">LOW</strong></td><td>Background priority — recommendation, not obligation</td><td>Handling off-topic requests (weather, jokes)</td></tr></table><p><strong>Important:</strong> if a rule should trigger an immediate action (transfer to operator, refusal) — set it to <strong>CRITICAL</strong>. In the "Expected behavior" field, specify the exact tool: <code>transfer_to_operator</code>.</p>',"help.scenarios.safety.steps":"Step-by-step: Safety Rules","help.scenarios.safety.stepsContent":'<p><strong>Creating a rule:</strong></p><ol><li>Click <strong>"New rule"</strong></li><li>Enter a <strong>title</strong> (e.g., "Prohibit discussing competitors")</li><li>Select <strong>type</strong> and <strong>severity</strong></li><li>In the <strong>"Trigger"</strong> field, enter an example customer message that should activate the rule</li><li>In the <strong>"Expected behavior"</strong> field, describe how the agent should respond</li><li>Save</li></ol><p><strong>Regression test:</strong></p><ol><li>Click <strong>"Regression Test"</strong> next to the create button</li><li>The system sends triggers from all active rules to the agent</li><li>Results show: passed / failed, expected vs actual behavior</li><li>Fix rules that failed the test</li></ol>',"help.scenarios.affects.title":"What changes affect","help.scenarios.affects.content":`<div class="help-affects"><p><strong>Response templates:</strong> affect the agent's <strong>specific phrases</strong> in standard situations. Change a greeting template — all new calls start with the new text.</p><p><strong>Dialogue scenarios:</strong> affect <strong>conversation style</strong>. The agent finds the most similar example and imitates it. More good examples = better dialogue quality.</p><p><strong>Safety rules:</strong> affect <strong>restrictions and boundaries</strong>. Critical rules cannot be violated. If a rule is deleted — the restriction is lifted.</p></div><p><strong>Important:</strong> all changes apply instantly. We recommend testing in the <strong>Sandbox</strong> first.</p>`,"help.scenarios.tips":`<ul><li>Start by reviewing existing templates and dialogues — they cover the main scenarios</li><li>Add 2-3 variants per template category — this makes the agent sound more natural</li><li>New dialogues are <strong>instantly</strong> available for the agent's few-shot selection</li><li>Before major changes, run the <strong>regression test</strong> for safety rules</li><li><strong>CRITICAL</strong> rules execute immediately — the agent skips the knowledge base search and acts right away (e.g., transfers to operator)</li><li>In the "Expected behavior" field, specify the exact action and tool: <code>transfer_to_operator</code>, not vague phrases</li></ul>`,"help.knowledge.title":"Help: Knowledge Base","help.knowledge.overview":"<p>The knowledge base contains articles the agent uses to consult customers. When a customer asks about delivery, warranty, returns, etc., the agent searches these articles via <strong>RAG search</strong> (semantic, not keyword-based). More quality articles = more accurate consultations.</p>","help.knowledge.articles.title":"What are articles","help.knowledge.articles.content":'<p>Articles are the main knowledge base content. Each article has:</p><ul><li><strong>Category</strong> — faq, guides, brands, comparisons, delivery, warranty, returns, policies, general, etc.</li><li><strong>Content</strong> — Markdown text (supports headings, lists, links)</li><li><strong>Embedding</strong> — vector representation for semantic search. Status:<ul><li>Green <strong>"indexed"</strong> — article is searchable</li><li>Yellow <strong>"pending"</strong> — awaiting generation (every 5 minutes)</li><li>Red <strong>"error"</strong> — error, needs reindexing</li></ul></li><li><strong>Expires at</strong> — optional date after which the article is auto-hidden (useful for promotions)</li></ul>',"help.knowledge.articles.steps":"Step-by-step: Articles","help.knowledge.articles.stepsContent":'<p><strong>Creating an article manually:</strong></p><ol><li>Click <strong>"+ New article"</strong></li><li>Enter a <strong>title</strong> — clear and descriptive (e.g., "Delivery terms across Ukraine")</li><li>Select a <strong>category</strong></li><li>Write <strong>content</strong> in Markdown format</li><li>Optionally set an <strong>expiration date</strong></li><li>Click <strong>"Save"</strong> — the article will be indexed within 5 minutes</li></ol><p><strong>Importing from files (quick population):</strong></p><ol><li>Click <strong>"Import documents"</strong></li><li>Select files (.md, .pdf, .docx) — multiple allowed</li><li>Optionally select a category (if not selected — detected from filename)</li><li>Click <strong>"Import"</strong> — articles are created automatically</li></ol><p><strong>Reindexing:</strong></p><ul><li><strong>Single article:</strong> menu ⋮ → "Reindex"</li><li><strong>All articles:</strong> "Reindex all" button (takes time, use for bulk issues)</li></ul>',"help.knowledge.sources.title":"What are source configurations","help.knowledge.sources.content":"<p>Sources are external websites from which the system automatically collects articles for the knowledge base.</p><ul><li><strong>Type</strong>:<ul><li><strong>HTML</strong> — regular web pages (text extraction via trafilatura)</li><li><strong>RSS</strong> — RSS/Atom feeds (feedparser + trafilatura)</li><li><strong>ProKoleso</strong> — specialized parser for prokoleso.ua</li></ul></li><li><strong>Language</strong> — source language (UK, DE, EN, FR). Foreign content is <strong>automatically translated</strong> to Ukrainian via LLM</li><li><strong>Schedule</strong> — day and hour for automatic runs</li><li><strong>Auto-approve</strong> — if enabled, articles are activated immediately; otherwise, manual approval required</li></ul>","help.knowledge.sources.steps":"Step-by-step: Sources","help.knowledge.sources.stepsContent":'<p><strong>Adding a source:</strong></p><ol><li>Go to the <strong>"Configurations"</strong> tab</li><li>Click <strong>"Add source"</strong></li><li>Fill in:<ol><li><strong>Name</strong> — for your reference</li><li><strong>Type</strong> — HTML, RSS, or ProKoleso</li><li><strong>Language</strong> — source language (articles will be translated to Ukrainian)</li><li><strong>URL</strong> — website or RSS feed address</li><li><strong>Max articles per run</strong> — limit per iteration</li><li><strong>Schedule</strong> — day of week and hour</li></ol></li><li>Click <strong>"Save"</strong></li></ol><p><strong>Manual run:</strong> menu ⋮ → "Run source" — immediate article fetch from this source.</p><p><strong>Enable/disable:</strong> toggle in the "Enabled" column — saves immediately.</p>',"help.knowledge.scraper.title":'"Scraper" tab',"help.knowledge.scraper.content":'<p>Scraper settings management and import results overview.</p><p><strong>Settings:</strong></p><ul><li><strong>Enabled</strong> — enable/disable scraper globally</li><li><strong>Auto-approve</strong> — automatically activate imported articles</li><li><strong>Dedup LLM check</strong> — LLM duplicate checking (prevents repeat articles)</li><li><strong>"Run now"</strong> — immediate run of all active sources</li></ul><p><strong>Results table:</strong> shows each imported page with status:</p><ul><li>Green <strong>processed</strong> — successfully processed</li><li>Yellow <strong>new</strong> — not yet processed</li><li>Gray <strong>skipped</strong> — skipped (duplicate or irrelevant)</li><li>Red <strong>error</strong> — import/processing error</li></ul><p>For processed articles: menu ⋮ → "View article" or "Approve" / "Reject".</p>',"help.knowledge.watched.title":"What are watched pages","help.knowledge.watched.content":'<p>Watched pages are URLs that the system periodically re-scans. When content changes are detected, the article is <strong>automatically updated</strong>.</p><ul><li><strong>Interval</strong> — check frequency: 6h, 12h, 24h, or 1 week</li><li><strong>Discovery</strong> — "discovery" mode: scans the page for nested links and auto-adds child pages</li><li><strong>Bulk import</strong> — upload a URL list (one per line)</li><li><strong>Tenant binding</strong> — articles can belong to a specific network (ProKoleso / Tvoya Shina)</li></ul>',"help.knowledge.watched.steps":"Step-by-step: Watched Pages","help.knowledge.watched.stepsContent":'<p><strong>Adding a page:</strong></p><ol><li>Go to the <strong>"Watched"</strong> tab</li><li>Enter the page <strong>URL</strong></li><li>Select a <strong>category</strong> and check <strong>interval</strong></li><li>Optionally select a <strong>tenant</strong></li><li>Check <strong>Discovery</strong> to auto-discover child pages</li><li>Click <strong>"Add"</strong></li></ol><p><strong>Bulk import:</strong></p><ol><li>Click <strong>"Bulk import"</strong></li><li>Paste URLs (one per line)</li><li>Select category, interval, and tenant</li><li>Click <strong>"Import"</strong> — duplicates are automatically skipped</li></ol><p><strong>Immediate scan:</strong> menu ⋮ → "Scrape now". Result: content unchanged / updated.</p>',"help.knowledge.promotions.title":"Tracking promotions","help.knowledge.promotions.content":'<p>Promotions are tracked via <strong>Discovery pages</strong> — the system automatically discovers and keeps all promotional offers up to date.</p><h4>How it works</h4><ol><li><strong>Add the main promotions page</strong> (e.g. <code>/promotions/</code>) with the <strong>Discovery</strong> flag</li><li>The system finds all links to child pages (each promotion = a separate link)</li><li>Each child page is scraped, processed by LLM, and saved as an article in the knowledge base</li><li>Embeddings are generated — the promotion becomes available to the agent via <code>search_knowledge_base</code></li></ol><h4>Promotion lifecycle</h4><ul><li><strong>New promotion</strong> — on the next discovery scan, a new link is found → a child watched page is auto-created → scraped → article added to KB</li><li><strong>Content changed</strong> — on rescan, the SHA-256 hash is compared. If changed — the article is <strong>updated</strong> (not duplicated), embeddings are regenerated</li><li><strong>Promotion ended</strong> — if the link disappears from the main promotions page, the article is <strong>automatically deactivated</strong> (active=false) and no longer appears in RAG search</li></ul><h4>What the agent sees</h4><p>During a call, the agent invokes <code>search_knowledge_base</code> with category <strong>"promotions"</strong>. pgvector search finds relevant article chunks and the agent communicates current promotions to the customer.</p>',"help.knowledge.promotions.steps":"Step-by-step: Setting up promotion tracking","help.knowledge.promotions.stepsContent":'<p><strong>Setting up a Discovery page for promotions:</strong></p><ol><li>Go to the <strong>"Watched"</strong> tab</li><li>Enter the main promotions page URL (e.g. <code>https://prokoleso.ua/ua/promotions/</code>)</li><li>Select category <strong>"promotions"</strong></li><li>Set interval to <strong>24 hours</strong> (optimal for promotions)</li><li>Make sure to check <strong>☑ Discovery</strong></li><li>Select a <strong>tenant</strong> (e.g. ProKoleso)</li><li>Click <strong>"Add"</strong></li></ol><p><strong>Initial scan:</strong></p><ol><li>After adding, click menu ⋮ → <strong>"Scrape now"</strong></li><li>The system will find all child promotion pages</li><li>Each promotion will be processed by LLM and indexed</li><li>Check the result: the number of discovered child pages is shown in the <strong>"Children"</strong> column</li></ol><p><strong>From here, the system works automatically:</strong> new promotions are added, expired ones are hidden, content is updated when it changes on the website.</p>',"help.knowledge.affects.title":"What changes affect","help.knowledge.affects.content":'<div class="help-affects"><p><strong>Articles</strong> — the content the agent quotes when answering customer questions. If an article is deleted or deactivated — the agent <strong>cannot answer</strong> related questions.</p><p><strong>Embeddings</strong> — without them, the article is <strong>invisible</strong> to RAG search. New articles are indexed automatically every 5 minutes.</p><p><strong>Sources and watched pages</strong> — affect <strong>automatic updates</strong> of the knowledge base. If a source is disabled — new articles from that site are not fetched.</p></div>',"help.knowledge.tips":'<ul><li>For quick population, use <strong>.md file import</strong> or <strong>bulk URL import</strong></li><li>Check the <strong>"Embedding"</strong> column — articles with "pending" status are not yet searchable</li><li>Set <strong>expiration dates</strong> for promotional articles — they auto-hide</li><li>Use <strong>Discovery</strong> mode to automatically find new pages on a website</li><li>Watched pages with <strong>24h</strong> interval — optimal balance between freshness and load</li></ul>',"help.prompts.title":"Help: Prompts","help.prompts.overview":"<p>The prompt is the AI agent's <strong>main instruction</strong>: the text defining its behavior, communication style, competencies, and restrictions. The prompt is the most influential parameter — even a small change can dramatically alter dialogue quality.</p>","help.prompts.versions.title":"What are prompt versions","help.prompts.versions.content":'<p>The system stores a <strong>history of all prompt versions</strong>. At any time, only one version is <strong>active</strong> (used in real calls). Others are drafts or archived.</p><ul><li><strong>Version name</strong> — unique identifier (e.g., <code>v3.5-natural</code>)</li><li><strong>Active status</strong> — green badge = currently in use</li><li><strong>"Load default"</strong> — fills the text field with the built-in prompt (convenient as a base for a new version)</li></ul>',"help.prompts.versions.steps":"Step-by-step: Prompts","help.prompts.versions.stepsContent":`<p><strong>Creating a new version:</strong></p><ol><li>Click <strong>"New version"</strong></li><li>Enter a <strong>name</strong> (e.g., <code>v4.0-concise</code>)</li><li>Click <strong>"Load default"</strong> to start from the base prompt</li><li>Edit the <strong>prompt text</strong> — this is the agent's instruction in Ukrainian</li><li>Click <strong>"Create"</strong></li></ol><p><strong>Activating a version:</strong></p><ol><li>Find the version in the table</li><li>Menu ⋮ → <strong>"Activate"</strong></li><li>Confirm — <strong>all new calls</strong> will immediately use this version</li></ol><p><strong>Safe prompt update process:</strong></p><ol><li>Create a new version</li><li>Test in the <strong>Sandbox</strong> (select the version when creating a conversation)</li><li>Verify quality — check several scenarios</li><li>Activate or run an <strong>A/B test</strong></li></ol>`,"help.prompts.ab.title":"What are A/B tests","help.prompts.ab.content":"<p>A/B tests let you <strong>compare two prompt versions</strong> on real traffic. Calls are automatically distributed between variants, and the system collects quality metrics.</p><ul><li><strong>Traffic split</strong> — slider from 10% to 90% (recommend starting at 50/50)</li><li><strong>Metrics</strong> — quality, duration, operator transfer rate</li><li><strong>Statistical significance</strong> — the system calculates p-value and z-score</li><li><strong>Report</strong> — detailed comparison across 8 criteria, scenario breakdown, daily trend</li></ul>","help.prompts.ab.steps":"Step-by-step: A/B Tests","help.prompts.ab.stepsContent":'<p><strong>Starting an A/B test:</strong></p><ol><li>Make sure you have <strong>at least 2 prompt versions</strong></li><li>Click <strong>"New A/B test"</strong></li><li>Enter a test <strong>name</strong></li><li>Select <strong>Variant A</strong> and <strong>Variant B</strong></li><li>Adjust the <strong>traffic split</strong> with the slider</li><li>Click <strong>"Create"</strong> — the test starts immediately</li></ol><p><strong>Analyzing results:</strong></p><ol><li>Click the <strong>test name</strong> in the table to view the report</li><li>Check <strong>overall metrics</strong>: calls, quality, duration, transfers</li><li>Study the <strong>criteria breakdown</strong>: greeting, intent detection, tool usage, etc.</li><li>Wait for statistical significance (significance badge)</li></ol><p><strong>Completing the test:</strong></p><ol><li>Menu ⋮ → <strong>"Stop"</strong></li><li>Activate the winning version via the prompts table</li></ol>',"help.prompts.affects.title":"What changes affect","help.prompts.affects.content":'<div class="help-affects"><p><strong>Activating a prompt</strong> — instantly changes agent behavior for <strong>all new calls</strong>. Current calls use the version they started with.</p><p><strong>A/B test</strong> — splits traffic between two versions. During the test, the agent may behave differently for different customers.</p><p><strong>The prompt is the most influential parameter.</strong> A small wording change can dramatically alter communication style, response accuracy, and tool usage.</p></div>',"help.prompts.tips":`<ul><li><strong>Never</strong> activate a prompt without testing it in the Sandbox first</li><li>Use A/B tests to validate hypotheses — don't change prompts by guesswork</li><li>Versioning allows <strong>instant rollback</strong> to a previous version if issues arise</li><li>The <strong>"Reset to default"</strong> button creates a new version from the built-in prompt — useful for recovery</li><li>Export A/B test reports to CSV for detailed analysis</li></ul>`,"help.sandbox.title":"Help: Sandbox","help.sandbox.overview":"<p>The Sandbox is an environment for <strong>testing the AI agent</strong> without real calls. Chat with the agent, rate response quality, run regression tests, and export behavior patterns. This is the primary <strong>quality control</strong> tool.</p>","help.sandbox.chat.title":'"Chat" tab',"help.sandbox.chat.content":'<p>Interactive dialogue with the AI agent. Left panel — conversation list, right — chat.</p><p><strong>Features:</strong></p><ul><li><strong>Tool mode:</strong> Mock (test data) or Live (real data from Store API)</li><li><strong>Prompt selection:</strong> test any version, not just the active one</li><li><strong>Model selection:</strong> different LLM models (speed / quality)</li><li><strong>Scenario type:</strong> tire_search, order_creation, fitting_booking, etc.</li><li><strong>Customer persona:</strong> neutral, angry, confused, rushed, detailed — affects auto-generated messages</li><li><strong>Auto customer:</strong> "Auto customer" button — LLM generates a realistic customer message</li><li><strong>Rating:</strong> stars on each agent response (1-5) with comment</li><li><strong>Branching:</strong> "Branch" button — try an alternative customer message from a specific point</li></ul>',"help.sandbox.chat.steps":"Step-by-step: Chat","help.sandbox.chat.stepsContent":`<p><strong>Starting a test:</strong></p><ol><li>Click <strong>"+ New conversation"</strong></li><li>If quick start templates exist — pick one (conversation starts automatically)</li><li>Or fill in manually:<ol><li><strong>Title</strong> — for identification (e.g., "Winter tire test")</li><li><strong>Prompt version</strong> — select one (active marked with *)</li><li><strong>Model</strong> — LLM model</li><li><strong>Tool mode</strong> — Mock for tests, Live for real data checks</li><li><strong>Scenario</strong> — dialogue type (optional)</li></ol></li><li>Click <strong>"Create"</strong></li></ol><p><strong>Rating response quality:</strong></p><ol><li>Read the agent's response</li><li>Click the <strong>stars</strong> (1-5) to rate</li><li>Add a <strong>comment</strong> — what's good / what needs improvement</li></ol><p><strong>Marking turn groups (for pattern export):</strong></p><ol><li>Enable <strong>"Marking mode"</strong> in the chat header</li><li>Check the turns you want to group</li><li>Click <strong>"Create group"</strong></li><li>Enter <strong>intent</strong>, <strong>type</strong> (positive/negative), and <strong>rating</strong></li><li>For negative groups, enter <strong>correction</strong> — the correct response</li><li>Save — the group can be exported to patterns</li></ol>`,"help.sandbox.regression.title":'"Regression" tab',"help.sandbox.regression.content":"<p>Automatically replay a saved conversation with a new prompt — to verify changes haven't degraded quality.</p><ul><li>The system takes <strong>customer messages</strong> from a baseline conversation</li><li>Sends them to the agent with a <strong>new prompt version</strong></li><li>Compares responses: <strong>original</strong> vs <strong>new</strong> — shows differences</li></ul>","help.sandbox.regression.steps":"Step-by-step: Regression","help.sandbox.regression.stepsContent":`<p><strong>Preparation:</strong></p><ol><li>Go to the <strong>"Chat"</strong> tab</li><li>Create or find a quality conversation with ratings</li><li>Click <strong>"Mark as baseline"</strong> in the chat header — a <strong>[B]</strong> badge will appear</li></ol><p><strong>Running a regression test:</strong></p><ol><li>Open a baseline conversation on the <strong>"Chat"</strong> tab</li><li>Click <strong>"Replay"</strong> in the button bar (only visible for baseline conversations)</li><li>Select the <strong>prompt version</strong> to test</li><li>Click <strong>"Run"</strong> — results will appear on the "Regression" tab</li></ol><p><strong>Analyzing results:</strong></p><ol><li>Go to the <strong>"Regression"</strong> tab</li><li>Click the row in the table to view details</li><li>Compare responses <strong>side by side</strong>: original on the left, new on the right</li><li>Differences are highlighted — quickly see what changed</li><li>If quality dropped — don't activate the new prompt</li></ol>`,"help.sandbox.patterns.title":'"Patterns" tab',"help.sandbox.patterns.content":'<p>Patterns are exported turn groups from chats. Used for automatic evaluation and training.</p><ul><li><strong>Creation:</strong> patterns are created by exporting groups from the "Chat" tab (not here)</li><li><strong>Search:</strong> semantic pattern search — enter a query and click "Test search"</li><li><strong>Management:</strong> activate/deactivate, delete via menu ⋮</li></ul>',"help.sandbox.phrases.title":'"Agent Phrases" tab',"help.sandbox.phrases.content":'<p>Reference tab (read-only) — shows <strong>all phrases</strong> the agent can use.</p><ul><li><strong>DB templates</strong> (purple) — overrides from "Scenarios → Templates"</li><li><strong>Built-in phrases</strong> — hardcoded fallback phrases (used when no templates exist)</li><li><strong>Phrase pools</strong> — variant sets for random selection (waiting, clarification, etc.)</li></ul><p>To edit phrases, go to <strong>Scenarios → Response Templates</strong>.</p>',"help.sandbox.starters.title":'"Starter Templates" tab',"help.sandbox.starters.content":'<p>Ready-made scenarios for quickly starting a test conversation. Starters appear as cards when creating a new conversation.</p><ul><li><strong>Title</strong> — brief scenario description</li><li><strong>First message</strong> — initial customer message (sent automatically)</li><li><strong>Scenario</strong> — type (tire_search, order_creation, etc.)</li><li><strong>Persona</strong> — customer type (neutral, angry, confused, rushed, detailed)</li></ul><p>Create: <strong>"New starter"</strong> button. Edit / delete via row buttons.</p>',"help.sandbox.import.title":"Importing real calls","help.sandbox.import.content":'<p>You can import <strong>real calls</strong> from the Call Log into the Sandbox. This allows you to analyze problematic dialogues with the full set of Sandbox tools.</p><p><strong>Method 1 — from Sandbox:</strong> click the <strong>📞</strong> button next to "New conversation" in the sidebar, find the call in the table, and click <strong>"Import"</strong>.</p><p><strong>Method 2 — from Call Log:</strong> open call details and click the <strong>"Open in Sandbox"</strong> button.</p><p><strong>What gets imported:</strong></p><ul><li>All turns (customer and agent) in original order</li><li>Tool calls with arguments and results</li><li>Metadata: scenario, tenant, quality score, duration</li></ul><p><strong>Imported conversations are tagged:</strong> <code>imported</code>, <code>call:{id}</code>.</p>',"help.sandbox.import.steps":"Step-by-step: Working with an imported call","help.sandbox.import.stepsContent":'<p><strong>Quick import from Sandbox:</strong></p><ol><li>Click the <strong>📞</strong> button next to "New conversation"</li><li>Find the call by phone number or date</li><li>Click <strong>"Import"</strong> — the conversation opens in chat</li></ol><p><strong>Working with an imported call:</strong></p><ol><li>Review the dialogue and <strong>rate agent responses</strong></li><li>At a problematic point, click <strong>"Branch"</strong> — try an alternative message</li><li>Compare how the agent handles different request variations</li><li>Mark problematic groups and <strong>export to patterns</strong></li><li>Use the patterns to <strong>improve the prompt</strong></li></ol>',"help.sandbox.regressionAdvanced.title":"Advanced Regression Features","help.sandbox.regressionAdvanced.content":"<p>Additional regression testing capabilities:</p><ul><li><strong>Delete runs</strong> — remove unwanted regression tests along with generated conversations</li><li><strong>Rate new responses</strong> — rate each new agent response on a 1-5 scale, average is calculated automatically</li><li><strong>Verdict (Approve/Reject)</strong> — approve or reject regression results, filter by verdict</li><li><strong>Semantic similarity</strong> — automatic response comparison via embeddings (requires OPENAI_API_KEY). Green ≥85%, yellow ≥60%, red &lt;60%</li><li><strong>Batch replay</strong> — run regression for multiple baseline conversations at once</li></ul>","help.sandbox.workflow.title":"Recommended workflow","help.sandbox.workflow.content":'<p>Complete prompt quality control cycle:</p><ol><li><strong>Create starter templates</strong> for typical scenarios ("Starters" tab)</li><li><strong>Run a series of test dialogues</strong> with the old prompt, rate responses with stars</li><li><strong>Mark the best conversations as baseline</strong> (button in chat header)</li><li><strong>Create a new prompt version</strong> ("Prompts" section)</li><li><strong>Run regression tests</strong> — compare new prompt responses with baseline</li><li><strong>Run new test dialogues</strong> with the new prompt</li><li><strong>If quality is satisfactory</strong> — activate the prompt or start an A/B test</li></ol>',"help.sandbox.tips":`<ul><li>Before changing a prompt, <strong>mark the best conversations as baseline</strong> — that's your reference point</li><li>Use <strong>"Auto customer"</strong> for quick generation of realistic customer messages</li><li><strong>Live Tools</strong> mode provides real data — useful for final pre-production checks</li><li><strong>Branching</strong> lets you try "what if the customer asked differently?"</li><li>Export <strong>negative groups</strong> to patterns — this improves automatic evaluation</li><li><strong>Import real calls</strong> from the Call Log — analyze problematic dialogues with Sandbox tools</li></ul>`,"help.tools.title":"Help: Agent Tools","help.tools.overview":"<p>Tools are <strong>actions</strong> the AI agent can perform during conversations: search tires, check availability, create orders, book fitting, etc. Here you can <strong>change the description</strong> of any tool to influence when and how the agent uses it.</p>","help.tools.overrides.title":"What are description overrides","help.tools.overrides.content":'<p>Each tool has a <strong>default description</strong> (hardcoded). The LLM reads this description and decides when to invoke the tool.</p><ul><li><strong>Override</strong> — replaces the default description with custom text</li><li><strong>"Overridden"</strong> badge (yellow) — description has been changed</li><li><strong>"Default"</strong> badge (gray) — using standard description</li><li><strong>Reset</strong> — red button removes the override and restores the default</li></ul>',"help.tools.overrides.steps":"Step-by-step: Changing descriptions","help.tools.overrides.stepsContent":'<p><strong>Changing a tool description:</strong></p><ol><li>Find the tool in the table</li><li>Click <strong>"Edit"</strong></li><li>The modal shows the <strong>original description</strong> at the top (for reference)</li><li>Edit the <strong>description text</strong> in the field below</li><li>Click <strong>"Save"</strong></li></ol><p><strong>Resetting to default:</strong></p><ol><li>Click the red <strong>"Reset"</strong> button next to the tool</li><li>Confirm — the description reverts to the code default</li></ol><p><strong>Verifying changes:</strong></p><ol><li>Go to the <strong>Sandbox</strong></li><li>Create a test conversation</li><li>Ask the agent to perform the action related to the tool</li><li>Verify the agent selects the correct tool</li></ol>',"help.tools.list.title":"Tool list","help.tools.list.content":"<p>Available agent tools:</p><ul><li><code>get_vehicle_tire_sizes</code> — determine tire size by vehicle make/model</li><li><code>search_tires</code> — search tires by parameters (size, brand, season)</li><li><code>check_availability</code> — check stock for a specific tire</li><li><code>get_order_status</code> — check order status by number</li><li><code>create_order_draft</code> — create an order draft</li><li><code>update_order_delivery</code> — select delivery method</li><li><code>confirm_order</code> — confirm the order</li><li><code>get_fitting_stations</code> — list tire fitting stations</li><li><code>get_fitting_slots</code> — available booking slots</li><li><code>book_fitting</code> — book a fitting appointment</li><li><code>get_pickup_points</code> — pickup locations</li><li><code>search_knowledge_base</code> — knowledge base search (RAG)</li><li><code>transfer_to_operator</code> — transfer to a live operator</li></ul>","help.tools.affects.title":"What changes affect","help.tools.affects.content":`<div class="help-affects"><p><strong>Tool description</strong> is a hint for the LLM. The agent <strong>doesn't know</strong> what a tool does — it relies solely on the description.</p><p>If the description is <strong>too vague</strong> — the agent may invoke the tool in inappropriate situations.</p><p>If the description is <strong>too narrow</strong> — the agent may miss situations where the tool is needed.</p><p><strong>Example:</strong> if the agent confuses <code>search_tires</code> and <code>check_availability</code>, clarify in the description: "use search_tires for parameter-based search, check_availability — only to check a specific SKU."</p></div>`,"help.tools.tips":`<ul><li>Change descriptions <strong>carefully</strong> — they directly affect the agent's tool selection</li><li><strong>Always</strong> test changes in the Sandbox before applying</li><li>If the agent confuses two tools — add <strong>explicit disambiguation</strong> to the description</li><li>Write descriptions in <strong>English</strong> — the LLM understands English instructions better</li><li>Use the <strong>"Reset"</strong> button if a change degraded quality</li></ul>`,"help.monitoring.title":"Help: Monitoring","help.monitoring.overview":"<p>System technical monitoring page. Shows the status of all components: server, database, Redis, external APIs, background tasks. Used for diagnostics and health verification.</p>","help.monitoring.health.title":"Health check","help.monitoring.health.content":'<p>The <strong>"Health check"</strong> card shows basic system status:</p><ul><li><strong>Status</strong> — overall server state (OK / error)</li><li><strong>Active calls</strong> — calls being processed right now</li><li><strong>Redis</strong> — session store connection (Connected / Disconnected)</li><li><strong>Service readiness</strong>:<ul><li>Store API — shop API connection</li><li>Claude API — LLM connection</li><li>Google STT — speech recognition</li><li>TTS — speech synthesis</li></ul></li></ul><p>Green badge = working, red = problem, yellow = warning.</p>',"help.monitoring.extended.title":"Extended status","help.monitoring.extended.content":'<p>Detailed system resource information (admin only):</p><ul><li><strong>Version</strong> — current application version</li><li><strong>Uptime</strong> — server uptime without restart</li><li><strong>PostgreSQL</strong> — database size and connection count</li><li><strong>Redis</strong> — memory usage</li><li><strong>Celery</strong> — number of active workers for background tasks</li><li><strong>Backup</strong> — last backup time</li></ul><p>Click <strong>"Load status"</strong> to fetch data (request may take a few seconds).</p>',"help.monitoring.external.title":"External tools","help.monitoring.external.content":"<p>Quick links to external monitoring systems:</p><ul><li><strong>Grafana</strong> — real-time metric dashboards (port 3000)</li><li><strong>Prometheus</strong> — metrics storage, PromQL queries (port 9090)</li><li><strong>Flower</strong> — Celery queue monitoring (background tasks: scraping, embeddings, quality)</li></ul><p>Links automatically use the current hostname.</p>","help.monitoring.tips":`<ul><li>If <strong>Redis</strong> shows "Disconnected" — call sessions won't work</li><li>Check <strong>Celery workers</strong> — if 0, background tasks (scraping, embeddings, quality scoring) will stop</li><li>Monitor <strong>DB size</strong> — if growing rapidly, check table partitioning</li><li>Use <strong>Grafana</strong> for detailed metric analysis over time</li></ul>`,"help.configuration.title":"Help: Configuration","help.configuration.overview":"<p>Manage system technical settings: hot-reload configuration and LLM request routing between providers (Anthropic, OpenAI, DeepSeek, Gemini). Available to administrators only.</p>","help.configuration.reload.title":"Configuration reload","help.configuration.reload.content":'<p>The <strong>"Reload config"</strong> button applies safe configuration parameters <strong>without restarting</strong> the server:</p><ul><li>Feature flags (e.g., enabling/disabling LLM routing)</li><li>Quality parameters (scoring thresholds)</li><li>Logging levels</li></ul><p>Critical parameters (ports, DB connections) require a full restart.</p>',"help.configuration.llm.title":"LLM routing","help.configuration.llm.content":"<p>Multi-provider routing distributes LLM requests across multiple providers:</p><ul><li><strong>Providers table</strong> — all connected LLM providers with status:<ul><li><strong>Model</strong> — model name (editable)</li><li><strong>Enabled</strong> — on/off</li><li><strong>Status</strong> — OK (green) / DOWN (red) / unchecked (gray)</li><li><strong>API Key</strong> — key presence in environment variables</li></ul></li><li><strong>Test</strong> — provider check button (sends a test request)</li></ul>","help.configuration.llm.steps":"Step-by-step: LLM setup","help.configuration.llm.stepsContent":`<p><strong>Checking providers:</strong></p><ol><li>Click <strong>"Load configuration"</strong></li><li>Review the providers table — check statuses</li><li>For a problematic provider, click <strong>"Test"</strong></li><li>If status is DOWN — verify the API key in environment variables</li></ol><p><strong>Changing a provider's model:</strong></p><ol><li>Edit the model name in the <strong>"Model"</strong> field</li><li>Press <strong>Enter</strong> or click outside — change saves automatically</li></ol><p><strong>Enabling/disabling a provider:</strong></p><ol><li>Toggle the switch in the <strong>"Enabled"</strong> column</li><li>Provider is instantly enabled/disabled</li></ol>`,"help.configuration.tasks.title":"Task routing","help.configuration.tasks.content":"<p>Each LLM task type can be assigned to a specific provider with a fallback chain:</p><ul><li><strong>agent</strong> — main customer dialogue (most critical task)</li><li><strong>quality_scoring</strong> — call quality assessment</li><li><strong>article_processing</strong> — scraper article processing</li><li><strong>auto_customer</strong> — customer message generation in sandbox</li></ul><p>Each task has a <strong>primary provider</strong> and a <strong>fallback chain</strong> (used if primary fails). Fallback order determines priority.</p>","help.configuration.schedules.title":"Background Task Schedules","help.configuration.schedules.content":'<p>Manage Celery task schedules without restart:</p><ul><li><strong>Full Catalog Sync</strong> — daily upload of all products from 1C (default 08:00 Kyiv)</li><li><strong>STT Hints Refresh</strong> — extract new models/manufacturers from catalog for better speech recognition (default weekly, Sunday 10:00)</li></ul><p>For each task you can configure: frequency (daily/weekly), execution hour, day of week. "Run Now" triggers the task immediately outside schedule. "Reset All to Defaults" restores default values.</p>',"help.configuration.tts.title":"TTS Voice Settings","help.configuration.tts.content":'<p>Manage Google Cloud TTS voice without restarting the system:</p><ul><li><strong>Voice</strong> — choose from available voices (Wavenet, Neural2, Chirp3-HD)</li><li><strong>Speaking Rate</strong> — from 0.25 (very slow) to 4.0 (very fast), recommended 0.85–1.0</li><li><strong>Pitch</strong> — from -20 to +20 semitones; not all voices support pitch</li></ul><p>The "Test Voice" button synthesizes a test phrase with current settings.</p>',"help.configuration.ttsBreaks.title":"Punctuation Break Durations","help.configuration.ttsBreaks.content":"<p>Configure SSML break (<code>&lt;break&gt;</code>) durations after punctuation marks. Affects speech rhythm and naturalness:</p><ul><li><strong>Comma</strong> — pause between clauses (default 100ms)</li><li><strong>Period</strong> — pause between sentences (200ms)</li><li><strong>Question/Exclamation</strong> — emotional pause (250ms)</li><li><strong>Colon</strong> — pause before explanation (200ms)</li><li><strong>Semicolon</strong> — pause between related clauses (150ms)</li><li><strong>Em Dash</strong> — contrast/clarification pause (150ms)</li></ul><p>A value of 0ms disables the break for that punctuation mark. Valid range: 0–1000ms.</p>","help.pointHints.title":"Point Hints","help.pointHints.overview":'District and landmark descriptions for fitting stations and pickup points. The AI agent uses them to match customer requests (e.g., "right bank") to the right location.',"help.pointHints.fitting.title":"Fitting Tab","help.pointHints.fitting.content":'<p>Hints for fitting stations:</p><ul><li><strong>District</strong> — "Right bank", "Left bank", "Center"</li><li><strong>Landmarks</strong> — "near Pit Line", "behind Karavan mall"</li><li><strong>Description</strong> — additional info for the agent</li></ul><p>Hints are automatically added to get_fitting_stations results.</p>',"help.pointHints.pickup.title":"Pickup Points Tab","help.pointHints.pickup.content":"<p>Hints for pickup/collection points. Same fields (district, landmarks, description) are added to get_pickup_points results.</p><p>Helps the agent when customers describe locations approximately.</p>","help.pointHints.steps":"Step-by-step","help.pointHints.stepsContent":'<ol><li>Open the desired tab (Fitting or Pickup Points)</li><li>The point list loads automatically from Redis cache</li><li>Fill in fields for the desired point: district, landmarks, description</li><li>Click "Save" next to the point</li><li>Hints apply to new tool requests immediately</li></ol>',"help.pointHints.affects.title":"System Impact","help.pointHints.affects.content":"<p>Hints are stored in PostgreSQL (primary) and Redis (cache) and merged into <code>get_fitting_stations</code> and <code>get_pickup_points</code> tool responses. Changes take effect immediately without restart.</p>","help.pointHints.tips":"Use Ukrainian-language descriptions — the agent communicates with customers in Ukrainian.","help.sttHints.title":"STT Phrase Hints","help.sttHints.overview":"Manage phrase hints to improve Google Cloud STT speech recognition. Three levels: base (brands, terms), from catalog (auto-extracted), custom.","help.sttHints.levels.title":"Hint Levels","help.sttHints.levels.content":"<p>Phrase hints system to improve Google STT speech recognition. Three levels:</p><ul><li><strong>Base</strong> — tire brands with Cyrillic pronunciations (Michelin → Мішлен), tire terms. Can be edited and reset to defaults.</li><li><strong>From catalog</strong> — auto-extracted from tire DB (manufacturers) with Latin→Cyrillic transliteration</li><li><strong>Custom</strong> — manually added phrases</li></ul><p>Google API limit: 5000 phrases. Cyrillic variants are most effective.</p>","help.sttHints.base.title":"Base Tab","help.sttHints.base.content":'<p>Manage the base dictionary: tire brands with pronunciations, tire terms, store names.</p><ul><li>Search the phrase list</li><li>Add and remove individual phrases</li><li><strong>Save base</strong> — save the modified list (marks as "modified")</li><li><strong>Reset to defaults</strong> — restore the hardcoded default list</li></ul>',"help.sttHints.catalog.title":"Catalog Tab","help.sttHints.catalog.content":"<p>Auto-extracted manufacturer names from the tire DB with transliteration. Read-only list.</p><ul><li><strong>Refresh from catalog</strong> — re-read manufacturers from DB and update transliterations</li></ul>","help.sttHints.custom.title":"Custom Tab","help.sttHints.custom.content":"<p>Manual phrase list for STT hints. Max 1000 phrases, up to 200 chars each.</p><ul><li>Search, add and remove phrases</li><li><strong>Save</strong> — send the modified list to the server</li></ul>","help.sttHints.overrides.title":"Transliteration Tab","help.sttHints.overrides.content":'<p>Whole-word overrides for Latin-to-Cyrillic transliteration in STT hints. For example, "weather" → "везер" instead of letter-by-letter transliteration.</p><ul><li>Search by key or value</li><li>Add new overrides: key — Latin, value — Cyrillic</li><li><strong>Save</strong> — send the modified set to the server</li><li><strong>Reset to defaults</strong> — restore the default override set</li></ul>',"help.sttHints.tips":"<ul><li>Cyrillic variants are most effective (STT uk-UA outputs Cyrillic)</li><li>Total limit is 5000 phrases — watch the fill percentage</li><li>Hints are applied to new calls automatically</li></ul>","help.configuration.providerMgmt.title":"Provider Management","help.configuration.providerMgmt.content":'<p>Each provider in the table has <strong>"Edit"</strong> and <strong>"Delete"</strong> buttons:</p><ul><li><strong>Edit</strong> — opens a dialog to change type, model, Base URL, and API key env var. All fields can be modified and saved.</li><li><strong>Delete</strong> — removes the provider. Before deletion, the system checks whether it is used as primary or fallback in any task. If in use — deletion is blocked (reassign tasks first).</li></ul>',"help.configuration.testPhones.title":"Test Phones","help.configuration.testPhones.content":`<p>The <strong>"Test Phones"</strong> section lets you control AI agent behavior for specific phone numbers:</p><ul><li><strong>No History</strong> — the agent does not receive previous call history. The call is treated as the first one (standard greeting).</li><li><strong>With History</strong> — normal behavior, the agent sees the customer's previous calls.</li><li><strong>Clear History</strong> — deletes all call records from the database (calls, turns, tool calls) and resets the customer's call counter.</li></ul>`,"help.configuration.affects.title":"What changes affect","help.configuration.affects.content":`<div class="help-affects"><p><strong>Disabling a provider</strong> — if it's the only one for a task with no fallbacks, that task will stop working.</p><p><strong>Changing model</strong> — instantly affects all new requests. A more powerful model = better quality, but more expensive and slower.</p><p><strong>Task routing</strong> — lets you use cheaper models for non-critical tasks (quality, scraping) and powerful ones for customer dialogues.</p><p><strong>TTS settings</strong> — new voice/rate/pitch apply to new calls; current calls continue with the old voice.</p><p><strong>Station hints</strong> — district/landmarks apply to the next get_fitting_stations call immediately.</p></div>`,"help.configuration.tips":`<ul><li>Use <strong>fallbacks</strong> for critical tasks (agent) — this protects against a single provider failure</li><li>For <strong>quality_scoring</strong> and <strong>article_processing</strong> tasks, cheaper models work fine</li><li>After changing a provider, click <strong>"Test"</strong> to verify it works</li><li><strong>Config reload</strong> doesn't interrupt current calls — changes apply to new requests</li></ul>`,"help.notifications.title":"Help: Notifications","help.notifications.overview":"<p>Configure Telegram notifications for critical system event alerts: component failures, high load, API errors. Alerts are sent via Alertmanager.</p>","help.notifications.telegram.title":"Telegram bot setup","help.notifications.telegram.content":'<p>To receive notifications, configure a Telegram bot:</p><ul><li><strong>Bot Token</strong> — token obtained from @BotFather in Telegram</li><li><strong>Chat ID</strong> — ID of the chat or group for notifications</li><li><strong>Data source</strong> — where current settings come from: Redis (configured via UI), ENV (environment variables), or "—" (not configured)</li></ul>',"help.notifications.telegram.steps":"Step-by-step: Setup","help.notifications.telegram.stepsContent":'<p><strong>Creating a Telegram bot:</strong></p><ol><li>Open <strong>@BotFather</strong> in Telegram</li><li>Send <code>/newbot</code> and follow instructions</li><li>Copy the <strong>Bot Token</strong></li></ol><p><strong>Getting Chat ID:</strong></p><ol><li>Add the bot to the <strong>group</strong> where you want alerts</li><li>Send any message in the group</li><li>Open <code>https://api.telegram.org/bot&lt;TOKEN&gt;/getUpdates</code></li><li>Find <code>chat.id</code> in the response (number, may be negative for groups)</li></ol><p><strong>Saving settings:</strong></p><ol><li>Paste the <strong>Bot Token</strong></li><li>Paste the <strong>Chat ID</strong></li><li>Click <strong>"Save"</strong></li><li>Click <strong>"Test"</strong> — a test message should arrive in the chat</li></ol>',"help.notifications.affects.title":"What changes affect","help.notifications.affects.content":`<div class="help-affects"><p><strong>Without a configured bot</strong> — you won't receive failure alerts. Issues may go unnoticed.</p><p><strong>Settings are saved in Redis</strong> and take priority over environment variables. Alertmanager configuration is also updated automatically.</p></div>`,"help.notifications.tips":`<ul><li>Always click <strong>"Test"</strong> after saving — make sure the message arrives</li><li>Create a <strong>dedicated group</strong> in Telegram for alerts — don't mix with work chats</li><li>If the test fails — verify the bot is <strong>added to the group</strong> and has permission to send messages</li></ul>`,"help.tenants.title":"Help: Networks","help.tenants.overview":"<p>Manage tenants (retail networks). Each tenant is a separate retail network (e.g., ProKoleso, Tvoya Shina) with its own AI agent settings: name, greeting, tool set, and prompt additions. Calls are automatically assigned to tenants based on PBX data.</p>","help.tenants.table.title":"Networks table","help.tenants.table.content":'<p>Table shows all registered retail networks:</p><ul><li><strong>Slug</strong> — unique identifier (Latin chars, e.g., <code>prokoleso</code>). Set at creation and <strong>cannot be changed</strong></li><li><strong>Name</strong> — display name (e.g., "ProKoleso")</li><li><strong>Network ID</strong> — identifier for 1C and Store API integration</li><li><strong>Agent name</strong> — how the AI agent introduces itself (e.g., "Olena")</li><li><strong>Tools</strong> — number of enabled tools out of 15 available</li><li><strong>Active</strong> — whether the network is enabled</li></ul>',"help.tenants.creating.title":"Creating and editing a network","help.tenants.creating.content":`<p>Each network has settings for AI agent personalization:</p><ul><li><strong>Slug</strong> — unique ID (e.g., <code>tvoya-shina</code>). Used in URLs and API</li><li><strong>Network ID</strong> — retail network ID in 1C. Used for Store API requests and pickup points</li><li><strong>Agent name</strong> — name the agent uses to introduce itself (default "Olena")</li><li><strong>Greeting</strong> — personalized greeting at call start. Supports <code>{agent_name}</code> variable</li><li><strong>Prompt suffix</strong> — additional text appended to the agent's system prompt. Allows setting network-specific behavior</li><li><strong>Configuration (JSON)</strong> — additional parameters in JSON format (e.g., Store API URL)</li></ul>`,"help.tenants.creating.steps":"Step-by-step: Creating a network","help.tenants.creating.stepsContent":'<p><strong>Creating a new network:</strong></p><ol><li>Click <strong>"+ New network"</strong></li><li>Enter a <strong>Slug</strong> — Latin chars, no spaces (e.g., <code>nova-shina</code>)</li><li>Enter a <strong>name</strong> — display name</li><li>Enter the <strong>Network ID</strong> — identifier from 1C</li><li>Optionally change the <strong>agent name</strong></li><li>Write a <strong>greeting</strong> in Ukrainian</li><li>Select <strong>tools</strong> available to the agent for this network</li><li>Click <strong>"Save"</strong></li></ol><p><strong>Editing:</strong> click <strong>⋮ → "Edit"</strong>. All fields editable except Slug.</p><p><strong>Deleting:</strong> click <strong>⋮ → "Delete"</strong>. Calls linked to the deleted network will have <code>tenant_id = NULL</code>.</p>',"help.tenants.tools.title":"Managing network tools","help.tenants.tools.content":"<p>Each network can have its <strong>own tool set</strong>. This lets you restrict agent capabilities per network:</p><ul><li>If a network <strong>doesn't offer fitting</strong> — disable <code>get_fitting_stations</code>, <code>get_fitting_slots</code>, <code>book_fitting</code></li><li>If a network <strong>doesn't accept bot orders</strong> — disable <code>create_order_draft</code>, <code>update_order_delivery</code>, <code>confirm_order</code></li><li><code>transfer_to_operator</code> should <strong>always remain enabled</strong></li></ul><p>By default, all tools are enabled when creating a network.</p>","help.tenants.affects.title":"What changes affect","help.tenants.affects.content":'<div class="help-affects"><p><strong>Greeting and agent name</strong> — instantly change the first phrase for new calls.</p><p><strong>Prompt suffix</strong> — appended to the main prompt, allowing network-specific behavior without creating a separate prompt version.</p><p><strong>Tool set</strong> — determines which actions the agent can perform. A disabled tool cannot be invoked even on explicit customer request.</p><p><strong>Network deactivation</strong> — calls from this network will be handled with default settings (first active network).</p></div>',"help.tenants.tips":'<ul><li>Use the <strong>prompt suffix</strong> for network specifics (e.g., "This network does not provide warranty on used tires")</li><li>When adding a new network, start with the <strong>full tool set</strong> and disable unnecessary ones</li><li>Verify the <strong>Network ID</strong> — it must match the 1C identifier for Store API to work correctly</li><li>Test the greeting in the <strong>Sandbox</strong> before activating</li></ul>',"help.users.title":"Help: Users","help.users.overview":"<p>Manage accounts for administrators, analysts, operators, and content managers. The granular permissions system lets you precisely configure each user's access to sections and actions in the admin panel.</p>","help.users.table.title":"Users table","help.users.table.content":'<p>List of all system users:</p><ul><li><strong>Username</strong> — login name (unique)</li><li><strong>Role</strong> — base role determining default permissions</li><li><strong>Permissions</strong> — status: <strong>"Role defaults"</strong> (using role permissions) or <strong>"Custom"</strong> (individual permission set)</li><li><strong>Active</strong> — whether the account is enabled</li><li><strong>Last login</strong> — date of last system login</li></ul>',"help.users.creating.title":"Creating a user","help.users.creating.content":'<p>To create a new user, specify:</p><ul><li><strong>Username</strong> — unique user name (Latin chars)</li><li><strong>Password</strong> — initial password (user can change later)</li><li><strong>Role</strong> — selected from 4 available roles (see "Roles" section)</li></ul>',"help.users.creating.steps":"Step-by-step: Creating a user","help.users.creating.stepsContent":`<p><strong>Adding a new user:</strong></p><ol><li>Click <strong>"+ New user"</strong></li><li>Enter a <strong>username</strong> (Latin chars, no spaces)</li><li>Enter a <strong>password</strong></li><li>Select a <strong>role</strong></li><li>Click <strong>"Create"</strong></li></ol><p><strong>Changing role:</strong></p><ol><li>Click <strong>⋮</strong> in the user's row</li><li>Select a new role from the list</li><li>Role changes instantly</li></ol><p><strong>Password reset:</strong></p><ol><li>Click <strong>⋮ → "Reset password"</strong></li><li>Enter the new password</li><li>Confirm</li></ol>`,"help.users.roles.title":"Roles and their permissions","help.users.roles.content":"<p>The system has 4 roles with preset permission sets:</p><ul><li><strong>admin</strong> — full access to all sections and actions (wildcard <code>*</code>)</li><li><strong>analyst</strong> — view analytics, export data, read calls. No ability to change settings</li><li><strong>operator</strong> — view operator list only. Minimal permissions</li><li><strong>content_manager</strong> — content management: knowledge base, scraper, training, prompts, sandbox. No access to system settings</li></ul><p>The role determines the <strong>default permission set</strong>. For any user, you can set a <strong>custom permission set</strong> that overrides role defaults.</p>","help.users.permissions.title":"Granular permissions","help.users.permissions.content":'<p>Permissions are divided into <strong>groups</strong>, each with a set of actions:</p><ul><li><strong>Groups</strong>: sandbox, knowledge, scraper, training, prompts, users, audit, tenants, operators, analytics, llm_config, notifications, configuration, monitoring, onec_data, vehicles, pronunciation</li><li><strong>Actions</strong>: read (r), write (w), delete (d), execute (x)</li></ul><p><strong>Modes:</strong></p><ul><li><strong>Role defaults</strong> — uses standard role permissions ("Use role defaults" toggle enabled)</li><li><strong>Custom</strong> — individual checkbox set. Empty set = no access to anything</li></ul>',"help.users.permissions.groups.title":"Permission groups table","help.users.permissions.groups.content":'<table style="width:100%;border-collapse:collapse;font-size:0.92em"><thead><tr style="border-bottom:2px solid #e5e7eb"><th style="text-align:left;padding:4px 8px">Group</th><th style="text-align:left;padding:4px 8px">Pages / Functions</th><th style="text-align:left;padding:4px 8px">Actions</th></tr></thead><tbody><tr><td style="padding:4px 8px"><strong>Sandbox</strong></td><td style="padding:4px 8px">Sandbox</td><td style="padding:4px 8px">r, w, d</td></tr><tr><td style="padding:4px 8px"><strong>Knowledge Base</strong></td><td style="padding:4px 8px">Knowledge Base</td><td style="padding:4px 8px">r, w, d</td></tr><tr><td style="padding:4px 8px"><strong>Scraper</strong></td><td style="padding:4px 8px">Source Configs, Scraper, Watched Pages</td><td style="padding:4px 8px">r, w, d, x</td></tr><tr><td style="padding:4px 8px"><strong>Training</strong></td><td style="padding:4px 8px">Scenarios, Tools</td><td style="padding:4px 8px">r, w, d, x</td></tr><tr><td style="padding:4px 8px"><strong>Prompts</strong></td><td style="padding:4px 8px">Prompt Versions</td><td style="padding:4px 8px">r, w, d</td></tr><tr><td style="padding:4px 8px"><strong>Users</strong></td><td style="padding:4px 8px">Users</td><td style="padding:4px 8px">r, w</td></tr><tr><td style="padding:4px 8px"><strong>Audit</strong></td><td style="padding:4px 8px">Audit Log</td><td style="padding:4px 8px">r</td></tr><tr><td style="padding:4px 8px"><strong>Tenants</strong></td><td style="padding:4px 8px">Networks (Tenants)</td><td style="padding:4px 8px">r, w, d</td></tr><tr><td style="padding:4px 8px"><strong>Operators</strong></td><td style="padding:4px 8px">Operators</td><td style="padding:4px 8px">r, w</td></tr><tr><td style="padding:4px 8px"><strong>Analytics</strong></td><td style="padding:4px 8px">Call Log, Dashboard</td><td style="padding:4px 8px">r, export</td></tr><tr><td style="padding:4px 8px"><strong>LLM Configuration</strong></td><td style="padding:4px 8px">LLM Router Settings</td><td style="padding:4px 8px">r, w</td></tr><tr><td style="padding:4px 8px"><strong>Notifications</strong></td><td style="padding:4px 8px">Telegram Notifications</td><td style="padding:4px 8px">r, w</td></tr><tr><td style="padding:4px 8px"><strong>Configuration</strong></td><td style="padding:4px 8px">Config Reload</td><td style="padding:4px 8px">r, w</td></tr><tr><td style="padding:4px 8px"><strong>Monitoring</strong></td><td style="padding:4px 8px">System Status</td><td style="padding:4px 8px">r</td></tr><tr><td style="padding:4px 8px"><strong>1C Data</strong></td><td style="padding:4px 8px">1C Data Viewer</td><td style="padding:4px 8px">r</td></tr><tr><td style="padding:4px 8px"><strong>Vehicles</strong></td><td style="padding:4px 8px">Vehicle Database</td><td style="padding:4px 8px">r, w</td></tr><tr><td style="padding:4px 8px"><strong>Pronunciation</strong></td><td style="padding:4px 8px">Pronunciation Dictionary</td><td style="padding:4px 8px">r, w</td></tr></tbody></table>',"help.users.permissions.steps":"Step-by-step: Configuring permissions","help.users.permissions.stepsContent":`<p><strong>Setting up custom permissions:</strong></p><ol><li>Click <strong>⋮ → "Permissions"</strong> in the user's row</li><li>A modal opens with the permissions table</li><li>Disable the <strong>"Use role defaults"</strong> toggle</li><li>Check the <strong>checkboxes</strong> for desired groups and actions</li><li>Click <strong>"Save"</strong></li></ol><p><strong>Reverting to role defaults:</strong></p><ol><li>Open the user's permissions window</li><li>Enable the <strong>"Use role defaults"</strong> toggle</li><li>Save — user gets standard role permissions</li></ol>`,"help.users.tips":"<ul><li>For a new analyst, use the <strong>analyst</strong> role — it provides read-only access</li><li><strong>content_manager</strong> — ideal role for SEO specialists or content managers</li><li>Use <strong>custom permissions</strong> only for non-standard cases — role defaults cover 90% of needs</li><li>A deactivated user <strong>cannot log in</strong>, but their data is preserved</li><li>Check the <strong>audit log</strong> — it records all user actions</li></ul>","help.audit.title":"Help: Audit Log","help.audit.overview":"<p>The audit log records all modifying actions in the system: creating, editing, and deleting objects. Used for security control, change tracking, and incident investigation. Audit records <strong>cannot be deleted or modified</strong> — it's an immutable log.</p>","help.audit.table.title":"Audit table","help.audit.table.content":"<p>Each record contains:</p><ul><li><strong>Date</strong> — exact action timestamp</li><li><strong>User</strong> — who performed the action</li><li><strong>Action</strong> — HTTP method type: POST (create), PATCH (update), DELETE (delete)</li><li><strong>Resource</strong> — object type (prompt, article, operator, etc.) and its ID</li><li><strong>IP address</strong> — where the action was performed from</li></ul><p>Sort by any column — click the header.</p>","help.audit.filters.title":"Filtering records","help.audit.filters.content":"<p>Available filters:</p><ul><li><strong>Date from / to</strong> — date range</li><li><strong>Action</strong> — POST, PATCH, or DELETE</li></ul>","help.audit.filters.steps":"Step-by-step: Finding actions","help.audit.filters.stepsContent":'<p><strong>Finding specific changes:</strong></p><ol><li>Set the <strong>date range</strong> when changes occurred</li><li>Optionally select an <strong>action type</strong> (e.g., DELETE to find deletions)</li><li>Click <strong>"Filter"</strong></li><li>Review results — note the user and resource</li></ol><p><strong>Typical use cases:</strong></p><ul><li>"Who deleted article X?" — DELETE filter + date range</li><li>"What changed last week?" — set dates</li><li>"What did user Y do?" — review the log (user filter in development)</li></ul>',"help.audit.tips":"<ul><li>Check the audit log after <strong>unexpected changes</strong> — it shows who made them and when</li><li>Use audit to <strong>monitor content managers</strong> — what articles they create and delete</li><li>The log is <strong>immutable</strong> — no one can hide their actions</li><li>When investigating an incident, start with a <strong>date filter</strong> — narrow the range as much as possible</li></ul>","help.vehicles.title":"Help: Vehicle Database","help.vehicles.overview":"<p>Vehicle and tire size reference database. Used by the <code>get_vehicle_tire_sizes</code> tool — when a customer names a car make and model, the agent finds matching tire sizes in this database. Data is imported from CSV files.</p>","help.vehicles.navigation.title":"Database navigation","help.vehicles.navigation.content":"<p>The database is organized in three levels:</p><ol><li><strong>Brands</strong> — list of car brands (Toyota, BMW, Hyundai...) with model counts</li><li><strong>Models</strong> — models for the selected brand (Camry, Corolla...) with trim counts</li><li><strong>Trims</strong> — specific configurations with parameters:<ul><li><strong>Year</strong> — production year</li><li><strong>Trim</strong> — trim name</li><li><strong>PCD</strong> — bolt pattern (e.g., 5×114.3)</li><li><strong>DIA</strong> — center bore</li><li><strong>Tire sizes</strong> — expandable list of all matching sizes (stock and tuning)</li></ul></li></ol>","help.vehicles.navigation.steps":"Step-by-step: Finding sizes","help.vehicles.navigation.stepsContent":'<p><strong>Finding tire sizes for a vehicle:</strong></p><ol><li>Enter the <strong>brand name</strong> in the search field (e.g., "Toyota")</li><li>Click <strong>"Search"</strong> or press <strong>Enter</strong></li><li>Click the <strong>brand</strong> in the table — model list opens</li><li>Click the <strong>model</strong> — trim list opens</li><li>Click <strong>"Expand" (↕)</strong> next to a trim — see all tire sizes</li></ol><p>Use <strong>breadcrumbs</strong> at the top or the <strong>"Back"</strong> button to navigate back.</p>',"help.vehicles.import.title":"Data import","help.vehicles.import.content":"<p>The vehicle database is populated via <strong>CSV file import</strong>. CSV format is defined in the <code>scripts/import_vehicle_db.py</code> script.</p><ul><li><strong>Update DB</strong> — button opens the import modal</li><li>The field specifies the <strong>server directory path</strong> containing CSV files</li><li>Import <strong>merges data</strong> — existing records are updated, new ones are added</li></ul>","help.vehicles.import.steps":"Step-by-step: CSV import","help.vehicles.import.stepsContent":'<p><strong>Updating the vehicle database:</strong></p><ol><li>Upload CSV files to the server (e.g., via <code>docker cp</code>)</li><li>Click <strong>"Update DB"</strong></li><li>Enter the <strong>directory path</strong> with CSV files (e.g., <code>/tmp/vehicle_csv</code>)</li><li>Click <strong>"Import"</strong></li><li>Wait for completion — statistics update automatically</li></ol>',"help.vehicles.affects.title":"What changes affect","help.vehicles.affects.content":`<div class="help-affects"><p><strong>Vehicle database</strong> is used by the <code>get_vehicle_tire_sizes</code> tool. When a customer names a make/model — the agent searches for sizes here.</p><p><strong>Incomplete database</strong> — the agent won't be able to find sizes for missing vehicles and will ask the customer to provide the size manually.</p><p><strong>Import is safe</strong> — it updates existing records and adds new ones without deleting old data.</p></div>`,"help.vehicles.tips":"<ul><li>Regularly <strong>update the database</strong> when new car models appear</li><li>Check the <strong>statistics cards</strong> after import — brand, model, and size counts should increase</li><li>If customers frequently ask about cars not in the database — that's a signal to update</li><li>Use <strong>search</strong> to quickly verify a specific brand exists</li></ul>","nav.costAnalysis":"Cost Analysis","costs.title":"LLM Cost Analysis","costs.pricing":"Model Pricing","costs.comparison":"Cost Comparison","costs.provider":"Provider","costs.model":"Model","costs.displayName":"Display Name","costs.inputPrice":"Input $/1M","costs.outputPrice":"Output $/1M","costs.system":"System","costs.actions":"Actions","costs.addModel":"Add Model","costs.syncSystem":"Sync from Config","costs.edit":"Edit","costs.delete":"Delete","costs.confirmDelete":"Delete this model from the pricing list?","costs.taskType":"Task Type","costs.period":"Period","costs.dateFrom":"Date from","costs.dateTo":"Date to","costs.apply":"Apply","costs.callCount":"Call Count","costs.totalInputTokens":"Input Tokens","costs.totalOutputTokens":"Output Tokens","costs.avgLatency":"Avg Latency (ms)","costs.totalCost":"Cost ($)","costs.cost":"Cost ($)","costs.difference":"Difference","costs.actual":"actual","costs.noData":"No data for the selected period","costs.allTasks":"All tasks","costs.allTenants":"All tenants","costs.summary":"Usage Summary","costs.synced":"Synced","costs.created":"Created","costs.updated":"Updated","costs.deleted":"Deleted","costs.providerKey":"Provider Key","costs.modelName":"Model Name","costs.save":"Save","costs.cancel":"Cancel","costs.myModels":"My Models","costs.providerCatalog":"Provider Catalog","costs.newModelsFound":"{count} new models found","costs.viewCatalog":"View Catalog","costs.updateCatalog":"Update Catalog","costs.lastSync":"Last sync","costs.searchModels":"Search models...","costs.allProviders":"All Providers","costs.maxTokens":"Max Tokens","costs.status":"Status","costs.added":"Added","costs.new":"New","costs.addToPricing":"Add","costs.dismiss":"Dismiss","costs.includeInComparison":"Compare","costs.catalogSyncStarted":"Catalog sync started","costs.modelAdded":"Model added to pricing","costs.modelsDismissed":"Models dismissed","costs.providerKeyHint":"Unique key for LLM router binding","costs.neverSynced":"Catalog not synced yet","costs.hide":"Hide","costs.unhide":"Unhide","costs.hidden":"Hidden","costs.modelsHidden":"Models hidden","costs.modelUnhidden":"Model unhidden","costs.showHidden":"Show hidden","help.costAnalysis.title":"LLM Cost Analysis","help.costAnalysis.overview":"Manage LLM model pricing, browse the provider catalog, and compare usage costs.","help.costAnalysis.pricing.title":"Model Pricing","help.costAnalysis.pricing.content":'The "My Models" tab lists models used in the system. Each model has input/output prices per 1M tokens. The "Compare" checkbox controls whether the model appears in the cost comparison section.',"help.costAnalysis.catalog.title":"Provider Catalog","help.costAnalysis.catalog.content":'The "Provider Catalog" tab shows all available models from the LiteLLM database. The catalog is automatically updated daily. New models are marked in blue. You can add a model from the catalog to your pricing list or dismiss the "New" label.',"help.costAnalysis.catalog.steps":"Adding a model from the catalog","help.costAnalysis.catalog.stepsContent":`1. Go to the "Provider Catalog" tab
2. Find the model using search or provider filter
3. Click "Add" → enter a provider_key
4. The model appears in "My Models" with current prices`,"help.costAnalysis.comparison.title":"Cost Comparison","help.costAnalysis.comparison.content":'The comparison section takes real token usage for the period and recalculates costs across all models with the "Compare" flag enabled. Shows difference in $ and % relative to the current model.',"help.costAnalysis.tips":'Tip: Update the catalog manually with the "Update Catalog" button if you need to see fresh prices before the daily auto-sync.',"nav.customers":"Customers","customers.title":"Customers","customers.breadcrumb":"Customers","customers.searchPlaceholder":"Search by phone or name...","customers.phone":"Phone","customers.name":"Name","customers.city":"City","customers.vehicles":"Vehicles","customers.totalCalls":"Calls","customers.lastCall":"Last Call","customers.firstCall":"First Call","customers.deliveryAddress":"Delivery Address","customers.noCustomers":"No customers found","customers.loadFailed":"Load failed: {error}","customers.detailTitle":"Customer Profile","customers.recentCalls":"Recent Calls","customers.noRecentCalls":"No calls","customers.callDate":"Date","customers.callDuration":"Duration","customers.callScenario":"Scenario","customers.callTransferred":"Transferred","customers.vehiclePlate":"Plate","customers.vehicleModel":"Brand","customers.vehicleTires":"Tires","customers.noVehicles":"No vehicles","customers.noAddress":"Not specified","help.customers.title":"Customers","help.customers.overview":"This page displays customer profiles created automatically by the AI agent during calls. Data is updated via the <code>update_customer_profile</code> tool.","help.customers.table.title":"Customer Table","help.customers.table.content":"The table shows phone, name, city, number of vehicles, total calls, and last call date. Columns can be sorted by clicking the header.","help.customers.search.title":"Search","help.customers.search.content":"Search by phone number or customer name. Enter a query and press Enter or click the search button.","help.customers.detail.title":"Customer Details","help.customers.detail.content":"Click a row in the table to open a modal with the full profile: contacts, delivery address, vehicle list (plate, brand, tire size), and the last 20 calls.","help.customers.tips":"<ul><li>Profiles are created <strong>automatically</strong> — the AI agent collects information during calls</li><li>This page is <strong>read-only</strong> — editing is not available</li><li>Use <strong>phone number</strong> search for quick customer lookup</li></ul>","help.onecData.title":"1C Data","help.onecData.overview":"View data fetched from the 1C system: pickup points, fitting stations, orders.","help.onecData.viewer.title":"Data viewer","help.onecData.viewer.content":"The table shows data cached from the 1C API. Data refreshes automatically on schedule. Use tabs to switch between data types.","help.onecData.refresh.title":"Refreshing data","help.onecData.refresh.content":'Click the "Refresh" button to force-update data from 1C. The cache will be refreshed for the selected trading network.',"help.onecData.tips":"<ul><li>Data is cached in Redis with a <strong>1 hour</strong> TTL</li><li>Pickup points are grouped by <strong>trading network</strong></li><li>On 1C errors, the system falls back to the Store API</li></ul>"},Ln="admin_lang",fn={ru:Yo,en:Xo};let me="ru";function Zo(){me=localStorage.getItem(Ln)||"ru",document.documentElement.lang=me;const s=document.getElementById("langLabel");s&&(s.textContent=me==="ru"?"EN":"RU")}var En;const yn=typeof window<"u"&&((En=window.location)==null?void 0:En.hostname)==="localhost";function e(s,n){var a,i;let o=((a=fn[me])==null?void 0:a[s])??((i=fn.ru)==null?void 0:i[s]);if(o===void 0&&(yn&&console.warn(`[i18n] missing key: ${s}`),o=yn?`[${s}]`:""),n)for(const[r,l]of Object.entries(n))o=o.replace(`{${r}}`,l);return o}function ea(){me=me==="ru"?"en":"ru",localStorage.setItem(Ln,me),document.documentElement.lang=me,An();const s=document.getElementById("langLabel");s&&(s.textContent=me==="ru"?"EN":"RU"),window.dispatchEvent(new CustomEvent("langchange"))}function An(){document.querySelectorAll("[data-i18n]").forEach(s=>{s.textContent=e(s.dataset.i18n)}),document.querySelectorAll("[data-i18n-placeholder]").forEach(s=>{s.placeholder=e(s.dataset.i18nPlaceholder)}),document.querySelectorAll("[data-i18n-aria]").forEach(s=>{s.setAttribute("aria-label",e(s.dataset.i18nAria))}),document.querySelectorAll("[data-i18n-title]").forEach(s=>{s.title=e(s.dataset.i18nTitle)})}function Hn(){return me==="ru"?"ru-RU":"en-US"}const Us="",ta=3e4;let ke=localStorage.getItem("admin_token"),Pt=null;const Wt=new Map;function ht(){return ke}function sa(s){ke=s,localStorage.setItem("admin_token",s)}function na(){ke=null,localStorage.removeItem("admin_token")}function oa(s){Pt=s}function Mn(s){return s.name==="AbortError"?new Error(e("api.requestTimeout")):s instanceof TypeError&&s.message==="Failed to fetch"?new Error(e("api.networkError")):s}function Dn(s,n){if(n)return n;const o={400:"api.badRequest",403:"api.noAccess",404:"api.notFound",409:"api.conflict",422:"api.validationError",429:"api.tooManyRequests",500:"api.serverError",502:"api.serverError",503:"api.serverError"}[s];return o?e(o):`HTTP ${s}`}async function g(s,n={}){const a=(n.method||"GET").toUpperCase()==="GET";if(a&&Wt.has(s))return Wt.get(s);const i=aa(s,n);return a&&(Wt.set(s,i),i.finally(()=>Wt.delete(s))),i}async function aa(s,n={}){const o={"Content-Type":"application/json"};ke&&(o.Authorization=`Bearer ${ke}`);const a=n.timeout||ta,i=new AbortController,r=setTimeout(()=>i.abort(),a);let l;try{const{timeout:p,...m}=n;l=await fetch(`${Us}${s}`,{...m,headers:o,signal:i.signal})}catch(p){throw Mn(p)}finally{clearTimeout(r)}if(l.status===401)throw c(e("api.sessionExpired"),"error"),Pt&&Pt(),new Error(e("api.unauthorized"));if(!l.ok){const p=await l.json().catch(()=>({}));throw new Error(Dn(l.status,p.detail))}return l.json()}async function ra(s,n){const o={};ke&&(o.Authorization=`Bearer ${ke}`);const a=new AbortController,i=setTimeout(()=>a.abort(),12e4);let r;try{r=await fetch(`${Us}${s}`,{method:"POST",headers:o,body:n,signal:a.signal})}catch(l){throw Mn(l)}finally{clearTimeout(i)}if(r.status===401)throw c(e("api.sessionExpired"),"error"),Pt&&Pt(),new Error(e("api.unauthorized"));if(!r.ok){const l=await r.json().catch(()=>({}));throw new Error(Dn(r.status,l.detail))}return r.json()}async function At(s){const n={};return ke&&(n.Authorization=`Bearer ${ke}`),fetch(`${Us}${s}`,{headers:n})}let se=null,Xt=1e3;const ia=3e4;let Ts=null;function la(s){Ts=s}function Gs(){const s=ht();if(!s)return;const o=`${location.protocol==="https:"?"wss:":"ws:"}//${location.host}/ws?token=${s}`;try{se=new WebSocket(o)}catch{return}se.onopen=()=>{Xt=1e3,St("connected")},se.onclose=()=>{St("disconnected"),ca()},se.onerror=()=>{St("disconnected")},se.onmessage=a=>{try{const i=JSON.parse(a.data);if(i.type==="ping"){se&&se.readyState===WebSocket.OPEN&&se.send("pong");return}if(i.type==="pong")return;Ts&&Ts(i)}catch{}}}function da(){se&&(se.close(),se=null)}function ca(){ht()&&(St("reconnecting"),setTimeout(()=>{ht()&&Gs()},Xt),Xt=Math.min(Xt*2,ia))}let Rn="disconnected";function St(s){Rn=s;const n=document.getElementById("wsDot"),o=document.getElementById("wsLabel");if(!n||!o)return;const a={connected:"bg-green-500",reconnecting:"bg-yellow-500",disconnected:"bg-red-500"};n.className=`w-2 h-2 rounded-full ${a[s]||"bg-red-500"}`;const i={connected:e("ws.live"),reconnecting:e("ws.reconnecting"),disconnected:e("ws.offline")};o.textContent=i[s]||e("ws.offline")}function pa(){St(Rn)}setInterval(()=>{se&&se.readyState===WebSocket.OPEN&&se.send("ping")},25e3);const Fn=new Set;function ua(){return Fn.size===0?!0:window.confirm(e("common.unsavedChanges"))}window.addEventListener("beforeunload",s=>{Fn.size>0&&(s.preventDefault(),s.returnValue="")});let Zt=null,On={},_t=null;function j(s,n){On[s]=n}function zs(){Zt&&(clearInterval(Zt),Zt=null)}function Ss(s){const n=document.querySelector(`.nav-group[data-group="${s}"]`);n&&n.classList.toggle("open")}function Lt(){return location.hash.replace(/^#\/?/,"")||null}function je(s){if(_t&&_t!==s&&!ua())return;document.querySelectorAll('[id^="page-"]').forEach(l=>l.style.display="none");const n=document.getElementById(`page-${s}`);n&&(n.style.display="block"),document.querySelectorAll(".nav-item[data-page], .nav-flyout-link[data-page]").forEach(l=>l.classList.remove("active")),document.querySelectorAll(".nav-group-trigger").forEach(l=>l.classList.remove("active"));const o=document.querySelector(`.nav-item[data-page="${s}"], .nav-flyout-link[data-page="${s}"]`);o&&o.classList.add("active");const a=o==null?void 0:o.closest(".nav-group");if(a){const l=a.querySelector(".nav-group-trigger");l&&l.classList.add("active")}_t=s;const i=document.getElementById("mainContent");i&&(i.scrollTop=0),window.scrollTo(0,0),Lt()!==s&&history.pushState(null,"","#/"+s),localStorage.setItem("admin_active_page",s),zs();const r=On[s];r&&r()}function ga(){window.addEventListener("hashchange",()=>{const s=Lt();s&&s!==_t&&je(s)}),window.addEventListener("popstate",()=>{const s=Lt();s&&s!==_t&&je(s)})}function os(s,n){zs(),Zt=setInterval(s,n)}const ma=new Map;function ha(){ma.clear()}let Oe=[];function Te(s){return Oe.includes("*")||Oe.includes(s)}async function Nn(){try{Oe=(await g("/auth/me")).permissions||[],localStorage.setItem("admin_permissions",JSON.stringify(Oe))}catch{try{Oe=JSON.parse(localStorage.getItem("admin_permissions")||"[]")}catch{Oe=[]}}}const ba={dashboard:null,calls:"analytics:read",customers:"customers:read",prompts:"prompts:read",knowledge:"knowledge:read",scenarios:"training:read",tools:"training:read",sandbox:"sandbox:read",operators:"operators:read",monitoring:"monitoring:read",configuration:"configuration:read",tenants:"tenants:read",notifications:"notifications:read",users:"users:read",audit:"audit:read",vehicles:"vehicles:read","onec-data":"onec_data:read","stt-hints":"stt_hints:read","point-hints":"point_hints:read"};function Kn(){document.querySelectorAll("[data-page]").forEach(s=>{const n=s.getAttribute("data-page"),o=ba[n];o!=null&&(s.style.display=Te(o)?"":"none")}),document.querySelectorAll(".admin-only").forEach(s=>{s.hasAttribute("data-page")||(s.style.display=Te("*")?"":"none")})}async function qn(){const s=document.getElementById("loginUsername").value,n=document.getElementById("loginPassword").value;if(!s||!n){document.getElementById("loginError").textContent=e("login.error"),document.getElementById("loginError").style.display="block";return}try{const o=await g("/auth/login",{method:"POST",body:JSON.stringify({username:s,password:n})});sa(o.token),document.getElementById("loginContainer").style.display="none",document.getElementById("app").style.display="block",document.getElementById("loginError").style.display="none",await Nn(),Kn(),Gs();const a=Lt(),i=localStorage.getItem("admin_active_page")||"dashboard";je(a||i)}catch{document.getElementById("loginError").textContent=e("login.error"),document.getElementById("loginError").style.display="block"}}function Vs(){na(),Oe=[],_s=!1,localStorage.removeItem("admin_permissions"),zs(),ha(),da(),document.getElementById("app").style.display="none",document.getElementById("loginContainer").style.display="flex"}let _s=!1;function Un(){const s=ht();if(s)try{const n=JSON.parse(atob(s.split(".")[1]));if(!n.exp)return;const o=n.exp-Date.now()/1e3;o<=0?(c(e("api.sessionExpired"),"error"),Vs()):o<=300&&!_s&&(_s=!0,c(e("auth.sessionExpiringSoon"),"warning"))}catch{}}oa(Vs);const Ye="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium",M=`${Ye} bg-neutral-100 text-neutral-600 dark:bg-neutral-800 dark:text-neutral-400`,L=`${Ye} bg-emerald-50 text-emerald-700 dark:bg-emerald-950 dark:text-emerald-400`,q=`${Ye} bg-amber-50 text-amber-700 dark:bg-amber-950 dark:text-amber-400`,D=`${Ye} bg-red-50 text-red-700 dark:bg-red-950 dark:text-red-400`,N=`${Ye} bg-blue-50 text-blue-700 dark:bg-blue-950 dark:text-blue-400`,xn=`${Ye} bg-violet-50 text-violet-700 dark:bg-violet-950 dark:text-violet-400`,at=`${Ye} bg-neutral-100 text-neutral-600 dark:bg-neutral-800 dark:text-neutral-400`,cs="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer max-md:min-h-11",E=`${cs} bg-blue-600 text-white hover:bg-blue-700`,Ht=`${cs} bg-red-600 text-white hover:bg-red-700`,G=`${cs} bg-neutral-500 text-white hover:bg-neutral-600 dark:bg-neutral-600 dark:hover:bg-neutral-500`,va=`${cs} bg-violet-600 text-white hover:bg-violet-700`,T="text-xs px-2 py-1",J="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-5 mb-4",Y="text-2xl font-bold text-blue-600 dark:text-blue-400",X="text-xs text-neutral-500 dark:text-neutral-400 mt-1",A="w-full text-sm responsive-table",b="px-3 py-2.5 text-left text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider border-b border-neutral-200 dark:border-neutral-700",P=`${b} cursor-pointer select-none hover:text-neutral-700 dark:hover:text-neutral-300`,u="px-3 py-2.5 border-b border-neutral-100 dark:border-neutral-800 text-neutral-700 dark:text-neutral-300",V="px-3 py-2.5 border-b border-neutral-100 dark:border-neutral-800 text-neutral-700 dark:text-neutral-300 td-actions",_="hover:bg-neutral-50 dark:hover:bg-neutral-800/50 transition-colors",Ie="px-2.5 py-1.5 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500 max-md:w-full",fa="pagination flex justify-center gap-1 mt-4",rt="px-3 py-1.5 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-50 dark:hover:bg-neutral-700 cursor-pointer transition-colors max-md:min-h-11 max-md:min-w-11",k="text-center py-8 text-neutral-400 dark:text-neutral-500 text-sm",H="flex justify-center py-8",js="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500",ae="text-xs px-1.5 py-1 border border-neutral-300 dark:border-neutral-700 rounded bg-white dark:bg-neutral-800 text-neutral-700 dark:text-neutral-300",Gn="py-2 border-b border-neutral-100 dark:border-neutral-800",Ws="font-semibold text-xs text-blue-600 dark:text-blue-400",Js="font-semibold text-xs text-emerald-600 dark:text-emerald-400",Qs="text-sm text-neutral-700 dark:text-neutral-300 mt-0.5",$n="text-blue-600 dark:text-blue-400 hover:underline",Ne="text-sm font-semibold text-neutral-900 dark:text-neutral-50 mb-3",ya="grid grid-cols-[repeat(auto-fill,minmax(180px,1fr))] gap-4 mb-6 max-md:grid-cols-2 max-[480px]:grid-cols-1",C="text-xs text-neutral-500 dark:text-neutral-400",xa="tab-bar flex border-b border-neutral-200 dark:border-neutral-700 mb-4",kt="px-4 py-2 text-sm text-neutral-500 dark:text-neutral-400 border-b-2 border-transparent -mb-px cursor-pointer transition-colors hover:text-neutral-700 dark:hover:text-neutral-200 max-md:min-h-11",$a=["a[href]","button:not(:disabled)","input:not(:disabled)","select:not(:disabled)","textarea:not(:disabled)",'[tabindex]:not([tabindex="-1"])'].join(", ");function zn(s){const n=document.activeElement;function o(){return[...s.querySelectorAll($a)].filter(i=>i.offsetParent!==null)}function a(i){if(i.key!=="Tab")return;const r=o();if(r.length===0)return;const l=r[0],p=r[r.length-1];i.shiftKey?document.activeElement===l&&(i.preventDefault(),p.focus()):document.activeElement===p&&(i.preventDefault(),l.focus())}return s.addEventListener("keydown",a),requestAnimationFrame(()=>{var l;const i=o();(l=i.find(p=>p.tagName==="INPUT"||p.tagName==="TEXTAREA"||p.tagName==="SELECT")||i[0])==null||l.focus()}),function(){s.removeEventListener("keydown",a),n&&n.focus&&n.focus()}}const wn=new Map;function ye(s){if(s==null)return`<span class="${M}">N/A</span>`;const n=parseFloat(s).toFixed(2);return s>=.8?`<span class="${L}">${n}</span>`:s>=.5?`<span class="${q}">${n}</span>`:`<span class="${D}">${n}</span>`}function z(s){return s?new Date(s).toLocaleString(Hn(),{dateStyle:"short",timeStyle:"short"}):"-"}function F(s){const n=document.getElementById(s);n&&n.classList.remove("show");const o=wn.get(s);o&&(o(),wn.delete(s))}function wa(){const s=document.querySelectorAll(".modal-overlay.show");if(s.length===0)return!1;const n=s[s.length-1];return F(n.id),!0}function Vn(s){const n=document.getElementById(s);if(!n)return;const a=new Date().toLocaleTimeString(Hn(),{hour:"2-digit",minute:"2-digit",second:"2-digit"});n.textContent=`${e("common.lastUpdated")} ${a}`}function d(s){if(!s)return"";const n=document.createElement("div");return n.textContent=s,n.innerHTML}function ka(s){return s?`<span class="${{online:L,offline:at,busy:q,break:N}[s]||at}">${d(s)}</span>`:`<span class="${at}">unknown</span>`}function Mt(s,n){const o=URL.createObjectURL(s),a=document.createElement("a");a.href=o,a.download=n,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(o)}function Ta(){document.addEventListener("click",s=>{document.querySelectorAll(".dropdown-menu-open").forEach(n=>{var o;if(!n.contains(s.target)&&!((o=n.previousElementSibling)!=null&&o.contains(s.target))){n.classList.add("hidden"),n.classList.remove("dropdown-menu-open");const a=n.previousElementSibling;a&&a.setAttribute("aria-expanded","false")}})}),document.addEventListener("keydown",s=>{const n=document.activeElement;if(!n)return;const o=n.nextElementSibling;if(o&&o.classList.contains("hidden")&&Sa(o)&&(s.key==="ArrowDown"||s.key==="Enter"||s.key===" ")){s.preventDefault(),_a(n,o);return}const a=n.closest(".dropdown-menu-open");a&&Ea(s,a)})}function Sa(s){return s.classList.contains("absolute")||s.dataset.dropdownMenu!==void 0}function _a(s,n){n.classList.remove("hidden"),n.classList.add("dropdown-menu-open"),s.setAttribute("aria-expanded","true");const o=jn(n);o.length>0&&o[0].focus()}function Ca(s){s.classList.add("hidden"),s.classList.remove("dropdown-menu-open");const n=s.previousElementSibling;n&&(n.setAttribute("aria-expanded","false"),n.focus())}function jn(s){return[...s.querySelectorAll('button, a[href], [role="menuitem"]')].filter(n=>n.offsetParent!==null)}function Ea(s,n){var i,r;const o=jn(n),a=o.indexOf(document.activeElement);switch(s.key){case"ArrowDown":s.preventDefault(),a<o.length-1?o[a+1].focus():o[0].focus();break;case"ArrowUp":s.preventDefault(),a>0?o[a-1].focus():o[o.length-1].focus();break;case"Escape":s.preventDefault(),s.stopPropagation(),Ca(n);break;case"Home":s.preventDefault(),(i=o[0])==null||i.focus();break;case"End":s.preventDefault(),(r=o[o.length-1])==null||r.focus();break}}const Wn="admin_theme",Ia='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>',Ba='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>';function Pa(){as(),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",s=>{localStorage.getItem(Wn)||(document.documentElement.classList.toggle("dark",s.matches),as())})}function La(){const s=document.documentElement.classList.toggle("dark");localStorage.setItem(Wn,s?"dark":"light"),as()}function as(){const s=document.documentElement.classList.contains("dark"),n=document.getElementById("themeIcon"),o=document.getElementById("themeLabel");n&&(n.innerHTML=s?Ia:Ba),o&&(o.textContent=e(s?"theme.light":"theme.dark"))}function Aa(){as()}const Jn={dashboard:{titleKey:"help.dashboard.title",overviewKey:"help.dashboard.overview",sections:[{titleKey:"help.dashboard.stats.title",contentKey:"help.dashboard.stats.content"},{titleKey:"help.dashboard.filters.title",contentKey:"help.dashboard.filters.content"},{titleKey:"help.dashboard.export.title",contentKey:"help.dashboard.export.content"},{titleKey:"help.dashboard.export.steps",contentKey:"help.dashboard.export.stepsContent"}],tipsKey:"help.dashboard.tips"},calls:{titleKey:"help.calls.title",overviewKey:"help.calls.overview",sections:[{titleKey:"help.calls.table.title",contentKey:"help.calls.table.content"},{titleKey:"help.calls.filters.title",contentKey:"help.calls.filters.content"},{titleKey:"help.calls.filters.steps",contentKey:"help.calls.filters.stepsContent"},{titleKey:"help.calls.detail.title",contentKey:"help.calls.detail.content"},{titleKey:"help.calls.detail.steps",contentKey:"help.calls.detail.stepsContent"},{titleKey:"help.calls.quality.title",contentKey:"help.calls.quality.content"},{titleKey:"help.calls.import.title",contentKey:"help.calls.import.content"},{titleKey:"help.calls.import.steps",contentKey:"help.calls.import.stepsContent"},{titleKey:"help.calls.costBreakdown.title",contentKey:"help.calls.costBreakdown.content"}],tipsKey:"help.calls.tips"},scenarios:{titleKey:"help.scenarios.title",overviewKey:"help.scenarios.overview",sections:[{titleKey:"help.scenarios.templates.title",contentKey:"help.scenarios.templates.content"},{titleKey:"help.scenarios.templates.steps",contentKey:"help.scenarios.templates.stepsContent"},{titleKey:"help.scenarios.dialogues.title",contentKey:"help.scenarios.dialogues.content"},{titleKey:"help.scenarios.dialogues.steps",contentKey:"help.scenarios.dialogues.stepsContent"},{titleKey:"help.scenarios.safety.title",contentKey:"help.scenarios.safety.content"},{titleKey:"help.scenarios.safety.severity.title",contentKey:"help.scenarios.safety.severity.content"},{titleKey:"help.scenarios.safety.steps",contentKey:"help.scenarios.safety.stepsContent"},{titleKey:"help.scenarios.affects.title",contentKey:"help.scenarios.affects.content"}],tipsKey:"help.scenarios.tips"},knowledge:{titleKey:"help.knowledge.title",overviewKey:"help.knowledge.overview",sections:[{titleKey:"help.knowledge.articles.title",contentKey:"help.knowledge.articles.content"},{titleKey:"help.knowledge.articles.steps",contentKey:"help.knowledge.articles.stepsContent"},{titleKey:"help.knowledge.sources.title",contentKey:"help.knowledge.sources.content"},{titleKey:"help.knowledge.sources.steps",contentKey:"help.knowledge.sources.stepsContent"},{titleKey:"help.knowledge.scraper.title",contentKey:"help.knowledge.scraper.content"},{titleKey:"help.knowledge.watched.title",contentKey:"help.knowledge.watched.content"},{titleKey:"help.knowledge.watched.steps",contentKey:"help.knowledge.watched.stepsContent"},{titleKey:"help.knowledge.promotions.title",contentKey:"help.knowledge.promotions.content"},{titleKey:"help.knowledge.promotions.steps",contentKey:"help.knowledge.promotions.stepsContent"},{titleKey:"help.knowledge.affects.title",contentKey:"help.knowledge.affects.content"}],tipsKey:"help.knowledge.tips"},prompts:{titleKey:"help.prompts.title",overviewKey:"help.prompts.overview",sections:[{titleKey:"help.prompts.versions.title",contentKey:"help.prompts.versions.content"},{titleKey:"help.prompts.versions.steps",contentKey:"help.prompts.versions.stepsContent"},{titleKey:"help.prompts.ab.title",contentKey:"help.prompts.ab.content"},{titleKey:"help.prompts.ab.steps",contentKey:"help.prompts.ab.stepsContent"},{titleKey:"help.prompts.affects.title",contentKey:"help.prompts.affects.content"}],tipsKey:"help.prompts.tips"},sandbox:{titleKey:"help.sandbox.title",overviewKey:"help.sandbox.overview",sections:[{titleKey:"help.sandbox.chat.title",contentKey:"help.sandbox.chat.content"},{titleKey:"help.sandbox.chat.steps",contentKey:"help.sandbox.chat.stepsContent"},{titleKey:"help.sandbox.regression.title",contentKey:"help.sandbox.regression.content"},{titleKey:"help.sandbox.regression.steps",contentKey:"help.sandbox.regression.stepsContent"},{titleKey:"help.sandbox.patterns.title",contentKey:"help.sandbox.patterns.content"},{titleKey:"help.sandbox.phrases.title",contentKey:"help.sandbox.phrases.content"},{titleKey:"help.sandbox.starters.title",contentKey:"help.sandbox.starters.content"},{titleKey:"help.sandbox.import.title",contentKey:"help.sandbox.import.content"},{titleKey:"help.sandbox.import.steps",contentKey:"help.sandbox.import.stepsContent"},{titleKey:"help.sandbox.regressionAdvanced.title",contentKey:"help.sandbox.regressionAdvanced.content"},{titleKey:"help.sandbox.workflow.title",contentKey:"help.sandbox.workflow.content"}],tipsKey:"help.sandbox.tips"},operators:{titleKey:"help.operators.title",overviewKey:"help.operators.overview",sections:[{titleKey:"help.operators.table.title",contentKey:"help.operators.table.content"},{titleKey:"help.operators.creating.title",contentKey:"help.operators.creating.content"},{titleKey:"help.operators.creating.steps",contentKey:"help.operators.creating.stepsContent"},{titleKey:"help.operators.status.title",contentKey:"help.operators.status.content"},{titleKey:"help.operators.status.steps",contentKey:"help.operators.status.stepsContent"},{titleKey:"help.operators.skills.title",contentKey:"help.operators.skills.content"},{titleKey:"help.operators.transfer.title",contentKey:"help.operators.transfer.content"},{titleKey:"help.operators.affects.title",contentKey:"help.operators.affects.content"}],tipsKey:"help.operators.tips"},monitoring:{titleKey:"help.monitoring.title",overviewKey:"help.monitoring.overview",sections:[{titleKey:"help.monitoring.health.title",contentKey:"help.monitoring.health.content"},{titleKey:"help.monitoring.extended.title",contentKey:"help.monitoring.extended.content"},{titleKey:"help.monitoring.external.title",contentKey:"help.monitoring.external.content"}],tipsKey:"help.monitoring.tips"},configuration:{titleKey:"help.configuration.title",overviewKey:"help.configuration.overview",sections:[{titleKey:"help.configuration.reload.title",contentKey:"help.configuration.reload.content"},{titleKey:"help.configuration.llm.title",contentKey:"help.configuration.llm.content"},{titleKey:"help.configuration.llm.steps",contentKey:"help.configuration.llm.stepsContent"},{titleKey:"help.configuration.tasks.title",contentKey:"help.configuration.tasks.content"},{titleKey:"help.configuration.schedules.title",contentKey:"help.configuration.schedules.content"},{titleKey:"help.configuration.tts.title",contentKey:"help.configuration.tts.content"},{titleKey:"help.configuration.ttsBreaks.title",contentKey:"help.configuration.ttsBreaks.content"},{titleKey:"help.configuration.providerMgmt.title",contentKey:"help.configuration.providerMgmt.content"},{titleKey:"help.configuration.testPhones.title",contentKey:"help.configuration.testPhones.content"},{titleKey:"help.configuration.affects.title",contentKey:"help.configuration.affects.content"}],tipsKey:"help.configuration.tips"},"stt-hints":{titleKey:"help.sttHints.title",overviewKey:"help.sttHints.overview",sections:[{titleKey:"help.sttHints.levels.title",contentKey:"help.sttHints.levels.content"},{titleKey:"help.sttHints.base.title",contentKey:"help.sttHints.base.content"},{titleKey:"help.sttHints.catalog.title",contentKey:"help.sttHints.catalog.content"},{titleKey:"help.sttHints.custom.title",contentKey:"help.sttHints.custom.content"},{titleKey:"help.sttHints.overrides.title",contentKey:"help.sttHints.overrides.content"}],tipsKey:"help.sttHints.tips"},"point-hints":{titleKey:"help.pointHints.title",overviewKey:"help.pointHints.overview",sections:[{titleKey:"help.pointHints.fitting.title",contentKey:"help.pointHints.fitting.content"},{titleKey:"help.pointHints.pickup.title",contentKey:"help.pointHints.pickup.content"},{titleKey:"help.pointHints.steps",contentKey:"help.pointHints.stepsContent"},{titleKey:"help.pointHints.affects.title",contentKey:"help.pointHints.affects.content"}],tipsKey:"help.pointHints.tips"},notifications:{titleKey:"help.notifications.title",overviewKey:"help.notifications.overview",sections:[{titleKey:"help.notifications.telegram.title",contentKey:"help.notifications.telegram.content"},{titleKey:"help.notifications.telegram.steps",contentKey:"help.notifications.telegram.stepsContent"},{titleKey:"help.notifications.affects.title",contentKey:"help.notifications.affects.content"}],tipsKey:"help.notifications.tips"},tenants:{titleKey:"help.tenants.title",overviewKey:"help.tenants.overview",sections:[{titleKey:"help.tenants.table.title",contentKey:"help.tenants.table.content"},{titleKey:"help.tenants.creating.title",contentKey:"help.tenants.creating.content"},{titleKey:"help.tenants.creating.steps",contentKey:"help.tenants.creating.stepsContent"},{titleKey:"help.tenants.tools.title",contentKey:"help.tenants.tools.content"},{titleKey:"help.tenants.affects.title",contentKey:"help.tenants.affects.content"}],tipsKey:"help.tenants.tips"},users:{titleKey:"help.users.title",overviewKey:"help.users.overview",sections:[{titleKey:"help.users.table.title",contentKey:"help.users.table.content"},{titleKey:"help.users.creating.title",contentKey:"help.users.creating.content"},{titleKey:"help.users.creating.steps",contentKey:"help.users.creating.stepsContent"},{titleKey:"help.users.roles.title",contentKey:"help.users.roles.content"},{titleKey:"help.users.permissions.title",contentKey:"help.users.permissions.content"},{titleKey:"help.users.permissions.groups.title",contentKey:"help.users.permissions.groups.content"},{titleKey:"help.users.permissions.steps",contentKey:"help.users.permissions.stepsContent"}],tipsKey:"help.users.tips"},audit:{titleKey:"help.audit.title",overviewKey:"help.audit.overview",sections:[{titleKey:"help.audit.table.title",contentKey:"help.audit.table.content"},{titleKey:"help.audit.filters.title",contentKey:"help.audit.filters.content"},{titleKey:"help.audit.filters.steps",contentKey:"help.audit.filters.stepsContent"}],tipsKey:"help.audit.tips"},vehicles:{titleKey:"help.vehicles.title",overviewKey:"help.vehicles.overview",sections:[{titleKey:"help.vehicles.navigation.title",contentKey:"help.vehicles.navigation.content"},{titleKey:"help.vehicles.navigation.steps",contentKey:"help.vehicles.navigation.stepsContent"},{titleKey:"help.vehicles.import.title",contentKey:"help.vehicles.import.content"},{titleKey:"help.vehicles.import.steps",contentKey:"help.vehicles.import.stepsContent"},{titleKey:"help.vehicles.affects.title",contentKey:"help.vehicles.affects.content"}],tipsKey:"help.vehicles.tips"},"cost-analysis":{titleKey:"help.costAnalysis.title",overviewKey:"help.costAnalysis.overview",sections:[{titleKey:"help.costAnalysis.pricing.title",contentKey:"help.costAnalysis.pricing.content"},{titleKey:"help.costAnalysis.catalog.title",contentKey:"help.costAnalysis.catalog.content"},{titleKey:"help.costAnalysis.catalog.steps",contentKey:"help.costAnalysis.catalog.stepsContent"},{titleKey:"help.costAnalysis.comparison.title",contentKey:"help.costAnalysis.comparison.content"}],tipsKey:"help.costAnalysis.tips"},tools:{titleKey:"help.tools.title",overviewKey:"help.tools.overview",sections:[{titleKey:"help.tools.overrides.title",contentKey:"help.tools.overrides.content"},{titleKey:"help.tools.overrides.steps",contentKey:"help.tools.overrides.stepsContent"},{titleKey:"help.tools.list.title",contentKey:"help.tools.list.content"},{titleKey:"help.tools.affects.title",contentKey:"help.tools.affects.content"}],tipsKey:"help.tools.tips"},customers:{titleKey:"help.customers.title",overviewKey:"help.customers.overview",sections:[{titleKey:"help.customers.table.title",contentKey:"help.customers.table.content"},{titleKey:"help.customers.search.title",contentKey:"help.customers.search.content"},{titleKey:"help.customers.detail.title",contentKey:"help.customers.detail.content"}],tipsKey:"help.customers.tips"},"onec-data":{titleKey:"help.onecData.title",overviewKey:"help.onecData.overview",sections:[{titleKey:"help.onecData.viewer.title",contentKey:"help.onecData.viewer.content"},{titleKey:"help.onecData.refresh.title",contentKey:"help.onecData.refresh.content"}],tipsKey:"help.onecData.tips"}};let te=null,Qn=null,vs=null,ot=null,es=null,kn=null;function Ha(){te=document.createElement("div"),te.className="help-overlay",te.innerHTML=`
        <div class="help-drawer" role="complementary" aria-label="Help">
            <div class="flex items-center justify-between px-5 py-4 border-b border-neutral-200 dark:border-neutral-700">
                <h2 class="text-base font-semibold text-neutral-900 dark:text-neutral-50 help-drawer-title"></h2>
                <button onclick="window._app.closeHelp()" class="text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-200" aria-label="Close">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                </button>
            </div>
            <div class="px-5 pt-3 pb-2">
                <input type="text" id="helpSearch" class="w-full px-3 py-1.5 text-sm rounded-lg border border-neutral-300 dark:border-neutral-600 bg-white dark:bg-neutral-800 text-neutral-800 dark:text-neutral-200 placeholder-neutral-400" data-i18n-placeholder="help.searchPlaceholder" placeholder="Search help...">
            </div>
            <div class="help-drawer-content flex-1 overflow-y-auto px-5 py-4 text-sm text-neutral-700 dark:text-neutral-300 space-y-4"></div>
        </div>`,te.addEventListener("click",s=>{s.target===te&&Cs()}),document.body.appendChild(te),Qn=te.querySelector(".help-drawer-content"),vs=te.querySelector("#helpSearch"),vs.addEventListener("input",()=>{clearTimeout(kn),kn=setTimeout(()=>{ot&&Es(ot,vs.value.trim())},300)}),document.addEventListener("keydown",s=>{s.key==="Escape"&&te.classList.contains("open")&&Cs()}),window.addEventListener("langchange",()=>{ot&&te.classList.contains("open")&&Es(ot)})}function Ma(s){if(!Jn[s])return;ot=s,Es(s),te.classList.add("open");const n=te.querySelector(".help-drawer");es=zn(n)}function Cs(){te.classList.remove("open"),ot=null,es&&(es(),es=null)}function Jt(s,n){if(!n)return s;const o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return s.replace(new RegExp(`(${o})`,"gi"),"<mark>$1</mark>")}function Es(s,n=""){const o=Jn[s];te.querySelector(".help-drawer-title").textContent=e(o.titleKey);const a=n.toLowerCase();let i=`<div class="text-neutral-600 dark:text-neutral-400">${Jt(e(o.overviewKey),n)}</div>`;for(const r of o.sections){const l=e(r.titleKey),p=e(r.contentKey);if(a&&!l.toLowerCase().includes(a)&&!p.toLowerCase().includes(a))continue;i+=`
        <details class="help-section border border-neutral-200 dark:border-neutral-700 rounded-lg"${a?" open":""}>
            <summary class="flex items-center gap-2 px-4 py-3 text-sm font-medium text-neutral-800 dark:text-neutral-200 hover:bg-neutral-50 dark:hover:bg-neutral-800 rounded-lg">
                <svg class="help-chevron w-4 h-4 text-neutral-400 transition-transform duration-200 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                ${Jt(l,n)}
            </summary>
            <div class="px-4 pb-3 text-sm text-neutral-600 dark:text-neutral-400 [&_ul]:list-disc [&_ul]:pl-5 [&_ul]:mt-1 [&_ul]:space-y-1 [&_code]:bg-neutral-100 [&_code]:dark:bg-neutral-800 [&_code]:px-1 [&_code]:rounded [&_code]:text-xs">${Jt(p,n)}</div>
        </details>`}if(o.tipsKey){const r=e(o.tipsKey);(!a||r.toLowerCase().includes(a))&&(i+=`
            <div class="bg-blue-50 dark:bg-blue-950 border border-blue-200 dark:border-blue-800 rounded-lg p-4">
                <div class="text-sm font-medium text-blue-800 dark:text-blue-300 mb-2">${e("help.tipsTitle")}</div>
                <div class="text-sm text-blue-700 dark:text-blue-400 [&_ul]:list-disc [&_ul]:pl-5 [&_ul]:space-y-1">${Jt(r,n)}</div>
            </div>`)}Qn.innerHTML=i}function Da(){let s=null;function n(a){o();const i=a.dataset.tooltip,r=e(i);if(!r)return;const l=document.createElement("div");l.className="tooltip-popover",l.setAttribute("role","tooltip"),l.textContent=r,document.body.appendChild(l);const p=a.getBoundingClientRect();l.style.top=`${p.bottom+6+window.scrollY}px`,l.style.left=`${Math.max(8,p.left+p.width/2-120)}px`,a.setAttribute("aria-describedby","tooltip-active"),l.id="tooltip-active",s=l}function o(){s&&(s.remove(),s=null),document.querySelectorAll('[aria-describedby="tooltip-active"]').forEach(a=>a.removeAttribute("aria-describedby"))}document.addEventListener("mouseenter",a=>{var r,l;const i=(l=(r=a.target).closest)==null?void 0:l.call(r,"[data-tooltip]");i&&n(i)},!0),document.addEventListener("mouseleave",a=>{var i,r;(r=(i=a.target).closest)!=null&&r.call(i,"[data-tooltip]")&&o()},!0),document.addEventListener("focusin",a=>{var r,l;const i=(l=(r=a.target).closest)==null?void 0:l.call(r,"[data-tooltip]");i&&n(i)}),document.addEventListener("focusout",a=>{var i,r;(r=(i=a.target).closest)!=null&&r.call(i,"[data-tooltip]")&&o()})}const Tn="animate-pulse bg-neutral-200 dark:bg-neutral-700 rounded";function Ra(s=4){return Array.from({length:s},()=>`<div class="rounded-xl border border-neutral-200 dark:border-neutral-700 p-6 text-center">
            <div class="${Tn} h-8 w-16 mx-auto mb-2"></div>
            <div class="${Tn} h-4 w-24 mx-auto"></div>
        </div>`).join("")}const Is=3e4,Fa=3e5;let tt=Is,bt="",it="today",ts=[];function Ys(){const s=new Date,n=a=>a.toISOString().split("T")[0],o=n(s);if(it==="all")return{};if(it==="30d"){const a=new Date(s);return a.setDate(a.getDate()-30),{date_from:n(a),date_to:o}}if(it==="7d"){const a=new Date(s);return a.setDate(a.getDate()-7),{date_from:n(a),date_to:o}}return{date_from:o,date_to:o}}async function Oa(){if(!Te("tenants:read")){ts=[];return}try{ts=(await g("/admin/tenants?is_active=true&limit=100")).tenants||[]}catch{ts=[]}}function Yn(){const s=document.getElementById("dashboardTenantFilter");if(!s)return;let n=`<label class="text-sm font-medium text-neutral-600 dark:text-neutral-400">${e("dashboard.filterByNetwork")}</label>`;n+=`<select id="dashboardTenantSelect" class="${ae} w-auto" onchange="window._pages.dashboard.onTenantChange(this.value)">`,n+=`<option value="">${e("dashboard.allNetworks")}</option>`;for(const o of ts){const a=o.id===bt?" selected":"";n+=`<option value="${d(o.id)}"${a}>${d(o.name)}</option>`}n+="</select>",s.innerHTML=n}function Xs(){const s=document.getElementById("dashboardPeriodFilter");if(!s)return;const n=[{key:"today",label:e("dashboard.periodToday")},{key:"7d",label:e("dashboard.period7d")},{key:"30d",label:e("dashboard.period30d")},{key:"all",label:e("dashboard.periodAll")}];let o=`<label class="text-sm font-medium text-neutral-600 dark:text-neutral-400">${e("dashboard.period")}</label>`;o+='<div class="inline-flex rounded-md border border-neutral-300 dark:border-neutral-700 overflow-hidden">';for(const a of n){const r=a.key===it?"bg-blue-600 text-white":"bg-white dark:bg-neutral-800 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-700";o+=`<button class="px-2.5 py-1 text-xs font-medium transition-colors cursor-pointer ${r}" onclick="window._pages.dashboard.onPeriodChange('${a.key}')">${a.label}</button>`}o+="</div>",s.innerHTML=o}function Na(s){bt=s,We()}function Ka(s){it=s,Xs(),We()}async function We(){if(!Te("analytics:read")){document.getElementById("dashboardStats").innerHTML=`
            <div class="${k}">${e("dashboard.noAnalyticsAccess")}</div>
        `;return}const s=document.getElementById("dashboardStats");s&&s.children.length===0&&(s.innerHTML=Ra(5));try{const n=new URLSearchParams;bt&&n.set("tenant_id",bt);const o=Ys();o.date_from&&n.set("date_from",o.date_from),o.date_to&&n.set("date_to",o.date_to);const a=n.toString()?`?${n}`:"",r=(await g(`/analytics/summary${a}`)).daily_stats||[];Yn(),Xs();const l=r.reduce((B,I)=>B+(I.total_calls||0),0),p=r.reduce((B,I)=>B+(I.resolved_by_bot||0),0),m=r.reduce((B,I)=>B+(I.transferred||0),0),h=r.reduce((B,I)=>B+(parseFloat(I.total_cost_usd)||0),0),v=r.reduce((B,I)=>B+(I.avg_quality_score||0),0),x=r.filter(B=>B.avg_quality_score!=null).length||1,f=v/x,y=l>0?(p/l*100).toFixed(1):"0.0",$=it==="today",w=e($?"dashboard.callsToday":"dashboard.calls"),S=e($?"dashboard.costToday":"dashboard.cost");document.getElementById("dashboardStats").innerHTML=`
            <div class="${J} text-center"><div class="${Y}">${l}</div><div class="${X}">${w}</div></div>
            <div class="${J} text-center"><div class="${Y}">${p}<small class="text-xs text-neutral-500 dark:text-neutral-400"> (${y}%)</small></div><div class="${X}">${e("dashboard.resolvedByBot")}</div></div>
            <div class="${J} text-center"><div class="${Y}">${m}</div><div class="${X}">${e("dashboard.transferred")}</div></div>
            <div class="${J} text-center"><div class="${Y}">${f.toFixed(2)}</div><div class="${X}">${e("dashboard.avgQuality")}</div></div>
            <div class="${J} text-center"><div class="${Y}">$${h.toFixed(2)}</div><div class="${X}">${S}</div></div>
        `,Vn("dashboardLastUpdated"),tt!==Is&&(tt=Is,os(We,tt))}catch(n){document.getElementById("dashboardStats").innerHTML=`
            <div class="${k}">${e("dashboard.failedToLoad",{error:d(n.message)})}
            <br><button class="${E} ${T} mt-2" onclick="window._pages.dashboard.loadDashboard()">${e("common.retry")}</button></div>
        `,tt=Math.min(tt*2,Fa),os(We,tt)}}function qa(){try{const s=document.getElementById("grafanaBlock"),n=document.getElementById("grafanaFrame");if(!s||!n)return;const o=window.location.origin,a="/grafana/d/calls-overview/calls-overview?orgId=1&refresh=30s&kiosk";n.onerror=()=>{s.style.display="none"},n.src=o+a,s.style.display=""}catch{}}async function Ua(){try{const s=new URLSearchParams;bt&&s.set("tenant_id",bt);const n=Ys();n.date_from&&s.set("date_from",n.date_from),n.date_to&&s.set("date_to",n.date_to);const o=s.toString()?`?${s}`:"",a=await At(`/analytics/summary/export${o}`);if(!a.ok)throw new Error(`HTTP ${a.status}`);const i=await a.blob(),l=(a.headers.get("Content-Disposition")||"").match(/filename="(.+)"/),p=l?l[1]:"daily_stats_export.csv";Mt(i,p),c(e("dashboard.csvExported"))}catch(s){c(e("dashboard.exportFailed",{error:s.message}),"error")}}async function Ga(){const s=Ys(),n=new Date,o=r=>r.toISOString().split("T")[0],a=s.date_from||(()=>{const r=new Date(n);return r.setDate(r.getDate()-7),o(r)})(),i=s.date_to||o(n);try{const r=await At(`/analytics/report/pdf?date_from=${a}&date_to=${i}`);if(!r.ok)throw new Error(`HTTP ${r.status}`);const l=await r.blob(),m=(r.headers.get("Content-Disposition")||"").match(/filename="(.+)"/),h=m?m[1]:`report_${a}_${i}.pdf`;Mt(l,h),c(e("dashboard.pdfDownloaded"))}catch(r){c(e("dashboard.pdfFailed",{error:r.message}),"error")}}function za(){j("dashboard",async()=>{const s=document.querySelectorAll("#page-dashboard .flex.gap-2 button"),n=Te("analytics:read");s.forEach(o=>{o.style.display=n?"":"none"}),await Oa(),Yn(),Xs(),qa(),We(),n&&os(We,3e4)})}window._pages=window._pages||{};window._pages.dashboard={loadDashboard:We,exportStatsCSV:Ua,downloadPdfReport:Ga,onTenantChange:Na,onPeriodChange:Ka};const Va=" ▲",ja=" ▼";function Q(s){const n=typeof s=="string"?document.getElementById(s):s;if(!n)return;const o=n.querySelector("thead"),a=n.querySelector("tbody");if(!o||!a)return;const i=Array.from(o.querySelectorAll("th"));i.forEach((r,l)=>{r.hasAttribute("data-sortable")&&(r.dataset.sortInit||(r.dataset.sortInit="1",r.style.cursor="pointer",r.style.userSelect="none",r.addEventListener("click",()=>{Wa(a,i,r,l)})))})}function Wa(s,n,o,a){const r=o.dataset.sortDir==="asc"?"desc":"asc";n.forEach(x=>{delete x.dataset.sortDir;const f=x.querySelector(".sort-arrow");f&&(f.textContent="")}),o.dataset.sortDir=r;let l=o.querySelector(".sort-arrow");l||(l=document.createElement("span"),l.className="sort-arrow",l.style.opacity="0.6",l.style.fontSize="0.65em",o.appendChild(l)),l.textContent=r==="asc"?Va:ja;const p=Array.from(s.querySelectorAll("tr"));if(p.some(x=>Array.from(x.cells).some(f=>f.rowSpan>1)))return;const m=n.length,h=[];for(const x of p)x.cells.length<m&&h.length>0?h[h.length-1].detail.push(x):h.push({data:x,detail:[]});h.sort((x,f)=>{const y=x.data.cells[a],$=f.data.cells[a];if(!y||!$)return 0;const w=(y.dataset.sortValue??y.textContent??"").trim(),S=($.dataset.sortValue??$.textContent??"").trim(),B=w.replace(/[^0-9.\-]/g,""),I=S.replace(/[^0-9.\-]/g,""),ie=Number(B),ge=Number(I);if(B!==""&&I!==""&&!isNaN(ie)&&!isNaN(ge))return r==="asc"?ie-ge:ge-ie;const U=w.localeCompare(S,void 0,{numeric:!0,sensitivity:"base"});return r==="asc"?U:-U});const v=document.createDocumentFragment();for(const x of h){v.appendChild(x.data);for(const f of x.detail)v.appendChild(f)}s.appendChild(v)}let Xn=0,rs=[];async function Ja(){try{rs=(await g("/admin/tenants?is_active=true&limit=100")).tenants||[]}catch{rs=[]}}function Qa(){const s=document.getElementById("filterTenant");if(!s||rs.length===0)return;const n=s.value;s.innerHTML=`<option value="">${e("dashboard.allNetworks")}</option>`;for(const o of rs){const a=document.createElement("option");a.value=o.id,a.textContent=o.name,o.id===n&&(a.selected=!0),s.appendChild(a)}}async function Zn(s=0){var x,f,y,$,w,S,B;Xn=s;const n=document.getElementById("callsLoading"),o=document.querySelector("#callsTable tbody");n&&(n.style.display="flex");const a=new URLSearchParams({limit:20,offset:s}),i=(x=document.getElementById("filterDateFrom"))==null?void 0:x.value,r=(f=document.getElementById("filterDateTo"))==null?void 0:f.value,l=(y=document.getElementById("filterScenario"))==null?void 0:y.value,p=($=document.getElementById("filterTransferred"))==null?void 0:$.value,m=(w=document.getElementById("filterQualityBelow"))==null?void 0:w.value,h=(S=document.getElementById("filterSearch"))==null?void 0:S.value,v=(B=document.getElementById("filterTenant"))==null?void 0:B.value;i&&a.set("date_from",i),r&&a.set("date_to",r),l&&a.set("scenario",l),p&&a.set("transferred",p),m&&a.set("quality_below",m),h&&a.set("search",h),v&&a.set("tenant_id",v);try{const I=await g(`/analytics/calls?${a}`);if(n&&(n.style.display="none"),!I.calls||I.calls.length===0){o&&(o.innerHTML=`<tr><td colspan="7" class="${k}">${e("calls.noCalls")}</td></tr>`);const U=document.getElementById("callsPagination");U&&(U.innerHTML="");return}o.innerHTML=I.calls.map(U=>`
            <tr class="${_} cursor-pointer" data-id="${d(U.id)}" onclick="window._pages.calls.showCallDetail(this.dataset.id)">
                <td class="${u}" data-label="${e("calls.date")}" data-sort-value="${U.started_at||""}">${z(U.started_at)}</td>
                <td class="${u}" data-label="${e("calls.caller")}">${d(U.caller_id)||"-"}</td>
                <td class="${u}" data-label="${e("calls.scenario")}">${d(U.scenario)||"-"}</td>
                <td class="${u}" data-label="${e("calls.duration")}">${U.duration_seconds||0}s</td>
                <td class="${u}" data-label="${e("calls.quality")}">${ye(U.quality_score)}</td>
                <td class="${u}" data-label="${e("calls.cost")}">$${(U.total_cost_usd||0).toFixed(3)}</td>
                <td class="${u}" data-label="${e("calls.status")}">${U.transferred_to_operator?`<span class="${q}">${e("calls.statusTransferred")}</span>`:`<span class="${L}">${e("calls.statusResolved")}</span>`}</td>
            </tr>
        `).join("");const ie=Math.ceil(I.total/20),ge=Math.floor(s/20);document.getElementById("callsPagination").innerHTML=Array.from({length:Math.min(ie,10)},(U,Re)=>`<button class="${rt}${Re===ge?" active":""}" onclick="window._pages.calls.loadCalls(${Re*20})">${Re+1}</button>`).join(""),Q("callsTable"),Vn("callsLastUpdated")}catch(I){n.style.display="none",o.innerHTML=`<tr><td colspan="7" class="${k}">${e("calls.failedToLoad",{error:d(I.message)})}
            <br><button class="${E} ${T} mt-2" onclick="window._pages.calls.loadCalls(${s})">${e("common.retry")}</button></td></tr>`}}async function Ya(){var p,m,h,v,x,f;const s=new URLSearchParams,n=(p=document.getElementById("filterDateFrom"))==null?void 0:p.value,o=(m=document.getElementById("filterDateTo"))==null?void 0:m.value,a=(h=document.getElementById("filterScenario"))==null?void 0:h.value,i=(v=document.getElementById("filterTransferred"))==null?void 0:v.value,r=(x=document.getElementById("filterQualityBelow"))==null?void 0:x.value,l=(f=document.getElementById("filterTenant"))==null?void 0:f.value;n&&s.set("date_from",n),o&&s.set("date_to",o),a&&s.set("scenario",a),i&&s.set("transferred",i),r&&s.set("min_quality",r),l&&s.set("tenant_id",l);try{const y=await At(`/analytics/calls/export?${s}`);if(!y.ok)throw new Error(`HTTP ${y.status}`);const $=await y.blob(),S=(y.headers.get("Content-Disposition")||"").match(/filename="(.+)"/),B=S?S[1]:"calls_export.csv";Mt($,B),c(e("calls.csvExported"))}catch(y){c(e("calls.exportFailed",{error:y.message}),"error")}}async function Xa(s){try{const n=await g(`/analytics/calls/${s}`),o=n.call,a=n.turns||[],i=n.tool_calls||[];let r=`
            <div class="grid grid-cols-2 gap-3 mb-4 text-sm">
                <div><span class="font-medium text-neutral-500 dark:text-neutral-400">${e("calls.detailCaller")}</span> <span class="text-neutral-900 dark:text-neutral-100">${d(o.caller_id)||"-"}</span></div>
                <div><span class="font-medium text-neutral-500 dark:text-neutral-400">${e("calls.detailScenario")}</span> <span class="text-neutral-900 dark:text-neutral-100">${d(o.scenario)||"-"}</span></div>
                <div><span class="font-medium text-neutral-500 dark:text-neutral-400">${e("calls.detailDuration")}</span> <span class="text-neutral-900 dark:text-neutral-100">${o.duration_seconds||0}s</span></div>
                <div><span class="font-medium text-neutral-500 dark:text-neutral-400">${e("calls.detailQuality")}</span> ${ye(o.quality_score)}</div>
                <div><span class="font-medium text-neutral-500 dark:text-neutral-400">${e("calls.detailCost")}</span> <span class="text-neutral-900 dark:text-neutral-100">$${(o.total_cost_usd||0).toFixed(3)}</span></div>
                <div><span class="font-medium text-neutral-500 dark:text-neutral-400">${e("calls.detailPrompt")}</span> <span class="text-neutral-900 dark:text-neutral-100">${d(o.prompt_version)||"-"}</span></div>
            </div>
        `;if(o.quality_details){r+=`<h3 class="${Ne} mt-4">${e("calls.qualityBreakdown")}</h3><div class="overflow-x-auto"><table class="${A}">`;for(const[l,p]of Object.entries(o.quality_details))l!=="comment"&&(r+=`<tr class="${_}"><td class="${u}">${d(l)}</td><td class="${u}">${ye(p)}</td></tr>`);o.quality_details.comment&&(r+=`<tr><td colspan="2" class="${u} italic">${d(o.quality_details.comment)}</td></tr>`),r+="</table></div>"}if(o.cost_breakdown){const l=o.cost_breakdown;r+=`<h3 class="${Ne} mt-4">${e("calls.costBreakdownTitle")}</h3><div class="overflow-x-auto"><table class="${A}">`,r+=`<tr class="${_}"><td class="${u} font-medium">${e("calls.sttProvider")}</td><td class="${u}">${d(l.stt_provider||"google")}</td></tr>`,r+=`<tr class="${_}"><td class="${u} font-medium">${e("calls.sttSeconds")}</td><td class="${u}">${l.stt_seconds??"-"}</td></tr>`,r+=`<tr class="${_}"><td class="${u} font-medium">${e("calls.sttCost")}</td><td class="${u}">$${(l.stt_cost||0).toFixed(6)}</td></tr>`,r+=`<tr class="${_}"><td class="${u} font-medium">${e("calls.llmModel")}</td><td class="${u}">${d(l.llm_model||"-")}</td></tr>`,r+=`<tr class="${_}"><td class="${u} font-medium">${e("calls.llmInputTokens")}</td><td class="${u}">${l.llm_input_tokens??0}</td></tr>`,r+=`<tr class="${_}"><td class="${u} font-medium">${e("calls.llmOutputTokens")}</td><td class="${u}">${l.llm_output_tokens??0}</td></tr>`,l.llm_input_price_per_1m!=null&&(r+=`<tr class="${_}"><td class="${u} font-medium">${e("calls.llmInputPrice")}</td><td class="${u}">$${l.llm_input_price_per_1m}</td></tr>`,r+=`<tr class="${_}"><td class="${u} font-medium">${e("calls.llmOutputPrice")}</td><td class="${u}">$${l.llm_output_price_per_1m}</td></tr>`),r+=`<tr class="${_}"><td class="${u} font-medium">${e("calls.llmCost")}</td><td class="${u}">$${(l.llm_cost||0).toFixed(6)}</td></tr>`,r+=`<tr class="${_}"><td class="${u} font-medium">${e("calls.ttsCharacters")}</td><td class="${u}">${l.tts_characters??0}</td></tr>`,r+=`<tr class="${_}"><td class="${u} font-medium">${e("calls.ttsCost")}</td><td class="${u}">$${(l.tts_cost||0).toFixed(6)}</td></tr>`,r+=`<tr class="${_} font-semibold"><td class="${u}">${e("calls.totalCost")}</td><td class="${u}">$${(l.total_cost||0).toFixed(6)}</td></tr>`,r+="</table></div>"}r+=`<div class="flex items-center justify-between mt-4"><h3 class="${Ne}">${e("calls.transcription")}</h3><div class="flex gap-2"><button class="${E} ${T}" data-id="${d(s)}" onclick="window._pages.calls.importToSandbox(this.dataset.id, this)">${e("calls.openInSandbox")}</button><button class="${E} ${T}" data-id="${d(s)}" onclick="window._pages.calls.downloadTranscript(this.dataset.id)">${e("calls.downloadTranscript")}</button></div></div>`,a.length===0?r+=`<div class="${k}">${e("calls.noTranscription")}</div>`:a.forEach(l=>{r+=`<div class="${Gn}"><span class="${l.speaker==="customer"?Ws:Js}">${l.speaker==="customer"?e("calls.customer"):e("calls.bot")}</span>`,r+=`<div class="${Qs}">${d(l.text)}</div></div>`}),i.length&&(r+=`<h3 class="${Ne} mt-4">${e("calls.toolCalls")}</h3><div class="overflow-x-auto"><table class="${A}"><tr><th class="${b}">${e("calls.toolName")}</th><th class="${b}">${e("calls.toolSuccess")}</th><th class="${b}">${e("calls.toolDuration")}</th></tr>`,i.forEach((l,p)=>{const m=l.tool_args||l.tool_result;r+=`<tr class="${_}${m?" cursor-pointer":""}" ${m?`onclick="window._pages.calls.toggleToolDetail(${p})"`:""}>
                    <td class="${u}"><span class="inline-flex items-center gap-1">${m?`<svg class="w-3.5 h-3.5 text-neutral-400 transition-transform tool-chevron-${p}" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd"/></svg>`:""}${d(l.tool_name)}</span></td>
                    <td class="${u}">${l.success?`<span class="${L}">${e("common.yes")}</span>`:`<span class="${D}">${e("common.no")}</span>`}</td>
                    <td class="${u}">${l.duration_ms||0}ms</td></tr>`,m&&(r+=`<tr id="toolDetail-${p}" class="hidden"><td colspan="3" class="px-3 py-2 border-b border-neutral-100 dark:border-neutral-800">`,l.tool_args&&Object.keys(l.tool_args).length&&(r+=`<div class="mb-2"><span class="text-xs font-semibold text-neutral-500 dark:text-neutral-400">${e("calls.toolArgs")}</span><pre class="mt-1 p-2 text-xs bg-neutral-50 dark:bg-neutral-800 rounded-md overflow-x-auto text-neutral-700 dark:text-neutral-300">${d(JSON.stringify(l.tool_args,null,2))}</pre></div>`),l.tool_result&&(r+=`<div><span class="text-xs font-semibold text-neutral-500 dark:text-neutral-400">${e("calls.toolResult")}</span><pre class="mt-1 p-2 text-xs bg-neutral-50 dark:bg-neutral-800 rounded-md overflow-x-auto text-neutral-700 dark:text-neutral-300 max-h-64 overflow-y-auto">${d(JSON.stringify(l.tool_result,null,2))}</pre></div>`),r+="</td></tr>")}),r+="</table></div>"),document.getElementById("callDetailContent").innerHTML=r,document.getElementById("callModal").classList.add("show")}catch(n){c(e("calls.failedToLoadDetail",{error:n.message}),"error")}}async function Za(s){try{const n=await At(`/analytics/calls/${s}/transcript`);if(!n.ok)throw new Error(`HTTP ${n.status}`);const o=await n.blob(),i=(n.headers.get("Content-Disposition")||"").match(/filename="(.+)"/),r=i?i[1]:`transcript_${s}.txt`;Mt(o,r),c(e("calls.transcriptDownloaded"))}catch(n){c(e("calls.transcriptFailed",{error:n.message}),"error")}}async function er(s,n){var a;const o=n.textContent;n.disabled=!0,n.textContent=e("calls.importingToSandbox");try{const i=await g("/admin/sandbox/conversations/import-call",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({call_id:s})});c(e("calls.importedToSandbox")),eo();const r=(a=i.item)==null?void 0:a.id;window._app&&window._app.showPage&&(window._app.showPage("sandbox"),r&&setTimeout(()=>{window._pages.sandbox&&window._pages.sandbox.openConversation&&window._pages.sandbox.openConversation(r)},300))}catch(i){c(e("calls.importFailed",{error:i.message}),"error"),n.disabled=!1,n.textContent=o}}function tr(s){const n=document.getElementById(`toolDetail-${s}`);if(!n)return;const o=document.querySelector(`.tool-chevron-${s}`);n.classList.toggle("hidden"),o&&(o.style.transform=n.classList.contains("hidden")?"":"rotate(90deg)")}function eo(){document.getElementById("callModal").classList.remove("show")}function sr(){return Xn}function nr(){j("calls",async()=>{await Ja(),Qa(),Zn()})}window._pages=window._pages||{};window._pages.calls={loadCalls:Zn,exportCallsCSV:Ya,showCallDetail:Xa,closeCallModal:eo,downloadTranscript:Za,importToSandbox:er,toggleToolDetail:tr};const Bs=25;function K({containerId:s,total:n,offset:o,pageSize:a=Bs,onPage:i}){const r=document.getElementById(s);if(!r)return;const l=a||Bs,p=Math.max(1,Math.ceil(n/l)),m=Math.floor(o/l);if(p<=1){r.innerHTML="";return}const h=window.innerWidth<768,v=[],x=S=>{v.includes(S)||v.push(S)};x(0),x(p-1);const f=h?0:1;for(let S=Math.max(0,m-f);S<=Math.min(p-1,m+f);S++)x(S);v.sort((S,B)=>S-B);const y=e("common.pageInfo",{current:m+1,total:p});let $=`<div class="${fa}">`;$+=`<button class="${rt}" data-page-offset="${Math.max(0,(m-1)*l)}" ${m===0?'disabled style="opacity:0.4;cursor:default"':""}>«</button>`;let w=-1;for(const S of v)w>=0&&S-w>1&&($+='<span class="px-2 py-1.5 text-sm text-neutral-400">…</span>'),$+=`<button class="${rt}${S===m?" active":""}" data-page-offset="${S*l}">${S+1}</button>`,w=S;$+=`<button class="${rt}" data-page-offset="${Math.min((p-1)*l,(m+1)*l)}" ${m>=p-1?'disabled style="opacity:0.4;cursor:default"':""}>»</button>`,$+=`<span class="px-2 py-1.5 text-xs text-neutral-500 dark:text-neutral-400 self-center max-md:hidden">${y}</span>`,$+="</div>",r.innerHTML=$,r.querySelectorAll("[data-page-offset]").forEach(S=>{S.disabled||S.addEventListener("click",()=>{const B=parseInt(S.dataset.pageOffset,10);!isNaN(B)&&i&&i(B)})})}function re({limit:s=Bs,offset:n=0,filters:o={}}={}){var i;const a=new URLSearchParams;a.set("limit",String(s)),a.set("offset",String(n));for(const[r,l]of Object.entries(o)){const p=document.getElementById(l);if(!p)continue;const m=(i=p.value)==null?void 0:i.trim();m&&a.set(r,m)}return a}let to=[],fs=0,ys=0;async function Xe(s){s!==void 0&&(fs=s);const n=document.getElementById("promptsContent"),o=re({offset:fs});try{const a=await g(`/prompts?${o}`),i=a.versions||[];if(to=i,i.length===0){n.innerHTML=`
                <div class="mb-4">
                    <button class="${E}" onclick="window._pages.prompts.showCreatePrompt()">${e("prompts.newVersion")}</button>
                    <button class="${G} ml-2" onclick="window._pages.prompts.resetToDefault()">${e("prompts.resetToDefault")}</button>
                </div>
                <div class="${k}">${e("prompts.noVersions")}</div>`,Je();return}n.innerHTML=`
            <div class="mb-4">
                <button class="${E}" onclick="window._pages.prompts.showCreatePrompt()">${e("prompts.newVersion")}</button>
                <button class="${G} ml-2" onclick="window._pages.prompts.resetToDefault()">${e("prompts.resetToDefault")}</button>
            </div>
            <div class="overflow-x-auto min-h-[480px]"><table class="${A}" id="promptsTable"><thead><tr><th class="${P}" data-sortable>${e("prompts.name")}</th><th class="${P}" data-sortable>${e("prompts.active")}</th><th class="${P}" data-sortable>${e("prompts.created")}</th><th class="${b}">${e("prompts.action")}</th></tr></thead><tbody>
            ${i.map(l=>`
                <tr class="${_}">
                    <td class="${u}" data-label="${e("prompts.name")}"><a href="#" class="text-blue-600 dark:text-blue-400 hover:underline" onclick="event.preventDefault(); window._pages.prompts.viewPrompt('${l.id}')">${d(l.name)}</a></td>
                    <td class="${u}" data-label="${e("prompts.active")}">${l.is_active?`<span class="${L}">${e("prompts.activeLabel")}</span>`:""}</td>
                    <td class="${u}" data-label="${e("prompts.created")}" data-sort-value="${l.created_at||""}">${z(l.created_at)}</td>
                    <td class="${V}">
                        ${l.is_active?"":`<div class="relative inline-block">
                            <button class="px-1.5 py-0.5 text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 text-sm cursor-pointer" onclick="this.nextElementSibling.classList.toggle('hidden')">&hellip;</button>
                            <div class="hidden absolute right-0 z-20 mt-1 w-36 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-md shadow-lg py-1">
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.prompts.activatePrompt('${l.id}')">${e("prompts.activateBtn")}</button>
                                <button class="w-full text-left px-3 py-1.5 text-xs text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950/30 cursor-pointer" data-id="${d(l.id)}" data-name="${d(l.name)}" onclick="window._pages.prompts.deletePrompt(this.dataset.id, this.dataset.name)">${e("common.delete")}</button>
                            </div>
                        </div>`}
                    </td>
                </tr>
            `).join("")}
            </tbody></table></div>`,Q("promptsTable");let r=document.getElementById("promptsPagination");r||(r=document.createElement("div"),r.id="promptsPagination",n.appendChild(r)),K({containerId:"promptsPagination",total:a.total,offset:fs,onPage:l=>Xe(l)}),Je()}catch(a){n.innerHTML=`<div class="${k}">${e("prompts.failedToLoad",{error:d(a.message)})}
            <br><button class="${E} ${T} mt-2" onclick="window._pages.prompts.loadPromptVersions()">${e("common.retry")}</button></div>`}}function or(){const s=document.getElementById("createPromptModalTitle");s&&(s.textContent=e("prompts.createTitle")),document.getElementById("promptName").value="",document.getElementById("promptName").disabled=!1,document.getElementById("promptSystemPrompt").value="",document.getElementById("promptSystemPrompt").disabled=!1,document.getElementById("createPromptBtn").style.display="",document.getElementById("loadDefaultBtn").style.display="",document.getElementById("createPromptModal").classList.add("show")}async function ar(){const s=document.getElementById("promptName").value.trim(),n=document.getElementById("promptSystemPrompt").value.trim();if(!s||!n){c(e("prompts.nameRequired"),"error");return}try{await g("/prompts",{method:"POST",body:JSON.stringify({name:s,system_prompt:n})}),F("createPromptModal"),c(e("prompts.created_toast")),Xe()}catch(o){c(e("prompts.createFailed",{error:o.message}),"error")}}async function rr(s){if(confirm(e("prompts.activateConfirm")))try{await g(`/prompts/${s}/activate`,{method:"PATCH"}),c(e("prompts.activated")),Xe()}catch(n){c(e("prompts.activateFailed",{error:n.message}),"error")}}async function ir(s){try{const o=(await g(`/prompts/${s}`)).version,a=document.getElementById("createPromptModalTitle");a&&(a.textContent=e("prompts.viewTitle")),document.getElementById("promptName").value=o.name||"",document.getElementById("promptName").disabled=!0,document.getElementById("promptSystemPrompt").value=o.system_prompt||"",document.getElementById("promptSystemPrompt").disabled=!0,document.getElementById("createPromptBtn").style.display="none",document.getElementById("loadDefaultBtn").style.display="none",document.getElementById("createPromptModal").classList.add("show")}catch(n){c(e("prompts.failedToLoad",{error:n.message}),"error")}}async function lr(){try{const s=await g("/prompts/default");document.getElementById("promptSystemPrompt").value=s.system_prompt||""}catch(s){c(e("prompts.failedToLoad",{error:s.message}),"error")}}async function dr(){var s;if(confirm(e("prompts.resetConfirm")))try{const n=await g("/prompts/default"),a=(s=(await g("/prompts",{method:"POST",body:JSON.stringify({name:`${n.name} (reset)`,system_prompt:n.system_prompt})})).version)==null?void 0:s.id;a&&await g(`/prompts/${a}/activate`,{method:"PATCH"}),c(e("prompts.resetDone")),Xe()}catch(n){c(e("prompts.resetFailed",{error:n.message}),"error")}}async function cr(s,n){if(confirm(e("prompts.deleteConfirm",{name:n})))try{await g(`/prompts/${s}`,{method:"DELETE"}),c(e("prompts.deleted")),Xe()}catch(o){c(e("prompts.deleteFailed",{error:o.message}),"error")}}function pr(s){switch(s){case"active":return`<span class="${L}">${d(s)}</span>`;case"completed":return`<span class="${N}">${d(s)}</span>`;case"stopped":return`<span class="${D}">${d(s)}</span>`;default:return`<span class="${M}">${d(s||"unknown")}</span>`}}function so(s){return s?s.min_samples_needed?`<span class="${M}">${e("prompts.notEnoughData")}</span>`:s.is_significant&&s.recommended_variant?`<span class="${L}">${e("prompts.recommended",{variant:s.recommended_variant})}</span>`:`<span class="${M}">${e("prompts.noSignificance")}</span>`:""}function ur(s){return s?s.min_samples_needed?e("prompts.notEnoughData"):s.is_significant&&s.recommended_variant?e("prompts.recommended",{variant:s.recommended_variant}):e("prompts.noSignificance"):""}async function Je(s){s!==void 0&&(ys=s);const n=document.getElementById("promptsContent"),o=document.getElementById("abTestsSection");o&&o.remove();const a=document.createElement("div");a.id="abTestsSection",a.className="mt-6",n.appendChild(a);const i=re({offset:ys});try{const r=await g(`/prompts/ab-tests?${i}`),l=r.tests||[];let p=`<h3 class="text-base font-semibold text-neutral-900 dark:text-neutral-50 mb-3">${e("prompts.abTests")}</h3>`;if(p+=`<div class="mb-4"><button class="${E}" onclick="window._pages.prompts.showCreateABTest()">${e("prompts.newABTest")}</button></div>`,l.length===0)p+=`<div class="${k}">${e("prompts.noABTests")}</div>`;else{p+=`<div class="overflow-x-auto min-h-[480px]"><table class="${A}" id="abTestsTable"><thead><tr>
                <th class="${b}">${e("prompts.testName")}</th>
                <th class="${b}">${e("prompts.variantA")}</th>
                <th class="${b}">${e("prompts.variantB")}</th>
                <th class="${b}">${e("prompts.callsAB")}</th>
                <th class="${b}">${e("prompts.qualityAB")}</th>
                <th class="${b}">${e("prompts.abStatus")}</th>
                <th class="${b}">${e("prompts.abAction")}</th>
            </tr></thead><tbody>`;for(const h of l){const v=h.quality_a!=null?Number(h.quality_a).toFixed(2):"—",x=h.quality_b!=null?Number(h.quality_b).toFixed(2):"—";let f="";h.status==="active"?f=`<div class="relative inline-block">
                        <button class="px-1.5 py-0.5 text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 text-sm cursor-pointer" onclick="this.nextElementSibling.classList.toggle('hidden')">&hellip;</button>
                        <div class="hidden absolute right-0 z-20 mt-1 w-36 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-md shadow-lg py-1">
                            <button class="w-full text-left px-3 py-1.5 text-xs text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950/30 cursor-pointer" onclick="window._pages.prompts.stopABTest('${h.id}')">${e("prompts.stopBtn")}</button>
                        </div>
                    </div>`:f=(h.significance?so(h.significance)+" ":"")+`<div class="relative inline-block">
                        <button class="px-1.5 py-0.5 text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 text-sm cursor-pointer" onclick="this.nextElementSibling.classList.toggle('hidden')">&hellip;</button>
                        <div class="hidden absolute right-0 z-20 mt-1 w-36 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-md shadow-lg py-1">
                            <button class="w-full text-left px-3 py-1.5 text-xs text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950/30 cursor-pointer" data-id="${d(h.id)}" data-name="${d(h.test_name)}" onclick="window._pages.prompts.deleteABTest(this.dataset.id, this.dataset.name)">${e("common.delete")}</button>
                        </div>
                    </div>`,p+=`<tr class="${_}">
                    <td class="${u}" data-label="${e("prompts.testName")}"><a href="#" class="text-blue-600 dark:text-blue-400 hover:underline" onclick="event.preventDefault(); window._pages.prompts.showABReport('${h.id}')">${d(h.test_name)}</a></td>
                    <td class="${u}" data-label="${e("prompts.variantA")}">${d(h.variant_a_name||"")}</td>
                    <td class="${u}" data-label="${e("prompts.variantB")}">${d(h.variant_b_name||"")}</td>
                    <td class="${u}" data-label="${e("prompts.callsAB")}">${h.calls_a||0} / ${h.calls_b||0}</td>
                    <td class="${u}" data-label="${e("prompts.qualityAB")}">${v} / ${x}</td>
                    <td class="${u}" data-label="${e("prompts.abStatus")}">${pr(h.status)}</td>
                    <td class="${V}">${f}</td>
                </tr>`}p+="</tbody></table></div>"}a.innerHTML=p;const m=document.createElement("div");m.id="abTestsPagination",a.appendChild(m),K({containerId:"abTestsPagination",total:r.total,offset:ys,onPage:h=>Je(h)})}catch(r){a.innerHTML=`<div class="${k}">${e("prompts.failedToLoadAB",{error:d(r.message)})}</div>`}ps(),oo()}function gr(){document.getElementById("abTestName").value="",document.getElementById("abVariantA").value="",document.getElementById("abVariantB").value="",document.getElementById("abTrafficSplit").value="50",document.getElementById("abTrafficSplitValue").textContent="50%";const s=document.getElementById("abVariantA"),n=document.getElementById("abVariantB");s.innerHTML=`<option value="">${e("common.select")}</option>`,n.innerHTML=`<option value="">${e("common.select")}</option>`;for(const o of to){const a=`<option value="${o.id}">${d(o.name)}</option>`;s.innerHTML+=a,n.innerHTML+=a}document.getElementById("createABTestModal").classList.add("show")}async function mr(){const s=document.getElementById("abTestName").value.trim(),n=document.getElementById("abVariantA").value,o=document.getElementById("abVariantB").value,a=parseInt(document.getElementById("abTrafficSplit").value,10)/100;if(!s){c(e("prompts.testNameRequired"),"error");return}if(!n||!o){c(e("prompts.variantsRequired"),"error");return}if(n===o){c(e("prompts.variantsMustDiffer"),"error");return}try{await g("/prompts/ab-tests",{method:"POST",body:JSON.stringify({test_name:s,variant_a_id:n,variant_b_id:o,traffic_split:a})}),F("createABTestModal"),c(e("prompts.abTestCreated")),Je()}catch(i){c(e("prompts.abTestCreateFailed",{error:i.message}),"error")}}async function hr(s){var n;if(confirm(e("prompts.stopConfirm")))try{const o=await g(`/prompts/ab-tests/${s}/stop`,{method:"PATCH"}),a=ur((n=o.test)==null?void 0:n.significance);c(a?e("prompts.stoppedWithResult",{result:a}):e("prompts.stopped")),Je()}catch(o){c(e("prompts.stopFailed",{error:o.message}),"error")}}async function br(s,n){if(confirm(e("prompts.deleteABTestConfirm",{name:n})))try{await g(`/prompts/ab-tests/${s}`,{method:"DELETE"}),c(e("prompts.abTestDeleted")),Je()}catch(o){c(e("prompts.abTestDeleteFailed",{error:o.message}),"error")}}const vr={bot_greeted_properly:"prompts.criterionGreeting",bot_understood_intent:"prompts.criterionIntent",bot_used_correct_tool:"prompts.criterionToolUsage",bot_provided_accurate_info:"prompts.criterionAccuracy",bot_confirmed_before_action:"prompts.criterionConfirmation",bot_was_concise:"prompts.criterionConciseness",call_resolved_without_human:"prompts.criterionResolution",customer_seemed_satisfied:"prompts.criterionSatisfaction"};async function fr(s){const n=document.getElementById("abReportContent");n.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`,document.getElementById("abReportModal").classList.add("show");try{const o=await g(`/prompts/ab-tests/${s}/report`),a=o.test||{},i=o.summary||{},r=o.per_criterion||[],l=o.by_scenario||[],p=o.daily||[],m=document.getElementById("abReportModalTitle");m&&(m.textContent=`${e("prompts.abReportTitle")}: ${a.test_name||""}`);const h=y=>y!=null?(y*100).toFixed(1)+"%":"—",v=y=>y!=null?y.toFixed(0)+"s":"—",x=i.significance||{};let f="";if(f+=`<h3 class="text-sm font-semibold text-neutral-700 dark:text-neutral-300 mb-2">${e("prompts.reportSummary")}</h3>`,f+=`<div class="${ya}">
            <div class="${J}">
                <div class="${Y}">${i.calls_a||0} / ${i.calls_b||0}</div>
                <div class="${X}">${e("prompts.reportCalls")} (A / B)</div>
            </div>
            <div class="${J}">
                <div class="${Y}">${h(i.quality_a)} / ${h(i.quality_b)}</div>
                <div class="${X}">${e("prompts.reportQuality")} (A / B)</div>
            </div>
            <div class="${J}">
                <div class="${Y}">${v(i.avg_duration_a)} / ${v(i.avg_duration_b)}</div>
                <div class="${X}">${e("prompts.reportAvgDuration")} (A / B)</div>
            </div>
            <div class="${J}">
                <div class="${Y}">${h(i.transfer_rate_a)} / ${h(i.transfer_rate_b)}</div>
                <div class="${X}">${e("prompts.reportTransferRate")} (A / B)</div>
            </div>
        </div>`,x.is_significant!=null&&(f+=`<div class="mb-4">${so(x)} <span class="${C} ml-2">p=${x.p_value_approx??"—"}, z=${x.z_score??"—"}</span></div>`),r.length>0){f+=`<h3 class="text-sm font-semibold text-neutral-700 dark:text-neutral-300 mb-2 mt-4">${e("prompts.reportCriteria")}</h3>`,f+=`<div class="overflow-x-auto mb-4"><table class="${A}"><thead><tr>
                <th class="${b}">${e("prompts.reportCriterion")}</th>
                <th class="${b}">${a.variant_a_name||"A"}</th>
                <th class="${b}">${a.variant_b_name||"B"}</th>
                <th class="${b}">${e("prompts.reportDelta")}</th>
            </tr></thead><tbody>`;for(const y of r){const $=y.avg_a!=null&&y.avg_b!=null?y.avg_a-y.avg_b:null,w=$!=null?($>=0?"+":"")+($*100).toFixed(1)+"%":"—",S=$!=null?$>0?"text-emerald-600 dark:text-emerald-400":$<0?"text-red-600 dark:text-red-400":"":"";f+=`<tr class="${_}">
                    <td class="${u}">${e(vr[y.criterion]||y.criterion)}</td>
                    <td class="${u}">${ye(y.avg_a)}</td>
                    <td class="${u}">${ye(y.avg_b)}</td>
                    <td class="${u}"><span class="${S} font-medium">${w}</span></td>
                </tr>`}f+="</tbody></table></div>"}if(l.length>0){f+=`<h3 class="text-sm font-semibold text-neutral-700 dark:text-neutral-300 mb-2 mt-4">${e("prompts.reportScenarios")}</h3>`,f+=`<div class="overflow-x-auto mb-4"><table class="${A}"><thead><tr>
                <th class="${b}">${e("prompts.reportScenario")}</th>
                <th class="${b}">${e("prompts.reportCalls")} A</th>
                <th class="${b}">${e("prompts.reportCalls")} B</th>
                <th class="${b}">${e("prompts.reportQuality")} A</th>
                <th class="${b}">${e("prompts.reportQuality")} B</th>
            </tr></thead><tbody>`;for(const y of l)f+=`<tr class="${_}">
                    <td class="${u}"><span class="${N}">${d(y.scenario)}</span></td>
                    <td class="${u}">${y.calls_a}</td>
                    <td class="${u}">${y.calls_b}</td>
                    <td class="${u}">${ye(y.quality_a)}</td>
                    <td class="${u}">${ye(y.quality_b)}</td>
                </tr>`;f+="</tbody></table></div>"}if(p.length>0){f+=`<h3 class="text-sm font-semibold text-neutral-700 dark:text-neutral-300 mb-2 mt-4">${e("prompts.reportDaily")}</h3>`,f+='<div class="space-y-2 mb-4">';for(const y of p){const $=y.quality_a!=null?y.quality_a:0,w=y.quality_b!=null?y.quality_b:0;f+=`<div class="flex items-center gap-2 text-xs">
                    <span class="w-20 text-neutral-500 dark:text-neutral-400 shrink-0">${d(y.date)}</span>
                    <div class="flex-1 flex flex-col gap-0.5">
                        <div class="flex items-center gap-1">
                            <span class="w-4 text-right text-neutral-400">A</span>
                            <div class="h-3 rounded bg-blue-500 dark:bg-blue-400" style="width:${Math.max($*100,2)}%"></div>
                            <span class="${C}">${h(y.quality_a)} (${y.calls_a})</span>
                        </div>
                        <div class="flex items-center gap-1">
                            <span class="w-4 text-right text-neutral-400">B</span>
                            <div class="h-3 rounded bg-violet-500 dark:bg-violet-400" style="width:${Math.max(w*100,2)}%"></div>
                            <span class="${C}">${h(y.quality_b)} (${y.calls_b})</span>
                        </div>
                    </div>
                </div>`}f+="</div>"}f+=`<div class="mt-4"><button class="${E}" onclick="window._pages.prompts.exportABReportCSV('${s}')">${e("prompts.exportCSV")}</button></div>`,n.innerHTML=f}catch(o){n.innerHTML=`<div class="${k}">${e("prompts.reportFailedToLoad",{error:d(o.message)})}</div>`}}async function yr(s){try{const n=await At(`/prompts/ab-tests/${s}/report/csv`);if(!n.ok)throw new Error(`HTTP ${n.status}`);const o=await n.blob();Mt(o,`ab_report_${s}.csv`),c(e("prompts.csvExported"))}catch(n){c(e("prompts.exportFailed",{error:n.message}),"error")}}async function ps(){if(!Te("pronunciation:read"))return;const s=document.getElementById("promptsContent"),n=document.getElementById("pronunciationRulesSection");n&&n.remove();const o=document.createElement("div");o.id="pronunciationRulesSection",o.className="mt-6",s.appendChild(o);try{const a=await g("/admin/agent/pronunciation-rules"),i=a.source==="redis"?e("prompts.pronunciationRulesSourceRedis"):e("prompts.pronunciationRulesSourceDefault");o.innerHTML=`
            <details id="pronunciationDetails">
                <summary class="cursor-pointer select-none flex items-center gap-2 text-base font-semibold text-neutral-900 dark:text-neutral-50 mb-1">
                    <svg class="w-4 h-4 transition-transform duration-200 details-chevron" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd"/></svg>
                    ${e("prompts.pronunciationRules")}
                    <span class="${M} ml-1">${e("prompts.pronunciationRulesSource",{source:i})}</span>
                </summary>
                <div class="mt-3">
                    <p class="text-sm text-neutral-500 dark:text-neutral-400 mb-3">${e("prompts.pronunciationRulesDesc")}</p>
                    <textarea id="pronunciationRulesText" rows="16"
                        class="w-full font-mono text-sm rounded border border-neutral-300 dark:border-neutral-600 bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    >${d(a.rules||"")}</textarea>
                    <div class="mt-3 flex gap-2">
                        <button class="${E}" onclick="window._pages.prompts.savePronunciationRules()">${e("prompts.pronunciationRulesSave")}</button>
                        <button class="${G}" onclick="window._pages.prompts.resetPronunciationRules()">${e("prompts.pronunciationRulesReset")}</button>
                    </div>
                </div>
            </details>`}catch(a){o.innerHTML=`<div class="${k}">${e("prompts.pronunciationRulesSaveFailed",{error:d(a.message)})}</div>`}}async function xr(){if(!Te("pronunciation:write"))return;const s=document.getElementById("pronunciationRulesText").value;try{await g("/admin/agent/pronunciation-rules",{method:"PATCH",body:JSON.stringify({rules:s})}),c(e("prompts.pronunciationRulesSaved")),await ps(),no()}catch(n){c(e("prompts.pronunciationRulesSaveFailed",{error:n.message}),"error")}}async function $r(){if(Te("pronunciation:write")&&confirm(e("prompts.pronunciationRulesResetConfirm")))try{await g("/admin/agent/pronunciation-rules/reset",{method:"POST"}),c(e("prompts.pronunciationRulesResetDone")),await ps(),no()}catch(s){c(e("prompts.pronunciationRulesSaveFailed",{error:s.message}),"error")}}function no(){const s=document.getElementById("pronunciationDetails");s&&(s.open=!0)}async function oo(){const s=document.getElementById("promptsContent"),n=document.getElementById("optimizerSection");n&&n.remove();const o=document.createElement("div");o.id="optimizerSection",o.className="mt-6",s.appendChild(o);try{const i=(await g("/prompts/optimizer/results")).items||[];let r=`
            <details id="optimizerDetails">
                <summary class="cursor-pointer select-none flex items-center gap-2 text-base font-semibold text-neutral-900 dark:text-neutral-50 mb-1">
                    <svg class="w-4 h-4 transition-transform duration-200 details-chevron" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd"/></svg>
                    ${e("prompts.optimizer")}
                    <span class="${M} ml-1">${i.length} ${e("prompts.optimizerRuns")}</span>
                </summary>
                <div class="mt-3">
                    <p class="text-sm text-neutral-500 dark:text-neutral-400 mb-3">${e("prompts.optimizerDesc")}</p>
                    <div class="mb-3">
                        <button class="${E}" id="runOptimizerBtn" onclick="window._pages.prompts.runOptimizer()">${e("prompts.optimizerRun")}</button>
                    </div>`;if(i.length>0){r+=`<div class="overflow-x-auto"><table class="${A}"><thead><tr>
                <th class="${b}">${e("prompts.optimizerDate")}</th>
                <th class="${b}">${e("prompts.optimizerCalls")}</th>
                <th class="${b}">${e("prompts.optimizerPatterns")}</th>
                <th class="${b}">${e("prompts.optimizerStatus")}</th>
                <th class="${b}">${e("prompts.optimizerTriggered")}</th>
                <th class="${b}">${e("prompts.action")}</th>
            </tr></thead><tbody>`;for(const l of i){const p=l.patterns||[],m=l.status==="completed"?`<span class="${L}">${e("prompts.optimizerCompleted")}</span>`:`<span class="${D}">${e("prompts.optimizerError")}</span>`;r+=`<tr class="${_}">
                    <td class="${u}" data-label="${e("prompts.optimizerDate")}">${z(l.created_at)}</td>
                    <td class="${u}" data-label="${e("prompts.optimizerCalls")}">${l.calls_analyzed}</td>
                    <td class="${u}" data-label="${e("prompts.optimizerPatterns")}">${p.length}</td>
                    <td class="${u}" data-label="${e("prompts.optimizerStatus")}">${m}</td>
                    <td class="${u}" data-label="${e("prompts.optimizerTriggered")}"><span class="${M}">${d(l.triggered_by)}</span></td>
                    <td class="${V}">
                        <button class="${G} ${T}" onclick="window._pages.prompts.showOptimizerDetail('${l.id}')">${e("prompts.optimizerView")}</button>
                    </td>
                </tr>`}r+="</tbody></table></div>"}else r+=`<div class="${k}">${e("prompts.optimizerNoResults")}</div>`;r+="</div></details>",o.innerHTML=r}catch(a){o.innerHTML=`<div class="${k}">${e("prompts.optimizerLoadFailed",{error:d(a.message)})}</div>`}}async function wr(){const s=document.getElementById("runOptimizerBtn");s&&(s.disabled=!0,s.textContent=e("prompts.optimizerRunning"));try{const n=await g("/prompts/optimizer/run",{method:"POST"});c(e("prompts.optimizerStarted",{taskId:n.task_id||""}))}catch(n){c(e("prompts.optimizerRunFailed",{error:n.message}),"error")}finally{s&&(s.disabled=!1,s.textContent=e("prompts.optimizerRun"))}}function kr(s){g("/prompts/optimizer/results").then(n=>{const o=(n.items||[]).find(l=>l.id===s);if(!o)return;const a=o.patterns||[];let i=`<p class="mb-3"><strong>${e("prompts.optimizerRecommendation")}:</strong> ${d(o.overall_recommendation||"—")}</p>`;if(a.length>0){i+=`<div class="overflow-x-auto"><table class="${A}"><thead><tr>
                <th class="${b}">${e("prompts.optimizerPattern")}</th>
                <th class="${b}">${e("prompts.optimizerSeverity")}</th>
                <th class="${b}">${e("prompts.optimizerFrequency")}</th>
                <th class="${b}">${e("prompts.optimizerSuggestion")}</th>
            </tr></thead><tbody>`;for(const l of a){const p=l.severity==="high"?D:l.severity==="medium"?q:M;i+=`<tr class="${_}">
                    <td class="${u}"><div class="max-w-xs">${d(l.description||"")}</div></td>
                    <td class="${u}"><span class="${p}">${d(l.severity||"")}</span></td>
                    <td class="${u}">${l.frequency||0}</td>
                    <td class="${u}"><div class="max-w-md text-sm">${d(l.suggestion||"")}</div></td>
                </tr>`}i+="</tbody></table></div>"}const r=document.createElement("div");r.className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",r.id="optimizerDetailModal",r.onclick=l=>{l.target===r&&r.remove()},r.innerHTML=`
            <div class="bg-white dark:bg-neutral-800 rounded-lg shadow-xl max-w-3xl w-full max-h-[80vh] overflow-hidden flex flex-col">
                <div class="modal-fixed-header">
                    <h3 class="text-lg font-semibold">${e("prompts.optimizerDetailTitle")}</h3>
                    <span class="cursor-pointer text-lg text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-200 transition-colors leading-none shrink-0" onclick="document.getElementById('optimizerDetailModal').remove()">&times;</span>
                </div>
                <div class="modal-body">${i}</div>
            </div>`,document.body.appendChild(r)})}function Tr(){j("prompts",Xe),document.addEventListener("click",s=>{s.target.closest(".relative")||document.querySelectorAll("#page-prompts .relative > div:not(.hidden)").forEach(n=>n.classList.add("hidden"))})}window._pages=window._pages||{};window._pages.prompts={loadPromptVersions:Xe,showCreatePrompt:or,createPrompt:ar,activatePrompt:rr,viewPrompt:ir,loadDefaultPrompt:lr,resetToDefault:dr,deletePrompt:cr,loadABTests:Je,showCreateABTest:gr,createABTest:mr,stopABTest:hr,deleteABTest:br,showABReport:fr,exportABReportCSV:yr,loadPronunciationRules:ps,savePronunciationRules:xr,resetPronunciationRules:$r,loadOptimizerResults:oo,runOptimizer:wr,showOptimizerDetail:kr};let Fe=[],ao="articles",he=0,lt=0,ss=0,Ct=0,Tt="",nt=[];function Zs(s){ao=s,["articles","source-configs","scraper","watched"].forEach(i=>{const r=document.getElementById(`knowledgeContent-${i}`);r&&(r.style.display=i===s?"block":"none")}),document.querySelectorAll("#page-knowledge .tab-bar button").forEach(i=>i.classList.remove("active"));const o=document.querySelector(`#page-knowledge .tab-bar button[data-tab="${s}"]`);o&&o.classList.add("active"),he=0,lt=0,ss=0,Ct=0;const a={articles:Er,"source-configs":yt,scraper:()=>{io(),Dt()},watched:Ae};a[s]&&a[s]()}function Sr(s){switch(s){case"indexed":return`<span class="${L}">indexed</span>`;case"pending":return`<span class="${q}">pending</span>`;case"processing":return`<span class="${N}">processing</span>`;case"error":return`<span class="${D}">error</span>`;default:return`<span class="${M}">${d(s||"unknown")}</span>`}}function _r(s){if(!s)return`<span class="${C} text-xs">—</span>`;const n=new Date(s),o=new Date,a=z(s);return n<o?`<span class="${D}" title="${a}">${e("knowledge.expired")}</span>`:Math.ceil((n-o)/864e5)<=7?`<span class="${q}" title="${a}">${a}</span>`:`<span class="text-xs" title="${a}">${a}</span>`}function xs(s,n,o){if(s.innerHTML="",o){const a=document.createElement("option");a.value="",a.textContent=e("knowledge.allCategories"),s.appendChild(a)}for(const a of n){const i=document.createElement("option");i.value=a.value,i.textContent=a.label,s.appendChild(i)}}async function Cr(){try{Fe=(await g("/knowledge/article-categories")).categories||[]}catch{Fe=[{value:"brands",label:"Brands"},{value:"guides",label:"Guides"},{value:"faq",label:"FAQ"},{value:"comparisons",label:"Comparisons"},{value:"general",label:"General"}]}const s=document.getElementById("kbCategory");s&&xs(s,Fe,!0);const n=document.getElementById("articleCategory");n&&xs(n,Fe,!1);const o=document.getElementById("importCategory");o&&xs(o,Fe,!0)}async function Er(){await Cr(),await Se()}async function Se(s){s!==void 0&&(he=s);const n=document.getElementById("articlesContainer");n.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;const o=re({offset:he,filters:{category:"kbCategory",search:"kbSearch",active:"kbActive"}});try{const a=await g(`/knowledge/articles?${o}`),i=a.articles||[];if(i.length===0){n.innerHTML=`<div class="${k}">${e("knowledge.noArticles")}</div>`,K({containerId:"articlesPagination",total:0,offset:0});return}n.innerHTML=`
            <div class="overflow-x-auto min-h-[480px]"><table class="${A}" id="articlesTable"><thead><tr><th class="${P}" data-sortable>${e("knowledge.articleTitle")}</th><th class="${P}" data-sortable>${e("knowledge.category")}</th><th class="${P}" data-sortable>${e("knowledge.embedding")}</th><th class="${P}" data-sortable>${e("knowledge.activeCol")}</th><th class="${P}" data-sortable>${e("knowledge.expiresAt")}</th><th class="${P}" data-sortable>${e("knowledge.updated")}</th><th class="${b}">${e("knowledge.actions")}</th></tr></thead><tbody>
            ${i.map(r=>`
                <tr class="${_}">
                    <td class="${u}" data-label="${e("knowledge.articleTitle")}">${d(r.title)}</td>
                    <td class="${u}" data-label="${e("knowledge.category")}"><span class="${N}">${d(r.category)}</span></td>
                    <td class="${u}" data-label="${e("knowledge.embedding")}">${Sr(r.embedding_status)}</td>
                    <td class="${u}" data-label="${e("knowledge.activeCol")}">${r.active!==!1?`<span class="${L}">${e("common.yes")}</span>`:`<span class="${D}">${e("common.no")}</span>`}</td>
                    <td class="${u}" data-label="${e("knowledge.expiresAt")}" data-sort-value="${r.expires_at||""}">${_r(r.expires_at)}</td>
                    <td class="${u}" data-label="${e("knowledge.updated")}" data-sort-value="${r.updated_at||r.created_at||""}">${z(r.updated_at||r.created_at)}</td>
                    <td class="${V}">
                        <div class="relative inline-block">
                            <button class="px-1.5 py-0.5 text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 text-sm cursor-pointer" onclick="this.nextElementSibling.classList.toggle('hidden')">&hellip;</button>
                            <div class="hidden absolute right-0 z-20 mt-1 w-40 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-md shadow-lg py-1">
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.knowledge.editArticle('${r.id}')">${e("knowledge.editBtn")}</button>
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.knowledge.reindexArticle('${r.id}')">${e("knowledge.reindexBtn")}</button>
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.knowledge.toggleArticle('${r.id}', ${r.active!==!1})">${r.active!==!1?e("common.deactivate"):e("common.activate")}</button>
                                <button class="w-full text-left px-3 py-1.5 text-xs text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950/30 cursor-pointer" data-id="${d(r.id)}" data-name="${d(r.title)}" onclick="window._pages.knowledge.deleteArticle(this.dataset.id, this.dataset.name)">${e("common.delete")}</button>
                            </div>
                        </div>
                    </td>
                </tr>
            `).join("")}
            </tbody></table></div>
            <p class="${C} mt-2">${e("knowledge.total",{count:a.total})}</p>`,Q("articlesTable"),K({containerId:"articlesPagination",total:a.total,offset:he,onPage:r=>Se(r)})}catch(a){n.innerHTML=`<div class="${k}">${e("knowledge.failedToLoad",{error:d(a.message)})}
            <br><button class="${E} ${T} mt-2" onclick="window._pages.knowledge.loadArticles()">${e("common.retry")}</button></div>`}}function Ir(){document.getElementById("articleModalTitle").textContent=e("knowledge.newArticleTitle"),document.getElementById("editArticleId").value="",document.getElementById("articleTitle").value="",document.getElementById("articleCategory").value="faq",document.getElementById("articleContent").value="",document.getElementById("articleExpiresAt").value="",document.getElementById("createArticleModal").classList.add("show")}async function ro(s){try{const o=(await g(`/knowledge/articles/${s}`)).article;document.getElementById("articleModalTitle").textContent=e("knowledge.editArticleTitle"),document.getElementById("editArticleId").value=s,document.getElementById("articleTitle").value=o.title||"",document.getElementById("articleCategory").value=o.category||"faq",document.getElementById("articleContent").value=o.content||"";const a=document.getElementById("articleExpiresAt");if(o.expires_at){const i=new Date(o.expires_at);a.value=i.getFullYear()+"-"+String(i.getMonth()+1).padStart(2,"0")+"-"+String(i.getDate()).padStart(2,"0")+"T"+String(i.getHours()).padStart(2,"0")+":"+String(i.getMinutes()).padStart(2,"0")}else a.value="";document.getElementById("createArticleModal").classList.add("show")}catch(n){c(e("knowledge.loadFailed",{error:n.message}),"error")}}async function Br(){const s=document.getElementById("editArticleId").value,n=document.getElementById("articleTitle").value.trim(),o=document.getElementById("articleCategory").value,a=document.getElementById("articleContent").value.trim(),i=document.getElementById("articleExpiresAt").value;if(!n||!a){c(e("knowledge.titleRequired"),"error");return}const r=i?new Date(i).toISOString():"";try{if(s)await g(`/knowledge/articles/${s}`,{method:"PATCH",body:JSON.stringify({title:n,category:o,content:a,expires_at:r})}),c(e("knowledge.articleUpdated"));else{const l={title:n,category:o,content:a};r&&(l.expires_at=r),await g("/knowledge/articles",{method:"POST",body:JSON.stringify(l)}),c(e("knowledge.articleCreated"))}F("createArticleModal"),Se(he)}catch(l){c(e("knowledge.saveFailed",{error:l.message}),"error")}}async function Pr(s,n){try{await g(`/knowledge/articles/${s}`,{method:"PATCH",body:JSON.stringify({active:!n})}),c(e(n?"knowledge.articleDeactivated":"knowledge.articleActivated")),Se(he)}catch(o){c(e("knowledge.toggleFailed",{error:o.message}),"error")}}async function Lr(s,n){if(confirm(e("knowledge.deleteConfirm",{title:n})))try{await g(`/knowledge/articles/${s}`,{method:"DELETE"}),c(e("knowledge.articleDeleted")),Se(he)}catch(o){c(e("knowledge.deleteFailed",{error:o.message}),"error")}}async function Ar(s){try{const n=await g(`/knowledge/articles/${s}/reindex`,{method:"POST"});c(n.message||e("knowledge.reindexQueued")),Se(he)}catch(n){c(e("knowledge.reindexFailed",{error:n.message}),"error")}}async function Hr(){if(confirm(e("knowledge.reindexAllConfirm")))try{const s=await g("/knowledge/reindex-all",{method:"POST"});c(s.message||e("knowledge.reindexAllDispatched")),Se(he)}catch(s){c(e("knowledge.reindexAllFailed",{error:s.message}),"error")}}function Mr(){document.getElementById("importFiles").value="";const s=document.getElementById("importCategory");s&&(s.value=""),document.getElementById("importDocumentsModal").classList.add("show")}async function Dr(){const s=document.getElementById("importFiles"),n=document.getElementById("importCategory"),o=s.files;if(!o||o.length===0){c(e("knowledge.importNoFiles"),"error");return}const a=new FormData;for(const l of o)a.append("files",l);let i="/knowledge/articles/import";const r=n?n.value:"";r&&(i+=`?category=${encodeURIComponent(r)}`);try{const l=await ra(i,a),p=[e("knowledge.importResult",{imported:l.imported})];if(l.errors>0&&p.push(e("knowledge.importErrors",{errors:l.errors})),c(p.join(", "),l.errors>0?"warning":"success"),l.error_details&&l.error_details.length>0)for(const m of l.error_details)c(`${m.filename}: ${m.error}`,"error");F("importDocumentsModal"),Se(he)}catch(l){c(e("knowledge.importFailed",{error:l.message}),"error")}}function Ps(s){switch(s){case"processed":return`<span class="${L}">${d(s)}</span>`;case"processing":return`<span class="${N}">${d(s)}</span>`;case"new":return`<span class="${q}">${d(s)}</span>`;case"skipped":return`<span class="${M}">${d(s)}</span>`;case"error":return`<span class="${D}">${d(s)}</span>`;case"duplicate":return`<span class="${M}">${e("sources.duplicate")}</span>`;case"duplicate_suspect":return`<span class="${q}">${e("sources.duplicateSuspect")}</span>`;default:return`<span class="${M}">${d(s||"unknown")}</span>`}}async function io(){const s=document.getElementById("scraperConfigCard");if(s)try{const o=(await g("/admin/scraper/config")).config||{};s.innerHTML=`
            <div class="flex flex-wrap items-center gap-4 mb-2">
                <label class="flex items-center gap-2 text-sm cursor-pointer">
                    <input type="checkbox" id="scraperEnabled" ${o.enabled?"checked":""} onchange="window._pages.knowledge.toggleScraperEnabled()">
                    <span>${e("sources.enabled")}</span>
                </label>
                <label class="flex items-center gap-2 text-sm cursor-pointer">
                    <input type="checkbox" id="scraperAutoApprove" ${o.auto_approve?"checked":""} onchange="window._pages.knowledge.toggleAutoApprove()">
                    <span>${e("sources.autoApprove")}</span>
                </label>
                <label class="flex items-center gap-2 text-sm cursor-pointer">
                    <input type="checkbox" id="scraperDedupLlm" ${o.dedup_llm_check?"checked":""} onchange="window._pages.knowledge.toggleDedupLlm()">
                    <span title="${e("sources.dedupLlmCheckHint")}">${e("sources.dedupLlmCheck")}</span>
                </label>
                <button class="${E} ${T}" onclick="window._pages.knowledge.runScraperNow()">${e("sources.runNow")}</button>
            </div>
            <div class="flex flex-wrap items-center gap-4">
                <label class="flex items-center gap-2 text-sm">
                    <span>${e("sources.minDate")}</span>
                    <input type="date" id="scraperMinDate" value="${d(o.min_date||"")}" class="border rounded px-2 py-1 text-sm dark:bg-gray-700 dark:border-gray-600" onchange="window._pages.knowledge.updateMinDate()">
                    <span class="${C} text-xs" title="${e("sources.minDateHint")}">?</span>
                </label>
                <label class="flex items-center gap-2 text-sm">
                    <span>${e("sources.maxDate")}</span>
                    <input type="date" id="scraperMaxDate" value="${d(o.max_date||"")}" class="border rounded px-2 py-1 text-sm dark:bg-gray-700 dark:border-gray-600" onchange="window._pages.knowledge.updateMaxDate()">
                    <span class="${C} text-xs" title="${e("sources.maxDateHint")}">?</span>
                </label>
            </div>`}catch(n){s.innerHTML=`<div class="${C}">${e("sources.configLoadFailed",{error:d(n.message)})}</div>`}}function Rr(s){switch(s){case"prokoleso":return`<span class="${N}">ProKoleso</span>`;case"rss":return`<span class="${q}">RSS</span>`;case"generic_html":return`<span class="${M}">HTML</span>`;default:return`<span class="${M}">${d(s)}</span>`}}function Fr(s){return`<span class="${M}">${{uk:"🇺🇦 UK",de:"🇩🇪 DE",en:"🇬🇧 EN",fr:"🇫🇷 FR"}[s]||s}</span>`}function Or(s){if(!s)return`<span class="${C} text-xs">—</span>`;switch(s){case"ok":return`<span class="${L}">ok</span>`;case"error":return`<span class="${D}">error</span>`;case"disabled":return`<span class="${M}">disabled</span>`;default:return`<span class="${M}">${d(s)}</span>`}}async function yt(s){s!==void 0&&(ss=s);const n=document.getElementById("sourceConfigsContainer");if(!n)return;n.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;const o=re({offset:ss});try{const a=await g(`/admin/scraper/source-configs?${o}`),i=a.configs||[];let r=`
            <div class="mb-4">
                <button class="${E}" onclick="window._pages.knowledge.showAddSourceConfig()">${e("sources.addSource")}</button>
            </div>`;if(i.length===0)r+=`<div class="${k}">${e("sources.noSourceConfigs")}</div>`;else{const l={monday:e("sources.scheduleDays.monday"),tuesday:e("sources.scheduleDays.tuesday"),wednesday:e("sources.scheduleDays.wednesday"),thursday:e("sources.scheduleDays.thursday"),friday:e("sources.scheduleDays.friday"),saturday:e("sources.scheduleDays.saturday"),sunday:e("sources.scheduleDays.sunday")};r+=`
            <div class="overflow-x-auto min-h-[480px]"><table class="${A}" id="sourceConfigsTable"><thead><tr>
                <th class="${P}" data-sortable>${e("sources.sourceName")}</th>
                <th class="${b}">${e("sources.sourceType")}</th>
                <th class="${b}">${e("sources.sourceLanguage")}</th>
                <th class="${P}" data-sortable>${e("sources.enabled")}</th>
                <th class="${b}">${e("sources.schedule")}</th>
                <th class="${P}" data-sortable>${e("sources.lastRun")}</th>
                <th class="${b}">${e("sources.actions")}</th>
            </tr></thead><tbody>
            ${i.map(p=>{const m=p.schedule_enabled?`${l[p.schedule_day_of_week]||p.schedule_day_of_week} ${String(p.schedule_hour).padStart(2,"0")}:00`:e("common.no"),h=p.last_run_stats?`${e("sources.processed")}: ${p.last_run_stats.processed||0}`:"";return`
                <tr class="${_}">
                    <td class="${u}" data-label="${e("sources.sourceName")}">
                        <div>${d(p.name)}</div>
                        <div class="${C} text-xs">${d((p.source_url||"").replace(/^https?:\/\//,"").substring(0,40))}</div>
                    </td>
                    <td class="${u}" data-label="${e("sources.sourceType")}">${Rr(p.source_type)}</td>
                    <td class="${u}" data-label="${e("sources.sourceLanguage")}">${Fr(p.language)}</td>
                    <td class="${u}" data-label="${e("sources.enabled")}" data-sort-value="${p.enabled?1:0}">
                        <label class="inline-flex items-center cursor-pointer">
                            <input type="checkbox" ${p.enabled?"checked":""} onchange="window._pages.knowledge.toggleSourceConfigEnabled('${p.id}', this.checked)">
                        </label>
                    </td>
                    <td class="${u}" data-label="${e("sources.schedule")}"><span class="text-xs">${d(m)}</span></td>
                    <td class="${u}" data-label="${e("sources.lastRun")}" data-sort-value="${p.last_run_at||""}">
                        ${Or(p.last_run_status)}
                        ${p.last_run_at?`<br><span class="${C} text-xs">${z(p.last_run_at)}</span>`:""}
                        ${h?`<br><span class="${C} text-xs">${h}</span>`:""}
                    </td>
                    <td class="${V}">
                        <div class="relative inline-block">
                            <button class="px-1.5 py-0.5 text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 text-sm cursor-pointer" onclick="this.nextElementSibling.classList.toggle('hidden')">&hellip;</button>
                            <div class="hidden absolute right-0 z-20 mt-1 w-36 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-md shadow-lg py-1">
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.knowledge.runSourceConfig('${p.id}')">${e("sources.runSource")}</button>
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.knowledge.editSourceConfig('${p.id}')">${e("common.edit")}</button>
                                <button class="w-full text-left px-3 py-1.5 text-xs text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950/30 cursor-pointer" data-id="${d(p.id)}" data-name="${d(p.name)}" onclick="window._pages.knowledge.deleteSourceConfig(this.dataset.id, this.dataset.name)">${e("common.delete")}</button>
                            </div>
                        </div>
                    </td>
                </tr>`}).join("")}
            </tbody></table></div>`}n.innerHTML=r,Q("sourceConfigsTable"),K({containerId:"sourceConfigsPagination",total:a.total,offset:ss,onPage:l=>yt(l)})}catch(a){n.innerHTML=`<div class="${k}">${e("sources.failedToLoad",{error:d(a.message)})}
            <br><button class="${E} ${T} mt-2" onclick="window._pages.knowledge.loadSourceConfigs()">${e("common.retry")}</button></div>`}}function Nr(){document.getElementById("sourceConfigModalTitle").textContent=e("sources.addSource"),document.getElementById("editSourceConfigId").value="",document.getElementById("sourceConfigName").value="",document.getElementById("sourceConfigType").value="generic_html",document.getElementById("sourceConfigLanguage").value="de",document.getElementById("sourceConfigUrl").value="",document.getElementById("sourceConfigMaxArticles").value="20",document.getElementById("sourceConfigDay").value="monday",document.getElementById("sourceConfigHour").value="6",document.getElementById("sourceConfigEnabled").checked=!1,document.getElementById("sourceConfigAutoApprove").checked=!1,document.getElementById("sourceConfigSettings").value="{}",document.getElementById("sourceConfigModal").classList.add("show")}async function Kr(s){try{const o=((await g("/admin/scraper/source-configs")).configs||[]).find(a=>a.id===s);if(!o){c(e("sources.configLoadFailed",{error:"Not found"}),"error");return}document.getElementById("sourceConfigModalTitle").textContent=e("sources.editSource"),document.getElementById("editSourceConfigId").value=s,document.getElementById("sourceConfigName").value=o.name||"",document.getElementById("sourceConfigType").value=o.source_type||"generic_html",document.getElementById("sourceConfigLanguage").value=o.language||"uk",document.getElementById("sourceConfigUrl").value=o.source_url||"",document.getElementById("sourceConfigMaxArticles").value=String(o.max_articles_per_run||20),document.getElementById("sourceConfigDay").value=o.schedule_day_of_week||"monday",document.getElementById("sourceConfigHour").value=String(o.schedule_hour??6),document.getElementById("sourceConfigEnabled").checked=!!o.enabled,document.getElementById("sourceConfigAutoApprove").checked=!!o.auto_approve,document.getElementById("sourceConfigSettings").value=JSON.stringify(o.settings||{},null,2),document.getElementById("sourceConfigModal").classList.add("show")}catch(n){c(e("sources.configLoadFailed",{error:n.message}),"error")}}async function qr(){const s=document.getElementById("editSourceConfigId").value,n=document.getElementById("sourceConfigName").value.trim(),o=document.getElementById("sourceConfigType").value,a=document.getElementById("sourceConfigLanguage").value,i=document.getElementById("sourceConfigUrl").value.trim(),r=parseInt(document.getElementById("sourceConfigMaxArticles").value,10),l=document.getElementById("sourceConfigDay").value,p=parseInt(document.getElementById("sourceConfigHour").value,10),m=document.getElementById("sourceConfigEnabled").checked,h=document.getElementById("sourceConfigAutoApprove").checked;let v;try{v=JSON.parse(document.getElementById("sourceConfigSettings").value)}catch{c(e("sources.invalidSettingsJson"),"error");return}if(!n||!i){c(e("sources.nameUrlRequired"),"error");return}const x={name:n,source_type:o,source_url:i,language:a,max_articles_per_run:r,schedule_day_of_week:l,schedule_hour:p,enabled:m,auto_approve:h,settings:v};try{s?await g(`/admin/scraper/source-configs/${s}`,{method:"PATCH",body:JSON.stringify(x)}):await g("/admin/scraper/source-configs",{method:"POST",body:JSON.stringify(x)}),F("sourceConfigModal"),c(e("sources.sourceConfigSaved")),yt()}catch(f){c(e("sources.sourceConfigSaveFailed",{error:f.message}),"error")}}async function Ur(s,n){try{await g(`/admin/scraper/source-configs/${s}`,{method:"PATCH",body:JSON.stringify({enabled:n})}),c(e("sources.configUpdated"))}catch(o){c(e("sources.configUpdateFailed",{error:o.message}),"error"),yt()}}async function Gr(s){try{await g(`/admin/scraper/source-configs/${s}/run`,{method:"POST"}),c(e("sources.runDispatched"))}catch(n){c(e("sources.runFailed",{error:n.message}),"error")}}async function zr(s,n){if(confirm(e("sources.deleteSourceConfirm",{name:n})))try{await g(`/admin/scraper/source-configs/${s}`,{method:"DELETE"}),c(e("sources.sourceConfigDeleted")),yt()}catch(o){c(e("sources.sourceConfigDeleteFailed",{error:o.message}),"error")}}async function Dt(s){s!==void 0&&(lt=s);const n=document.getElementById("sourcesContainer");n.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;const o=re({offset:lt,filters:{status:"sourcesStatusFilter"}});try{const a=await g(`/admin/scraper/sources?${o}`),i=a.sources||[];if(i.length===0){n.innerHTML=`<div class="${k}">${e("sources.noSources")}</div>`,K({containerId:"sourcesPagination",total:0,offset:0});return}n.innerHTML=`
            <div class="overflow-x-auto min-h-[480px]"><table class="${A}" id="sourcesTable"><thead><tr><th class="${P}" data-sortable>${e("sources.url")}</th><th class="${P}" data-sortable>${e("sources.originalTitle")}</th><th class="${P}" data-sortable>${e("sources.status")}</th><th class="${P}" data-sortable>${e("sources.date")}</th><th class="${b}">${e("sources.actions")}</th></tr></thead><tbody>
            ${i.map(r=>`
                <tr class="${_}">
                    <td class="${u}" data-label="${e("sources.url")}"><a href="${d(r.url)}" target="_blank" class="text-blue-600 dark:text-blue-400 hover:underline text-xs">${d((r.url||"").replace(/^https?:\/\//,"").substring(0,50))}${(r.url||"").length>60?"...":""}</a></td>
                    <td class="${u}" data-label="${e("sources.originalTitle")}">${d(r.original_title||"-")}</td>
                    <td class="${u}" data-label="${e("sources.status")}" data-sort-value="${d(r.status||"")}">${Ps(r.status)}${r.skip_reason?`<br><span class="${C} text-xs">${d(r.skip_reason)}</span>`:""}</td>
                    <td class="${u}" data-label="${e("sources.date")}" data-sort-value="${r.created_at||""}">${z(r.created_at)}</td>
                    <td class="${V}">
                        ${r.status==="processed"&&r.article_id?`
                        <div class="relative inline-block">
                            <button class="px-1.5 py-0.5 text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 text-sm cursor-pointer" onclick="this.nextElementSibling.classList.toggle('hidden')">&hellip;</button>
                            <div class="hidden absolute right-0 z-20 mt-1 w-36 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-md shadow-lg py-1">
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.knowledge.viewSourceArticle('${r.article_id}')">${e("sources.viewArticle")}</button>
                                ${r.article_active===!1?`<button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.knowledge.approveSource('${r.id}')">${e("sources.approve")}</button>`:""}
                                <button class="w-full text-left px-3 py-1.5 text-xs text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950/30 cursor-pointer" onclick="window._pages.knowledge.rejectSource('${r.id}')">${e("sources.reject")}</button>
                            </div>
                        </div>`:""}
                    </td>
                </tr>
            `).join("")}
            </tbody></table></div>
            <p class="${C} mt-2">${e("sources.total",{count:a.total})}</p>`,Q("sourcesTable"),K({containerId:"sourcesPagination",total:a.total,offset:lt,onPage:r=>Dt(r)})}catch(a){n.innerHTML=`<div class="${k}">${e("sources.failedToLoad",{error:d(a.message)})}
            <br><button class="${E} ${T} mt-2" onclick="window._pages.knowledge.loadSources()">${e("common.retry")}</button></div>`}}async function Vr(){const s=document.getElementById("scraperEnabled").checked;try{await g("/admin/scraper/config",{method:"PATCH",body:JSON.stringify({enabled:s})}),c(e("sources.configUpdated"))}catch(n){c(e("sources.configUpdateFailed",{error:n.message}),"error")}}async function jr(){const s=document.getElementById("scraperAutoApprove").checked;try{await g("/admin/scraper/config",{method:"PATCH",body:JSON.stringify({auto_approve:s})}),c(e("sources.configUpdated"))}catch(n){c(e("sources.configUpdateFailed",{error:n.message}),"error")}}async function Wr(){const s=document.getElementById("scraperDedupLlm").checked;try{await g("/admin/scraper/config",{method:"PATCH",body:JSON.stringify({dedup_llm_check:s})}),c(e("sources.configUpdated"))}catch(n){c(e("sources.configUpdateFailed",{error:n.message}),"error")}}async function Jr(){const s=document.getElementById("scraperMinDate").value||"";try{await g("/admin/scraper/config",{method:"PATCH",body:JSON.stringify({min_date:s})}),c(e("sources.configUpdated"))}catch(n){c(e("sources.configUpdateFailed",{error:n.message}),"error")}}async function Qr(){const s=document.getElementById("scraperMaxDate").value||"";try{await g("/admin/scraper/config",{method:"PATCH",body:JSON.stringify({max_date:s})}),c(e("sources.configUpdated"))}catch(n){c(e("sources.configUpdateFailed",{error:n.message}),"error")}}async function Yr(){try{await g("/admin/scraper/run",{method:"POST"}),c(e("sources.runDispatched"))}catch(s){c(e("sources.runFailed",{error:s.message}),"error")}}async function Xr(s){try{await g(`/admin/scraper/sources/${s}/approve`,{method:"POST"}),c(e("sources.approved")),Dt(lt)}catch(n){c(e("sources.approveFailed",{error:n.message}),"error")}}async function Zr(s){if(confirm(e("sources.rejectConfirm")))try{await g(`/admin/scraper/sources/${s}/reject`,{method:"POST"}),c(e("sources.rejected")),Dt(lt)}catch(n){c(e("sources.rejectFailed",{error:n.message}),"error")}}function ei(s){Zs("articles"),setTimeout(()=>ro(s),500)}const Ls=[{value:6,label:()=>e("sources.intervalHours.6")},{value:12,label:()=>e("sources.intervalHours.12")},{value:24,label:()=>e("sources.intervalHours.24")},{value:168,label:()=>e("sources.intervalHours.168")}];function ti(s){const n=Ls.find(o=>o.value===s);return n?n.label():`${s}h`}async function Ae(s){s!==void 0&&(Ct=s);const n=document.getElementById("watchedPagesContainer");if(n){n.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;try{if(nt.length===0&&Te("tenants:read"))try{nt=((await g("/admin/tenants")).tenants||[]).filter(f=>f.is_active)}catch{nt=[]}const o=re({offset:Ct});Tt&&o.set("tenant_id",Tt);const a=await g(`/admin/scraper/watched-pages?${o}`),i=a.pages||[],r=Fe.length?Fe:[{value:"delivery",label:"delivery"},{value:"warranty",label:"warranty"},{value:"returns",label:"returns"},{value:"policies",label:"policies"},{value:"general",label:"general"}],l=`<option value="" disabled selected>${e("common.select")}</option>`+r.map(x=>`<option value="${x.value}">${d(x.label)}</option>`).join(""),p=`<option value="" disabled selected>${e("common.select")}</option>`+Ls.map(x=>`<option value="${x.value}">${x.label()}</option>`).join(""),m=`<option value="">${e("sources.allTenants")}</option>`+nt.map(x=>`<option value="${x.id}" ${x.id===Tt?"selected":""}>${d(x.name)}</option>`).join(""),h=`<option value="">${e("sources.noTenant")}</option>`+nt.map(x=>`<option value="${x.id}" ${x.id===Tt?"selected":""}>${d(x.name)}</option>`).join("");let v=`
            <div class="flex flex-wrap items-center gap-2 mb-3">
                <label class="text-xs ${C}">${e("sources.filterByTenant")}</label>
                <select id="watchedTenantFilter" class="border rounded px-2 py-1.5 text-sm dark:bg-gray-700 dark:border-gray-600"
                    onchange="window._pages.knowledge.filterWatchedByTenant(this.value)">${m}</select>
            </div>
            <div class="flex flex-wrap items-end gap-2 mb-4">
                <div class="flex-1 min-w-[250px]">
                    <label class="block text-xs ${C} mb-1">${e("sources.watchedUrl")}</label>
                    <input type="text" id="watchedPageUrl" placeholder="${e("sources.urlPlaceholder")}" class="w-full border rounded px-2 py-1.5 text-sm dark:bg-gray-700 dark:border-gray-600">
                </div>
                <div>
                    <label class="block text-xs ${C} mb-1">${e("sources.watchedCategory")}</label>
                    <select id="watchedPageCategory" class="border rounded px-2 py-1.5 text-sm dark:bg-gray-700 dark:border-gray-600">${l}</select>
                </div>
                <div>
                    <label class="block text-xs ${C} mb-1">${e("sources.watchedInterval")}</label>
                    <select id="watchedPageInterval" class="border rounded px-2 py-1.5 text-sm dark:bg-gray-700 dark:border-gray-600">${p}</select>
                </div>
                <div>
                    <label class="block text-xs ${C} mb-1">${e("sources.tenant")}</label>
                    <select id="watchedPageTenant" class="border rounded px-2 py-1.5 text-sm dark:bg-gray-700 dark:border-gray-600">${h}</select>
                </div>
                <div>
                    <label class="flex items-center gap-1.5 text-sm cursor-pointer pt-4">
                        <input type="checkbox" id="watchedPageDiscovery">
                        <span>${e("sources.discoveryLabel")}</span>
                        <span class="${C} text-xs cursor-help" title="${e("sources.discoveryHint")}">(?)</span>
                    </label>
                </div>
                <button class="${E} ${T}" onclick="window._pages.knowledge.addWatchedPage()">${e("sources.addWatchedPage")}</button>
                <button class="${E} ${T} ml-2" onclick="window._pages.knowledge.showBulkImportModal()">${e("sources.bulkImport")}</button>
            </div>`;if(i.length===0)v+=`<div class="${k}">${e("sources.noWatchedPages")}</div>`;else{const x=i.filter(w=>!w.parent_id),f=i.filter(w=>w.parent_id),y={};for(const w of f){const S=w.parent_id;y[S]||(y[S]=[]),y[S].push(w)}let $="";for(const w of x){const S=w.is_discovery,B=y[w.id]||[];$+=`
                <tr class="${_}">
                    <td class="${u}" data-label="${e("sources.watchedUrl")}">
                        <a href="${d(w.url)}" target="_blank" class="text-blue-600 dark:text-blue-400 hover:underline text-xs">${d((w.url||"").replace(/^https?:\/\//,"").substring(0,50))}</a>
                        ${S?`<br><span class="${q} text-xs">${e("sources.discoveryBadge")}</span> <span class="${C} text-xs">${e("sources.childCount",{count:w.child_count||0})}</span>`:""}
                    </td>
                    <td class="${u}" data-label="${e("sources.watchedCategory")}"><span class="${N}">${d(w.article_category||"-")}</span></td>
                    <td class="${u}" data-label="${e("sources.watchedInterval")}">
                        <select class="border rounded px-1 py-0.5 text-xs dark:bg-gray-700 dark:border-gray-600"
                            onchange="window._pages.knowledge.updateWatchedInterval('${w.id}', parseInt(this.value))">
                            ${Ls.map(I=>`<option value="${I.value}" ${I.value===w.rescrape_interval_hours?"selected":""}>${I.label()}</option>`).join("")}
                        </select>
                    </td>
                    <td class="${u}" data-label="${e("sources.watchedStatus")}">${Ps(w.status)}</td>
                    <td class="${u}" data-label="${e("sources.watchedLastScraped")}">${w.fetched_at?z(w.fetched_at):`<span class="${C} text-xs">${e("sources.neverScraped")}</span>`}</td>
                    <td class="${u}" data-label="${e("sources.watchedNextScrape")}">${w.next_scrape_at?z(w.next_scrape_at):"-"}</td>
                    <td class="${V}">
                        <div class="relative inline-block">
                            <button class="px-1.5 py-0.5 text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 text-sm cursor-pointer" onclick="this.nextElementSibling.classList.toggle('hidden')">&hellip;</button>
                            <div class="hidden absolute right-0 z-20 mt-1 w-40 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-md shadow-lg py-1">
                                ${!S&&w.article_id?`<button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.knowledge.viewSourceArticle('${w.article_id}')">${e("sources.watchedArticle")}</button>`:""}
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.knowledge.scrapeWatchedNow('${w.id}')">${e("sources.scrapeNow")}</button>
                                <button class="w-full text-left px-3 py-1.5 text-xs text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950/30 cursor-pointer" onclick="window._pages.knowledge.deleteWatchedPage('${w.id}')">${e("sources.deleteWatched")}</button>
                            </div>
                        </div>
                    </td>
                </tr>`;for(const I of B)$+=`
                    <tr class="${_} opacity-80">
                        <td class="${u} pl-8" data-label="${e("sources.watchedUrl")}">
                            <span class="${C}">↳</span>
                            <a href="${d(I.url)}" target="_blank" class="text-blue-600 dark:text-blue-400 hover:underline text-xs">${d((I.url||"").replace(/^https?:\/\//,"").substring(0,50))}</a>
                        </td>
                        <td class="${u}" data-label="${e("sources.watchedCategory")}"><span class="${N}">${d(I.article_category||"-")}</span></td>
                        <td class="${u}" data-label="${e("sources.watchedInterval")}"><span class="text-xs">${ti(I.rescrape_interval_hours)}</span></td>
                        <td class="${u}" data-label="${e("sources.watchedStatus")}">${Ps(I.status)}</td>
                        <td class="${u}" data-label="${e("sources.watchedLastScraped")}">${I.fetched_at?z(I.fetched_at):`<span class="${C} text-xs">${e("sources.neverScraped")}</span>`}</td>
                        <td class="${u}" data-label="${e("sources.watchedNextScrape")}">${I.next_scrape_at?z(I.next_scrape_at):"-"}</td>
                        <td class="${V}">
                            ${I.article_id?`<button class="text-xs text-blue-600 dark:text-blue-400 hover:underline cursor-pointer" onclick="window._pages.knowledge.viewSourceArticle('${I.article_id}')">${e("sources.watchedArticle")}</button>`:""}
                        </td>
                    </tr>`}v+=`
            <div class="overflow-x-auto min-h-[480px]"><table class="${A}" id="watchedPagesTable"><thead><tr>
                <th class="${b}">${e("sources.watchedUrl")}</th>
                <th class="${b}">${e("sources.watchedCategory")}</th>
                <th class="${b}">${e("sources.watchedInterval")}</th>
                <th class="${b}">${e("sources.watchedStatus")}</th>
                <th class="${b}">${e("sources.watchedLastScraped")}</th>
                <th class="${b}">${e("sources.watchedNextScrape")}</th>
                <th class="${b}">${e("sources.watchedActions")}</th>
            </tr></thead><tbody>
            ${$}
            </tbody></table></div>`}n.innerHTML=v,K({containerId:"watchedPagesPagination",total:a.total,offset:Ct,onPage:x=>Ae(x)})}catch(o){n.innerHTML=`<div class="${k}">${e("sources.watchedFailedToLoad",{error:d(o.message)})}
            <br><button class="${E} ${T} mt-2" onclick="window._pages.knowledge.loadWatchedPages()">${e("common.retry")}</button></div>`}}}function si(s){Tt=s,Ct=0,Ae()}async function ni(){var l,p,m,h,v,x;const s=(p=(l=document.getElementById("watchedPageUrl"))==null?void 0:l.value)==null?void 0:p.trim(),n=(m=document.getElementById("watchedPageCategory"))==null?void 0:m.value,o=(h=document.getElementById("watchedPageInterval"))==null?void 0:h.value,a=((v=document.getElementById("watchedPageDiscovery"))==null?void 0:v.checked)||!1,i=((x=document.getElementById("watchedPageTenant"))==null?void 0:x.value)||null;if(!s){c(e("sources.urlRequired"),"error");return}if(!n){c(e("sources.categoryRequired"),"error");return}if(!o){c(e("sources.intervalRequired"),"error");return}const r=parseInt(o,10);if(isNaN(r)||r<1){c(e("sources.intervalRequired"),"error");return}try{await g("/admin/scraper/watched-pages",{method:"POST",body:JSON.stringify({url:s,category:n,rescrape_interval_hours:r,is_discovery:a,tenant_id:i})}),c(e("sources.watchedPageAdded")),document.getElementById("watchedPageUrl").value="",Ae()}catch(f){c(e("sources.watchedPageAddFailed",{error:f.message}),"error")}}async function oi(s,n){try{await g(`/admin/scraper/watched-pages/${s}`,{method:"PATCH",body:JSON.stringify({rescrape_interval_hours:n})}),c(e("sources.watchedPageUpdated"))}catch(o){c(e("sources.watchedPageUpdateFailed",{error:o.message}),"error")}}async function ai(s){try{c(e("sources.scrapeNowRunning"),"info");const n=await g(`/admin/scraper/watched-pages/${s}/scrape-now`,{method:"POST"});n.status==="unchanged"?c(e("sources.scrapeNowUnchanged")):n.status==="ok"&&n.discovered!==void 0?c(e("sources.scrapeNowDiscoveryDone",{discovered:n.discovered,created:n.created||0,updated:n.updated||0})):c(e("sources.scrapeNowDone",{status:n.status||"ok"})),Ae()}catch(n){c(e("sources.scrapeNowFailed",{error:n.message}),"error")}}async function ri(s){if(confirm(e("sources.watchedPageDeleteConfirm")))try{await g(`/admin/scraper/watched-pages/${s}`,{method:"DELETE"}),c(e("sources.watchedPageDeleted")),Ae()}catch(n){c(e("sources.watchedPageDeleteFailed",{error:n.message}),"error")}}function ii(){let s='<option value="">—</option>';for(const o of nt)s+=`<option value="${d(o.id)}">${d(o.name)}</option>`;const n=`
        <div id="bulkImportOverlay" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center" onclick="if(event.target===this)this.remove()">
            <div class="bg-white dark:bg-neutral-800 rounded-lg shadow-xl w-full max-w-lg mx-4 overflow-hidden flex flex-col max-h-[80vh]">
                <div class="modal-fixed-header">
                    <h3 class="text-lg font-semibold text-neutral-900 dark:text-neutral-50">${e("sources.bulkImportTitle")}</h3>
                    <span class="cursor-pointer text-lg text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-200 transition-colors leading-none shrink-0" onclick="document.getElementById('bulkImportOverlay').remove()">&times;</span>
                </div>
                <div class="modal-body">
                <textarea id="bulkUrls" rows="8" class="w-full border rounded px-3 py-2 text-sm dark:bg-neutral-700 dark:border-neutral-600 mb-3" placeholder="${e("sources.bulkUrlsPlaceholder")}"></textarea>
                <div class="grid grid-cols-3 gap-3 mb-4">
                    <div>
                        <label class="block text-xs ${C} mb-1">${e("sources.watchedCategory")}</label>
                        <select id="bulkCategory" class="w-full border rounded px-2 py-1.5 text-sm dark:bg-neutral-700 dark:border-neutral-600">
                            <option value="general">general</option>
                            <option value="faq">faq</option>
                            <option value="guides">guides</option>
                            <option value="comparisons">comparisons</option>
                            <option value="brands">brands</option>
                            <option value="procedures">procedures</option>
                            <option value="delivery">delivery</option>
                            <option value="warranty">warranty</option>
                            <option value="returns">returns</option>
                            <option value="policies">policies</option>
                            <option value="promotions">promotions</option>
                            <option value="news">news</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs ${C} mb-1">${e("sources.watchedInterval")}</label>
                        <select id="bulkInterval" class="w-full border rounded px-2 py-1.5 text-sm dark:bg-neutral-700 dark:border-neutral-600">
                            <option value="6">${e("sources.intervalHours.6")}</option>
                            <option value="12">${e("sources.intervalHours.12")}</option>
                            <option value="24">${e("sources.intervalHours.24")}</option>
                            <option value="168" selected>${e("sources.intervalHours.168")}</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs ${C} mb-1">${e("sources.tenant")}</label>
                        <select id="bulkTenant" class="w-full border rounded px-2 py-1.5 text-sm dark:bg-neutral-700 dark:border-neutral-600">${s}</select>
                    </div>
                </div>
                <div class="flex justify-end gap-2">
                    <button class="${G} ${T}" onclick="document.getElementById('bulkImportOverlay').remove()">${e("common.cancel")}</button>
                    <button class="${E} ${T}" onclick="window._pages.knowledge.submitBulkImport()">${e("sources.bulkImport")}</button>
                </div>
                </div>
            </div>
        </div>`;document.body.insertAdjacentHTML("beforeend",n)}async function li(){var i,r,l,p,m;const n=(((i=document.getElementById("bulkUrls"))==null?void 0:i.value)||"").split(`
`).map(h=>h.trim()).filter(Boolean);if(n.length===0)return;const o=parseInt(((r=document.getElementById("bulkInterval"))==null?void 0:r.value)||"168",10),a=((l=document.getElementById("bulkTenant"))==null?void 0:l.value)||null;try{const h=await g("/admin/scraper/watched-pages/bulk",{method:"POST",body:JSON.stringify({urls:n,category:((p=document.getElementById("bulkCategory"))==null?void 0:p.value)||"general",rescrape_interval_hours:o,tenant_id:a})});c(e("sources.bulkImportResult",{added:h.added,skipped:h.skipped})),(m=document.getElementById("bulkImportOverlay"))==null||m.remove(),Ae()}catch(h){c(e("sources.watchedPageAddFailed",{error:h.message}),"error")}}function di(){j("knowledge",()=>Zs(ao)),document.addEventListener("click",s=>{s.target.closest(".relative")||document.querySelectorAll("#page-knowledge .relative > div:not(.hidden)").forEach(n=>n.classList.add("hidden"))})}window._pages=window._pages||{};window._pages.knowledge={showTab:Zs,loadArticles:Se,showCreateArticle:Ir,editArticle:ro,saveArticle:Br,toggleArticle:Pr,deleteArticle:Lr,reindexArticle:Ar,reindexAll:Hr,showImportModal:Mr,importDocuments:Dr,loadSourceConfigs:yt,showAddSourceConfig:Nr,editSourceConfig:Kr,saveSourceConfig:qr,toggleSourceConfigEnabled:Ur,runSourceConfig:Gr,deleteSourceConfig:zr,loadScraperConfig:io,loadSources:Dt,toggleScraperEnabled:Vr,toggleAutoApprove:jr,toggleDedupLlm:Wr,updateMinDate:Jr,updateMaxDate:Qr,runScraperNow:Yr,approveSource:Xr,rejectSource:Zr,viewSourceArticle:ei,loadWatchedPages:Ae,addWatchedPage:ni,updateWatchedInterval:oi,scrapeWatchedNow:ai,deleteWatchedPage:ri,filterWatchedByTenant:si,showBulkImportModal:ii,submitBulkImport:li};let lo="templates",dt=0,ct=0,pt=0,we=!1;function co(s){lo=s,["templates","dialogues","safety"].forEach(i=>{const r=document.getElementById(`scenariosContent-${i}`);r&&(r.style.display=i===s?"block":"none")}),document.querySelectorAll("#page-scenarios .tab-bar button").forEach(i=>i.classList.remove("active"));const o=document.querySelector(`#page-scenarios .tab-bar button[data-tab="${s}"]`);o&&o.classList.add("active"),dt=0,ct=0,pt=0;const a={templates:Rt,dialogues:Ft,safety:Ot};a[s]&&a[s]()}async function Rt(s){var a,i;s!==void 0&&(dt=s);const n=document.getElementById("templatesContainer")||document.getElementById("scenariosContent-templates");n.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;const o=re({offset:dt});try{const r=await g(`/training/templates/?${o}`);let l=r.items||[];const p=document.getElementById("templateFilterKey");if(p){const f=p.value,y=[...new Set(l.map($=>$.template_key))].sort();p.innerHTML=`<option value="">${e("training.allTemplateKeys")}</option>`+y.map($=>`<option value="${d($)}"${$===f?" selected":""}>${d($)}</option>`).join("")}const m=((a=document.getElementById("templateFilterKey"))==null?void 0:a.value)||"",h=(((i=document.getElementById("templateSearch"))==null?void 0:i.value)||"").toLowerCase().trim();if(m&&(l=l.filter(f=>f.template_key===m)),h&&(l=l.filter(f=>(f.title||"").toLowerCase().includes(h)||(f.content||"").toLowerCase().includes(h)||(f.template_key||"").toLowerCase().includes(h))),l.length===0){n.innerHTML=`
                <div class="mb-4"><button class="${E}" onclick="window._pages.scenarios.showCreateTemplate()">${e("training.newTemplate")}</button></div>
                <div class="${k}">${e("training.noTemplates")}</div>`,K({containerId:"templatesPagination",total:0,offset:0});return}const v={};for(const f of l)v[f.template_key]||(v[f.template_key]=[]),v[f.template_key].push(f);let x="";for(const[f,y]of Object.entries(v))for(let $=0;$<y.length;$++){const w=y[$],S=$===0,B=y.length;x+=`
                <tr class="${_}">
                    ${S?`<td class="${u}" data-label="${e("training.templateKey")}" rowspan="${B}"><span class="${N}">${d(f)}</span><br><span class="${C} text-xs">${B} ${e("training.variantCount",{count:B})}</span><br><button class="${E} ${T} mt-1" onclick="window._pages.scenarios.addVariant('${d(f)}')">${e("training.addVariant")}</button></td>`:`<td class="${u} mobile-only-cell" data-label="${e("training.templateKey")}"><span class="${N}">${d(f)}</span></td>`}
                    <td class="${u}" data-label="#"><span class="${M}">#${w.variant_number}</span></td>
                    <td class="${u}" data-label="${e("training.templateTitle")}">${d(w.title)}</td>
                    <td class="${u}" data-label="${e("training.content")}"><span class="${C}">${d((w.content||"").substring(0,80))}${(w.content||"").length>80?"...":""}</span></td>
                    <td class="${u}" data-label="${e("training.activeCol")}">${w.is_active!==!1?`<span class="${L}">${e("common.yes")}</span>`:`<span class="${D}">${e("common.no")}</span>`}</td>
                    <td class="${V}">
                        <div class="relative inline-block">
                            <button class="px-1.5 py-0.5 text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 text-sm cursor-pointer" onclick="this.nextElementSibling.classList.toggle('hidden')">&hellip;</button>
                            <div class="hidden absolute right-0 z-20 mt-1 w-36 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-md shadow-lg py-1">
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.scenarios.editTemplate('${w.id}')">${e("common.edit")}</button>
                                ${B>1?`<button class="w-full text-left px-3 py-1.5 text-xs text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950/30 cursor-pointer" data-id="${d(w.id)}" data-name="${d(w.title)}" onclick="window._pages.scenarios.deleteTemplate(this.dataset.id, this.dataset.name)">${e("common.delete")}</button>`:""}
                            </div>
                        </div>
                    </td>
                </tr>`}n.innerHTML=`
            <div class="mb-4">
                <button class="${E}" onclick="window._pages.scenarios.showCreateTemplate()">${e("training.newTemplate")}</button>
                <span class="${C} ml-3 text-sm">${e("training.variantsHint")}</span>
            </div>
            <div class="overflow-x-auto min-h-[480px]"><table class="${A}"><thead><tr><th class="${b}">${e("training.templateKey")}</th><th class="${b}">#</th><th class="${b}">${e("training.templateTitle")}</th><th class="${b}">${e("training.content")}</th><th class="${b}">${e("training.activeCol")}</th><th class="${b}">${e("training.actions")}</th></tr></thead><tbody>
            ${x}
            </tbody></table></div>`,K({containerId:"templatesPagination",total:r.total,offset:dt,onPage:f=>Rt(f)})}catch(r){n.innerHTML=`<div class="${k}">${e("training.loadFailed",{error:d(r.message)})}</div>`}}function ci(){document.getElementById("templateModalTitle").textContent=e("training.newTemplate"),document.getElementById("editTemplateId").value="",document.getElementById("templateKey").value="",document.getElementById("templateKey").disabled=!1,document.getElementById("templateTitle").value="",document.getElementById("templateContent").value="",document.getElementById("templateDescription").value="",document.getElementById("responseTemplateModal").classList.add("show")}function pi(s){document.getElementById("templateModalTitle").textContent=e("training.addVariantTitle"),document.getElementById("editTemplateId").value="",document.getElementById("templateKey").value=s,document.getElementById("templateKey").disabled=!0,document.getElementById("templateTitle").value="",document.getElementById("templateContent").value="",document.getElementById("templateDescription").value="",document.getElementById("responseTemplateModal").classList.add("show")}async function ui(s){try{const o=(await g(`/training/templates/${s}`)).item;document.getElementById("templateModalTitle").textContent=e("training.editTemplate"),document.getElementById("editTemplateId").value=s,document.getElementById("templateKey").value=o.template_key||"",document.getElementById("templateKey").disabled=!0,document.getElementById("templateTitle").value=o.title||"",document.getElementById("templateContent").value=o.content||"",document.getElementById("templateDescription").value=o.description||"",document.getElementById("responseTemplateModal").classList.add("show")}catch(n){c(e("training.loadFailed",{error:n.message}),"error")}}async function gi(){if(we)return;const s=document.getElementById("editTemplateId").value,n=document.getElementById("templateKey").value.trim(),o=document.getElementById("templateTitle").value.trim(),a=document.getElementById("templateContent").value.trim(),i=document.getElementById("templateDescription").value.trim();if(!o||!a){c(e("training.titleContentRequired"),"error");return}we=!0;try{if(s)await g(`/training/templates/${s}`,{method:"PATCH",body:JSON.stringify({title:o,content:a,description:i||null})});else{if(!n){c(e("training.keyRequired"),"error");return}await g("/training/templates/",{method:"POST",body:JSON.stringify({template_key:n,title:o,content:a,description:i||null})})}F("responseTemplateModal"),c(e("training.templateSaved")),Rt(dt)}catch(r){c(e("training.saveFailed",{error:r.message}),"error")}finally{we=!1}}async function mi(s,n){if(confirm(e("training.deleteVariantConfirm",{title:n})))try{await g(`/training/templates/${s}`,{method:"DELETE"}),c(e("training.variantDeleted")),Rt(dt)}catch(o){c(e("training.deleteFailed",{error:o.message}),"error")}}async function Ft(s){s!==void 0&&(ct=s);const n=document.getElementById("dialoguesContainer")||document.getElementById("scenariosContent-dialogues");n.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;const o=re({offset:ct,filters:{scenario_type:"dialogueFilterScenario",phase:"dialogueFilterPhase",is_active:"dialogueFilterActive"}});try{const a=await g(`/training/dialogues/?${o}`),i=a.items||[];if(i.length===0){n.innerHTML=`
                <div class="mb-4"><button class="${E}" onclick="window._pages.scenarios.showCreateDialogue()">${e("training.newDialogue")}</button></div>
                <div class="${k}">${e("training.noDialogues")}</div>`,K({containerId:"dialoguesPagination",total:0,offset:0});return}n.innerHTML=`
            <div class="mb-4"><button class="${E}" onclick="window._pages.scenarios.showCreateDialogue()">${e("training.newDialogue")}</button></div>
            <div class="overflow-x-auto min-h-[480px]"><table class="${A}" id="dialoguesTable"><thead><tr><th class="${P}" data-sortable>${e("training.dialogueTitle")}</th><th class="${P}" data-sortable>${e("training.scenario")}</th><th class="${P}" data-sortable>${e("training.phase")}</th><th class="${b}">${e("training.tools")}</th><th class="${P}" data-sortable>${e("training.activeCol")}</th><th class="${b}">${e("training.actions")}</th></tr></thead><tbody>
            ${i.map(r=>`
                <tr class="${_}">
                    <td class="${u}" data-label="${e("training.dialogueTitle")}">${d(r.title)}</td>
                    <td class="${u}" data-label="${e("training.scenario")}"><span class="${N}">${d(r.scenario_type)}</span></td>
                    <td class="${u}" data-label="${e("training.phase")}"><span class="${M}">${d(r.phase)}</span></td>
                    <td class="${u}" data-label="${e("training.tools")}">${(r.tools_used||[]).map(l=>`<span class="${at}">${d(l)}</span>`).join(" ")}</td>
                    <td class="${u}" data-label="${e("training.activeCol")}">${r.is_active!==!1?`<span class="${L}">${e("common.yes")}</span>`:`<span class="${D}">${e("common.no")}</span>`}</td>
                    <td class="${V}">
                        <div class="relative inline-block">
                            <button class="px-1.5 py-0.5 text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 text-sm cursor-pointer" onclick="this.nextElementSibling.classList.toggle('hidden')">&hellip;</button>
                            <div class="hidden absolute right-0 z-20 mt-1 w-36 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-md shadow-lg py-1">
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.scenarios.editDialogue('${r.id}')">${e("common.edit")}</button>
                                <button class="w-full text-left px-3 py-1.5 text-xs text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950/30 cursor-pointer" data-id="${d(r.id)}" data-name="${d(r.title)}" onclick="window._pages.scenarios.deleteDialogue(this.dataset.id, this.dataset.name)">${e("common.delete")}</button>
                            </div>
                        </div>
                    </td>
                </tr>
            `).join("")}
            </tbody></table></div>`,Q("dialoguesTable"),K({containerId:"dialoguesPagination",total:a.total,offset:ct,onPage:r=>Ft(r)})}catch(a){n.innerHTML=`<div class="${k}">${e("training.loadFailed",{error:d(a.message)})}</div>`}}function hi(){document.getElementById("dialogueModalTitle").textContent=e("training.newDialogue"),document.getElementById("editDialogueId").value="",document.getElementById("dialogueTitle").value="",document.getElementById("dialogueScenarioType").value="tire_search",document.getElementById("dialoguePhase").value="mvp",document.getElementById("dialogueJSON").value=`[
  {"role": "customer", "text": ""},
  {"role": "agent", "text": ""}
]`,document.getElementById("dialogueDescription").value="",document.getElementById("dialogueModal").classList.add("show")}async function bi(s){try{const o=(await g(`/training/dialogues/${s}`)).item;document.getElementById("dialogueModalTitle").textContent=e("training.editDialogue"),document.getElementById("editDialogueId").value=s,document.getElementById("dialogueTitle").value=o.title||"",document.getElementById("dialogueScenarioType").value=o.scenario_type||"tire_search",document.getElementById("dialoguePhase").value=o.phase||"mvp",document.getElementById("dialogueJSON").value=JSON.stringify(o.dialogue||[],null,2),document.getElementById("dialogueDescription").value=o.description||"",document.getElementById("dialogueModal").classList.add("show")}catch(n){c(e("training.loadFailed",{error:n.message}),"error")}}async function vi(){if(we)return;const s=document.getElementById("editDialogueId").value,n=document.getElementById("dialogueTitle").value.trim(),o=document.getElementById("dialogueScenarioType").value,a=document.getElementById("dialoguePhase").value,i=document.getElementById("dialogueDescription").value.trim();let r;try{r=JSON.parse(document.getElementById("dialogueJSON").value)}catch{c(e("training.invalidJSON"),"error");return}if(!n){c(e("training.titleRequired"),"error");return}const l=[...new Set(r.filter(m=>m.tool_calls).flatMap(m=>m.tool_calls.map(h=>h.name)))],p={title:n,scenario_type:o,phase:a,dialogue:r,tools_used:l,description:i||null};we=!0;try{s?await g(`/training/dialogues/${s}`,{method:"PATCH",body:JSON.stringify(p)}):await g("/training/dialogues/",{method:"POST",body:JSON.stringify(p)}),F("dialogueModal"),c(e("training.dialogueSaved")),Ft(ct)}catch(m){c(e("training.saveFailed",{error:m.message}),"error")}finally{we=!1}}async function fi(s,n){if(confirm(e("training.deleteConfirm",{title:n})))try{await g(`/training/dialogues/${s}`,{method:"DELETE"}),c(e("training.dialogueDeleted")),Ft(ct)}catch(o){c(e("training.deleteFailed",{error:o.message}),"error")}}const yi={critical:4,high:3,medium:2,low:1};function po(s){switch(s){case"critical":return`<span class="${D}">${d(s)}</span>`;case"high":return`<span class="${q}">${d(s)}</span>`;case"medium":return`<span class="${N}">${d(s)}</span>`;default:return`<span class="${M}">${d(s)}</span>`}}async function Ot(s){s!==void 0&&(pt=s);const n=document.getElementById("safetyRulesContainer")||document.getElementById("scenariosContent-safety");n.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;const o=re({offset:pt,filters:{rule_type:"safetyFilterType",severity:"safetyFilterSeverity",is_active:"safetyFilterActive"}});try{const a=await g(`/training/safety-rules/?${o}`),i=a.items||[];if(i.length===0){n.innerHTML=`
                <div class="mb-4"><button class="${E}" onclick="window._pages.scenarios.showCreateSafetyRule()">${e("training.newSafetyRule")}</button></div>
                <div class="${k}">${e("training.noSafetyRules")}</div>`,K({containerId:"safetyPagination",total:0,offset:0});return}n.innerHTML=`
            <div class="mb-4">
                <button class="${E}" onclick="window._pages.scenarios.showCreateSafetyRule()">${e("training.newSafetyRule")}</button>
                <button class="${G} ml-2" id="regressionTestBtn" onclick="window._pages.scenarios.runSafetyRegressionTest()">${e("training.regressionTest")}</button>
            </div>
            <div class="overflow-x-auto min-h-[480px]"><table class="${A}" id="safetyRulesTable"><thead><tr><th class="${P}" data-sortable>${e("training.ruleTitle")}</th><th class="${P}" data-sortable>${e("training.ruleType")}</th><th class="${P}" data-sortable>${e("training.severity")}</th><th class="${b}">${e("training.triggerInput")}</th><th class="${P}" data-sortable>${e("training.activeCol")}</th><th class="${b}">${e("training.actions")}</th></tr></thead><tbody>
            ${i.map(r=>`
                <tr class="${_}">
                    <td class="${u}" data-label="${e("training.ruleTitle")}">${d(r.title)}</td>
                    <td class="${u}" data-label="${e("training.ruleType")}"><span class="${N}">${d(r.rule_type)}</span></td>
                    <td class="${u}" data-label="${e("training.severity")}" data-sort-value="${yi[r.severity]||0}">${po(r.severity)}</td>
                    <td class="${u}" data-label="${e("training.triggerInput")}"><span class="${C}">${d((r.trigger_input||"").substring(0,60))}${(r.trigger_input||"").length>60?"...":""}</span></td>
                    <td class="${u}" data-label="${e("training.activeCol")}">${r.is_active!==!1?`<span class="${L}">${e("common.yes")}</span>`:`<span class="${D}">${e("common.no")}</span>`}</td>
                    <td class="${V}">
                        <div class="relative inline-block">
                            <button class="px-1.5 py-0.5 text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 text-sm cursor-pointer" onclick="this.nextElementSibling.classList.toggle('hidden')">&hellip;</button>
                            <div class="hidden absolute right-0 z-20 mt-1 w-36 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-md shadow-lg py-1">
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.scenarios.editSafetyRule('${r.id}')">${e("common.edit")}</button>
                                <button class="w-full text-left px-3 py-1.5 text-xs text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950/30 cursor-pointer" data-id="${d(r.id)}" data-name="${d(r.title)}" onclick="window._pages.scenarios.deleteSafetyRule(this.dataset.id, this.dataset.name)">${e("common.delete")}</button>
                            </div>
                        </div>
                    </td>
                </tr>
            `).join("")}
            </tbody></table></div>`,Q("safetyRulesTable"),K({containerId:"safetyPagination",total:a.total,offset:pt,onPage:r=>Ot(r)})}catch(a){n.innerHTML=`<div class="${k}">${e("training.loadFailed",{error:d(a.message)})}</div>`}}function xi(){document.getElementById("safetyRuleModalTitle").textContent=e("training.newSafetyRule"),document.getElementById("editSafetyRuleId").value="",document.getElementById("safetyRuleTitle").value="",document.getElementById("safetyRuleType").value="behavioral",document.getElementById("safetyRuleSeverity").value="medium",document.getElementById("safetyTriggerInput").value="",document.getElementById("safetyExpectedBehavior").value="",document.getElementById("safetyRuleModal").classList.add("show")}async function $i(s){try{const o=(await g(`/training/safety-rules/${s}`)).item;document.getElementById("safetyRuleModalTitle").textContent=e("training.editSafetyRule"),document.getElementById("editSafetyRuleId").value=s,document.getElementById("safetyRuleTitle").value=o.title||"",document.getElementById("safetyRuleType").value=o.rule_type||"behavioral",document.getElementById("safetyRuleSeverity").value=o.severity||"medium",document.getElementById("safetyTriggerInput").value=o.trigger_input||"",document.getElementById("safetyExpectedBehavior").value=o.expected_behavior||"",document.getElementById("safetyRuleModal").classList.add("show")}catch(n){c(e("training.loadFailed",{error:n.message}),"error")}}async function wi(){if(we)return;const s=document.getElementById("editSafetyRuleId").value,n=document.getElementById("safetyRuleTitle").value.trim(),o=document.getElementById("safetyRuleType").value,a=document.getElementById("safetyRuleSeverity").value,i=document.getElementById("safetyTriggerInput").value.trim(),r=document.getElementById("safetyExpectedBehavior").value.trim();if(!n||!i||!r){c(e("training.fieldsRequired"),"error");return}const l={title:n,rule_type:o,severity:a,trigger_input:i,expected_behavior:r};we=!0;try{s?await g(`/training/safety-rules/${s}`,{method:"PATCH",body:JSON.stringify(l)}):await g("/training/safety-rules/",{method:"POST",body:JSON.stringify(l)}),F("safetyRuleModal"),c(e("training.safetyRuleSaved")),Ot(pt)}catch(p){c(e("training.saveFailed",{error:p.message}),"error")}finally{we=!1}}async function ki(s,n){if(confirm(e("training.deleteConfirm",{title:n})))try{await g(`/training/safety-rules/${s}`,{method:"DELETE"}),c(e("training.safetyRuleDeleted")),Ot(pt)}catch(o){c(e("training.deleteFailed",{error:o.message}),"error")}}async function Ti(){const s=document.getElementById("regressionTestBtn");s&&(s.disabled=!0,s.textContent=e("training.regressionRunning"));try{const n=await g("/training/safety-rules/regression-test",{method:"POST"});Si(n)}catch(n){c(e("training.regressionFailed",{error:n.message}),"error")}finally{s&&(s.disabled=!1,s.textContent=e("training.regressionTest"))}}function Si(s){const o=(s.results||[]).map(r=>`
        <tr class="${_}">
            <td class="${u}">
                ${r.passed?`<span class="${L}">${e("training.regressionPassed")}</span>`:`<span class="${D}">${e("training.regressionFailed_label")}</span>`}
            </td>
            <td class="${u}">${d(r.title)}</td>
            <td class="${u}">${po(r.severity)}</td>
            <td class="${u}"><span class="${C}">${d((r.trigger_input||"").substring(0,80))}</span></td>
            <td class="${u}"><span class="${C}">${d((r.expected||"").substring(0,80))}</span></td>
            <td class="${u}"><span class="${C}">${d((r.actual||"").substring(0,120))}</span></td>
            <td class="${u}"><span class="${C}">${d((r.reason||"").substring(0,80))}</span></td>
        </tr>
    `).join("");if(!document.getElementById("regressionResultsModal")){const r=document.createElement("div");r.id="regressionResultsModal",r.className="modal",r.innerHTML=`
            <div class="modal-content" style="max-width:900px">
                <div class="modal-header">
                    <h3>${e("training.regressionResults")}</h3>
                    <button class="modal-close" onclick="window._pages.scenarios.closeRegressionModal()">&times;</button>
                </div>
                <div class="modal-body" id="regressionResultsBody"></div>
            </div>`,document.body.appendChild(r)}const i=document.getElementById("regressionResultsBody");i.innerHTML=`
        <div class="mb-4">
            <span class="${L} mr-2">${e("training.regressionPassedCount",{count:s.passed})}</span>
            <span class="${D}">${e("training.regressionFailedCount",{count:s.failed})}</span>
            <span class="${C} ml-2">${e("training.regressionTotal",{count:s.total})}</span>
        </div>
        <div class="overflow-x-auto"><table class="${A}"><thead><tr>
            <th class="${b}">${e("training.regressionStatus")}</th>
            <th class="${b}">${e("training.ruleTitle")}</th>
            <th class="${b}">${e("training.severity")}</th>
            <th class="${b}">${e("training.triggerInput")}</th>
            <th class="${b}">${e("training.expectedBehavior")}</th>
            <th class="${b}">${e("training.regressionActual")}</th>
            <th class="${b}">${e("training.regressionReason")}</th>
        </tr></thead><tbody>${o}</tbody></table></div>`,document.getElementById("regressionResultsModal").classList.add("show")}function _i(){F("regressionResultsModal")}function Ci(){j("scenarios",()=>co(lo)),document.addEventListener("click",s=>{s.target.closest(".relative")||document.querySelectorAll("#page-scenarios .relative > div:not(.hidden)").forEach(n=>n.classList.add("hidden"))})}window._pages=window._pages||{};window._pages.scenarios={showTab:co,loadTemplates:Rt,showCreateTemplate:ci,addVariant:pi,editTemplate:ui,saveTemplate:gi,deleteTemplate:mi,loadDialogues:Ft,showCreateDialogue:hi,editDialogue:bi,saveDialogue:vi,deleteDialogue:fi,loadSafetyRules:Ot,showCreateSafetyRule:xi,editSafetyRule:$i,saveSafetyRule:wi,deleteSafetyRule:ki,runSafetyRegressionTest:Ti,closeRegressionModal:_i};const uo=25;let fe=0,Et=[];async function us(s){s!==void 0&&(fe=s);const n=document.getElementById("toolsContent");n.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;try{Et=(await g("/training/tools/")).items||[];const a=Et.slice(fe,fe+uo);n.innerHTML=`
            <div class="overflow-x-auto min-h-[480px]"><table class="${A}" id="toolsTable"><thead><tr><th class="${P}" data-sortable>${e("training.toolName")}</th><th class="${b}">${e("training.description")}</th><th class="${P}" data-sortable>${e("training.override")}</th><th class="${b}">${e("training.actions")}</th></tr></thead><tbody>
            ${a.map(i=>`
                <tr class="${_}">
                    <td class="${u}" data-label="${e("training.toolName")}"><span class="${N}">${d(i.name)}</span></td>
                    <td class="${u}" data-label="${e("training.description")}"><span class="${C}">${d((i.effective_description||"").substring(0,100))}${(i.effective_description||"").length>100?"...":""}</span></td>
                    <td class="${u}" data-label="${e("training.override")}">${i.has_override?`<span class="${q}">${e("training.overridden")}</span>`:`<span class="${M}">${e("training.default")}</span>`}</td>
                    <td class="${V}" data-label="${e("training.actions")}">
                        <div class="flex flex-wrap gap-1">
                            <button class="${E} ${T}" onclick="window._pages.tools.editToolOverride('${d(i.name)}')">${e("common.edit")}</button>
                            ${i.has_override?`<button class="${Ht} ${T}" onclick="window._pages.tools.resetToolOverride('${d(i.name)}')">${e("training.reset")}</button>`:""}
                        </div>
                    </td>
                </tr>
            `).join("")}
            </tbody></table></div>`,Q("toolsTable"),K({containerId:"toolsPagination",total:Et.length,offset:fe,onPage:i=>{fe=i,go()}})}catch(o){n.innerHTML=`<div class="${k}">${e("training.loadFailed",{error:d(o.message)})}</div>`}}function go(){const s=document.getElementById("toolsContent"),n=Et.slice(fe,fe+uo);s.innerHTML=`
        <div class="overflow-x-auto min-h-[480px]"><table class="${A}" id="toolsTable"><thead><tr><th class="${P}" data-sortable>${e("training.toolName")}</th><th class="${b}">${e("training.description")}</th><th class="${P}" data-sortable>${e("training.override")}</th><th class="${b}">${e("training.actions")}</th></tr></thead><tbody>
        ${n.map(o=>`
            <tr class="${_}">
                <td class="${u}" data-label="${e("training.toolName")}"><span class="${N}">${d(o.name)}</span></td>
                <td class="${u}" data-label="${e("training.description")}"><span class="${C}">${d((o.effective_description||"").substring(0,100))}${(o.effective_description||"").length>100?"...":""}</span></td>
                <td class="${u}" data-label="${e("training.override")}">${o.has_override?`<span class="${q}">${e("training.overridden")}</span>`:`<span class="${M}">${e("training.default")}</span>`}</td>
                <td class="${V}" data-label="${e("training.actions")}">
                    <div class="flex flex-wrap gap-1">
                        <button class="${E} ${T}" onclick="window._pages.tools.editToolOverride('${d(o.name)}')">${e("common.edit")}</button>
                        ${o.has_override?`<button class="${Ht} ${T}" onclick="window._pages.tools.resetToolOverride('${d(o.name)}')">${e("training.reset")}</button>`:""}
                    </div>
                </td>
            </tr>
        `).join("")}
        </tbody></table></div>`,Q("toolsTable"),K({containerId:"toolsPagination",total:Et.length,offset:fe,onPage:o=>{fe=o,go()}})}async function Ei(s){try{const o=((await g("/training/tools/")).items||[]).find(a=>a.name===s);if(!o){c(e("training.toolNotFound"),"error");return}document.getElementById("toolOverrideModalTitle").textContent=`${e("training.editTool")}: ${s}`,document.getElementById("editToolName").value=s,document.getElementById("toolOriginalDescription").textContent=o.description,document.getElementById("toolOverrideDescription").value=o.override&&o.override.description||o.description,document.getElementById("toolOverrideModal").classList.add("show")}catch(n){c(e("training.loadFailed",{error:n.message}),"error")}}async function Ii(){const s=document.getElementById("editToolName").value,n=document.getElementById("toolOverrideDescription").value.trim();if(!n){c(e("training.descriptionRequired"),"error");return}try{await g(`/training/tools/${s}`,{method:"PATCH",body:JSON.stringify({description:n})}),F("toolOverrideModal"),c(e("training.toolOverrideSaved")),us()}catch(o){c(e("training.saveFailed",{error:o.message}),"error")}}async function Bi(s){if(confirm(e("training.resetConfirm",{name:s})))try{await g(`/training/tools/${s}`,{method:"DELETE"}),c(e("training.toolOverrideReset")),us()}catch(n){c(e("training.resetFailed",{error:n.message}),"error")}}function Pi(){j("tools",us)}window._pages=window._pages||{};window._pages.tools={loadTools:us,editToolOverride:Ei,saveToolOverride:Ii,resetToolOverride:Bi};async function vt(){var o,a;const s=document.getElementById("operatorsLoading"),n=document.querySelector("#operatorsTable tbody");s.style.display="flex";try{const i=await g("/operators");s.style.display="none";let r=i.operators||[];const l=r.length,p=(((o=document.getElementById("operatorSearch"))==null?void 0:o.value)||"").toLowerCase().trim(),m=((a=document.getElementById("operatorFilterStatus"))==null?void 0:a.value)||"";if(p&&(r=r.filter(h=>(h.name||"").toLowerCase().includes(p)||(h.extension||"").toLowerCase().includes(p))),m&&(r=r.filter(h=>h.current_status===m)),r.length===0){n.innerHTML=`<tr><td colspan="7" class="${k}">${e("operators.noOperators")}</td></tr>`;return}n.innerHTML=r.map(h=>`
            <tr class="${_}">
                <td class="${u}" data-label="${e("operators.name")}">${d(h.name)}</td>
                <td class="${u}" data-label="${e("operators.extension")}">${d(h.extension)}</td>
                <td class="${u}" data-label="${e("operators.status")}">${ka(h.current_status)}</td>
                <td class="${u}" data-label="${e("operators.skills")}">${(h.skills||[]).map(v=>`<span class="${N}">${d(v)}</span>`).join(" ")}</td>
                <td class="${u}" data-label="${e("operators.shift")}">${h.shift_start||"09:00"} - ${h.shift_end||"18:00"}</td>
                <td class="${u}" data-label="${e("operators.activeCol")}">${h.is_active?`<span class="${L}">${e("common.yes")}</span>`:`<span class="${D}">${e("common.no")}</span>`}</td>
                <td class="${V}">
                    <div class="relative inline-block">
                        <button class="px-1.5 py-0.5 text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 text-sm cursor-pointer" onclick="this.nextElementSibling.classList.toggle('hidden')">&hellip;</button>
                        <div class="hidden absolute right-0 z-20 mt-1 w-44 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-md shadow-lg py-1">
                            <div class="px-3 py-1 text-xs text-neutral-400 uppercase">${e("operators.statusSelect")}</div>
                            <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.operators.changeOperatorStatus('${h.id}', 'online')">${e("operators.statusOnline")}</button>
                            <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.operators.changeOperatorStatus('${h.id}', 'offline')">${e("operators.statusOffline")}</button>
                            <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.operators.changeOperatorStatus('${h.id}', 'busy')">${e("operators.statusBusy")}</button>
                            <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.operators.changeOperatorStatus('${h.id}', 'break')">${e("operators.statusBreak")}</button>
                            <div class="border-t border-neutral-200 dark:border-neutral-700 my-1"></div>
                            <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.operators.editOperator('${h.id}')">${e("operators.editBtn")}</button>
                            ${h.is_active?`<button class="w-full text-left px-3 py-1.5 text-xs text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950/30 cursor-pointer" data-id="${d(h.id)}" data-name="${d(h.name)}" onclick="window._pages.operators.deactivateOperator(this.dataset.id, this.dataset.name)">${e("common.deactivate")}</button>`:""}
                        </div>
                    </div>
                </td>
            </tr>
        `).join(""),r.length<l&&(n.innerHTML+=`<tr><td colspan="7" class="${C} text-center py-2">${e("common.showing",{shown:r.length,total:l})}</td></tr>`),Q("operatorsTable")}catch(i){s.style.display="none",n.innerHTML=`<tr><td colspan="7" class="${k}">${e("operators.failedToLoad",{error:d(i.message)})}
            <br><button class="${E} ${T} mt-2" onclick="window._pages.operators.loadOperators()">${e("common.retry")}</button></td></tr>`}}async function As(){try{const s=await g("/operators/queue");document.getElementById("operatorQueueStats").innerHTML=`
            <div class="${J} text-center"><div class="${Y}">${s.operators_online||0}</div><div class="${X}">${e("operators.online")}</div></div>
            <div class="${J} text-center"><div class="${Y}">${s.transfers_last_hour||0}</div><div class="${X}">${e("operators.transfers1h")}</div></div>
        `}catch{document.getElementById("operatorQueueStats").innerHTML=`<div class="${k}">${e("operators.queueUnavailable")}</div>`}}function Li(){document.getElementById("operatorModalTitle").textContent=e("operators.newOperatorTitle"),document.getElementById("editOperatorId").value="",document.getElementById("operatorName").value="",document.getElementById("operatorExtension").value="",document.getElementById("operatorSkills").value="",document.getElementById("operatorShiftStart").value="09:00",document.getElementById("operatorShiftEnd").value="18:00",document.getElementById("operatorModal").classList.add("show")}async function Ai(s){try{const o=((await g("/operators")).operators||[]).find(a=>a.id===s);if(!o){c(e("operators.notFound"),"error");return}document.getElementById("operatorModalTitle").textContent=e("operators.editOperatorTitle"),document.getElementById("editOperatorId").value=s,document.getElementById("operatorName").value=o.name||"",document.getElementById("operatorExtension").value=o.extension||"",document.getElementById("operatorSkills").value=(o.skills||[]).join(", "),document.getElementById("operatorShiftStart").value=o.shift_start||"09:00",document.getElementById("operatorShiftEnd").value=o.shift_end||"18:00",document.getElementById("operatorModal").classList.add("show")}catch(n){c(e("operators.loadFailed",{error:n.message}),"error")}}async function Hi(){const s=document.getElementById("editOperatorId").value,n=document.getElementById("operatorName").value.trim(),o=document.getElementById("operatorExtension").value.trim(),a=document.getElementById("operatorSkills").value.trim(),i=a?a.split(",").map(p=>p.trim()).filter(Boolean):[],r=document.getElementById("operatorShiftStart").value,l=document.getElementById("operatorShiftEnd").value;if(!n||!o){c(e("operators.nameRequired"),"error");return}try{s?(await g(`/operators/${s}`,{method:"PATCH",body:JSON.stringify({name:n,extension:o,skills:i,shift_start:r,shift_end:l})}),c(e("operators.operatorUpdated"))):(await g("/operators",{method:"POST",body:JSON.stringify({name:n,extension:o,skills:i,shift_start:r,shift_end:l})}),c(e("operators.operatorCreated"))),F("operatorModal"),vt()}catch(p){c(e("operators.saveFailed",{error:p.message}),"error")}}async function Mi(s,n){if(n)try{await g(`/operators/${s}/status`,{method:"PATCH",body:JSON.stringify({status:n})}),c(e("operators.statusChanged",{status:n})),vt()}catch(o){c(e("operators.statusFailed",{error:o.message}),"error")}}async function Di(s,n){if(confirm(e("operators.deactivateConfirm",{name:n})))try{await g(`/operators/${s}`,{method:"DELETE"}),c(e("operators.operatorDeactivated")),vt()}catch(o){c(e("operators.deactivateFailed",{error:o.message}),"error")}}function Ri(){j("operators",()=>{vt(),As(),os(()=>{vt(),As()},1e4)}),document.addEventListener("click",s=>{s.target.closest(".relative")||document.querySelectorAll("#page-operators .relative > div:not(.hidden)").forEach(n=>n.classList.add("hidden"))})}window._pages=window._pages||{};window._pages.operators={loadOperators:vt,loadQueueStatus:As,showCreateOperator:Li,editOperator:Ai,saveOperator:Hi,changeOperatorStatus:Mi,deactivateOperator:Di};async function mo(){const s=document.getElementById("systemInfo");s.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;try{const[n,o]=await Promise.all([fetch("/health").then(i=>i.json()),fetch("/health/ready").then(i=>i.json()).catch(()=>null)]);let a=`<div class="overflow-x-auto"><table class="${A}">
            <tr class="${_}"><td class="${u}">${e("settings.status")}</td><td class="${u}"><span class="${L}">${n.status}</span></td></tr>
            <tr class="${_}"><td class="${u}">${e("settings.activeCalls")}</td><td class="${u}">${n.active_calls}</td></tr>
            <tr class="${_}"><td class="${u}">${e("settings.redis")}</td><td class="${u}"><span class="${n.redis==="connected"?L:D}">${n.redis}</span></td></tr>
        `;o&&(o.store_api&&(a+=`<tr class="${_}"><td class="${u}">${e("settings.storeAPI")}</td><td class="${u}"><span class="${o.store_api==="reachable"?L:D}">${o.store_api}</span></td></tr>`),o.claude_api&&(a+=`<tr class="${_}"><td class="${u}">${e("settings.claudeAPI")}</td><td class="${u}"><span class="${o.claude_api==="reachable"?L:D}">${o.claude_api}</span></td></tr>`),o.google_stt&&(a+=`<tr class="${_}"><td class="${u}">${e("settings.googleSTT")}</td><td class="${u}"><span class="${o.google_stt==="credentials_present"?L:q}">${o.google_stt}</span></td></tr>`),o.tts_engine&&(a+=`<tr class="${_}"><td class="${u}">${e("settings.ttsEngine")}</td><td class="${u}"><span class="${o.tts_engine==="initialized"?L:q}">${o.tts_engine}</span></td></tr>`)),a+="</table></div>",s.innerHTML=a}catch(n){s.innerHTML=`<div class="${k}">${e("settings.failedToLoad",{error:d(n.message)})}
            <br><button class="${E} ${T} mt-2" onclick="window._pages.monitoring.loadSettings()">${e("common.retry")}</button></div>`}}async function Fi(){const s=document.getElementById("extendedStatus");s.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;try{const n=await g("/admin/system-status"),o=Math.floor(n.uptime_seconds/3600),a=Math.floor(n.uptime_seconds%3600/60);let i=`<div class="overflow-x-auto"><table class="${A}">`;if(i+=`<tr class="${_}"><td class="${u}">${e("settings.extVersion")}</td><td class="${u}">${d(n.version||"unknown")}</td></tr>`,i+=`<tr class="${_}"><td class="${u}">${e("settings.uptime")}</td><td class="${u}">${e("settings.uptimeValue",{hours:o,minutes:a})}</td></tr>`,n.postgres_db_size_bytes){const r=(n.postgres_db_size_bytes/1048576).toFixed(1);i+=`<tr class="${_}"><td class="${u}">${e("settings.pgDbSize")}</td><td class="${u}">${r} MB</td></tr>`}if(n.postgres_connections!==void 0&&(i+=`<tr class="${_}"><td class="${u}">${e("settings.pgConnections")}</td><td class="${u}">${n.postgres_connections}</td></tr>`),n.redis_used_memory&&(i+=`<tr class="${_}"><td class="${u}">${e("settings.redisMemory")}</td><td class="${u}">${d(n.redis_used_memory)}</td></tr>`),i+=`<tr class="${_}"><td class="${u}">${e("settings.celeryWorkers")}</td><td class="${u}"><span class="${n.celery_workers_online>0?L:D}">${n.celery_workers_online}</span></td></tr>`,n.last_backup){const r=(n.last_backup.size_bytes/1048576).toFixed(1);i+=`<tr class="${_}"><td class="${u}">${e("settings.lastBackup")}</td><td class="${u}">${d(n.last_backup.file)} (${r} MB, ${d(n.last_backup.modified)})</td></tr>`}i+="</table></div>",s.innerHTML=i}catch(n){s.innerHTML=`<div class="${k}">${e("settings.extFailed",{error:d(n.message)})}</div>`}}function Oi(){const s=window.location.hostname,n=window.location.protocol;document.querySelectorAll("#externalToolsTable a[data-tool-port]").forEach(o=>{o.href=`${n}//${s}:${o.dataset.toolPort}`})}function Ni(){Oi(),j("monitoring",()=>mo())}window._pages=window._pages||{};window._pages.monitoring={loadSettings:mo,loadSystemStatus:Fi};let O=null,de=null,en=null,Nt={};async function Ki(){if(confirm(e("settings.reloadConfirm")))try{const s=await g("/admin/config/reload",{method:"POST"});let n=e("settings.configReloaded");if(s.changes)for(const[o,a]of Object.entries(s.changes))n+=`${o}: ${a}
`;c(n,"success")}catch(s){c(e("settings.reloadFailed",{error:s.message}),"error")}}async function He(){const s=document.getElementById("llmProvidersContainer"),n=document.getElementById("llmTasksContainer");s.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`,n.innerHTML="";try{const[o,a]=await Promise.all([g("/admin/llm/config"),g("/admin/llm/providers")]);O=o.config;const i={};for(const r of a.providers)i[r.key]=r;qi(O,i),ho(O),Gi(O)}catch(o){s.innerHTML=`<div class="${k}">${e("settings.llmLoadFailed",{error:d(o.message)})}</div>`}}function qi(s,n){const o=document.getElementById("llmProvidersContainer"),a=s.providers||{};let i=`<div class="overflow-x-auto"><table class="${A}">
        <thead><tr>
            <th class="${b}">${e("settings.llmProvider")}</th>
            <th class="${b}">${e("settings.llmType")}</th>
            <th class="${b}">${e("settings.llmModel")}</th>
            <th class="${b}">${e("settings.llmApiKey")}</th>
            <th class="${b}">${e("settings.llmEnabled")}</th>
            <th class="${b}">${e("settings.llmHealth")}</th>
            <th class="${b}">${e("settings.llmActions")}</th>
        </tr></thead><tbody>`;for(const[r,l]of Object.entries(a)){const p=n[r]||{},m=l.enabled?"checked":"",h=p.healthy===!0?`<span class="${L}">OK</span>`:p.healthy===!1?`<span class="${D}">DOWN</span>`:`<span class="${M}">—</span>`,v=l.api_key_set?`<span class="${L}">set</span>`:`<span class="${q}">missing</span>`;i+=`<tr class="${_}">
            <td class="${u}" data-label="${e("settings.llmProvider")}"><strong>${d(r)}</strong></td>
            <td class="${u}" data-label="${e("settings.llmType")}">${d(l.type||"")}</td>
            <td class="${u}" data-label="${e("settings.llmModel")}"><input type="text" value="${d(l.model||"")}" class="text-xs font-mono bg-transparent border border-neutral-300 dark:border-neutral-700 rounded px-1.5 py-0.5 w-48 focus:outline-none focus:border-blue-500" onchange="window._pages.configuration.updateLLMModel('${d(r)}', this.value)"></td>
            <td class="${u}" data-label="${e("settings.llmApiKey")}">${v}</td>
            <td class="${u}" data-label="${e("settings.llmEnabled")}"><input type="checkbox" ${m} onchange="window._pages.configuration.toggleLLMProvider('${d(r)}', this.checked)"></td>
            <td class="${u}" data-label="${e("settings.llmHealth")}">${h}</td>
            <td class="${V}" data-label="${e("settings.llmActions")}">
                <div class="relative inline-block">
                    <button class="px-1.5 py-0.5 text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 text-sm cursor-pointer" onclick="this.nextElementSibling.classList.toggle('hidden')">&hellip;</button>
                    <div class="hidden absolute right-0 z-20 mt-1 w-40 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-md shadow-lg py-1">
                        <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="this.closest('.relative').querySelector('.hidden')?.classList.add('hidden'); window._pages.configuration.testLLMProvider('${d(r)}')">${e("settings.llmTest")}</button>
                        <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="this.closest('.relative').querySelector('.hidden')?.classList.add('hidden'); window._pages.configuration.editLLMProvider('${d(r)}')">${e("settings.llmEditProvider")}</button>
                        <button class="w-full text-left px-3 py-1.5 text-xs text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950/30 cursor-pointer" onclick="this.closest('.relative').querySelector('.hidden')?.classList.add('hidden'); window._pages.configuration.deleteLLMProvider('${d(r)}')">${e("settings.llmDeleteProvider")}</button>
                    </div>
                </div>
            </td>
        </tr>`}i+=`<tr id="llm-add-row" style="display:none" class="${_}">
            <td class="${u}" data-label="${e("settings.llmProvider")}"><span id="llm-add-key-preview" class="text-xs font-mono text-neutral-400">—</span></td>
            <td class="${u}" data-label="${e("settings.llmType")}"><select id="llm-add-type" class="${ae}" onchange="window._pages.configuration.onAddTypeChange(this.value)">
                <option value="anthropic">anthropic</option>
                <option value="openai">openai</option>
                <option value="deepseek">deepseek</option>
                <option value="gemini">gemini</option>
            </select></td>
            <td class="${u}" data-label="${e("settings.llmModel")}"><input id="llm-add-model" type="text" placeholder="claude-opus-4-20250115" class="text-xs font-mono bg-transparent border border-neutral-300 dark:border-neutral-700 rounded px-1.5 py-0.5 w-48 focus:outline-none focus:border-blue-500" oninput="window._pages.configuration.onAddModelInput()"></td>
            <td class="${u}" data-label="${e("settings.llmApiKey")}"><span id="llm-add-env-preview" class="text-xs font-mono text-neutral-500">ANTHROPIC_API_KEY</span></td>
            <td colspan="3" class="${V}" data-label="${e("settings.llmActions")}">
                <button class="${E} ${T}" onclick="window._pages.configuration.saveNewProvider()">${e("common.save")}</button>
                <button class="${T} ml-1 text-neutral-500" onclick="document.getElementById('llm-add-row').style.display='none'">${e("common.cancel")}</button>
            </td>
        </tr>`,i+="</tbody></table></div>",i+=`<button class="${E} ${T} mt-2" onclick="document.getElementById('llm-add-row').style.display=''">${e("settings.llmAddProvider")}</button>`,i+=`<div id="llm-edit-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/40" style="display:none">
        <div class="bg-white dark:bg-neutral-900 rounded-lg shadow-xl p-6 w-full max-w-md">
            <h3 class="text-lg font-semibold text-neutral-900 dark:text-neutral-50 mb-4">${e("settings.llmEditTitle")}</h3>
            <div class="space-y-3">
                <div>
                    <label class="block text-xs font-medium text-neutral-700 dark:text-neutral-300 mb-1">${e("settings.llmProviderKey")}</label>
                    <input id="llm-edit-key" type="text" class="w-full text-sm font-mono bg-transparent border border-neutral-300 dark:border-neutral-700 rounded px-2 py-1 focus:outline-none focus:border-blue-500" placeholder="openai-gpt41">
                </div>
                <div>
                    <label class="block text-xs font-medium text-neutral-700 dark:text-neutral-300 mb-1">${e("settings.llmType")}</label>
                    <select id="llm-edit-type" class="${ae} w-full">
                        <option value="anthropic">anthropic</option>
                        <option value="openai">openai</option>
                        <option value="deepseek">deepseek</option>
                        <option value="gemini">gemini</option>
                    </select>
                </div>
                <div>
                    <label class="block text-xs font-medium text-neutral-700 dark:text-neutral-300 mb-1">${e("settings.llmModel")}</label>
                    <input id="llm-edit-model" type="text" class="w-full text-sm font-mono bg-transparent border border-neutral-300 dark:border-neutral-700 rounded px-2 py-1 focus:outline-none focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-xs font-medium text-neutral-700 dark:text-neutral-300 mb-1">${e("settings.llmBaseUrl")}</label>
                    <input id="llm-edit-base-url" type="text" class="w-full text-sm font-mono bg-transparent border border-neutral-300 dark:border-neutral-700 rounded px-2 py-1 focus:outline-none focus:border-blue-500" placeholder="https://api.openai.com/v1">
                </div>
                <div>
                    <label class="block text-xs font-medium text-neutral-700 dark:text-neutral-300 mb-1">${e("settings.llmApiKeyEnv")}</label>
                    <input id="llm-edit-api-key-env" type="text" class="w-full text-sm font-mono bg-transparent border border-neutral-300 dark:border-neutral-700 rounded px-2 py-1 focus:outline-none focus:border-blue-500" placeholder="OPENAI_API_KEY">
                </div>
            </div>
            <div class="flex justify-end gap-2 mt-5">
                <button class="${T} border border-neutral-300 dark:border-neutral-600 text-neutral-700 dark:text-neutral-300" onclick="document.getElementById('llm-edit-modal').style.display='none'">${e("common.cancel")}</button>
                <button class="${E} ${T}" onclick="window._pages.configuration.saveEditProvider()">${e("common.save")}</button>
            </div>
        </div>
    </div>`,o.innerHTML=i}function Ui(s){const n=`settings.llmTaskDesc_${s}`,o=`settings.llmTaskRec_${s}`,a=e(n),i=e(o);return a===n?"":`<span class="relative group ml-1 cursor-help">
        <span class="inline-flex items-center justify-center w-4 h-4 rounded-full border border-neutral-400 dark:border-neutral-500 text-neutral-400 dark:text-neutral-500 text-[10px] font-bold leading-none">?</span>
        <span class="pointer-events-none absolute z-50 left-5 -top-1 w-64 p-2 rounded shadow-lg border text-xs bg-white dark:bg-neutral-800 text-neutral-700 dark:text-neutral-200 border-neutral-200 dark:border-neutral-700 opacity-0 group-hover:opacity-100 transition-opacity">
            <span class="block font-semibold mb-1">${d(a)}</span>
            ${i!==o?`<span class="block text-neutral-500 dark:text-neutral-400">${d(i)}</span>`:""}
        </span>
    </span>`}function ho(s){const n=document.getElementById("llmTasksContainer"),o=s.tasks||{},a=Object.keys(s.providers||{});let i=`<h4 class="${Ne}">${e("settings.llmTaskRouting")}</h4>`;i+=`<div class="overflow-x-auto"><table class="${A}">
        <thead><tr>
            <th class="${b}">${e("settings.llmTask")}</th>
            <th class="${b}">${e("settings.llmPrimary")}</th>
            <th class="${b}">${e("settings.llmFallbacks")}</th>
        </tr></thead><tbody>`;for(const[r,l]of Object.entries(o)){const p=l.primary||"",m=l.fallbacks||[],h=a.map(f=>`<option value="${d(f)}" ${f===p?"selected":""}>${d(f)}</option>`).join("");let v='<div class="space-y-1">';m.length>0&&(v+='<ol class="list-none p-0 m-0 space-y-1">',m.forEach((f,y)=>{const $=y===0,w=y===m.length-1;v+=`<li class="flex items-center gap-1 text-xs">
                    <span class="inline-flex items-center justify-center w-4 h-4 rounded-full bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 text-[10px] font-bold flex-shrink-0">${y+1}</span>
                    <span class="font-mono text-neutral-700 dark:text-neutral-300">${d(f)}</span>
                    <span class="inline-flex gap-0.5 ml-auto flex-shrink-0">
                        <button class="px-0.5 text-neutral-400 hover:text-blue-600 disabled:opacity-30 disabled:cursor-default" ${$?"disabled":""} onclick="window._pages.configuration.moveFallback('${d(r)}', ${y}, -1)" title="${e("settings.llmFbMoveUp")}">&#9650;</button>
                        <button class="px-0.5 text-neutral-400 hover:text-blue-600 disabled:opacity-30 disabled:cursor-default" ${w?"disabled":""} onclick="window._pages.configuration.moveFallback('${d(r)}', ${y}, 1)" title="${e("settings.llmFbMoveDown")}">&#9660;</button>
                        <button class="px-0.5 text-neutral-400 hover:text-red-600" onclick="window._pages.configuration.removeFallback('${d(r)}', '${d(f)}')" title="${e("common.delete")}">&#10005;</button>
                    </span>
                </li>`}),v+="</ol>");const x=a.filter(f=>f!==p&&!m.includes(f));if(x.length>0){const f=x.map(y=>`<option value="${d(y)}">${d(y)}</option>`).join("");v+=`<div class="flex items-center gap-1 mt-1">
                <select id="fb-add-${d(r)}" class="text-xs bg-white dark:bg-neutral-800 text-neutral-800 dark:text-neutral-200 border border-neutral-300 dark:border-neutral-600 rounded px-1 py-0.5">
                    <option value="" disabled selected>${e("settings.llmFbSelect")}</option>
                    ${f}
                </select>
                <button class="text-xs text-blue-600 hover:text-blue-800 dark:text-blue-400" onclick="window._pages.configuration.addFallback('${d(r)}')">+ ${e("common.add")}</button>
            </div>`}v+="</div>",i+=`<tr class="${_}">
            <td class="${u}" data-label="${e("settings.llmTask")}"><strong>${d(r)}</strong>${Ui(r)}</td>
            <td class="${u}" data-label="${e("settings.llmPrimary")}"><select class="${ae}" onchange="window._pages.configuration.updateTaskRoute('${d(r)}', this.value)">${h}</select></td>
            <td class="${u}" data-label="${e("settings.llmFallbacks")}">${v}</td>
        </tr>`}i+="</tbody></table></div>",n.innerHTML=i}function Gi(s){let n=document.getElementById("llmSandboxDefaultsContainer");if(!n){const m=document.getElementById("llmTasksContainer");if(m)n=document.createElement("div"),n.id="llmSandboxDefaultsContainer",n.className="mt-4",m.after(n);else return}const o=s.sandbox||{},a=s.providers||{},i=Object.entries(a).filter(([,m])=>m.enabled).map(([m,h])=>({key:m,model:h.model||m,type:h.type||""})),r=o.default_model||"",l=o.auto_customer_model||"";function p(m){let h=`<option value="">${e("common.select")}</option>`;for(const v of i){const x=v.key===m?" selected":"";h+=`<option value="${d(v.key)}"${x}>${d(v.key)} (${d(v.model)})</option>`}return h}if(i.length===0){n.innerHTML=`
            <h4 class="${Ne}">${e("settings.sandboxDefaults")}</h4>
            <p class="${C}">${e("settings.sandboxNoProviders")}</p>`;return}n.innerHTML=`
        <h4 class="${Ne}">${e("settings.sandboxDefaults")}</h4>
        <p class="text-xs text-neutral-500 dark:text-neutral-400 mb-3">${e("settings.sandboxDefaultsHint")}</p>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-3">
            <div>
                <label class="block text-xs font-medium text-neutral-700 dark:text-neutral-300 mb-1">${e("settings.sandboxDefaultModel")}</label>
                <select id="sandboxDefaultModelSelect" class="${ae} w-full">${p(r)}</select>
            </div>
            <div>
                <label class="block text-xs font-medium text-neutral-700 dark:text-neutral-300 mb-1">${e("settings.sandboxAutoCustomerModel")}</label>
                <select id="sandboxAutoCustomerModelSelect" class="${ae} w-full">${p(l)}</select>
            </div>
        </div>
        <button class="${E} ${T}" onclick="window._pages.configuration.saveSandboxDefaults()">${e("common.save")}</button>`}async function zi(){var o,a;const s=((o=document.getElementById("sandboxDefaultModelSelect"))==null?void 0:o.value)||"",n=((a=document.getElementById("sandboxAutoCustomerModelSelect"))==null?void 0:a.value)||"";try{await g("/admin/llm/config",{method:"PATCH",body:JSON.stringify({sandbox:{default_model:s,auto_customer_model:n}})}),O&&(O.sandbox={default_model:s,auto_customer_model:n}),c(e("settings.sandboxDefaultsSaved"),"success")}catch(i){c(e("settings.llmConfigFailed",{error:i.message}),"error")}}const Hs={anthropic:{api_key_env:"ANTHROPIC_API_KEY"},openai:{api_key_env:"OPENAI_API_KEY",base_url:"https://api.openai.com/v1"},deepseek:{api_key_env:"DEEPSEEK_API_KEY",base_url:"https://api.deepseek.com/v1"},gemini:{api_key_env:"GEMINI_API_KEY",base_url:"https://generativelanguage.googleapis.com/v1beta/openai"}};function bo(){const s=document.getElementById("llm-add-type").value,n=document.getElementById("llm-add-model").value.trim();if(!n)return"";const o=n.replace(/^claude-/,"").replace(/^gpt-/,"gpt").split("-")[0]||n;return`${s}-${o}`}function vo(){const s=bo(),n=document.getElementById("llm-add-type").value,o=Hs[n]||{};document.getElementById("llm-add-key-preview").textContent=s||"—",document.getElementById("llm-add-env-preview").textContent=o.api_key_env||""}function Vi(){vo()}function ji(){vo()}async function Wi(){var l;const s=document.getElementById("llm-add-type").value,n=document.getElementById("llm-add-model").value.trim(),o=bo(),a=((l=Hs[s])==null?void 0:l.api_key_env)||"";if(!n){c(e("settings.llmAddFillRequired"),"error");return}const i={type:s,model:n,api_key_env:a,enabled:!1},r=Hs[s];r!=null&&r.base_url&&(i.base_url=r.base_url);try{await g("/admin/llm/config",{method:"PATCH",body:JSON.stringify({providers:{[o]:i}})}),c(e("settings.llmProviderAdded",{key:o}),"success"),He()}catch(p){c(e("settings.llmConfigFailed",{error:p.message}),"error")}}async function Ji(s,n){if(n.trim())try{await g("/admin/llm/config",{method:"PATCH",body:JSON.stringify({providers:{[s]:{model:n.trim()}}})}),c(e("settings.llmModelUpdated",{key:s,model:n.trim()}),"success")}catch(o){c(e("settings.llmConfigFailed",{error:o.message}),"error"),He()}}async function Qi(s,n){try{await g("/admin/llm/config",{method:"PATCH",body:JSON.stringify({providers:{[s]:{enabled:n}}})}),c(e("settings.llmProviderToggled",{key:s,state:n?"ON":"OFF"}),"success")}catch(o){c(e("settings.llmConfigFailed",{error:o.message}),"error"),He()}}async function Yi(s,n){try{await g("/admin/llm/config",{method:"PATCH",body:JSON.stringify({tasks:{[s]:{primary:n,fallbacks:[]}}})}),c(e("settings.llmRouteUpdated",{task:s,provider:n}),"success"),He()}catch(o){c(e("settings.llmConfigFailed",{error:o.message}),"error")}}async function tn(s,n){try{await g("/admin/llm/config",{method:"PATCH",body:JSON.stringify({tasks:{[s]:{fallbacks:n}}})}),O&&O.tasks&&O.tasks[s]&&(O.tasks[s].fallbacks=n),ho(O),c(e("settings.llmFallbacksUpdated",{task:s,count:n.length}),"success")}catch(o){c(e("settings.llmConfigFailed",{error:o.message}),"error")}}async function Xi(s){var i,r;const n=document.getElementById(`fb-add-${s}`);if(!n)return;const o=n.value;if(!o)return;const a=(((r=(i=O==null?void 0:O.tasks)==null?void 0:i[s])==null?void 0:r.fallbacks)||[]).slice();a.includes(o)||(a.push(o),await tn(s,a))}async function Zi(s,n){var a,i;const o=(((i=(a=O==null?void 0:O.tasks)==null?void 0:a[s])==null?void 0:i.fallbacks)||[]).filter(r=>r!==n);await tn(s,o)}async function el(s,n,o){var r,l;const a=(((l=(r=O==null?void 0:O.tasks)==null?void 0:r[s])==null?void 0:l.fallbacks)||[]).slice(),i=n+o;i<0||i>=a.length||([a[n],a[i]]=[a[i],a[n]],await tn(s,a))}let ns=null;function tl(s){var o;const n=(o=O==null?void 0:O.providers)==null?void 0:o[s];n&&(ns=s,document.getElementById("llm-edit-key").value=s,document.getElementById("llm-edit-type").value=n.type||"openai",document.getElementById("llm-edit-model").value=n.model||"",document.getElementById("llm-edit-base-url").value=n.base_url||"",document.getElementById("llm-edit-api-key-env").value=n.api_key_env||"",document.getElementById("llm-edit-modal").style.display="")}async function sl(){var h;if(!ns)return;const s=ns,n=document.getElementById("llm-edit-key").value.trim(),o=document.getElementById("llm-edit-type").value,a=document.getElementById("llm-edit-model").value.trim(),i=document.getElementById("llm-edit-base-url").value.trim(),r=document.getElementById("llm-edit-api-key-env").value.trim();if(!n){c(e("settings.llmAddFillRequired"),"error");return}const l=n!==s,p=((h=O==null?void 0:O.providers)==null?void 0:h[s])||{},m={type:o,model:a,enabled:p.enabled??!1};i&&(m.base_url=i),r&&(m.api_key_env=r);try{if(l){const v=(O==null?void 0:O.tasks)||{},x={};for(const[y,$]of Object.entries(v)){const w={};$.primary===s&&(w.primary=n);const S=$.fallbacks||[];S.includes(s)&&(w.fallbacks=S.map(B=>B===s?n:B)),Object.keys(w).length>0&&(x[y]=w)}const f={providers:{[n]:m}};Object.keys(x).length>0&&(f.tasks=x),await g("/admin/llm/config",{method:"PATCH",body:JSON.stringify(f)}),await g(`/admin/llm/config/providers/${encodeURIComponent(s)}`,{method:"DELETE"}),c(e("settings.llmProviderRenamed",{oldKey:s,newKey:n}),"success")}else await g("/admin/llm/config",{method:"PATCH",body:JSON.stringify({providers:{[s]:m}})}),c(e("settings.llmProviderUpdated",{key:s}),"success");document.getElementById("llm-edit-modal").style.display="none",ns=null,He()}catch(v){c(e("settings.llmConfigFailed",{error:v.message}),"error")}}async function nl(s){if(confirm(e("settings.llmDeleteConfirm",{key:s})))try{await g(`/admin/llm/config/providers/${encodeURIComponent(s)}`,{method:"DELETE"}),c(e("settings.llmProviderDeleted",{key:s}),"success"),He()}catch(n){let o=n.message;try{const a=JSON.parse(n.message);a.detail&&(o=a.detail)}catch{}if(n.status===409||o.includes("used in tasks")){const a=o.replace(/^.*tasks:\s*/,"");c(e("settings.llmProviderInUse",{tasks:a}),"error")}else c(e("settings.llmConfigFailed",{error:o}),"error")}}async function ol(s){c(e("settings.llmTesting",{key:s}),"info");try{const n=await g(`/admin/llm/providers/${encodeURIComponent(s)}/test`,{method:"POST"});n.success?c(e("settings.llmTestSuccess",{key:s,latency:n.latency_ms}),"success"):c(e("settings.llmTestFailed",{key:s,error:n.error||"Unknown"}),"error")}catch(n){c(e("settings.llmTestFailed",{key:s,error:n.message}),"error")}}async function fo(){const s=document.getElementById("ttsConfigContainer");if(s){s.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;try{const n=await g("/admin/tts/config");de=n,sn(n)}catch(n){s.innerHTML=`<div class="${k}">${e("settings.ttsLoadFailed",{error:d(n.message)})}</div>`}}}function st(s,n,o){return`<div>
        <label class="block text-xs font-medium text-neutral-700 dark:text-neutral-300 mb-1">
            ${e(n)}: <span id="${s}Value" class="font-mono">${o}</span><span class="text-neutral-400">мс</span>
        </label>
        <input id="${s}Range" type="range" min="0" max="500" step="10" value="${o}"
            class="w-full max-w-xs accent-blue-600"
            oninput="document.getElementById('${s}Value').textContent = this.value">
        <div class="flex justify-between text-[10px] text-neutral-400 max-w-xs"><span>0</span><span>250</span><span>500</span></div>
    </div>`}function sn(s){const n=document.getElementById("ttsConfigContainer");if(!n)return;const o=s.config||{},a=s.source||"env",i=s.known_voices||[],r=o.voice_name||"uk-UA-Wavenet-A",l=o.speaking_rate??.93,p=o.pitch??-1,m=o.break_comma_ms??100,h=o.break_period_ms??200,v=o.break_exclamation_ms??250,x=o.break_colon_ms??200,f=o.break_semicolon_ms??150,y=o.break_em_dash_ms??150,$=a==="redis"?`<span class="${L}">Redis</span>`:`<span class="${M}">env</span>`,w=i.map(I=>`<option value="${d(I)}" ${I===r?"selected":""}>${d(I)}</option>`).join(""),B=!i.includes(r)?`<option value="${d(r)}" selected>${d(r)} (custom)</option>`:"";n.innerHTML=`
        <div class="space-y-4">
            <div class="flex items-center gap-2 text-xs text-neutral-500 dark:text-neutral-400">
                ${e("settings.ttsSource")}: ${$}
            </div>
            <div>
                <label class="block text-xs font-medium text-neutral-700 dark:text-neutral-300 mb-1">${e("settings.ttsVoice")}</label>
                <select id="ttsVoiceSelect" class="${ae} w-full max-w-xs">
                    ${B}${w}
                </select>
            </div>
            <div>
                <label class="block text-xs font-medium text-neutral-700 dark:text-neutral-300 mb-1">
                    ${e("settings.ttsSpeakingRate")}: <span id="ttsRateValue" class="font-mono">${l.toFixed(2)}</span>
                </label>
                <input id="ttsRateRange" type="range" min="0.25" max="4.0" step="0.01" value="${l}"
                    class="w-full max-w-xs accent-blue-600"
                    oninput="document.getElementById('ttsRateValue').textContent = parseFloat(this.value).toFixed(2)">
                <div class="flex justify-between text-[10px] text-neutral-400 max-w-xs"><span>0.25</span><span>1.0</span><span>4.0</span></div>
            </div>
            <div>
                <label class="block text-xs font-medium text-neutral-700 dark:text-neutral-300 mb-1">
                    ${e("settings.ttsPitch")}: <span id="ttsPitchValue" class="font-mono">${p.toFixed(1)}</span>
                </label>
                <input id="ttsPitchRange" type="range" min="-20" max="20" step="0.5" value="${p}"
                    class="w-full max-w-xs accent-blue-600"
                    oninput="document.getElementById('ttsPitchValue').textContent = parseFloat(this.value).toFixed(1)">
                <div class="flex justify-between text-[10px] text-neutral-400 max-w-xs"><span>-20</span><span>0</span><span>+20</span></div>
            </div>

            <details class="mt-2">
                <summary class="cursor-pointer text-xs font-medium text-neutral-700 dark:text-neutral-300 select-none">
                    ${e("settings.ttsBreaksTitle")}
                </summary>
                <p class="text-[11px] text-neutral-500 dark:text-neutral-400 mt-1 mb-2">${e("settings.ttsBreaksDesc")}</p>
                <div class="space-y-3 pl-1">
                    ${st("ttsBreakComma","settings.ttsBreakComma",m)}
                    ${st("ttsBreakPeriod","settings.ttsBreakPeriod",h)}
                    ${st("ttsBreakExclamation","settings.ttsBreakExclamation",v)}
                    ${st("ttsBreakColon","settings.ttsBreakColon",x)}
                    ${st("ttsBreakSemicolon","settings.ttsBreakSemicolon",f)}
                    ${st("ttsBreakEmDash","settings.ttsBreakEmDash",y)}
                </div>
            </details>

            <div class="flex flex-wrap items-center gap-2 pt-2">
                <button class="${E} ${T}" onclick="window._pages.configuration.saveTTSConfig()">${e("common.save")}</button>
                <button class="${T} border border-neutral-300 dark:border-neutral-600 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-800" onclick="window._pages.configuration.testTTS()">${e("settings.ttsTest")}</button>
                <button class="${T} text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20" onclick="window._pages.configuration.resetTTSConfig()">${e("settings.ttsReset")}</button>
            </div>
            <div id="ttsTestResult"></div>
        </div>`}async function al(){var r,l,p;const s=(r=document.getElementById("ttsVoiceSelect"))==null?void 0:r.value,n=parseFloat((l=document.getElementById("ttsRateRange"))==null?void 0:l.value),o=parseFloat((p=document.getElementById("ttsPitchRange"))==null?void 0:p.value),a={voice_name:s,speaking_rate:n,pitch:o},i=[["ttsBreakCommaRange","break_comma_ms"],["ttsBreakPeriodRange","break_period_ms"],["ttsBreakExclamationRange","break_exclamation_ms"],["ttsBreakColonRange","break_colon_ms"],["ttsBreakSemicolonRange","break_semicolon_ms"],["ttsBreakEmDashRange","break_em_dash_ms"]];for(const[m,h]of i){const v=document.getElementById(m);v&&(a[h]=parseInt(v.value,10))}try{const m=await g("/admin/tts/config",{method:"PATCH",body:JSON.stringify(a)});de={config:m.config,source:m.source,known_voices:(de==null?void 0:de.known_voices)||[]},sn(de),c(e("settings.ttsSaved"),"success")}catch(m){c(e("settings.ttsSaveFailed",{error:m.message}),"error")}}async function rl(){const s=document.getElementById("ttsTestResult");s&&(s.innerHTML=`<div class="text-xs text-neutral-500 py-2">${e("settings.ttsTesting")}</div>`);try{const n=await g("/admin/tts/test",{method:"POST"});n.success&&n.audio_base64?s&&(s.innerHTML=`
                    <div class="mt-2 p-3 bg-neutral-50 dark:bg-neutral-800 rounded-lg">
                        <div class="text-xs text-neutral-500 dark:text-neutral-400 mb-2">${e("settings.ttsTestSuccess",{duration:n.duration_ms})}</div>
                        <audio controls autoplay src="data:audio/wav;base64,${n.audio_base64}" class="w-full max-w-xs"></audio>
                    </div>`):(c(e("settings.ttsTestFailed",{error:n.error||"Unknown"}),"error"),s&&(s.innerHTML=""))}catch(n){c(e("settings.ttsTestFailed",{error:n.message}),"error"),s&&(s.innerHTML="")}}async function il(){if(confirm(e("settings.ttsResetConfirm")))try{const s=await g("/admin/tts/config/reset",{method:"POST"});de={config:s.config,source:s.source,known_voices:(de==null?void 0:de.known_voices)||[]},sn(de),c(e("settings.ttsResetDone"),"success")}catch(s){c(e("settings.ttsSaveFailed",{error:s.message}),"error")}}const ll=["settings.taskDayMon","settings.taskDayTue","settings.taskDayWed","settings.taskDayThu","settings.taskDayFri","settings.taskDaySat","settings.taskDaySun"];async function yo(){const s=document.getElementById("taskSchedulesContainer");if(s){s.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;try{const n=await g("/admin/task-schedules");en=n.schedules,nn(n.schedules)}catch(n){s.innerHTML=`<div class="${k}">${e("settings.taskLoadFailed",{error:d(n.message)})}</div>`}}}function nn(s){const n=document.getElementById("taskSchedulesContainer");if(!n)return;let o='<div class="space-y-4">';for(const[a,i]of Object.entries(s)){const r=`settings.taskLabel_${a}`,l=e(r)!==r?e(r):i.label||a,p=i.enabled!==!1,m=i.frequency||"daily",h=i.hour??0,v=i.day_of_week??0,x=p?`<span class="${L}">${e("settings.taskEnabled")}</span>`:`<span class="${D}">${e("settings.taskDisabled")}</span>`;let f="";for(let $=0;$<=23;$++)f+=`<option value="${$}"${$===h?" selected":""}>${String($).padStart(2,"0")}:00</option>`;let y="";for(let $=0;$<=6;$++)y+=`<option value="${$}"${$===v?" selected":""}>${e(ll[$])}</option>`;o+=`
        <div class="p-4 border border-neutral-200 dark:border-neutral-700 rounded-lg">
            <div class="flex items-center justify-between mb-3">
                <div class="flex items-center gap-2">
                    <strong class="text-sm text-neutral-900 dark:text-neutral-50">${d(l)}</strong>
                    ${x}
                </div>
                <div class="flex items-center gap-2">
                    <label class="text-xs text-neutral-500 dark:text-neutral-400 flex items-center gap-1">
                        <input type="checkbox" id="taskEnabled_${a}" ${p?"checked":""}>
                        ${e("settings.taskEnabled")}
                    </label>
                </div>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 mb-3">
                <div>
                    <label class="block text-xs font-medium text-neutral-700 dark:text-neutral-300 mb-1">${e("settings.taskFrequency")}</label>
                    <select id="taskFreq_${a}" class="${ae} w-full" onchange="window._pages.configuration.onFreqChange('${a}')">
                        <option value="daily" ${m==="daily"?"selected":""}>${e("settings.taskFreqDaily")}</option>
                        <option value="weekly" ${m==="weekly"?"selected":""}>${e("settings.taskFreqWeekly")}</option>
                    </select>
                </div>
                <div>
                    <label class="block text-xs font-medium text-neutral-700 dark:text-neutral-300 mb-1">${e("settings.taskHour")}</label>
                    <select id="taskHour_${a}" class="${ae} w-full">${f}</select>
                </div>
                <div id="taskDowWrap_${a}" style="${m==="weekly"?"":"display:none"}">
                    <label class="block text-xs font-medium text-neutral-700 dark:text-neutral-300 mb-1">${e("settings.taskDayOfWeek")}</label>
                    <select id="taskDow_${a}" class="${ae} w-full">${y}</select>
                </div>
            </div>
            <div class="flex flex-wrap items-center gap-2">
                <button class="${E} ${T}" onclick="window._pages.configuration.saveSchedule('${a}')">${e("common.save")}</button>
                <button class="${T} border border-neutral-300 dark:border-neutral-600 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-800" onclick="window._pages.configuration.runTask('${a}')">${e("settings.taskRunNow")}</button>
            </div>
        </div>`}o+=`<div class="pt-2">
        <button class="${T} text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20" onclick="window._pages.configuration.resetSchedules()">${e("settings.taskResetAll")}</button>
    </div></div>`,n.innerHTML=o}function dl(s){var a;const n=(a=document.getElementById(`taskFreq_${s}`))==null?void 0:a.value,o=document.getElementById(`taskDowWrap_${s}`);o&&(o.style.display=n==="weekly"?"":"none")}async function cl(s){var l,p,m,h;const n=((l=document.getElementById(`taskEnabled_${s}`))==null?void 0:l.checked)??!0,o=((p=document.getElementById(`taskFreq_${s}`))==null?void 0:p.value)||"daily",a=parseInt(((m=document.getElementById(`taskHour_${s}`))==null?void 0:m.value)||"0",10),i=parseInt(((h=document.getElementById(`taskDow_${s}`))==null?void 0:h.value)||"0",10),r={enabled:n,frequency:o,hour:a};o==="weekly"&&(r.day_of_week=i);try{const v=await g("/admin/task-schedules",{method:"PATCH",body:JSON.stringify({[s]:r})});en=v.schedules,nn(v.schedules),c(e("settings.taskSaved"),"success")}catch(v){c(e("settings.taskSaveFailed",{error:v.message}),"error")}}async function pl(s){try{const n=await g(`/admin/task-schedules/${encodeURIComponent(s)}/run`,{method:"POST"});c(e("settings.taskRunQueued",{task:s,id:n.task_id}),"success")}catch(n){c(e("settings.taskRunFailed",{error:n.message}),"error")}}async function ul(){if(confirm(e("settings.taskResetConfirm")))try{const s=await g("/admin/task-schedules/reset",{method:"POST"});en=s.schedules,nn(s.schedules),c(e("settings.taskResetDone"),"success")}catch(s){c(e("settings.taskSaveFailed",{error:s.message}),"error")}}async function xo(){const s=document.getElementById("testPhonesContainer");if(s){s.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;try{Nt=(await g("/admin/test-phones/config")).phones||{},on()}catch(n){s.innerHTML=`<div class="${k}">${e("settings.testPhonesLoadFailed",{error:d(n.message)})}</div>`}}}function on(){const s=document.getElementById("testPhonesContainer");if(!s)return;const n=Object.entries(Nt);let o='<div class="space-y-3">';if(n.length>0){o+=`<table class="w-full text-sm">
            <thead><tr class="text-left text-xs text-neutral-500 dark:text-neutral-400 border-b border-neutral-200 dark:border-neutral-700">
                <th class="pb-2 font-medium">${e("settings.testPhonesNumber")}</th>
                <th class="pb-2 font-medium">${e("settings.testPhonesMode")}</th>
                <th class="pb-2 font-medium">${e("settings.testPhonesActions")}</th>
            </tr></thead><tbody>`;for(const[a,i]of n)o+=`<tr class="border-b border-neutral-100 dark:border-neutral-800">
                <td class="py-2 font-mono text-neutral-900 dark:text-neutral-100">${d(a)}</td>
                <td class="py-2">
                    <select class="${ae}" onchange="window._pages.configuration.updateTestPhoneMode('${d(a)}', this.value)">
                        <option value="no_history" ${i==="no_history"?"selected":""}>${e("settings.testPhonesModeNoHistory")}</option>
                        <option value="with_history" ${i==="with_history"?"selected":""}>${e("settings.testPhonesModeWithHistory")}</option>
                    </select>
                </td>
                <td class="py-2">
                    <div class="flex gap-1">
                        <button class="${T} text-orange-600 dark:text-orange-400 hover:bg-orange-50 dark:hover:bg-orange-900/20" onclick="window._pages.configuration.clearPhoneHistory('${d(a)}')">${e("settings.testPhonesClearHistory")}</button>
                        <button class="${T} text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20" onclick="window._pages.configuration.removeTestPhone('${d(a)}')">${e("common.delete")}</button>
                    </div>
                </td>
            </tr>`;o+="</tbody></table>"}else o+=`<div class="text-sm text-neutral-400 dark:text-neutral-500 py-2">${e("settings.testPhonesEmpty")}</div>`;o+=`<div class="flex items-end gap-2 pt-2 border-t border-neutral-200 dark:border-neutral-700 mt-2">
        <div>
            <label class="block text-xs font-medium text-neutral-700 dark:text-neutral-300 mb-1">${e("settings.testPhonesNumber")}</label>
            <input id="newTestPhone" type="text" placeholder="0501234567" class="${ae} w-40 font-mono">
        </div>
        <div>
            <label class="block text-xs font-medium text-neutral-700 dark:text-neutral-300 mb-1">${e("settings.testPhonesMode")}</label>
            <select id="newTestPhoneMode" class="${ae}">
                <option value="no_history">${e("settings.testPhonesModeNoHistory")}</option>
                <option value="with_history">${e("settings.testPhonesModeWithHistory")}</option>
            </select>
        </div>
        <button class="${E} ${T}" onclick="window._pages.configuration.addTestPhone()">${e("common.add")}</button>
    </div>`,o+="</div>",s.innerHTML=o}async function gl(){var i;const s=document.getElementById("newTestPhone"),n=document.getElementById("newTestPhoneMode"),o=(i=s==null?void 0:s.value)==null?void 0:i.trim(),a=(n==null?void 0:n.value)||"no_history";if(o)try{const r=await g("/admin/test-phones/config",{method:"PUT",body:JSON.stringify({phone:o,mode:a})});Nt=r.phones,on(),c(e("settings.testPhonesAdded",{phone:r.phone}),"success")}catch(r){c(e("settings.testPhonesSaveFailed",{error:r.message}),"error")}}async function ml(s,n){try{Nt=(await g("/admin/test-phones/config",{method:"PUT",body:JSON.stringify({phone:s,mode:n})})).phones,c(e("settings.testPhonesModeUpdated",{phone:s}),"success")}catch(o){c(e("settings.testPhonesSaveFailed",{error:o.message}),"error")}}async function hl(s){if(confirm(e("settings.testPhonesRemoveConfirm",{phone:s})))try{Nt=(await g(`/admin/test-phones/config/${encodeURIComponent(s)}`,{method:"DELETE"})).phones,on(),c(e("settings.testPhonesRemoved",{phone:s}),"success")}catch(n){c(e("settings.testPhonesSaveFailed",{error:n.message}),"error")}}async function bl(s){if(confirm(e("settings.testPhonesClearConfirm",{phone:s})))try{const n=await g(`/admin/test-phones/clear-history/${encodeURIComponent(s)}`,{method:"POST"});c(e("settings.testPhonesClearDone",{phone:n.phone,calls:n.calls_deleted,turns:n.turns_deleted,tools:n.tool_calls_deleted}),"success")}catch(n){c(e("settings.testPhonesClearFailed",{error:n.message}),"error")}}function vl(){j("configuration",()=>{He(),fo(),yo(),xo()})}window._pages=window._pages||{};window._pages.configuration={reloadConfig:Ki,loadLLMConfig:He,toggleLLMProvider:Qi,updateLLMModel:Ji,onAddTypeChange:Vi,onAddModelInput:ji,saveNewProvider:Wi,editLLMProvider:tl,saveEditProvider:sl,deleteLLMProvider:nl,updateTaskRoute:Yi,addFallback:Xi,removeFallback:Zi,moveFallback:el,testLLMProvider:ol,saveSandboxDefaults:zi,loadTTSConfig:fo,saveTTSConfig:al,testTTS:rl,resetTTSConfig:il,loadTaskSchedules:yo,saveSchedule:cl,runTask:pl,resetSchedules:ul,onFreqChange:dl,loadTestPhones:xo,addTestPhone:gl,updateTestPhoneMode:ml,removeTestPhone:hl,clearPhoneHistory:bl};let $s=0,fl="last_call_at",yl="desc";async function is(s=0){$s=s;const n=document.getElementById("customersLoading"),o=document.querySelector("#customersTable tbody");n.style.display="flex";try{const a=re({offset:$s,filters:{search:"customersSearch"}});a.set("sort_by",fl),a.set("sort_dir",yl);const i=await g(`/admin/customers?${a.toString()}`);n.style.display="none";const r=i.customers||[];if(r.length===0){o.innerHTML=`<tr><td colspan="6" class="${k}">${e("customers.noCustomers")}</td></tr>`,K({containerId:"customersPagination",total:0,offset:0,onPage:is});return}o.innerHTML=r.map(l=>{const p=Array.isArray(l.vehicles)?l.vehicles.length:0;return`
            <tr class="${_} cursor-pointer" onclick="window._pages.customers.showDetail('${d(l.id)}')">
                <td class="${u}" data-label="${e("customers.phone")}">${d(l.phone)}</td>
                <td class="${u}" data-label="${e("customers.name")}">${d(l.name||"-")}</td>
                <td class="${u}" data-label="${e("customers.city")}">${d(l.city||"-")}</td>
                <td class="${u}" data-label="${e("customers.vehicles")}">${p}</td>
                <td class="${u}" data-label="${e("customers.totalCalls")}">${l.total_calls||0}</td>
                <td class="${u}" data-label="${e("customers.lastCall")}" data-sort-value="${l.last_call_at||""}">${z(l.last_call_at)}</td>
            </tr>`}).join(""),Q("customersTable"),K({containerId:"customersPagination",total:i.total,offset:$s,onPage:is})}catch(a){n.style.display="none",o.innerHTML=`<tr><td colspan="6" class="${k}">${e("customers.loadFailed",{error:d(a.message)})}
            <br><button class="${E} ${T} mt-2" onclick="window._pages.customers.loadCustomers()">${e("common.retry")}</button></td></tr>`}}async function xl(s){const n=document.getElementById("customerDetailBody");n.innerHTML='<div class="flex justify-center py-8"><div class="spinner"></div></div>',document.getElementById("customerDetailModal").classList.add("show");try{const o=await g(`/admin/customers/${s}`),a=o.customer,i=o.recent_calls||[],r=Array.isArray(a.vehicles)?a.vehicles:[];let l;r.length===0?l=`<p class="${C}">${e("customers.noVehicles")}</p>`:l=`<table class="w-full text-sm mb-2">
                <thead><tr>
                    <th class="${b}">${e("customers.vehiclePlate")}</th>
                    <th class="${b}">${e("customers.vehicleModel")}</th>
                    <th class="${b}">${e("customers.vehicleTires")}</th>
                </tr></thead>
                <tbody>${r.map(m=>`<tr class="${_}">
                    <td class="${u}">${d(m.plate||"-")}</td>
                    <td class="${u}">${d(m.brand||m.model||"-")}</td>
                    <td class="${u}">${d(m.tire_size||"-")}</td>
                </tr>`).join("")}</tbody>
            </table>`;let p;i.length===0?p=`<p class="${C}">${e("customers.noRecentCalls")}</p>`:p=`<table class="w-full text-sm">
                <thead><tr>
                    <th class="${b}">${e("customers.callDate")}</th>
                    <th class="${b}">${e("customers.callDuration")}</th>
                    <th class="${b}">${e("customers.callScenario")}</th>
                    <th class="${b}">${e("customers.callTransferred")}</th>
                </tr></thead>
                <tbody>${i.map(m=>`<tr class="${_}">
                    <td class="${u}">${z(m.started_at)}</td>
                    <td class="${u}">${m.duration_seconds!=null?m.duration_seconds+"s":"-"}</td>
                    <td class="${u}">${d(m.scenario||"-")}</td>
                    <td class="${u}">${m.transferred_to_operator?`<span class="${q}">${e("common.yes")}</span>`:`<span class="${L}">${e("common.no")}</span>`}</td>
                </tr>`).join("")}</tbody>
            </table>`,n.innerHTML=`
            <div class="space-y-4 p-4">
                <div class="grid grid-cols-2 gap-3">
                    <div><span class="text-xs text-neutral-500 dark:text-neutral-400">${e("customers.phone")}</span><div class="font-medium">${d(a.phone)}</div></div>
                    <div><span class="text-xs text-neutral-500 dark:text-neutral-400">${e("customers.name")}</span><div class="font-medium">${d(a.name||"-")}</div></div>
                    <div><span class="text-xs text-neutral-500 dark:text-neutral-400">${e("customers.city")}</span><div class="font-medium">${d(a.city||"-")}</div></div>
                    <div><span class="text-xs text-neutral-500 dark:text-neutral-400">${e("customers.deliveryAddress")}</span><div class="font-medium">${d(a.delivery_address||e("customers.noAddress"))}</div></div>
                    <div><span class="text-xs text-neutral-500 dark:text-neutral-400">${e("customers.totalCalls")}</span><div class="font-medium">${a.total_calls||0}</div></div>
                    <div><span class="text-xs text-neutral-500 dark:text-neutral-400">${e("customers.firstCall")}</span><div class="font-medium">${z(a.first_call_at)}</div></div>
                </div>
                <div>
                    <h3 class="text-sm font-semibold text-neutral-900 dark:text-neutral-50 mb-2">${e("customers.vehicles")}</h3>
                    ${l}
                </div>
                <div>
                    <h3 class="text-sm font-semibold text-neutral-900 dark:text-neutral-50 mb-2">${e("customers.recentCalls")}</h3>
                    ${p}
                </div>
                <div class="flex justify-end pt-2">
                    <button class="${G} ${T}" onclick="window._app.closeModal('customerDetailModal')">${e("common.close")}</button>
                </div>
            </div>`}catch(o){n.innerHTML=`<div class="${k} p-4">${e("customers.loadFailed",{error:d(o.message)})}</div>`}}function $l(){j("customers",()=>is())}window._pages=window._pages||{};window._pages.customers={loadCustomers:is,showDetail:xl};let ut=0,It=[];const $o=["get_vehicle_tire_sizes","search_tires","check_availability","transfer_to_operator","get_order_status","create_order_draft","update_order_delivery","confirm_order","get_fitting_stations","get_fitting_slots","book_fitting","search_knowledge_base"];async function wo(){if(!(It.length>0))try{It=((await g("/admin/training/tools")).tools||[]).map(n=>n.name)}catch{It=$o}}async function xt(s){s!==void 0&&(ut=s);const n=document.getElementById("tenantsContainer");if(!n)return;n.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;const o=re({offset:ut,filters:{is_active:"tenantsActiveFilter"}});try{const a=await g(`/admin/tenants?${o}`),i=a.tenants||[];if(i.length===0){n.innerHTML=`<div class="${k}">${e("tenants.noTenants")}</div>`,K({containerId:"tenantsPagination",total:0,offset:0});return}n.innerHTML=`
            <div class="overflow-x-auto min-h-[480px]"><table class="${A}" id="tenantsTable"><thead><tr>
                <th class="${P}" data-sortable>${e("tenants.slug")}</th>
                <th class="${P}" data-sortable>${e("tenants.name")}</th>
                <th class="${P}" data-sortable>${e("tenants.networkId")}</th>
                <th class="${b}">${e("tenants.extensions")}</th>
                <th class="${b}">${e("tenants.agentName")}</th>
                <th class="${b}">${e("tenants.enabledTools")}</th>
                <th class="${P}" data-sortable>${e("tenants.statusCol")}</th>
                <th class="${b}">${e("tenants.actions")}</th>
            </tr></thead><tbody>
            ${i.map(r=>{const l=(r.enabled_tools||[]).length,p=l>0?`<span class="${M}">${l} tools</span>`:`<span class="${C} text-xs">${e("common.all")}</span>`,m=r.is_active?`<span class="${L}">${e("tenants.active")}</span>`:`<span class="${D}">${e("tenants.inactive")}</span>`;return`
                <tr class="${_}">
                    <td class="${u}"><span class="font-mono text-xs">${d(r.slug)}</span></td>
                    <td class="${u}">${d(r.name)}</td>
                    <td class="${u}"><span class="font-mono text-xs">${d(r.network_id)}</span></td>
                    <td class="${u}">${(r.extensions||[]).length>0?(r.extensions||[]).map(h=>`<span class="font-mono text-xs inline-block bg-neutral-100 dark:bg-neutral-800 rounded px-1.5 py-0.5 mr-1">${d(h)}</span>`).join(""):`<span class="${C} text-xs">—</span>`}</td>
                    <td class="${u}">${d(r.agent_name||"Олена")}</td>
                    <td class="${u}">${p}</td>
                    <td class="${u}" data-sort-value="${r.is_active?1:0}">${m}</td>
                    <td class="${u}">
                        <div class="relative inline-block">
                            <button class="px-1.5 py-0.5 text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 text-sm cursor-pointer" onclick="this.nextElementSibling.classList.toggle('hidden')">&hellip;</button>
                            <div class="hidden absolute right-0 z-20 mt-1 w-40 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-md shadow-lg py-1">
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.tenants.editTenant('${r.id}')">${e("common.edit")}</button>
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.tenants.toggleTenant('${r.id}', ${r.is_active})">${r.is_active?e("common.deactivate"):e("common.activate")}</button>
                                <button class="w-full text-left px-3 py-1.5 text-xs text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950/30 cursor-pointer" data-id="${d(r.id)}" data-name="${d(r.name)}" onclick="window._pages.tenants.deleteTenant(this.dataset.id, this.dataset.name)">${e("common.delete")}</button>
                            </div>
                        </div>
                    </td>
                </tr>`}).join("")}
            </tbody></table></div>
            <p class="${C} mt-2">${e("common.showing",{shown:i.length,total:a.total})}</p>`,Q("tenantsTable"),K({containerId:"tenantsPagination",total:a.total,offset:ut,onPage:r=>xt(r)})}catch(a){n.innerHTML=`<div class="${k}">${e("tenants.loadFailed",{error:d(a.message)})}
            <br><button class="${E} ${T} mt-2" onclick="window._pages.tenants.loadTenants()">${e("common.retry")}</button></div>`}}function ko(s){const n=It.length>0?It:$o,o=new Set(s||[]);return n.map(a=>`
        <label class="flex items-center gap-1.5 text-xs cursor-pointer">
            <input type="checkbox" value="${d(a)}" ${o.has(a)?"checked":""} class="tenant-tool-cb">
            <span class="font-mono">${d(a)}</span>
        </label>
    `).join("")}async function wl(){await wo(),document.getElementById("tenantModalTitle").textContent=e("tenants.newTenant"),document.getElementById("editTenantId").value="",document.getElementById("tenantSlug").value="",document.getElementById("tenantSlug").removeAttribute("readonly"),document.getElementById("tenantName").value="",document.getElementById("tenantNetworkId").value="",document.getElementById("tenantExtensions").value="",document.getElementById("tenantAgentName").value="Олена",document.getElementById("tenantGreeting").value="",document.getElementById("tenantPromptSuffix").value="",document.getElementById("tenantConfig").value="{}",document.getElementById("tenantIsActive").checked=!0,document.getElementById("tenantToolsContainer").innerHTML=ko([]),document.getElementById("tenantModal").classList.add("show")}async function kl(s){await wo();try{const o=(await g(`/admin/tenants/${s}`)).tenant;document.getElementById("tenantModalTitle").textContent=e("tenants.editTenant"),document.getElementById("editTenantId").value=s,document.getElementById("tenantSlug").value=o.slug||"",document.getElementById("tenantSlug").setAttribute("readonly","readonly"),document.getElementById("tenantName").value=o.name||"",document.getElementById("tenantNetworkId").value=o.network_id||"",document.getElementById("tenantExtensions").value=(o.extensions||[]).join(", "),document.getElementById("tenantAgentName").value=o.agent_name||"Олена",document.getElementById("tenantGreeting").value=o.greeting||"",document.getElementById("tenantPromptSuffix").value=o.prompt_suffix||"",document.getElementById("tenantConfig").value=JSON.stringify(o.config||{},null,2),document.getElementById("tenantIsActive").checked=o.is_active!==!1,document.getElementById("tenantToolsContainer").innerHTML=ko(o.enabled_tools||[]),document.getElementById("tenantModal").classList.add("show")}catch(n){c(e("tenants.loadFailed",{error:n.message}),"error")}}async function Tl(){const s=document.getElementById("editTenantId").value,n=document.getElementById("tenantSlug").value.trim(),o=document.getElementById("tenantName").value.trim(),a=document.getElementById("tenantNetworkId").value.trim(),i=document.getElementById("tenantAgentName").value.trim()||"Олена",r=document.getElementById("tenantGreeting").value.trim()||null,l=document.getElementById("tenantPromptSuffix").value.trim()||null,p=document.getElementById("tenantIsActive").checked;let m;try{m=JSON.parse(document.getElementById("tenantConfig").value)}catch{c(e("tenants.invalidConfigJson"),"error");return}const h=Array.from(document.querySelectorAll(".tenant-tool-cb:checked")).map(y=>y.value),v=document.getElementById("tenantExtensions").value.trim(),x=v?v.split(",").map(y=>y.trim()).filter(Boolean):[];if(!o||!a){c(e("tenants.nameRequired"),"error");return}if(!s&&!n){c(e("tenants.slugRequired"),"error");return}const f={name:o,network_id:a,agent_name:i,greeting:r,enabled_tools:h,extensions:x,prompt_suffix:l,config:m,is_active:p};s||(f.slug=n);try{s?(await g(`/admin/tenants/${s}`,{method:"PATCH",body:JSON.stringify(f)}),c(e("tenants.updated"))):(await g("/admin/tenants",{method:"POST",body:JSON.stringify(f)}),c(e("tenants.created"))),F("tenantModal"),xt(ut)}catch(y){c(e("tenants.saveFailed",{error:y.message}),"error")}}async function Sl(s,n){try{await g(`/admin/tenants/${s}`,{method:"PATCH",body:JSON.stringify({is_active:!n})}),c(e(n?"tenants.deactivated":"tenants.activated")),xt(ut)}catch(o){c(e("tenants.saveFailed",{error:o.message}),"error")}}async function _l(s,n){if(confirm(e("tenants.deleteConfirm",{name:n})))try{await g(`/admin/tenants/${s}`,{method:"DELETE"}),c(e("tenants.deleted")),xt(ut)}catch(o){c(e("tenants.saveFailed",{error:o.message}),"error")}}function Cl(){j("tenants",()=>xt()),document.addEventListener("click",s=>{s.target.closest(".relative")||document.querySelectorAll("#page-tenants .relative > div:not(.hidden)").forEach(n=>n.classList.add("hidden"))})}window._pages=window._pages||{};window._pages.tenants={loadTenants:xt,showCreateTenant:wl,editTenant:kl,saveTenant:Tl,toggleTenant:Sl,deleteTenant:_l};async function an(){const s=document.getElementById("telegramConfigContainer");s.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;try{const n=await g("/admin/notifications/telegram");let o;n.token_set?(o=`<span class="${L}">${e("settings.telegramTokenSet")}</span>`,n.token_hint&&(o+=` <span class="text-xs text-neutral-400 font-mono">...${d(n.token_hint)}</span>`)):o=`<span class="${q}">${e("settings.telegramTokenMissing")}</span>`;const a=n.source==="redis"?"Redis":n.source==="env"?"ENV":"—";let i=`<div class="space-y-3">
            <div class="flex items-center gap-2 text-sm">
                <span class="text-neutral-500 dark:text-neutral-400">${e("settings.telegramStatus")}:</span>
                ${o}
                <span class="${M}">${a}</span>
            </div>
            <div>
                <label class="block text-xs font-medium text-neutral-600 dark:text-neutral-400 mb-1">${e("settings.telegramBotToken")}</label>
                <input id="tgBotToken" type="password" placeholder="${e("settings.telegramBotTokenPlaceholder")}" class="w-full text-sm font-mono bg-white dark:bg-neutral-800 text-neutral-800 dark:text-neutral-200 border border-neutral-300 dark:border-neutral-600 rounded px-2 py-1.5 focus:outline-none focus:border-blue-500">
            </div>
            <div>
                <label class="block text-xs font-medium text-neutral-600 dark:text-neutral-400 mb-1">${e("settings.telegramChatId")}</label>
                <input id="tgChatId" type="text" value="${d(n.chat_id||"")}" placeholder="${e("settings.telegramChatIdPlaceholder")}" class="w-full text-sm font-mono bg-white dark:bg-neutral-800 text-neutral-800 dark:text-neutral-200 border border-neutral-300 dark:border-neutral-600 rounded px-2 py-1.5 focus:outline-none focus:border-blue-500">
            </div>
            <div class="flex gap-2">
                <button class="${E} ${T}" onclick="window._pages.notifications.saveTelegramConfig()">${e("common.save")}</button>
                <button class="${T} border border-neutral-300 dark:border-neutral-600 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-800" onclick="window._pages.notifications.testTelegram()">${e("settings.telegramTestBtn")}</button>
            </div>
        </div>`;s.innerHTML=i}catch(n){s.innerHTML=`<div class="${k}">${e("settings.telegramLoadFailed",{error:d(n.message)})}</div>`}}async function El(){var a,i,r,l;const s=((i=(a=document.getElementById("tgBotToken"))==null?void 0:a.value)==null?void 0:i.trim())||"",n=((l=(r=document.getElementById("tgChatId"))==null?void 0:r.value)==null?void 0:l.trim())||"";if(!s&&!n){c(e("settings.telegramFillFields"),"error");return}const o={};s&&(o.bot_token=s),n&&(o.chat_id=n);try{await g("/admin/notifications/telegram",{method:"PATCH",body:JSON.stringify(o)}),c(e("settings.telegramSaved"),"success"),an()}catch(p){c(e("settings.telegramSaveFailed",{error:p.message}),"error")}}async function Il(){c(e("settings.telegramTesting"),"info");try{const s=await g("/admin/notifications/telegram/test",{method:"POST"});s.success?c(e("settings.telegramTestSuccess",{latency:s.latency_ms}),"success"):c(e("settings.telegramTestFailed",{error:s.error||"Unknown"}),"error")}catch(s){c(e("settings.telegramTestFailed",{error:s.message}),"error")}}function Bl(){j("notifications",an)}window._pages=window._pages||{};window._pages.notifications={loadTelegramConfig:an,saveTelegramConfig:El,testTelegram:Il};let ws=0;const To={},Pl={sandbox:["sandbox:read","sandbox:write","sandbox:delete"],knowledge:["knowledge:read","knowledge:write","knowledge:delete"],scraper:["scraper:read","scraper:write","scraper:delete","scraper:execute"],training:["training:read","training:write","training:delete","training:execute"],prompts:["prompts:read","prompts:write","prompts:delete"],users:["users:read","users:write"],audit:["audit:read"],tenants:["tenants:read","tenants:write","tenants:delete"],operators:["operators:read","operators:write"],analytics:["analytics:read","analytics:export"],llm_config:["llm_config:read","llm_config:write"],notifications:["notifications:read","notifications:write"],configuration:["configuration:read","configuration:write"],monitoring:["monitoring:read"],onec_data:["onec_data:read"],vehicles:["vehicles:read","vehicles:write"],pronunciation:["pronunciation:read","pronunciation:write"],stt_hints:["stt_hints:read","stt_hints:write"],point_hints:["point_hints:read","point_hints:write"]},Ll={admin:["*"],analyst:["analytics:read","analytics:export","knowledge:read","training:read","prompts:read","vehicles:read","operators:read"],operator:["operators:read"],content_manager:["sandbox:read","sandbox:write","sandbox:delete","knowledge:read","knowledge:write","knowledge:delete","scraper:read","scraper:write","scraper:delete","scraper:execute","training:read","training:write","training:delete","training:execute","prompts:read","prompts:write","prompts:delete"]};function So(s){const n=`users.role${s.charAt(0).toUpperCase()}${s.slice(1).replace(/_(\w)/g,(o,a)=>a.toUpperCase())}`;return e(n)||s}async function Ze(s){s!==void 0&&(ws=s);const n=document.getElementById("usersContainer");n.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;const o=re({offset:ws});try{const a=await g(`/admin/users?${o}`),i=a.users||[];for(const r of i)To[r.id]=r.permissions;if(i.length===0){n.innerHTML=`<div class="${k}">${e("users.noUsers")}</div>`,K({containerId:"usersPagination",total:0,offset:0});return}n.innerHTML=`
            <div class="overflow-x-auto min-h-[480px]"><table class="${A}" id="usersTable"><thead><tr><th class="${P}" data-sortable>${e("users.username")}</th><th class="${P}" data-sortable>${e("users.role")}</th><th class="${P}" data-sortable>${e("users.permissions")}</th><th class="${P}" data-sortable>${e("users.activeCol")}</th><th class="${P}" data-sortable>${e("users.lastLogin")}</th><th class="${b}">${e("users.actionsCol")}</th></tr></thead><tbody>
            ${i.map(r=>{const l=r.permissions!==null&&r.permissions!==void 0?`<span class="${q}">${e("users.customPermissions")}</span>`:`<span class="${at}">${e("users.useRoleDefaults")}</span>`;return`
                <tr class="${_}">
                    <td class="${u}" data-label="${e("users.username")}">${d(r.username)}</td>
                    <td class="${u}" data-label="${e("users.role")}"><span class="${N}">${d(So(r.role))}</span></td>
                    <td class="${u}" data-label="${e("users.permissions")}">${l}</td>
                    <td class="${u}" data-label="${e("users.activeCol")}">${r.is_active?`<span class="${L}">${e("common.yes")}</span>`:`<span class="${D}">${e("common.no")}</span>`}</td>
                    <td class="${u}" data-label="${e("users.lastLogin")}" data-sort-value="${r.last_login_at||""}">${z(r.last_login_at)}</td>
                    <td class="${V}">
                        <div class="relative inline-block">
                            <button class="px-1.5 py-0.5 text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 text-sm cursor-pointer" onclick="this.nextElementSibling.classList.toggle('hidden')">&hellip;</button>
                            <div class="hidden absolute right-0 z-20 mt-1 w-44 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-md shadow-lg py-1">
                                <div class="px-3 py-1 text-xs text-neutral-400 uppercase">${e("users.changeRole")}</div>
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.users.changeRole('${r.id}', 'admin')">${e("users.roleAdmin")}</button>
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.users.changeRole('${r.id}', 'analyst')">${e("users.roleAnalyst")}</button>
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.users.changeRole('${r.id}', 'operator')">${e("users.roleOperator")}</button>
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.users.changeRole('${r.id}', 'content_manager')">${e("users.roleContentManager")}</button>
                                <div class="border-t border-neutral-200 dark:border-neutral-700 my-1"></div>
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" data-id="${d(r.id)}" data-role="${d(r.role)}" onclick="window._pages.users.showPermissionsEditor(this.dataset.id, this.dataset.role)">${e("users.editPermissions")}</button>
                                <div class="border-t border-neutral-200 dark:border-neutral-700 my-1"></div>
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.users.toggleUser('${r.id}', ${r.is_active})">${r.is_active?e("common.deactivate"):e("common.activate")}</button>
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" data-id="${d(r.id)}" data-name="${d(r.username)}" onclick="window._pages.users.resetUserPassword(this.dataset.id, this.dataset.name)">${e("users.resetPwd")}</button>
                            </div>
                        </div>
                    </td>
                </tr>
            `}).join("")}
            </tbody></table></div>
        `,Q("usersTable"),K({containerId:"usersPagination",total:a.total,offset:ws,onPage:r=>Ze(r)})}catch(a){n.innerHTML=`<div class="${k}">${e("users.failedToLoad",{error:d(a.message)})}</div>`}}function Al(){document.getElementById("newUsername").value="",document.getElementById("newPassword").value="",document.getElementById("newRole").value="operator",document.getElementById("createUserModal").classList.add("show")}async function Hl(){const s=document.getElementById("newUsername").value.trim(),n=document.getElementById("newPassword").value,o=document.getElementById("newRole").value;if(!s||!n){c(e("users.usernameRequired"),"error");return}try{await g("/admin/users",{method:"POST",body:JSON.stringify({username:s,password:n,role:o})}),F("createUserModal"),c(e("users.userCreated")),Ze()}catch(a){c(e("users.createFailed",{error:a.message}),"error")}}async function Ml(s,n){if(n)try{await g(`/admin/users/${s}`,{method:"PATCH",body:JSON.stringify({role:n})}),c(e("users.roleUpdated")),Ze()}catch(o){c(e("users.roleFailed",{error:o.message}),"error")}}async function Dl(s,n){try{await g(`/admin/users/${s}`,{method:"PATCH",body:JSON.stringify({is_active:!n})}),c(e(n?"users.userDeactivated":"users.userActivated")),Ze()}catch(o){c(e("users.toggleFailed",{error:o.message}),"error")}}async function Rl(s,n){const o=prompt(e("users.newPasswordPrompt",{username:n}));if(o)try{await g(`/admin/users/${s}/reset-password`,{method:"POST",body:JSON.stringify({new_password:o})}),c(e("users.passwordReset"))}catch(a){c(e("users.resetFailed",{error:a.message}),"error")}}function Fl(s,n){const o=To[s]??null,a=o!==null,i=Ll[n]||[],r=a?o:i,l=r.includes("*");let p=`
        <div class="fixed inset-0 bg-black/40 z-50 flex items-center justify-center" id="permissionsOverlay" onclick="if(event.target===this) window._pages.users.closePermissions()">
            <div class="bg-white dark:bg-neutral-900 rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] overflow-hidden flex flex-col">
                <div class="modal-fixed-header">
                    <h3 class="text-lg font-semibold">${e("users.editPermissions")}</h3>
                    <span class="cursor-pointer text-lg text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-200 transition-colors leading-none shrink-0" onclick="window._pages.users.closePermissions()">&times;</span>
                </div>
                <div class="modal-body">
                <label class="flex items-center gap-2 mb-4 cursor-pointer">
                    <input type="checkbox" id="permUseDefaults" ${a?"":"checked"} onchange="window._pages.users.togglePermDefaults()">
                    <span class="text-sm">${e("users.useRoleDefaults")} (${d(So(n))})</span>
                </label>
                <div id="permGrid" class="${a?"":"opacity-40 pointer-events-none"}">
    `;for(const[h,v]of Object.entries(Pl)){p+=`<div class="mb-3"><div class="text-xs mb-1"><span class="font-semibold text-neutral-700 dark:text-neutral-200">${e("users.permGroup."+h)}</span> <span class="text-neutral-400 dark:text-neutral-500">— ${e("users.permGroupHint."+h)}</span></div><div class="flex flex-wrap gap-x-4 gap-y-1">`;for(const x of v){const f=x.split(":")[1],y=l||r.includes(x)?"checked":"";p+=`<label class="flex items-center gap-1 text-sm cursor-pointer"><input type="checkbox" class="perm-cb" value="${d(x)}" ${y}><span>${d(f)}</span></label>`}p+="</div></div>"}p+=`
                </div>
                <div class="flex justify-end gap-2 mt-6">
                    <button class="px-4 py-2 text-sm rounded-md border border-neutral-300 dark:border-neutral-600 cursor-pointer" onclick="window._pages.users.closePermissions()">${e("common.cancel")}</button>
                    <button class="px-4 py-2 text-sm rounded-md bg-violet-600 text-white hover:bg-violet-700 cursor-pointer" onclick="window._pages.users.savePermissions('${d(s)}')">${e("common.save")}</button>
                </div>
                </div>
            </div>
        </div>
    `;const m=document.getElementById("permissionsOverlay");m&&m.remove(),document.body.insertAdjacentHTML("beforeend",p)}function Ol(){const s=document.getElementById("permUseDefaults").checked,n=document.getElementById("permGrid");n.className=s?"opacity-40 pointer-events-none":""}async function Nl(s){const n=document.getElementById("permUseDefaults").checked;let o=null;n||(o=[],document.querySelectorAll(".perm-cb:checked").forEach(a=>{o.push(a.value)}));try{await g(`/admin/users/${s}`,{method:"PATCH",body:JSON.stringify({permissions:o})}),c(e("users.permissionsUpdated")),_o(),Ze()}catch(a){c(e("users.permissionsFailed",{error:a.message}),"error")}}function _o(){const s=document.getElementById("permissionsOverlay");s&&s.remove()}function Kl(){j("users",()=>Ze()),document.addEventListener("click",s=>{s.target.closest(".relative")||document.querySelectorAll("#page-users .relative > div:not(.hidden)").forEach(n=>n.classList.add("hidden"))})}window._pages=window._pages||{};window._pages.users={loadUsers:Ze,showCreateUser:Al,createUser:Hl,changeRole:Ml,toggleUser:Dl,resetUserPassword:Rl,showPermissionsEditor:Fl,togglePermDefaults:Ol,savePermissions:Nl,closePermissions:_o};async function Co(s=0){const n=document.getElementById("auditContainer");n.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;const o=new URLSearchParams({limit:50,offset:s}),a=document.getElementById("auditDateFrom").value,i=document.getElementById("auditDateTo").value,r=document.getElementById("auditAction").value;a&&o.set("date_from",a),i&&o.set("date_to",i),r&&o.set("action",r);try{const l=await g(`/admin/audit-log?${o}`),p=l.entries||[];if(p.length===0){n.innerHTML=`<div class="${k}">${e("audit.noEntries")}</div>`,document.getElementById("auditPagination").innerHTML="";return}n.innerHTML=`
            <div class="overflow-x-auto min-h-[480px]"><table class="${A}" id="auditTable"><thead><tr><th class="${P}" data-sortable>${e("audit.date")}</th><th class="${P}" data-sortable>${e("audit.user")}</th><th class="${P}" data-sortable>${e("audit.action")}</th><th class="${P}" data-sortable>${e("audit.resource")}</th><th class="${b}">${e("audit.ip")}</th></tr></thead><tbody>
            ${p.map(v=>`
                <tr class="${_}">
                    <td class="${u}" data-label="${e("audit.date")}" data-sort-value="${v.created_at||""}">${z(v.created_at)}</td>
                    <td class="${u}" data-label="${e("audit.user")}">${d(v.username)||"-"}</td>
                    <td class="${u}" data-label="${e("audit.action")}"><span class="${N}">${d(v.action)}</span></td>
                    <td class="${u}" data-label="${e("audit.resource")}">${d(v.resource_type||"")}${v.resource_id?"/"+d(v.resource_id):""}</td>
                    <td class="${u}" data-label="${e("audit.ip")}">${d(v.ip_address)||"-"}</td>
                </tr>
            `).join("")}
            </tbody></table></div>
        `,Q("auditTable");const m=Math.ceil(l.total/50),h=Math.floor(s/50);document.getElementById("auditPagination").innerHTML=Array.from({length:Math.min(m,10)},(v,x)=>`<button class="${rt}${x===h?" active":""}" onclick="window._pages.audit.loadAuditLog(${x*50})">${x+1}</button>`).join("")}catch(l){n.innerHTML=`<div class="${k}">${e("audit.failedToLoad",{error:d(l.message)})}</div>`}}function ql(){j("audit",()=>Co())}window._pages=window._pages||{};window._pages.audit={loadAuditLog:Co};let xe="brands",gs=null,ft="",Eo=null,ls="";const gt=50;async function Io(){const s=document.getElementById("vehiclesStats");s.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;try{const n=await g("/admin/vehicles/stats");n.source_path&&(s.dataset.lastSourcePath=n.source_path),s.innerHTML=`
            <div class="${J}"><div class="${Y}">${n.brand_count??0}</div><div class="${X}">${e("vehicles.brands")}</div></div>
            <div class="${J}"><div class="${Y}">${n.model_count??0}</div><div class="${X}">${e("vehicles.models")}</div></div>
            <div class="${J}"><div class="${Y}">${n.kit_count??0}</div><div class="${X}">${e("vehicles.kits")}</div></div>
            <div class="${J}"><div class="${Y}">${n.tire_size_count??0}</div><div class="${X}">${e("vehicles.tireSizes")}</div></div>
            <div class="${J}"><div class="${Y}">${n.imported_at?z(n.imported_at):e("vehicles.neverImported")}</div><div class="${X}">${e("vehicles.lastImport")}</div></div>
        `}catch(n){s.innerHTML=`<div class="${k}">${e("vehicles.failedToLoad",{error:d(n.message)})}</div>`}}function rn(){const s=document.getElementById("vehiclesBreadcrumb");if(xe==="brands"){s.style.display="none";return}s.style.display="";let n=`<a href="#" class="${$n}" onclick="window._pages.vehicles.goToBrands()">${e("vehicles.brands")}</a>`;(xe==="models"||xe==="kits")&&(n+=` / <span>${d(ft)}</span>`),xe==="kits"&&(n+=` / <a href="#" class="${$n}" onclick="window._pages.vehicles.goToModels()">${e("vehicles.models")}</a>`,n+=` / <span>${d(ls)}</span>`),s.innerHTML=n}async function Kt(s=0){xe="brands",rn();const n=document.getElementById("vehiclesContainer");n.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;const o=new URLSearchParams({limit:gt,offset:s}),a=document.getElementById("vehiclesSearch").value.trim();a&&o.set("search",a);try{const i=await g(`/admin/vehicles/brands?${o}`),r=i.items||[];if(r.length===0){n.innerHTML=`<div class="${k}">${e("vehicles.noData")}</div>`,document.getElementById("vehiclesPagination").innerHTML="";return}n.innerHTML=`
            <div class="overflow-x-auto min-h-[480px]"><table class="${A}" id="brandsTable">
            <thead><tr>
                <th class="${P}" data-sortable>${e("vehicles.brand")}</th>
                <th class="${P}" data-sortable>${e("vehicles.models")}</th>
            </tr></thead>
            <tbody>
            ${r.map(l=>`
                <tr class="${_} cursor-pointer" data-id="${l.id}" data-name="${d(l.name)}" onclick="window._pages.vehicles.selectBrand(+this.dataset.id, this.dataset.name)">
                    <td class="${u}" data-label="${e("vehicles.brand")}">${d(l.name)}</td>
                    <td class="${u}" data-label="${e("vehicles.models")}">${l.model_count}</td>
                </tr>
            `).join("")}
            </tbody></table></div>
        `,Q("brandsTable"),dn(i.total,s,"loadBrands")}catch(i){n.innerHTML=`<div class="${k}">${e("vehicles.failedToLoad",{error:d(i.message)})}</div>`}}async function qt(s,n,o=0){gs=s,ft=n||ft,xe="models",rn();const a=document.getElementById("vehiclesContainer");a.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;const i=new URLSearchParams({limit:gt,offset:o}),r=document.getElementById("vehiclesSearch").value.trim();r&&i.set("search",r);try{const l=await g(`/admin/vehicles/brands/${s}/models?${i}`),p=l.items||[];if(p.length===0){a.innerHTML=`
                <button class="${G} mb-3" onclick="window._pages.vehicles.goToBrands()">${e("vehicles.back")}</button>
                <div class="${k}">${e("vehicles.noData")}</div>
            `,document.getElementById("vehiclesPagination").innerHTML="";return}a.innerHTML=`
            <button class="${G} mb-3" onclick="window._pages.vehicles.goToBrands()">${e("vehicles.back")}</button>
            <div class="overflow-x-auto"><table class="${A}" id="modelsTable">
            <thead><tr>
                <th class="${P}" data-sortable>${e("vehicles.model")}</th>
                <th class="${P}" data-sortable>${e("vehicles.kits")}</th>
            </tr></thead>
            <tbody>
            ${p.map(m=>`
                <tr class="${_} cursor-pointer" data-id="${m.id}" data-name="${d(m.name)}" onclick="window._pages.vehicles.selectModel(+this.dataset.id, this.dataset.name)">
                    <td class="${u}" data-label="${e("vehicles.model")}">${d(m.name)}</td>
                    <td class="${u}" data-label="${e("vehicles.kits")}">${m.kit_count}</td>
                </tr>
            `).join("")}
            </tbody></table></div>
        `,Q("modelsTable"),dn(l.total,o,"loadModelsPage")}catch(l){a.innerHTML=`<div class="${k}">${e("vehicles.failedToLoad",{error:d(l.message)})}</div>`}}async function ln(s,n,o=0){Eo=s,ls=n||ls,xe="kits",rn();const a=document.getElementById("vehiclesContainer");a.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;const i=new URLSearchParams({limit:gt,offset:o});try{const r=await g(`/admin/vehicles/models/${s}/kits?${i}`),l=r.items||[];if(l.length===0){a.innerHTML=`
                <button class="${G} mb-3" onclick="window._pages.vehicles.goToModels()">${e("vehicles.back")}</button>
                <div class="${k}">${e("vehicles.noData")}</div>
            `,document.getElementById("vehiclesPagination").innerHTML="";return}a.innerHTML=`
            <button class="${G} mb-3" onclick="window._pages.vehicles.goToModels()">${e("vehicles.back")}</button>
            <div class="overflow-x-auto"><table class="${A}" id="kitsTable">
            <thead><tr>
                <th class="${P}" data-sortable>${e("vehicles.year")}</th>
                <th class="${P}" data-sortable>${e("vehicles.trim")}</th>
                <th class="${P}" data-sortable>${e("vehicles.pcd")}</th>
                <th class="${P}" data-sortable>${e("vehicles.bolts")}</th>
                <th class="${P}" data-sortable>${e("vehicles.dia")}</th>
                <th class="${P}" data-sortable>${e("vehicles.tireSizes")}</th>
                <th class="${b}"></th>
            </tr></thead>
            <tbody>
            ${l.map(p=>`
                <tr class="${_}">
                    <td class="${u}" data-label="${e("vehicles.year")}">${p.year}</td>
                    <td class="${u}" data-label="${e("vehicles.trim")}">${d(p.name||"-")}</td>
                    <td class="${u}" data-label="${e("vehicles.pcd")}">${p.pcd??"-"}</td>
                    <td class="${u}" data-label="${e("vehicles.bolts")}" data-sort-value="${p.bolt_count??0}">${p.bolt_count??"-"}${p.bolt_size?" / "+d(p.bolt_size):""}</td>
                    <td class="${u}" data-label="${e("vehicles.dia")}">${p.dia??"-"}</td>
                    <td class="${u}" data-label="${e("vehicles.tireSizes")}">${p.tire_size_count}</td>
                    <td class="${V}">
                        <button class="${E} ${T}" onclick="window._pages.vehicles.toggleTireSizes(this, ${p.id})">${e("vehicles.tireSizes")}</button>
                    </td>
                </tr>
                <tr class="tire-sizes-row" id="tire-sizes-${p.id}" style="display:none">
                    <td colspan="7" class="${u} bg-neutral-50 dark:bg-neutral-800/50"></td>
                </tr>
            `).join("")}
            </tbody></table></div>
        `,Q("kitsTable"),dn(r.total,o,"loadKitsPage")}catch(r){a.innerHTML=`<div class="${k}">${e("vehicles.failedToLoad",{error:d(r.message)})}</div>`}}async function Ul(s,n){const o=document.getElementById(`tire-sizes-${n}`);if(!o)return;if(o.style.display!=="none"){o.style.display="none";return}o.style.display="";const a=o.querySelector("td");a.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;try{const r=(await g(`/admin/vehicles/kits/${n}/tire-sizes`)).items||[];if(r.length===0){a.innerHTML=`<div class="${k}">${e("vehicles.noData")}</div>`;return}const l=h=>e(h===1?"vehicles.stock":"vehicles.tuning"),p=h=>h===1?L:N,m=h=>e(h===1?"vehicles.front":h===2?"vehicles.rear":"vehicles.all");a.innerHTML=`
            <table class="${A}">
            <thead><tr>
                <th class="${b}">${e("vehicles.size")}</th>
                <th class="${b}">${e("vehicles.type")}</th>
                <th class="${b}">${e("vehicles.axle")}</th>
            </tr></thead>
            <tbody>
            ${r.map(h=>`
                <tr class="${_}">
                    <td class="${u}" data-label="${e("vehicles.size")}">${h.width}/${h.height} R${h.diameter}</td>
                    <td class="${u}" data-label="${e("vehicles.type")}"><span class="${p(h.type)}">${l(h.type)}</span></td>
                    <td class="${u}" data-label="${e("vehicles.axle")}">${m(h.axle)}</td>
                </tr>
            `).join("")}
            </tbody></table>
        `}catch(i){a.innerHTML=`<div class="${k}">${e("vehicles.failedToLoad",{error:d(i.message)})}</div>`}}function dn(s,n,o){const a=Math.ceil(s/gt),i=Math.floor(n/gt);document.getElementById("vehiclesPagination").innerHTML=Array.from({length:Math.min(a,10)},(r,l)=>`<button class="${rt}${l===i?" active":""}" onclick="window._pages.vehicles.${o}(${l*gt})">${l+1}</button>`).join("")}function Gl(s,n){document.getElementById("vehiclesSearch").value="",qt(s,n)}function zl(s,n){document.getElementById("vehiclesSearch").value="",ln(s,n)}function Vl(){document.getElementById("vehiclesSearch").value="",Kt()}function jl(){document.getElementById("vehiclesSearch").value="",qt(gs,ft)}function Wl(s){qt(gs,ft,s)}function Jl(s){ln(Eo,ls,s)}function Ql(){xe==="brands"?Kt():xe==="models"&&qt(gs,ft)}function Yl(){var a;const s=document.getElementById("vehiclesStats"),n=(a=s==null?void 0:s.dataset)==null?void 0:a.lastSourcePath,o=document.getElementById("vehicleImportPath");o&&n&&(o.value=n),document.getElementById("vehicleImportModal").classList.add("show")}async function Xl(){const s=document.getElementById("vehicleImportPath").value.trim();if(!s){c(e("vehicles.importPathRequired"),"error");return}const n=document.getElementById("vehicleImportBtn"),o=n.textContent;n.disabled=!0,n.textContent=e("common.loading");try{const a=await g("/admin/vehicles/import",{method:"POST",body:JSON.stringify({csv_dir:s})});F("vehicleImportModal"),c(e("vehicles.importSuccess",{brands:a.brand_count??0,models:a.model_count??0,kits:a.kit_count??0,tireSizes:a.tire_size_count??0})),Io(),Kt()}catch(a){c(e("vehicles.importFailed",{error:d(a.message)}),"error")}finally{n.disabled=!1,n.textContent=o}}function Zl(){j("vehicles",()=>{Io(),Kt()})}window._pages=window._pages||{};window._pages.vehicles={loadBrands:Kt,loadModels:qt,loadKits:ln,loadModelsPage:Wl,loadKitsPage:Jl,selectBrand:Gl,selectModel:zl,goToBrands:Vl,goToModels:jl,toggleTireSizes:Ul,search:Ql,openImportModal:Yl,runImport:Xl};const Ms=[{value:"greeting",i18nKey:"sandbox.intentGreeting"},{value:"tire_search",i18nKey:"sandbox.intentTireSearch"},{value:"clarification",i18nKey:"sandbox.intentClarification"},{value:"recommendation",i18nKey:"sandbox.intentRecommendation"},{value:"availability_check",i18nKey:"sandbox.intentAvailabilityCheck"},{value:"order_creation",i18nKey:"sandbox.intentOrderCreation"},{value:"order_status",i18nKey:"sandbox.intentOrderStatus"},{value:"fitting_booking",i18nKey:"sandbox.intentFittingBooking"},{value:"consultation",i18nKey:"sandbox.intentConsultation"},{value:"objection_handling",i18nKey:"sandbox.intentObjectionHandling"},{value:"upsell",i18nKey:"sandbox.intentUpsell"},{value:"farewell",i18nKey:"sandbox.intentFarewell"},{value:"other",i18nKey:"sandbox.intentOther"}];let cn="chat",R=null,$e=null,Be=[],Bt=!1,Ee=!1,le=new Set,Ke=[],qe=null,Ue=null,Ds=null,Bo=[],Ce=!1,Z=new Set,wt=0;function et(s){cn=s,["chat","regression","patterns","phrases","starters"].forEach(o=>{const a=document.getElementById(`sandboxContent-${o}`);a&&(a.style.display=o===s?"":"none")}),document.querySelectorAll("#page-sandbox .tab-bar button").forEach(o=>o.classList.remove("active"));const n=document.querySelector(`#page-sandbox .tab-bar button[data-tab="${s}"]`);n&&n.classList.add("active"),s==="chat"&&Ut(),s==="regression"&&ms(),s==="patterns"&&zt(),s==="phrases"&&Ao(),s==="starters"&&Ge()}function Ut(){const s=document.getElementById("sandboxChatContainer");if(!R){s.innerHTML=`
            <div class="flex items-center justify-center h-full">
                <p class="${k}">${e("sandbox.noConversation")}</p>
            </div>`;return}Me(R)}async function Me(s){const n=document.getElementById("sandboxChatContainer");n.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;try{const o=await g(`/admin/sandbox/conversations/${s}`);$e=o.item,Be=o.turns||[],R=s;try{Ke=(await g(`/admin/sandbox/conversations/${s}/turn-groups`)).items||[]}catch{Ke=[]}Gt()}catch(o){n.innerHTML=`<div class="${k}">${e("sandbox.loadFailed",{error:d(o.message)})}</div>`}}function Gt(){var Re;const s=document.getElementById("sandboxChatContainer"),n=$e,o=n.status==="active",a=n.tool_mode==="mock"?`<span class="${q}">${e("sandbox.mock")}</span>`:`<span class="${L}">${e("sandbox.live")}</span>`,i=n.prompt_version_name?`<span class="${N}">${d(n.prompt_version_name)}</span>`:`<span class="${M}">${e("sandbox.promptVersionDefault")}</span>`,r=n.model?d(n.model.replace("claude-","").replace(/-\d+$/,"")):e("sandbox.modelDefault"),l=o?`<select id="sandboxModelSwitch"
                class="text-[11px] px-1.5 py-0.5 rounded-md border border-neutral-300 dark:border-neutral-600 bg-white dark:bg-neutral-800 text-neutral-700 dark:text-neutral-200 cursor-pointer focus:outline-none focus:ring-1 focus:ring-blue-500"
                onchange="window._pages.sandbox.changeModel(this.value)"
                title="${e("sandbox.changeModel")}">
            </select>`:n.model?`<span class="${at}">${r}</span>`:"",p=n.scenario_type?`<span class="${M}">${d(n.scenario_type)}</span>`:"",m=(n.tags||[]).map($t=>`<span class="${M}">${d($t)}</span>`).join(" ");n.created_at&&z(n.created_at);const h=n.updated_at?z(n.updated_at):"-",v=n.avg_rating!=null?parseFloat(n.avg_rating).toFixed(1)+" &#9733;":"-",x=n.turns_count??Be.length,f=`
        <div class="mb-3 p-3 bg-neutral-50 dark:bg-neutral-800 rounded-md text-xs grid grid-cols-2 sm:grid-cols-4 gap-x-4 gap-y-2">
            <div><span class="text-neutral-500 dark:text-neutral-400">${e("sandbox.promptVersion")}:</span><br>${n.prompt_version_name?d(n.prompt_version_name):e("sandbox.promptVersionDefault")}</div>
            <div><span class="text-neutral-500 dark:text-neutral-400">${e("sandbox.model")}:</span><br>${n.model?d(n.model):e("sandbox.modelDefault")}</div>
            <div><span class="text-neutral-500 dark:text-neutral-400">${e("sandbox.toolMode")}:</span><br>${n.tool_mode==="mock"?e("sandbox.toolModeMock"):e("sandbox.toolModeLive")}</div>
            <div><span class="text-neutral-500 dark:text-neutral-400">${e("sandbox.scenarioType")}:</span><br>${n.scenario_type||e("sandbox.scenarioNone")}</div>
            <div><span class="text-neutral-500 dark:text-neutral-400">${e("sandbox.turnsCount")}:</span><br>${x}</div>
            <div><span class="text-neutral-500 dark:text-neutral-400">${e("sandbox.avgRating")}:</span><br>${v}</div>
            <div><span class="text-neutral-500 dark:text-neutral-400">${e("sandbox.status")}:</span><br>${n.status==="active"?e("sandbox.active"):e("sandbox.archivedStatus")}</div>
            <div><span class="text-neutral-500 dark:text-neutral-400">${e("sandbox.lastActivity")}:</span><br>${h}</div>
            ${m?`<div class="col-span-2 sm:col-span-4"><span class="text-neutral-500 dark:text-neutral-400">${e("sandbox.tags")}:</span> ${m}</div>`:""}
        </div>`,y=Ee?E:G,$=e(Ee?"sandbox.exitMarking":"sandbox.markingMode");let w="";Be.length===0?w=`<div class="${k} py-12">${e("sandbox.noMessages")}</div>`:w=Be.map($t=>td($t)).join("");let S="";Ee&&le.size>=1?S=`
            <div class="flex items-center gap-2 mb-2 p-2 bg-yellow-50 dark:bg-yellow-950/20 rounded border border-yellow-200 dark:border-yellow-800">
                <span class="text-sm">${e("sandbox.turnsSelected",{count:le.size})}</span>
                <button class="${E} ${T}" onclick="window._pages.sandbox.showGroupModal()">${e("sandbox.createGroup")}</button>
            </div>`:Ee&&le.size===0&&(S=`
            <div class="flex items-center gap-2 mb-2 p-2 bg-blue-50 dark:bg-blue-950/20 rounded border border-blue-200 dark:border-blue-800">
                <span class="text-sm text-blue-700 dark:text-blue-300">${e("sandbox.markingHint")}</span>
            </div>`);let B="";if(Ke.length>0){const $t=Ke.map(ee=>{const zo=ee.pattern_type==="positive"?`<span class="${L}">positive</span>`:`<span class="${D}">negative</span>`,Vo=ee.is_exported?`<span class="${N}">${e("sandbox.alreadyExported")}</span>`:`<button class="${G} ${T}" onclick="window._pages.sandbox.showExportModal('${ee.id}')">${e("sandbox.exportToPatterns")}</button>`,jo=ee.rating?"&#9733;".repeat(ee.rating):"-",Wo=(ee.tags||[]).map(Jo=>`<span class="${M}">${d(Jo)}</span>`).join(" ");return`
                <div class="p-2 rounded border ${ee.pattern_type==="positive"?"border-emerald-300 dark:border-emerald-800 bg-emerald-50/50 dark:bg-emerald-950/10":"border-red-300 dark:border-red-800 bg-red-50/50 dark:bg-red-950/10"} mb-2">
                    <div class="flex items-center gap-2 mb-1">
                        <span class="text-sm font-medium">${d(ee.intent_label)}</span>
                        ${zo}
                        <span class="text-amber-400 text-sm">${jo}</span>
                        <div class="ml-auto flex gap-1">
                            ${Vo}
                            <button class="${Ht} ${T}" onclick="window._pages.sandbox.deleteGroup('${ee.id}')">&times;</button>
                        </div>
                    </div>
                    <div class="${C}">${ee.turn_ids.length} ${e("sandbox.turnsCount").toLowerCase()} ${Wo}</div>
                    ${ee.rating_comment?`<div class="${C}">${d(ee.rating_comment)}</div>`:""}
                    ${ee.correction?`<div class="text-xs text-red-600 dark:text-red-400 mt-1">${e("sandbox.correction")}: ${d(ee.correction)}</div>`:""}
                </div>`}).join("");B=`
            <details class="mb-3" open>
                <summary class="text-sm font-semibold text-neutral-700 dark:text-neutral-300 cursor-pointer mb-2">${e("sandbox.turnGroups")} (${Ke.length})</summary>
                ${$t}
            </details>`}const I=((Re=document.getElementById("sandboxInput"))==null?void 0:Re.value)||"";s.innerHTML=`
        <div class="flex flex-col h-full">
            <div class="mb-3 pb-3 border-b border-neutral-200 dark:border-neutral-700">
                <div class="flex flex-wrap items-center gap-2">
                    <h2 class="text-sm font-semibold text-neutral-900 dark:text-neutral-50 mr-2">${d(n.title)}</h2>
                    ${i} ${a} ${l} ${p}
                    <div class="ml-auto flex flex-wrap gap-2">
                        <button class="${G} ${T}" onclick="document.getElementById('sandboxConvInfo').toggleAttribute('open')" title="${e("sandbox.convInfo")}">&#9432;</button>
                        <button class="${y} ${T}" onclick="window._pages.sandbox.toggleMarking()">${$}</button>
                        <button class="${n.is_baseline?E:G} ${T}" onclick="window._pages.sandbox.toggleBaseline('${n.id}', ${!!n.is_baseline})">${n.is_baseline?e("sandbox.unmarkBaseline"):e("sandbox.markBaseline")}</button>
                        ${n.is_baseline?`<button class="${G} ${T}" onclick="window._pages.sandbox.replayConversation('${n.id}')" title="${e("sandbox.replayHint")}">${e("sandbox.replay")}</button>`:""}
                        ${o?`<button class="${G} ${T}" onclick="window._pages.sandbox.archiveConversation()">${e("sandbox.archiveConversation")}</button>`:""}
                    </div>
                </div>
                <details id="sandboxConvInfo" class="mt-2">
                    <summary class="text-xs text-blue-600 dark:text-blue-400 cursor-pointer">${e("sandbox.convInfo")}</summary>
                    ${f}
                </details>
            </div>
            ${B}
            ${S}
            <div id="sandboxMessages" class="flex-1 overflow-y-auto mb-3 space-y-2">
                ${w}
            </div>
            ${o?`
            <div class="flex gap-2 pt-3 border-t border-neutral-200 dark:border-neutral-700">
                <input type="text" id="sandboxInput"
                    data-i18n-placeholder="sandbox.messagePlaceholder"
                    placeholder="${e("sandbox.messagePlaceholder")}"
                    class="${js} flex-1"
                    onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();window._pages.sandbox.sendMessage();}">
                <select id="sandboxPersonaSelect" class="px-1.5 py-1 text-xs border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500" title="${e("sandbox.persona")}">
                    <option value="neutral">${e("sandbox.personaNeutral")}</option>
                    <option value="impatient">${e("sandbox.personaImpatient")}</option>
                    <option value="confused">${e("sandbox.personaConfused")}</option>
                    <option value="angry">${e("sandbox.personaAngry")}</option>
                    <option value="expert">${e("sandbox.personaExpert")}</option>
                    <option value="rushed">${e("sandbox.personaRushed")}</option>
                    <option value="detailed">${e("sandbox.personaDetailed")}</option>
                </select>
                <button id="sandboxAutoBtn" class="${va} ${T}" title="${e("sandbox.autoCustomerHint")}" onclick="window._pages.sandbox.autoCustomer()">${e("sandbox.autoCustomer")}</button>
                <button id="sandboxSendBtn" class="${E}" onclick="window._pages.sandbox.sendMessage()">${e("sandbox.sendMessage")}</button>
            </div>`:""}
        </div>`;const ie=document.getElementById("sandboxInput");ie&&I&&(ie.value=I);const ge=document.getElementById("sandboxModelSwitch");ge&&ud(ge,n.model);const U=document.getElementById("sandboxMessages");U&&(U.scrollTop=U.scrollHeight)}function ed(s){return Ke.find(n=>n.turn_ids.includes(s))}function td(s){const n=s.speaker==="customer",o=n?Ws:Js,a=e(n?"sandbox.customer":"sandbox.agent"),i=ed(s.id);let r;i?r=i.pattern_type==="positive"?"bg-emerald-100 dark:bg-emerald-950/40 border-l-4 border-emerald-500":"bg-red-100 dark:bg-red-950/40 border-l-4 border-red-500":r=n?"bg-blue-50 dark:bg-blue-950/30":"bg-emerald-50 dark:bg-emerald-950/30";let l="";Ee&&(l=`<input type="checkbox" ${le.has(s.id)?"checked":""} onchange="window._pages.sandbox.toggleTurnSelect('${s.id}')" class="mr-2 mt-1 cursor-pointer">`);let p="";if(s.tool_calls&&s.tool_calls.length>0){const y=s.tool_calls.map($=>{const w=JSON.stringify($.tool_args),S=JSON.stringify($.tool_result),B=w.length>60?`<details><summary class="text-xs cursor-pointer">${d(w.substring(0,60))}...</summary><pre class="text-xs bg-neutral-100 dark:bg-neutral-800 p-2 rounded mt-1 max-h-48 overflow-auto whitespace-pre-wrap">${d(JSON.stringify($.tool_args,null,2))}</pre></details>`:`<code class="text-xs break-all">${d(w)}</code>`,I=S.length>60?`<details><summary class="text-xs cursor-pointer">${d(S.substring(0,60))}...</summary><pre class="text-xs bg-neutral-100 dark:bg-neutral-800 p-2 rounded mt-1 max-h-48 overflow-auto whitespace-pre-wrap">${d(JSON.stringify($.tool_result,null,2))}</pre></details>`:`<code class="text-xs break-all">${d(S)}</code>`;return`
            <tr class="${_}">
                <td class="${u}"><span class="${N}">${d($.tool_name)}</span></td>
                <td class="${u}">${B}</td>
                <td class="${u}">${I}</td>
                <td class="${u}">${$.duration_ms!=null?$.duration_ms+"ms":"-"}</td>
                <td class="${u}">${$.is_mock?`<span class="${q}">${e("sandbox.mock")}</span>`:`<span class="${L}">${e("sandbox.live")}</span>`}</td>
            </tr>`}).join("");p=`
            <details class="mt-1">
                <summary class="text-xs text-neutral-500 dark:text-neutral-400 cursor-pointer hover:text-neutral-700 dark:hover:text-neutral-200">
                    ${e("sandbox.toolCalls")} (${s.tool_calls.length})
                </summary>
                <div class="mt-1 overflow-x-auto">
                    <table class="${A}">
                        <thead><tr>
                            <th class="${b}">${e("sandbox.toolName")}</th>
                            <th class="${b}">${e("sandbox.toolArgs")}</th>
                            <th class="${b}">${e("sandbox.toolResult")}</th>
                            <th class="${b}">${e("sandbox.toolDuration")}</th>
                            <th class="${b}">${e("sandbox.toolMode")}</th>
                        </tr></thead>
                        <tbody>${y}</tbody>
                    </table>
                </div>
            </details>`}let m="";if(!n&&s.llm_latency_ms!=null){const y=!s.input_tokens&&!s.output_tokens;m=`<div class="${C} mt-1">${e("sandbox.metrics",{latency:s.llm_latency_ms,input:s.input_tokens||0,output:s.output_tokens||0,model:s.model||"-"})}</div>`,y&&(m+=`<div class="mt-1 text-xs text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-950/30 rounded px-2 py-1">${e("sandbox.llmErrorHint")}</div>`)}let h="",v="";if(!n){const y=s.id===qe&&Ue?Ue:s.rating,$=[1,2,3,4,5].map(S=>`<span class="cursor-pointer ${y&&S<=y?"text-amber-400":"text-neutral-300 dark:text-neutral-600"} text-lg" onclick="window._pages.sandbox.rateTurn('${s.id}', ${S})">&#9733;</span>`).join("");let w="";s.id===qe?w=`
                <div class="flex items-center gap-2 mt-1">
                    <input type="text" id="ratingCommentInput" placeholder="${e("sandbox.ratingCommentPlaceholder")}" class="${js} text-xs flex-1"
                        onkeydown="if(event.key==='Enter'){event.preventDefault();window._pages.sandbox.saveRating();}">
                    <button class="${E} ${T}" onclick="window._pages.sandbox.saveRating()">OK</button>
                    <button class="${G} ${T}" onclick="window._pages.sandbox.cancelRating()">&times;</button>
                </div>`:s.rating_comment&&(w=`<span class="${C} ml-2">${d(s.rating_comment)}</span>`),h=`<div class="mt-1 flex items-center gap-1 flex-wrap">${$}${w}</div>`,v=`<button class="${G} ${T} mt-1" onclick="window._pages.sandbox.branchFrom('${s.id}', ${s.turn_number})">${e("sandbox.branch")}</button>`}let x="";return i&&(x=`<span class="text-xs ml-2">${i.pattern_type==="positive"?"&#9989;":"&#10060;"} ${d(i.intent_label)}</span>`),`
        <div class="${r} ${n?"ml-auto max-w-[80%]":"mr-auto max-w-[80%]"} rounded-lg px-3 py-2" data-turn-id="${s.id}">
            <div class="flex items-start gap-1">
                ${l}
                <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-2">
                        <span class="${o}">${a}</span>
                        <span class="${C}">${z(s.created_at)}</span>
                        ${x}
                    </div>
                    <div class="${Qs}">${d(s.content)}</div>
                    ${p}
                    ${m}
                    <div class="flex items-center gap-2 flex-wrap">
                        ${h}
                        ${v}
                    </div>
                </div>
            </div>
        </div>`}function sd(){Ee=!Ee,le.clear(),Gt()}function nd(s){le.has(s)?le.delete(s):le.add(s),Gt()}function od(){const s=document.getElementById("sandboxGroupIntentCheckboxes");s.innerHTML=Ms.filter(n=>n.value!=="other").map(n=>`<label class="flex items-center gap-1.5 text-xs text-neutral-700 dark:text-neutral-300 cursor-pointer">
            <input type="checkbox" value="${n.value}" class="groupIntentCb cursor-pointer"> ${e(n.i18nKey)}
        </label>`).join("")+`<label class="flex items-center gap-1.5 text-xs text-neutral-700 dark:text-neutral-300 cursor-pointer">
        <input type="checkbox" value="__other__" class="groupIntentCb cursor-pointer"
            onchange="document.getElementById('sandboxGroupIntentCustom').style.display=this.checked?'':'none'"> ${e("sandbox.intentOther")}
    </label>`}function ad(){const s=document.querySelectorAll(".groupIntentCb:checked"),n=[];let o=!1;if(s.forEach(a=>{if(a.value==="__other__"){o=!0;return}n.push(a.value)}),o){const a=document.getElementById("sandboxGroupIntentCustom").value.trim();a&&a.split(",").map(i=>i.trim()).filter(Boolean).forEach(i=>{n.includes(i)||n.push(i)})}return n.join(", ")}function rd(){}function Po(s){document.getElementById("sandboxGroupType").value=s;const n=document.getElementById("sandboxGroupTypePositive"),o=document.getElementById("sandboxGroupTypeNegative");s==="positive"?(n.className="cursor-pointer rounded-lg border-2 border-green-500 ring-2 ring-green-200 dark:ring-green-800 bg-green-50 dark:bg-green-950 p-3 text-center transition-all",n.querySelector("div:first-child").className="text-lg text-green-600 dark:text-green-400 mb-1",n.querySelector("div:nth-child(2)").className="text-sm font-medium text-green-700 dark:text-green-300",n.querySelector("div:nth-child(3)").className="text-xs text-green-600 dark:text-green-400 mt-1",o.className="cursor-pointer rounded-lg border-2 border-neutral-300 dark:border-neutral-600 bg-white dark:bg-neutral-800 p-3 text-center transition-all",o.querySelector("div:first-child").className="text-lg text-neutral-400 dark:text-neutral-500 mb-1",o.querySelector("div:nth-child(2)").className="text-sm font-medium text-neutral-500 dark:text-neutral-400",o.querySelector("div:nth-child(3)").className="text-xs text-neutral-400 dark:text-neutral-500 mt-1"):(o.className="cursor-pointer rounded-lg border-2 border-red-500 ring-2 ring-red-200 dark:ring-red-800 bg-red-50 dark:bg-red-950 p-3 text-center transition-all",o.querySelector("div:first-child").className="text-lg text-red-600 dark:text-red-400 mb-1",o.querySelector("div:nth-child(2)").className="text-sm font-medium text-red-700 dark:text-red-300",o.querySelector("div:nth-child(3)").className="text-xs text-red-600 dark:text-red-400 mt-1",n.className="cursor-pointer rounded-lg border-2 border-neutral-300 dark:border-neutral-600 bg-white dark:bg-neutral-800 p-3 text-center transition-all",n.querySelector("div:first-child").className="text-lg text-neutral-400 dark:text-neutral-500 mb-1",n.querySelector("div:nth-child(2)").className="text-sm font-medium text-neutral-500 dark:text-neutral-400",n.querySelector("div:nth-child(3)").className="text-xs text-neutral-400 dark:text-neutral-500 mt-1"),document.getElementById("sandboxGroupCorrectionWrap").style.display=s==="negative"?"block":"none"}function id(){if(le.size<1)return;od(),document.getElementById("sandboxGroupIntentCustom").style.display="none",document.getElementById("sandboxGroupIntentCustom").value="",Po("positive");const s=Be.filter(l=>le.has(l.id)),n=s.map(l=>l.rating).filter(l=>l!=null);if(n.length>0){const l=Math.round(n.reduce((p,m)=>p+m,0)/n.length);document.getElementById("sandboxGroupRating").value=String(l)}else document.getElementById("sandboxGroupRating").value="";document.getElementById("sandboxGroupComment").value="",document.getElementById("sandboxGroupCorrection").value="",document.getElementById("sandboxGroupTags").value="";const o=document.getElementById("sandboxGroupPreview"),a=s.map(l=>{const p=l.role==="user"?e("sandbox.customer"):e("sandbox.agent"),m=l.role==="user"?"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300":"bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300",h=d((l.content||"").slice(0,100))+((l.content||"").length>100?"...":"");return`<div class="flex items-start gap-2 py-1.5 border-b border-neutral-100 dark:border-neutral-800 last:border-0">
            <span class="shrink-0 text-xs px-1.5 py-0.5 rounded font-medium ${m}">${p}</span>
            <span class="text-xs text-neutral-600 dark:text-neutral-400 leading-relaxed">${h}</span>
        </div>`}).join("");o.innerHTML=`<details open>
        <summary class="text-sm font-medium text-neutral-700 dark:text-neutral-300 cursor-pointer mb-1">${e("sandbox.previewSelectedTurns",{count:s.length})}</summary>
        <div class="max-h-40 overflow-y-auto border border-neutral-200 dark:border-neutral-700 rounded-md px-3 py-1">${a}</div>
    </details>`;const i=new Set;for(const l of Ke)l.tags&&l.tags.forEach(p=>i.add(p));const r=document.getElementById("sandboxGroupTagsList");r.innerHTML=Array.from(i).map(l=>`<option value="${d(l)}">`).join(""),document.getElementById("sandboxGroupModal").classList.add("show")}async function ld(){const s=ad();if(!s){c(e("sandbox.intentRequired"),"error");return}const n=document.getElementById("sandboxGroupType").value,o=document.getElementById("sandboxGroupRating").value,a=o?parseInt(o):null,i=document.getElementById("sandboxGroupComment").value.trim()||null,r=document.getElementById("sandboxGroupCorrection").value.trim()||null,l=document.getElementById("sandboxGroupTags").value.trim(),p=l?l.split(",").map(m=>m.trim()).filter(Boolean):[];try{await g(`/admin/sandbox/conversations/${R}/turn-groups`,{method:"POST",body:JSON.stringify({turn_ids:Array.from(le),intent_label:s,pattern_type:n,rating:a,rating_comment:i,correction:r,tags:p})}),F("sandboxGroupModal"),c(e("sandbox.groupCreated")),le.clear(),Ee=!1,await Me(R)}catch(m){c(e("sandbox.loadFailed",{error:m.message}),"error")}}async function dd(s){if(!confirm(e("sandbox.deleteConfirm",{title:"group"})))return;const n=document.querySelector(`[onclick*="deleteGroup('${s}')"]`);n&&(n.disabled=!0,n.innerHTML='<span class="spinner-sm"></span>');try{await g(`/admin/sandbox/turn-groups/${s}`,{method:"DELETE"}),c(e("sandbox.groupDeleted")),await Me(R)}catch(o){c(e("sandbox.loadFailed",{error:o.message}),"error")}finally{n&&(n.disabled=!1,n.textContent="×")}}function cd(s){document.getElementById("sandboxExportGroupId").value=s,document.getElementById("sandboxExportGuidance").value="",document.getElementById("sandboxExportModal").classList.add("show"),Lo()}async function Lo(){const s=document.getElementById("sandboxExportGroupId").value;if(!s)return;const n=document.getElementById("sandboxGenerateGuidanceBtn"),o=document.getElementById("sandboxExportGuidance");n.disabled=!0,o.placeholder=e("sandbox.generatingGuidance");try{const a=await g(`/admin/sandbox/turn-groups/${s}/generate-guidance`,{method:"POST"});a.guidance_note&&(o.value=a.guidance_note)}catch(a){c(e("sandbox.generateGuidanceFailed",{error:a.message}),"error")}finally{n.disabled=!1,o.placeholder=e("sandbox.guidanceHint")}}async function pd(){const s=document.getElementById("sandboxExportGroupId").value,n=document.getElementById("sandboxExportGuidance").value.trim();if(!n){c(e("sandbox.guidanceRequired"),"error");return}try{await g(`/admin/sandbox/turn-groups/${s}/export`,{method:"POST",body:JSON.stringify({guidance_note:n})}),F("sandboxExportModal"),c(e("sandbox.exportSuccess")),await Me(R)}catch(o){c(e("sandbox.loadFailed",{error:o.message}),"error")}}let Qt=null;async function ud(s,n){if(!Qt)try{Qt=(await g("/admin/sandbox/models")).models||[]}catch{Qt=[]}s.innerHTML=`<option value="">${e("sandbox.modelDefault")}</option>`;for(const o of Qt){const a=o.label||o.id,i=o.id===n?" selected":"";s.innerHTML+=`<option value="${d(o.id)}"${i}>${d(a)}</option>`}}async function gd(s){if(R)try{await g(`/admin/sandbox/conversations/${R}`,{method:"PATCH",body:JSON.stringify({model:s||""})}),$e&&($e.model=s||null),c(e("sandbox.modelChanged"))}catch(n){c(e("sandbox.loadFailed",{error:n.message}),"error");const o=document.getElementById("sandboxModelSwitch");o&&$e&&(o.value=$e.model||"")}}async function md(){var i;if(Bt)return;const s=document.getElementById("sandboxInput"),n=(i=s==null?void 0:s.value)==null?void 0:i.trim();if(!n||!R)return;Bt=!0;const o=document.getElementById("sandboxSendBtn");o&&(o.disabled=!0,o.textContent=e("sandbox.sending"));const a=n;s.value="";try{const r=await g(`/admin/sandbox/conversations/${R}/send`,{method:"POST",body:JSON.stringify({message:n})});r.error&&c(`${e("sandbox.llmError")}: ${r.error}`,"error"),await Me(R)}catch(r){c(e("sandbox.sendFailed",{error:r.message}),"error");const l=document.getElementById("sandboxInput");l&&(l.value=a)}finally{Bt=!1;const r=document.getElementById("sandboxSendBtn");r&&(r.disabled=!1,r.textContent=e("sandbox.sendMessage"));const l=document.getElementById("sandboxInput");l&&l.focus()}}function hd(s,n){qe=s,Ue=n,Gt(),setTimeout(()=>{const o=document.querySelector(`[data-turn-id="${s}"]`);o&&o.scrollIntoView({block:"nearest",behavior:"smooth"});const a=document.getElementById("ratingCommentInput");a&&a.focus()},0)}async function bd(){var o;if(!qe||!Ue)return;const s=document.getElementById("ratingCommentInput"),n=((o=s==null?void 0:s.value)==null?void 0:o.trim())||"";try{const a={rating:Ue};n&&(a.comment=n),await g(`/admin/sandbox/turns/${qe}/rate`,{method:"PATCH",body:JSON.stringify(a)}),c(e("sandbox.ratingSaved")),qe=null,Ue=null,R&&await Me(R)}catch(a){c(e("sandbox.ratingFailed",{error:a.message}),"error")}}function vd(){qe=null,Ue=null,Gt()}function fd(s,n){Ds=s;const o=document.getElementById("sandboxBranchTitle");o&&(o.textContent=e("sandbox.branchFromTurn",{turn:n}));const a=document.getElementById("sandboxBranchInput");a&&(a.value=""),document.getElementById("sandboxBranchModal").classList.add("show"),setTimeout(()=>{a&&a.focus()},100)}async function yd(){var o;const s=document.getElementById("sandboxBranchInput"),n=(o=s==null?void 0:s.value)==null?void 0:o.trim();if(!(!n||!Ds)){Bt=!0;try{await g(`/admin/sandbox/conversations/${R}/send`,{method:"POST",body:JSON.stringify({message:n,parent_turn_id:Ds})}),F("sandboxBranchModal"),await Me(R)}catch(a){c(e("sandbox.sendFailed",{error:a.message}),"error")}finally{Bt=!1}}}async function xd(){var n;const s=document.getElementById("sandboxAutoBtn");s&&(s.disabled=!0,s.textContent=e("sandbox.generating"));try{const o=((n=document.getElementById("sandboxPersonaSelect"))==null?void 0:n.value)||"neutral",a=await g(`/admin/sandbox/conversations/${R}/auto-customer`,{method:"POST",body:JSON.stringify({persona:o})}),i=document.getElementById("sandboxInput");i&&a.suggested_message&&(i.value=a.suggested_message,i.focus())}catch(o){c(e("sandbox.sendFailed",{error:o.message}),"error")}finally{s&&(s.disabled=!1,s.textContent=e("sandbox.autoCustomer"))}}async function $d(){if(!R)return;const s=document.querySelector('[onclick*="archiveConversation()"]');s&&(s.disabled=!0,s.textContent="...");try{await g(`/admin/sandbox/conversations/${R}`,{method:"PATCH",body:JSON.stringify({status:"archived"})}),c(e("sandbox.archived")),R=null,$e=null,Be=[],Ut(),ne()}catch(n){c(e("sandbox.loadFailed",{error:n.message}),"error")}finally{s&&(s.disabled=!1,s.textContent=e("sandbox.archiveConversation"))}}async function wd(){document.getElementById("sandboxConvTitle").value="",document.getElementById("sandboxConvTags").value="",document.getElementById("sandboxConvToolMode").value="live",document.getElementById("sandboxConvScenario").value="";try{const n=(await g("/admin/sandbox/scenario-starters?limit=20")).items||[];Bo=n;const o=document.getElementById("sandboxStartersSection"),a=document.getElementById("sandboxStarterCards");n.length>0?(o.style.display="",a.innerHTML=n.map((i,r)=>{const l=i.scenario_type?`<span class="text-[10px] px-1 rounded bg-neutral-200 dark:bg-neutral-700 text-neutral-600 dark:text-neutral-300">${d(i.scenario_type)}</span>`:"";return`
                    <div class="p-2 rounded-md border border-neutral-200 dark:border-neutral-700 hover:border-blue-400 dark:hover:border-blue-600 cursor-pointer transition-colors bg-neutral-50 dark:bg-neutral-800"
                         onclick="window._pages.sandbox.useStarterByIndex(${r})">
                        <div class="text-xs font-medium text-neutral-900 dark:text-neutral-100 mb-1">${d(i.title)}</div>
                        <div class="text-[10px] text-neutral-500 dark:text-neutral-400 truncate mb-1">${d(i.first_message)}</div>
                        ${l}
                    </div>`}).join("")):o.style.display="none"}catch{const s=document.getElementById("sandboxStartersSection");s&&(s.style.display="none")}try{const s=await g("/prompts"),n=document.getElementById("sandboxConvPrompt");n.innerHTML=`<option value="">${e("sandbox.promptVersionDefault")}</option>`;const o=s.versions||s.items||[];for(const a of o){const i=a.is_active?" *":"";n.innerHTML+=`<option value="${a.id}">${d(a.name)}${i}</option>`}}catch{}try{const s=await g("/admin/sandbox/models"),n=document.getElementById("sandboxConvModel"),o=s.default_model||"";n.innerHTML=`<option value="">${e("sandbox.modelDefault")}</option>`;for(const a of s.models||[]){const i=a.id===o?" selected":"";n.innerHTML+=`<option value="${d(a.id)}"${i}>${d(a.label)}</option>`}}catch{}document.getElementById("sandboxNewConvModal").classList.add("show")}async function kd(){const s=document.getElementById("sandboxConvTitle").value.trim();if(!s){c(e("sandbox.titleRequired"),"error");return}const n=document.getElementById("sandboxConvPrompt").value||null,o=document.getElementById("sandboxConvModel").value||null,a=document.getElementById("sandboxConvToolMode").value,i=document.getElementById("sandboxConvScenario").value||null,r=document.getElementById("sandboxConvTags").value.trim(),l=r?r.split(",").map(p=>p.trim()).filter(Boolean):[];try{const p={title:s,tool_mode:a,tags:l};n&&(p.prompt_version_id=n),o&&(p.model=o),i&&(p.scenario_type=i);const m=await g("/admin/sandbox/conversations",{method:"POST",body:JSON.stringify(p)});F("sandboxNewConvModal"),c(e("sandbox.created")),R=m.item.id,ne(),et("chat")}catch(p){c(e("sandbox.loadFailed",{error:p.message}),"error")}}async function ne(){var l,p,m,h;const s=document.getElementById("sandboxSidebarList");if(!s)return;s.innerHTML='<div class="flex justify-center py-6"><div class="spinner"></div></div>';const n=document.getElementById("sandboxBulkToggle");n&&(Ce?(n.classList.add("bg-blue-600","text-white","border-blue-600"),n.classList.remove("text-neutral-600","dark:text-neutral-300","border-neutral-300","dark:border-neutral-600")):(n.classList.remove("bg-blue-600","text-white","border-blue-600"),n.classList.add("text-neutral-600","dark:text-neutral-300","border-neutral-300","dark:border-neutral-600")));const o=((p=(l=document.getElementById("sandboxSearch"))==null?void 0:l.value)==null?void 0:p.trim())||"",a=((m=document.getElementById("sandboxFilterStatus"))==null?void 0:m.value)||"",i=((h=document.getElementById("sandboxFilterScenario"))==null?void 0:h.value)||"",r=new URLSearchParams;o&&r.set("search",o),a&&r.set("status",a),i&&r.set("scenario_type",i),r.set("limit","50");try{const x=(await g(`/admin/sandbox/conversations?${r}`)).items||[];if(x.length===0){s.innerHTML=`<div class="p-4 text-center ${C}">${e("sandbox.noConversations")}</div>`;return}let f="";if(Ce){const $=x.map(I=>I.id),w=$.length>0&&$.every(I=>Z.has(I)),S=e(w?"sandbox.deselectAll":"sandbox.selectAll");f=`
                <div class="px-3 py-2 border-b border-neutral-200 dark:border-neutral-700 flex items-center gap-2 bg-neutral-50 dark:bg-neutral-800">
                    <button class="${G} ${T}" onclick="window._pages.sandbox.${w?"deselectAll":"selectAll"}()">${S}</button>
                    ${Z.size>0?`<button class="${Ht} ${T}" onclick="window._pages.sandbox.bulkDelete()">${e("sandbox.bulkDelete",{count:Z.size})}</button>`:""}
                </div>`}const y=x.map($=>{const S=$.id===R?"bg-blue-50 dark:bg-blue-950/30 border-l-2 border-blue-500":"border-l-2 border-transparent hover:bg-neutral-50 dark:hover:bg-neutral-800",B=$.tool_mode==="mock"?`<span class="text-[10px] px-1 rounded bg-amber-100 dark:bg-amber-900/40 text-amber-700 dark:text-amber-300">${e("sandbox.mock")}</span>`:`<span class="text-[10px] px-1 rounded bg-emerald-100 dark:bg-emerald-900/40 text-emerald-700 dark:text-emerald-300">${e("sandbox.live")}</span>`,I=$.model?$.model.replace("claude-","").replace(/-\d+$/,""):"",ie=$.updated_at?new Date($.updated_at).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit"}):"",ge=$.is_baseline?'<span class="text-[10px] px-1 rounded bg-indigo-100 dark:bg-indigo-900/40 text-indigo-700 dark:text-indigo-300 font-semibold">B</span>':"";let U="";return Ce&&(U=`<input type="checkbox" ${Z.has($.id)?"checked":""} onclick="event.stopPropagation();window._pages.sandbox.toggleBulkSelect('${$.id}')" class="mr-1.5 mt-0.5 cursor-pointer flex-shrink-0">`),`
                <div class="px-3 py-2 cursor-pointer ${S} transition-colors" onclick="${Ce?`window._pages.sandbox.toggleBulkSelect('${$.id}')`:`window._pages.sandbox.openConversation('${$.id}')`}">
                    <div class="flex items-center gap-1">
                        ${U}
                        <span class="text-xs font-medium text-neutral-900 dark:text-neutral-100 truncate flex-1">${d($.title)}</span>
                        ${ge}
                        ${Ce?"":`<button class="text-neutral-400 hover:text-red-500 text-xs leading-none flex-shrink-0" onclick="event.stopPropagation();window._pages.sandbox.deleteConversation('${$.id}', '${d($.title).replace(/'/g,"\\'")}')" title="${e("common.delete")}">&times;</button>`}
                    </div>
                    <div class="flex items-center gap-1.5 mt-0.5 text-[10px] text-neutral-500 dark:text-neutral-400">
                        <span>${ie}</span>
                        <span>&middot;</span>
                        <span>${$.turns_count||0} ${e("sandbox.turnsCount").toLowerCase()}</span>
                        ${B}
                        ${I?`<span class="text-neutral-400">${d(I)}</span>`:""}
                    </div>
                </div>`}).join("");s.innerHTML=f+y}catch(v){s.innerHTML=`<div class="p-4 text-center ${C}">${e("sandbox.loadFailed",{error:d(v.message)})}</div>`}}function Td(s){R=s,cn!=="chat"?et("chat"):Ut(),ne()}async function Sd(s,n){if(!confirm(e("sandbox.deleteConfirm",{title:n})))return;const o=document.querySelector(`[onclick*="deleteConversation('${s}'"]`);o&&(o.disabled=!0,o.innerHTML="...");try{await g(`/admin/sandbox/conversations/${s}`,{method:"DELETE"}),c(e("sandbox.deleted")),R===s&&(R=null,$e=null,Be=[],Ut()),ne()}catch(a){const i=a.status===409?e("sandbox.deleteBlockedByRegression"):e("sandbox.loadFailed",{error:a.message});c(i,"error"),o&&(o.disabled=!1,o.innerHTML="&times;")}}async function ms(){var a;const s=document.getElementById("sandboxRegressionContainer");s.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;try{let m=function(f){const y={pending:M,running:q,completed:L,failed:D},$={pending:e("sandbox.pending"),running:e("sandbox.running"),completed:e("sandbox.completed"),failed:e("sandbox.failed")};return`<span class="${y[f]||M}">${$[f]||f}</span>`},h=function(f){return f==="approved"?`<span class="${L}">${e("sandbox.approved")}</span>`:f==="rejected"?`<span class="${D}">${e("sandbox.rejected")}</span>`:`<span class="${M}">${e("sandbox.pendingVerdict")}</span>`};var n=m,o=h;const i=((a=document.getElementById("regressionVerdictFilter"))==null?void 0:a.value)||"";let r="/admin/sandbox/regression-runs?limit=50";i&&(r+=`&verdict=${i}`);const p=(await g(r)).items||[],v=`
            <div class="flex gap-2 mb-3 items-center flex-wrap">
                <select id="regressionVerdictFilter" onchange="window._pages.sandbox.loadRegressionRuns()"
                    class="px-2 py-1.5 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100">
                    <option value="">${e("sandbox.all")}</option>
                    <option value="pending" ${i==="pending"?"selected":""}>${e("sandbox.pendingVerdict")}</option>
                    <option value="approved" ${i==="approved"?"selected":""}>${e("sandbox.approved")}</option>
                    <option value="rejected" ${i==="rejected"?"selected":""}>${e("sandbox.rejected")}</option>
                </select>
                <button class="${E} ${T}" onclick="window._pages.sandbox.showBatchReplayModal()">${e("sandbox.batchReplay")}</button>
            </div>`;if(p.length===0){s.innerHTML=v+`<div class="${k}">${e("sandbox.noRegressions")}</div>`;return}const x=p.map(f=>`
            <tr class="${_}">
                <td class="${u} cursor-pointer" onclick="window._pages.sandbox.showRegressionDetail('${f.id}')" data-label="${e("sandbox.conversationTitle")}">${d(f.source_title||"-")}</td>
                <td class="${u}" data-label="${e("sandbox.promptVersion")}">${f.prompt_version_name?`<span class="${N}">${d(f.prompt_version_name)}</span>`:"-"}</td>
                <td class="${u}" data-label="${e("sandbox.status")}">${m(f.status)}</td>
                <td class="${u}" data-label="${e("sandbox.verdict")}">${h(f.verdict)}</td>
                <td class="${u}" data-label="${e("sandbox.turnsCompared")}">${f.turns_compared||"-"}</td>
                <td class="${u}" data-label="${e("sandbox.sourceRating")}">${f.avg_source_rating!=null?parseFloat(f.avg_source_rating).toFixed(1):"-"}</td>
                <td class="${u}" data-label="${e("sandbox.lastActivity")}">${z(f.created_at)}</td>
                <td class="${u}">
                    <button class="text-red-500 hover:text-red-700 text-xs" onclick="event.stopPropagation();window._pages.sandbox.deleteRegressionRun('${f.id}')">${e("sandbox.deleteRun")}</button>
                </td>
            </tr>`).join("");s.innerHTML=v+`
            <div class="overflow-x-auto min-h-[480px]"><table class="${A}"><thead><tr>
                <th class="${b}">${e("sandbox.conversationTitle")}</th>
                <th class="${b}">${e("sandbox.promptVersion")}</th>
                <th class="${b}">${e("sandbox.status")}</th>
                <th class="${b}">${e("sandbox.verdict")}</th>
                <th class="${b}">${e("sandbox.turnsCompared")}</th>
                <th class="${b}">${e("sandbox.sourceRating")}</th>
                <th class="${b}">${e("sandbox.lastActivity")}</th>
                <th class="${b}"></th>
            </tr></thead><tbody>${x}</tbody></table></div>`}catch(i){s.innerHTML=`<div class="${k}">${e("sandbox.loadFailed",{error:d(i.message)})}</div>`}}async function pn(s){const n=document.getElementById("sandboxRegressionContainer");n.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;try{let h=function(w){if(w==null)return"";const S=Math.round(w*100);let B=D;return S>=85?B=L:S>=60&&(B=q),`<span class="${B}" title="${e("sandbox.semanticSimilarity")}">${S}%</span>`},v=function(w,S){let B='<span class="inline-flex gap-0.5" title="'+e("sandbox.rateNewResponse")+'">';for(let I=1;I<=5;I++){const ie=S&&I<=S;B+=`<span class="cursor-pointer text-sm ${ie?"text-yellow-400":"text-neutral-300 dark:text-neutral-600"}" onclick="event.stopPropagation();window._pages.sandbox.rateRegressionTurn('${s}',${w},${I})">★</span>`}return B+="</span>",B},y=function(w){return w==="approved"?`<span class="${L}">${e("sandbox.approved")}</span>`:w==="rejected"?`<span class="${D}">${e("sandbox.rejected")}</span>`:`<span class="${M}">${e("sandbox.pendingVerdict")}</span>`};var o=h,a=v,i=y;const l=(await g(`/admin/sandbox/regression-runs/${s}`)).item,p=l.summary||{},m=p.turn_diffs||[];let x="";m.length>0&&(x=m.map(w=>`
                <div class="${J}">
                    <div class="flex items-center gap-2 mb-1">
                        <span class="${C}">Turn ${w.turn_number}: ${d(w.customer_message)}</span>
                        ${h(w.similarity_score)}
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <div class="text-xs font-semibold text-neutral-500 mb-1">${e("sandbox.sourceResponse")} ${w.source_rating?`<span class="text-yellow-400">${"★".repeat(w.source_rating)}</span>`:""}</div>
                            <div class="text-sm bg-neutral-50 dark:bg-neutral-800 rounded p-2">${d(w.source_response)}</div>
                        </div>
                        <div>
                            <div class="text-xs font-semibold text-neutral-500 mb-1">${e("sandbox.newResponse")} ${v(w.turn_number,w.new_rating)}</div>
                            <div class="text-sm bg-emerald-50 dark:bg-emerald-950/30 rounded p-2">${d(w.new_response)}</div>
                        </div>
                    </div>
                    ${w.diff_lines&&w.diff_lines.length>0?`
                        <details class="mt-2">
                            <summary class="${C} cursor-pointer">${e("sandbox.diffView")}</summary>
                            <pre class="text-xs bg-neutral-900 text-neutral-100 rounded p-2 mt-1 overflow-x-auto">${d(w.diff_lines.join(`
`))}</pre>
                        </details>`:""}
                </div>`).join(""));const $=l.status==="completed"?`
            <div class="flex gap-2 items-center">
                ${y(l.verdict)}
                <button class="${E} ${T}" onclick="window._pages.sandbox.setVerdict('${s}','approved')">${e("sandbox.approve")}</button>
                <button class="${G} ${T}" onclick="window._pages.sandbox.setVerdict('${s}','rejected')">${e("sandbox.reject")}</button>
            </div>`:"";n.innerHTML=`
            <div class="mb-3 flex gap-2 items-center">
                <button class="${G} ${T}" onclick="window._pages.sandbox.loadRegressionRuns()">&larr; ${e("sandbox.regression")}</button>
                <button class="text-red-500 hover:text-red-700 text-sm" onclick="window._pages.sandbox.deleteRegressionRun('${s}')">${e("sandbox.deleteRun")}</button>
            </div>
            <div class="${J}">
                <div class="flex justify-between items-start mb-3">
                    <div class="grid grid-cols-3 sm:grid-cols-6 gap-4 flex-1">
                        <div><span class="${C}">${e("sandbox.status")}</span><br>${d(l.status)}</div>
                        <div><span class="${C}">${e("sandbox.turnsCompared")}</span><br>${l.turns_compared||0}</div>
                        <div><span class="${C}">${e("sandbox.sourceRating")}</span><br>${l.avg_source_rating!=null?parseFloat(l.avg_source_rating).toFixed(1):"-"}</div>
                        <div><span class="${C}">${e("sandbox.newRating")}</span><br>${l.avg_new_rating!=null?parseFloat(l.avg_new_rating).toFixed(1):"-"}</div>
                        <div><span class="${C}">${e("sandbox.avgSimilarity")}</span><br>${p.avg_similarity!=null?Math.round(p.avg_similarity*100)+"%":"-"}</div>
                        <div><span class="${C}">${e("sandbox.promptVersion")}</span><br>${d(l.prompt_version_name||"-")}</div>
                    </div>
                </div>
                ${$}
                ${l.error_message?`<div class="${D} mb-2 mt-2">${d(l.error_message)}</div>`:""}
                ${l.new_conversation_id?`<button class="${E} ${T} mt-2" onclick="window._pages.sandbox.openConversation('${l.new_conversation_id}');window._pages.sandbox.showTab('chat')">${e("sandbox.openNewConversation")}</button>`:""}
            </div>
            ${x}`}catch(r){n.innerHTML=`<div class="${k}">${e("sandbox.loadFailed",{error:d(r.message)})}</div>`}}async function _d(s){document.getElementById("sandboxReplayConvId").value=s;const n=document.getElementById("sandboxReplayPrompt");n.innerHTML="";try{const o=await g("/prompts"),a=o.versions||o.items||[];if(a.length===0){c(e("sandbox.regressionFailed",{error:"No prompt versions available"}),"error");return}for(const i of a){const r=i.is_active?" *":"";n.innerHTML+=`<option value="${i.id}">${d(i.name)}${r}</option>`}}catch{c(e("sandbox.regressionFailed",{error:"Failed to load versions"}),"error");return}document.getElementById("sandboxReplayModal").classList.add("show")}async function Cd(){const s=document.getElementById("sandboxReplayPrompt"),n=document.getElementById("sandboxReplayConvId").value,o=s==null?void 0:s.value;if(!o||!n)return;const a=document.querySelector('#sandboxReplayModal button[onclick*="submitReplay"]');a&&(a.disabled=!0,a.textContent="...");try{await g(`/admin/sandbox/conversations/${n}/replay`,{method:"POST",body:JSON.stringify({new_prompt_version_id:o})}),F("sandboxReplayModal"),c(e("sandbox.regressionStarted")),et("regression")}catch(i){c(e("sandbox.regressionFailed",{error:i.message}),"error")}finally{a&&(a.disabled=!1,a.textContent=e("sandbox.submitReplay"))}}async function Ed(s){if(confirm(e("sandbox.deleteRunConfirm")))try{await g(`/admin/sandbox/regression-runs/${s}`,{method:"DELETE"}),c(e("sandbox.runDeleted")),ms()}catch(n){c(n.message,"error")}}async function Id(s,n,o){try{await g(`/admin/sandbox/regression-runs/${s}/rate`,{method:"PATCH",body:JSON.stringify({turn_number:n,rating:o})}),c(e("sandbox.ratingSaved")),pn(s)}catch(a){c(a.message,"error")}}async function Bd(s,n){try{await g(`/admin/sandbox/regression-runs/${s}`,{method:"PATCH",body:JSON.stringify({verdict:n})}),c(e("sandbox.verdictSet")),pn(s)}catch(o){c(o.message,"error")}}async function Pd(){const s=document.getElementById("sandboxBatchReplayBody");if(s){s.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`,document.getElementById("sandboxBatchReplayModal").classList.add("show");try{const o=((await g("/admin/sandbox/conversations?limit=200&status=active")).items||[]).filter(p=>p.is_baseline),a=await g("/prompts"),i=a.versions||a.items||[];if(o.length===0){s.innerHTML=`<div class="${k}">${e("sandbox.noBaselines")}</div>`;return}const r=i.map(p=>{const m=p.is_active?" *":"";return`<option value="${p.id}">${d(p.name)}${m}</option>`}).join(""),l=o.map(p=>`
            <label class="flex items-center gap-2 text-sm py-1">
                <input type="checkbox" name="batchConvId" value="${p.id}" class="rounded">
                <span>${d(p.title)}</span>
                <span class="${C}">(${p.turns_count||0} ${e("sandbox.turnsCount").toLowerCase()})</span>
            </label>`).join("");s.innerHTML=`
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1">${e("sandbox.promptVersion")}</label>
                <select id="batchReplayPrompt" class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100">${r}</select>
            </div>
            <div class="mb-3">
                <div class="flex justify-between items-center mb-1">
                    <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300">${e("sandbox.selectBaselines")}</label>
                    <button type="button" class="text-xs text-blue-600 hover:text-blue-800" onclick="document.querySelectorAll('#sandboxBatchReplayBody input[name=batchConvId]').forEach(c=>c.checked=true)">${e("sandbox.selectAllBaselines")}</button>
                </div>
                <div class="max-h-[300px] overflow-y-auto border border-neutral-200 dark:border-neutral-700 rounded p-2">${l}</div>
            </div>`}catch(n){s.innerHTML=`<div class="${k}">${n.message}</div>`}}}async function Ld(){var i;const s=document.querySelectorAll("#sandboxBatchReplayBody input[name=batchConvId]:checked"),n=Array.from(s).map(r=>r.value);if(n.length===0){c(e("sandbox.batchSelectRequired"),"error");return}const o=(i=document.getElementById("batchReplayPrompt"))==null?void 0:i.value;if(!o)return;const a=document.querySelector('#sandboxBatchReplayModal button[onclick*="submitBatchReplay"]');a&&(a.disabled=!0,a.textContent=e("sandbox.batchRunning"));try{const r=await g("/admin/sandbox/regression-runs/batch",{method:"POST",body:JSON.stringify({conversation_ids:n,new_prompt_version_id:o})});F("sandboxBatchReplayModal"),c(e("sandbox.batchCompleted",{completed:r.completed,failed:r.failed})),ms()}catch(r){c(e("sandbox.batchFailed",{error:r.message}),"error")}finally{a&&(a.disabled=!1,a.textContent=e("sandbox.runBatchReplay"))}}async function Ad(s,n){try{await g(`/admin/sandbox/conversations/${s}`,{method:"PATCH",body:JSON.stringify({is_baseline:!n})}),R===s?await Me(s):ne()}catch(o){c(e("sandbox.loadFailed",{error:o.message}),"error")}}async function zt(){const s=document.getElementById("sandboxPatternsContainer");s.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;try{const o=(await g("/admin/sandbox/patterns?limit=100")).items||[];if(o.length===0){s.innerHTML=`<div class="${k}">${e("sandbox.noPatterns")}</div>`;return}const a=o.map(i=>{var v;const r=i.pattern_type==="positive"?`<span class="${L}">+</span>`:`<span class="${D}">&minus;</span>`,l=i.is_active?'<span class="inline-block w-2 h-2 rounded-full bg-emerald-500" title="Active"></span>':'<span class="inline-block w-2 h-2 rounded-full bg-neutral-300 dark:bg-neutral-600" title="Inactive"></span>',p=(i.tags||[]).join(", "),m=i.rating?"&#9733;".repeat(i.rating):"-",h=i.is_active?e("common.deactivate"):e("common.activate");return`
                <tr class="${_}">
                    <td class="${u}" data-label="${e("sandbox.intentLabel")}">
                        <div class="flex items-center gap-1.5">${l} ${r} <span class="truncate" title="${d(i.intent_label)}">${d(i.intent_label)}</span></div>
                    </td>
                    <td class="${u}" data-label="${e("sandbox.guidanceNote")}"><div class="truncate text-xs" title="${d(i.guidance_note)}">${d(i.guidance_note)}</div></td>
                    <td class="${u}" data-label="${e("sandbox.customerMessages")}"><div class="truncate text-xs" title="${d(i.customer_messages||"")}">${d(((v=i.customer_messages)==null?void 0:v.substring(0,60))||"-")}</div></td>
                    <td class="${u} text-center" data-label="${e("sandbox.avgRating")}"><span class="text-amber-400 text-xs">${m}</span></td>
                    <td class="${u} text-center text-xs" data-label="#">${i.times_used}${p?` <span class="text-neutral-400" title="${d(p)}">&#128196;</span>`:""}</td>
                    <td class="${V}">
                        <div class="relative inline-block">
                            <button class="px-1.5 py-0.5 text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 text-sm cursor-pointer" onclick="this.nextElementSibling.classList.toggle('hidden')">&hellip;</button>
                            <div class="hidden absolute right-0 z-20 mt-1 w-36 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-md shadow-lg py-1">
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="this.closest('.relative').querySelector('.hidden')||this.parentElement.classList.add('hidden');window._pages.sandbox.showEditPatternModal('${i.id}')">${e("common.edit")}</button>
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="this.closest('.relative').querySelector('.hidden')||this.parentElement.classList.add('hidden');window._pages.sandbox.togglePatternActive('${i.id}', ${i.is_active})">${h}</button>
                                <button class="w-full text-left px-3 py-1.5 text-xs text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950/30 cursor-pointer" onclick="this.closest('.relative').querySelector('.hidden')||this.parentElement.classList.add('hidden');window._pages.sandbox.deletePattern('${i.id}')">${e("common.delete")}</button>
                            </div>
                        </div>
                    </td>
                </tr>`}).join("");s.innerHTML=`
            <div class="mb-4 flex flex-wrap items-center gap-2">
                <input type="text" id="patternSearchQuery" placeholder="${e("sandbox.testSearchHint")}"
                    class="${js} flex-1"
                    onkeydown="if(event.key==='Enter')window._pages.sandbox.testSearch()">
                <button class="${E} ${T}" onclick="window._pages.sandbox.testSearch()">${e("sandbox.testSearch")}</button>
            </div>
            <div id="patternSearchResults" class="mb-4"></div>
            <table class="${A} table-fixed w-full"><thead><tr>
                <th class="${b}" style="width:20%">${e("sandbox.intentLabel")}</th>
                <th class="${b}" style="width:30%">${e("sandbox.guidanceNote")}</th>
                <th class="${b}" style="width:25%">${e("sandbox.customerMessages")}</th>
                <th class="${b} text-center" style="width:8%">${e("sandbox.avgRating")}</th>
                <th class="${b} text-center" style="width:9%">#</th>
                <th class="${b} text-right" style="width:8%"></th>
            </tr></thead><tbody>${a}</tbody></table>`}catch(n){s.innerHTML=`<div class="${k}">${e("sandbox.loadFailed",{error:d(n.message)})}</div>`}}function Hd(s){const n=document.getElementById("editPatternIntentCheckboxes"),o=s.map(l=>l.trim()).filter(Boolean),a=Ms.filter(l=>l.value!=="other").map(l=>l.value),i=o.filter(l=>!a.includes(l));n.innerHTML=Ms.filter(l=>l.value!=="other").map(l=>{const p=o.includes(l.value)?"checked":"";return`<label class="flex items-center gap-1.5 text-xs text-neutral-700 dark:text-neutral-300 cursor-pointer">
            <input type="checkbox" value="${l.value}" ${p} class="editPatternIntentCb cursor-pointer"> ${e(l.i18nKey)}
        </label>`}).join("")+`<label class="flex items-center gap-1.5 text-xs text-neutral-700 dark:text-neutral-300 cursor-pointer">
        <input type="checkbox" value="__other__" ${i.length?"checked":""} class="editPatternIntentCb cursor-pointer"
            onchange="document.getElementById('editPatternIntentCustom').classList.toggle('hidden', !this.checked)"> ${e("sandbox.intentOther")}
    </label>`;const r=document.getElementById("editPatternIntentCustom");r.value=i.join(", "),r.classList.toggle("hidden",!i.length)}function Md(){const s=document.querySelectorAll(".editPatternIntentCb:checked"),n=[];let o=!1;if(s.forEach(a=>{if(a.value==="__other__"){o=!0;return}n.push(a.value)}),o){const a=document.getElementById("editPatternIntentCustom").value.trim();a&&a.split(",").map(i=>i.trim()).filter(Boolean).forEach(i=>{n.includes(i)||n.push(i)})}return n.join(", ")}async function Dd(s){try{const o=(await g(`/admin/sandbox/patterns/${s}`)).item;document.getElementById("editPatternId").value=s,Hd((o.intent_label||"").split(",")),document.getElementById("editPatternGuidance").value=o.guidance_note||"",document.getElementById("editPatternTags").value=(o.tags||[]).join(", "),document.getElementById("sandboxEditPatternModal").classList.add("show")}catch(n){c(e("sandbox.loadFailed",{error:n.message}),"error")}}async function Rd(){const s=document.getElementById("editPatternId").value,n=Md();if(!n){c(e("sandbox.intentRequired"),"error");return}const o=document.getElementById("editPatternGuidance").value.trim();if(!o){c(e("sandbox.guidanceRequired"),"error");return}const a=document.getElementById("editPatternTags").value.trim(),i=a?a.split(",").map(r=>r.trim()).filter(Boolean):[];try{await g(`/admin/sandbox/patterns/${s}`,{method:"PATCH",body:JSON.stringify({intent_label:n,guidance_note:o,tags:i})}),F("sandboxEditPatternModal"),c(e("sandbox.patternSaved")),zt()}catch(r){c(e("sandbox.loadFailed",{error:r.message}),"error")}}async function Fd(s,n){try{await g(`/admin/sandbox/patterns/${s}`,{method:"PATCH",body:JSON.stringify({is_active:!n})}),zt()}catch(o){c(e("sandbox.loadFailed",{error:o.message}),"error")}}async function Od(s){if(!confirm(e("sandbox.deleteConfirm",{title:"pattern"})))return;const n=document.querySelector(`[onclick*="deletePattern('${s}')"]`);n&&(n.disabled=!0,n.innerHTML="...");try{await g(`/admin/sandbox/patterns/${s}`,{method:"DELETE"}),zt()}catch(o){c(e("sandbox.loadFailed",{error:o.message}),"error"),n&&(n.disabled=!1,n.innerHTML="&times;")}}async function Nd(){var o,a;const s=(a=(o=document.getElementById("patternSearchQuery"))==null?void 0:o.value)==null?void 0:a.trim();if(!s)return;const n=document.getElementById("patternSearchResults");n.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;try{const i=new URLSearchParams({query:s,top_k:"5",min_similarity:"0.5"}),l=(await g(`/admin/sandbox/patterns/search-test?${i}`,{method:"POST"})).results||[];if(l.length===0){n.innerHTML=`<div class="${C} p-2">${e("sandbox.noPatterns")}</div>`;return}const p=l.map(m=>{const h=(parseFloat(m.similarity)*100).toFixed(1);return`
                <div class="flex items-center gap-2 p-2 rounded bg-neutral-50 dark:bg-neutral-800 mb-1">
                    ${m.pattern_type==="positive"?`<span class="${L}">+</span>`:`<span class="${D}">&minus;</span>`}
                    <span class="text-sm font-medium">${d(m.intent_label)}</span>
                    <span class="${N}">${h}%</span>
                    <span class="${C} text-xs truncate flex-1">${d(m.guidance_note)}</span>
                </div>`}).join("");n.innerHTML=`
            <div class="text-xs font-semibold text-neutral-500 mb-1">${e("sandbox.similarity")} (${l.length})</div>
            ${p}`}catch(i){n.innerHTML=`<div class="${C} p-2">${d(i.message)}</div>`}}async function Ao(){const s=document.getElementById("sandboxPhrasesContainer");s.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;try{const n=await g("/admin/sandbox/agent-phrases"),o=n.fixed||[],a=n.wait_pools||[],i=n.db_templates||{},r=Object.keys(i).length>0;let l="";if(r){const h=Object.entries(i).map(([v,x])=>{var $,w;const f=x.filter(S=>S.is_active).length,y=x.map((S,B)=>`
                    <div class="py-1.5 ${B>0?"border-t border-neutral-100 dark:border-neutral-800":""}">
                        <div class="flex items-center gap-2">
                            <span class="${C} text-xs">#${S.variant_number}</span>
                            ${S.is_active?"":`<span class="text-[10px] px-1.5 py-0.5 rounded bg-neutral-200 dark:bg-neutral-700 text-neutral-500 dark:text-neutral-400">${e("sandbox.phrasesInactive")}</span>`}
                            <span class="text-xs text-neutral-600 dark:text-neutral-400">${d(S.title)}</span>
                        </div>
                        <div class="font-mono text-xs mt-0.5 ${S.is_active?"":"opacity-40 line-through"}">${d(S.content)}</div>
                    </div>`).join("");return`
                    <tr class="${_}">
                        <td class="${u}" data-label="${e("sandbox.phrasesKey")}">
                            <span class="${xn}">${d(v)}</span>
                            <div class="${C} text-xs mt-1">${e("sandbox.phrasesDbVariants",{active:f,total:x.length})}</div>
                        </td>
                        <td class="${u}" data-label="${e("sandbox.phrasesText")}">
                            <details>
                                <summary class="cursor-pointer text-xs text-blue-600 dark:text-blue-400">${d((($=x.find(S=>S.is_active))==null?void 0:$.content)||((w=x[0])==null?void 0:w.content)||"")}</summary>
                                <div class="mt-1 pl-2 border-l-2 border-purple-200 dark:border-purple-800">${y}</div>
                            </details>
                        </td>
                    </tr>`}).join("");l=`
                <div class="mb-6 p-3 bg-purple-50 dark:bg-purple-950/20 rounded-md border border-purple-200 dark:border-purple-800">
                    <h2 class="text-sm font-semibold text-purple-900 dark:text-purple-100 mb-1">${e("sandbox.phrasesDbTitle")}</h2>
                    <p class="text-xs text-purple-700 dark:text-purple-300 mb-3">${e("sandbox.phrasesDbDescription")}</p>
                    <div class="overflow-x-auto">
                        <table class="${A}">
                            <thead><tr>
                                <th class="${b}" style="width:200px">${e("sandbox.phrasesKey")}</th>
                                <th class="${b}">${e("sandbox.phrasesText")}</th>
                            </tr></thead>
                            <tbody>${h}</tbody>
                        </table>
                    </div>
                </div>`}const p=o.map(h=>{const v=!!i[h.key];return`
            <tr class="${_} ${v?"opacity-50":""}">
                <td class="${u}" data-label="${e("sandbox.phrasesKey")}"><span class="${N}">${d(h.label)}</span></td>
                <td class="${u} font-mono text-xs whitespace-pre-wrap" data-label="${e("sandbox.phrasesText")}">${d(h.text)}</td>
                <td class="${u}" data-label="${e("sandbox.phrasesStatus")}">
                    ${v?`<span class="${xn}">${e("sandbox.phrasesOverridden")}</span>`:`<span class="${L}">${e("sandbox.phrasesActive")}</span>`}
                </td>
            </tr>`}).join(""),m=a.map(h=>{const v=h.phrases.map((x,f)=>`
                <div class="py-1 ${f>0?"border-t border-neutral-100 dark:border-neutral-800":""}">
                    <span class="${C} text-xs mr-2">#${f+1}</span>
                    <span class="font-mono text-xs">${d(x)}</span>
                </div>`).join("");return`
                <tr class="${_}">
                    <td class="${u}" data-label="${e("sandbox.phrasesKey")}">
                        <span class="${q}">${d(h.label)}</span>
                        <div class="${C} text-xs mt-1">${e("sandbox.phrasesPoolLabel",{count:h.phrases.length})}</div>
                    </td>
                    <td class="${u}" data-label="${e("sandbox.phrasesText")}">
                        <details>
                            <summary class="cursor-pointer text-xs text-blue-600 dark:text-blue-400">${d(h.phrases[0])}</summary>
                            <div class="mt-1 pl-2 border-l-2 border-blue-200 dark:border-blue-800">${v}</div>
                        </details>
                    </td>
                    <td class="${u}" data-label="${e("sandbox.phrasesStatus")}"><span class="${L}">${e("sandbox.phrasesActive")}</span></td>
                </tr>`}).join("");s.innerHTML=`
            <div class="mb-4">
                <h2 class="text-sm font-semibold text-neutral-900 dark:text-neutral-50 mb-1">${e("sandbox.phrasesTitle")}</h2>
                <p class="${C} text-xs mb-4">${e("sandbox.phrasesDescription")}</p>
            </div>

            ${l}

            <h3 class="text-xs font-semibold text-neutral-700 dark:text-neutral-300 mb-2">${e("sandbox.phrasesCatFixed")}</h3>
            <div class="overflow-x-auto mb-6">
                <table class="${A}">
                    <thead><tr>
                        <th class="${b}" style="width:200px">${e("sandbox.phrasesKey")}</th>
                        <th class="${b}">${e("sandbox.phrasesText")}</th>
                        <th class="${b}" style="width:140px">${e("sandbox.phrasesStatus")}</th>
                    </tr></thead>
                    <tbody>${p}</tbody>
                </table>
            </div>

            <h3 class="text-xs font-semibold text-neutral-700 dark:text-neutral-300 mb-2">${e("sandbox.phrasesCatWait")}</h3>
            <div class="overflow-x-auto mb-6">
                <table class="${A}">
                    <thead><tr>
                        <th class="${b}" style="width:200px">${e("sandbox.phrasesKey")}</th>
                        <th class="${b}">${e("sandbox.phrasesText")}</th>
                        <th class="${b}" style="width:140px">${e("sandbox.phrasesStatus")}</th>
                    </tr></thead>
                    <tbody>${m}</tbody>
                </table>
            </div>

            <div class="p-3 bg-amber-50 dark:bg-amber-950/20 rounded-md border border-amber-200 dark:border-amber-800">
                <p class="text-xs text-amber-700 dark:text-amber-300">${e("sandbox.phrasesLlmNote")}</p>
            </div>`}catch(n){s.innerHTML=`<div class="${k}">${e("sandbox.phrasesLoadFailed",{error:d(n.message)})}</div>`}}async function Ge(s){s!==void 0&&(wt=s);const n=document.getElementById("sandboxStartersContainer");n.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;try{const o=re({offset:wt,filters:{search:"starterSearch",scenario_type:"starterFilterScenario",is_active:"starterFilterActive"}}),a=await g(`/admin/sandbox/scenario-starters?${o}`),i=a.items||[],r=a.total||0;if(i.length===0){n.innerHTML=`
                <div class="${k}">${e("sandbox.noStarters")}</div>`,K({containerId:"startersPagination",total:0,offset:wt,onPage:Ge});return}const l=i.map(p=>{const m=p.scenario_type?`<span class="${M}">${d(p.scenario_type)}</span>`:"",h=p.customer_persona?`<span class="${N}">${d(p.customer_persona)}</span>`:"",v=p.is_active!==!1?'<span class="inline-block w-2 h-2 rounded-full bg-emerald-500" title="Active"></span>':'<span class="inline-block w-2 h-2 rounded-full bg-neutral-300 dark:bg-neutral-600" title="Inactive"></span>';return`
                <tr class="${_}">
                    <td class="${u}" data-label="${e("sandbox.starterTitle")}"><div class="flex items-center gap-1.5">${v}<span class="font-medium">${d(p.title)}</span></div></td>
                    <td class="${u}" data-label="${e("sandbox.starterFirstMessage")}"><div class="max-w-xs truncate text-xs">${d(p.first_message)}</div></td>
                    <td class="${u}" data-label="${e("sandbox.scenarioType")}">${m}</td>
                    <td class="${u}" data-label="${e("sandbox.starterPersona")}">${h}</td>
                    <td class="${u}" data-label="${e("sandbox.starterDescription")}"><div class="max-w-xs truncate text-xs">${d(p.description||"")}</div></td>
                    <td class="${V}">
                        <div class="flex gap-1">
                            <button class="${G} ${T}" onclick="window._pages.sandbox.showStarterModal('${p.id}')">${e("common.edit")}</button>
                            <button class="${Ht} ${T}" onclick="window._pages.sandbox.deleteStarter('${p.id}', '${d(p.title).replace(/'/g,"\\'")}')">&times;</button>
                        </div>
                    </td>
                </tr>`}).join("");n.innerHTML=`
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-sm font-semibold text-neutral-900 dark:text-neutral-50">${e("sandbox.starters")} (${r})</h2>
            </div>
            <div class="overflow-x-auto"><table id="startersTable" class="${A}"><thead><tr>
                <th class="${P}" data-sortable>${e("sandbox.starterTitle")}</th>
                <th class="${b}">${e("sandbox.starterFirstMessage")}</th>
                <th class="${P}" data-sortable>${e("sandbox.scenarioType")}</th>
                <th class="${P}" data-sortable>${e("sandbox.starterPersona")}</th>
                <th class="${b}">${e("sandbox.starterDescription")}</th>
                <th class="${b}"></th>
            </tr></thead><tbody>${l}</tbody></table></div>`,Q("startersTable"),K({containerId:"startersPagination",total:r,offset:wt,onPage:Ge})}catch(o){n.innerHTML=`<div class="${k}">${e("sandbox.loadFailed",{error:d(o.message)})}</div>`,K({containerId:"startersPagination",total:0,offset:wt,onPage:Ge})}}async function Kd(s){document.getElementById("sandboxStarterEditId").value=s||"",document.getElementById("sandboxStarterTitle").value="",document.getElementById("sandboxStarterFirstMsg").value="",document.getElementById("sandboxStarterDesc").value="",document.getElementById("sandboxStarterScenario").value="",document.getElementById("sandboxStarterPersona").value="neutral";const n=document.getElementById("sandboxStarterModalTitle");if(s){n.textContent=e("sandbox.editStarter");try{const o=await g(`/admin/sandbox/scenario-starters/${s}`),a=o.item||o;document.getElementById("sandboxStarterTitle").value=a.title||"",document.getElementById("sandboxStarterFirstMsg").value=a.first_message||"",document.getElementById("sandboxStarterDesc").value=a.description||"",document.getElementById("sandboxStarterScenario").value=a.scenario_type||"",document.getElementById("sandboxStarterPersona").value=a.customer_persona||"neutral"}catch{}}else n.textContent=e("sandbox.newStarter");document.getElementById("sandboxStarterModal").classList.add("show")}async function qd(){const s=document.getElementById("sandboxStarterEditId").value,n=document.getElementById("sandboxStarterTitle").value.trim(),o=document.getElementById("sandboxStarterFirstMsg").value.trim();if(!n||!o){c(e("sandbox.starterTitleRequired"),"error");return}const a={title:n,first_message:o,description:document.getElementById("sandboxStarterDesc").value.trim()||null,scenario_type:document.getElementById("sandboxStarterScenario").value||null,customer_persona:document.getElementById("sandboxStarterPersona").value||"neutral"};try{s?await g(`/admin/sandbox/scenario-starters/${s}`,{method:"PATCH",body:JSON.stringify(a)}):await g("/admin/sandbox/scenario-starters",{method:"POST",body:JSON.stringify(a)}),F("sandboxStarterModal"),c(e("sandbox.starterSaved")),Ge()}catch(i){c(e("sandbox.loadFailed",{error:i.message}),"error")}}async function Ud(s,n){if(!confirm(e("sandbox.deleteStarterConfirm",{title:n})))return;const o=document.querySelector(`[onclick*="deleteStarter('${s}'"]`);o&&(o.disabled=!0,o.innerHTML="...");try{await g(`/admin/sandbox/scenario-starters/${s}`,{method:"DELETE"}),c(e("sandbox.starterDeleted")),Ge()}catch(a){c(e("sandbox.loadFailed",{error:a.message}),"error"),o&&(o.disabled=!1,o.innerHTML="&times;")}}function Gd(s){const n=Bo[s];n&&Ho(n)}async function Ho(s){var i,r;const n=((i=document.getElementById("sandboxConvModel"))==null?void 0:i.value)||null,o=((r=document.getElementById("sandboxConvToolMode"))==null?void 0:r.value)||"mock",a={title:s.title,tool_mode:o,tags:[]};n&&(a.model=n),s.scenario_type&&(a.scenario_type=s.scenario_type);try{const p=(await g("/admin/sandbox/conversations",{method:"POST",body:JSON.stringify(a)})).item.id;R=p,await g(`/admin/sandbox/conversations/${p}/send`,{method:"POST",body:JSON.stringify({message:s.first_message})}),F("sandboxNewConvModal"),c(e("sandbox.created")),ne(),et("chat")}catch(l){c(e("sandbox.loadFailed",{error:l.message}),"error")}}function zd(){Ce=!Ce,Z.clear(),ne()}function Vd(s){Z.has(s)?Z.delete(s):Z.add(s),ne()}function jd(){document.querySelectorAll('#sandboxSidebarList input[type="checkbox"]').forEach(s=>{const o=(s.getAttribute("onclick")||"").match(/toggleBulkSelect\('([^']+)'\)/);o&&Z.add(o[1])}),ne()}function Wd(){Z.clear(),ne()}async function Jd(){var s;if(Z.size!==0&&confirm(e("sandbox.bulkDeleteConfirm",{count:Z.size})))try{const n=await g("/admin/sandbox/conversations/bulk-delete",{method:"POST",body:JSON.stringify({conversation_ids:Array.from(Z)})}),o=e("sandbox.bulkDeleted",{deleted:n.deleted,skipped:n.skipped});c(o),n.skipped>0&&c(e("sandbox.bulkSkipped"),"warning"),R&&Z.has(R)&&!((s=n.skipped_ids)!=null&&s.includes(R))&&(R=null,$e=null,Be=[],Ut()),Z.clear(),Ce=!1,ne()}catch(n){c(e("sandbox.loadFailed",{error:n.message}),"error")}}function Qd(){document.getElementById("importCallSearch").value="",document.getElementById("importCallDateFrom").value="",document.getElementById("importCallDateTo").value="",document.getElementById("importCallsTableContainer").innerHTML="",document.getElementById("importCallsPagination").innerHTML="",document.getElementById("importCallTranscript").innerHTML=`<p class="text-neutral-400 dark:text-neutral-500 text-center py-8">${e("sandbox.importCallSelectToPreview")}</p>`,document.getElementById("importCallPreviewHeader").innerHTML=`<h4 class="text-sm font-semibold text-neutral-700 dark:text-neutral-300">${e("sandbox.importCallPreview")}</h4>`,document.getElementById("sandboxImportCallModal").classList.add("show"),un(0)}async function un(s){const o=document.getElementById("importCallSearch").value.trim(),a=document.getElementById("importCallDateFrom").value,i=document.getElementById("importCallDateTo").value,r=new URLSearchParams({limit:15,offset:s});o&&r.set("search",o),a&&r.set("date_from",a),i&&r.set("date_to",i);const l=document.getElementById("importCallsTableContainer");try{const p=await g(`/analytics/calls?${r}`),m=p.items||p.calls||[],h=p.total||m.length;if(!m.length){l.innerHTML=`<p class="text-sm text-neutral-500 dark:text-neutral-400 py-4 text-center">${e("sandbox.importCallsNone")}</p>`,document.getElementById("importCallsPagination").innerHTML="";return}l.innerHTML=`<table class="${A}">
            <thead><tr>
                <th class="${b}">${e("calls.date")}</th>
                <th class="${b}">${e("calls.caller")}</th>
                <th class="${b}">${e("calls.scenario")}</th>
                <th class="${b}">${e("calls.duration")}</th>
                <th class="${b}">${e("calls.quality")}</th>
            </tr></thead>
            <tbody>${m.map(v=>`<tr class="${_} cursor-pointer" data-call-id="${v.id}" onclick="window._pages.sandbox.previewCall('${v.id}', this)">
                <td class="${u}">${z(v.started_at||v.created_at)}</td>
                <td class="${u}">${d(v.caller_number||"-")}</td>
                <td class="${u}">${d(v.scenario||"-")}</td>
                <td class="${u}">${v.duration_seconds||0}s</td>
                <td class="${u}">${ye(v.quality_score)}</td>
            </tr>`).join("")}</tbody></table>`,K(document.getElementById("importCallsPagination"),{offset:s,limit:15,total:h,onPage:v=>un(v)})}catch(p){l.innerHTML=`<p class="text-sm text-red-500 py-4 text-center">${d(p.message)}</p>`}}async function Yd(s,n){const o=n.closest("table");o&&o.querySelectorAll("tr.ring-2").forEach(r=>{r.classList.remove("ring-2","ring-blue-500","bg-blue-50","dark:bg-blue-950/20")}),n.classList.add("ring-2","ring-blue-500","bg-blue-50","dark:bg-blue-950/20");const a=document.getElementById("importCallTranscript"),i=document.getElementById("importCallPreviewHeader");a.innerHTML='<div class="flex justify-center py-8"><div class="spinner"></div></div>',i&&(i.innerHTML=`<h4 class="text-sm font-semibold text-neutral-700 dark:text-neutral-300">${e("sandbox.importCallPreview")}</h4>
        <button class="${E} ${T}" id="importCallPreviewBtn" onclick="window._pages.sandbox.importCallById('${s}', this)">${e("sandbox.importBtn")}</button>`);try{const r=await g(`/analytics/calls/${s}`),l=r.call,p=r.turns||[];let m=`<div class="grid grid-cols-2 gap-2 mb-3 p-2 bg-neutral-50 dark:bg-neutral-800 rounded-md text-xs">
            <div><span class="text-neutral-500 dark:text-neutral-400">${e("calls.caller")}:</span> ${d(l.caller_id||l.caller_number||"-")}</div>
            <div><span class="text-neutral-500 dark:text-neutral-400">${e("calls.scenario")}:</span> ${d(l.scenario||"-")}</div>
            <div><span class="text-neutral-500 dark:text-neutral-400">${e("calls.quality")}:</span> ${ye(l.quality_score)}</div>
            <div><span class="text-neutral-500 dark:text-neutral-400">${e("calls.duration")}:</span> ${l.duration_seconds||0}s</div>
        </div>`;p.length===0?m+=`<p class="text-neutral-400 text-center py-4">${e("calls.noTranscription")}</p>`:p.forEach(h=>{const v=h.speaker==="customer";m+=`<div class="${Gn}">
                    <span class="${v?Ws:Js}">${e(v?"calls.customer":"calls.bot")}</span>
                    <div class="${Qs}">${d(h.text)}</div>
                </div>`}),a.innerHTML=m}catch(r){a.innerHTML=`<p class="text-red-500 text-center py-4">${d(r.message)}</p>`}}async function Xd(s,n){var a;const o=n.textContent;n.disabled=!0,n.textContent=e("sandbox.importingCall");try{const i=await g("/admin/sandbox/conversations/import-call",{method:"POST",body:JSON.stringify({call_id:s})});F("sandboxImportCallModal"),c(e("sandbox.importedCall")),R=((a=i.item)==null?void 0:a.id)||i.id,ne(),et("chat")}catch(i){c(e("sandbox.importCallFailed",{error:i.message}),"error"),n.disabled=!1,n.textContent=o}}function Zd(){j("sandbox",()=>{ne(),et(cn)}),document.addEventListener("click",s=>{s.target.closest(".relative")||document.querySelectorAll("#page-sandbox .relative > div:not(.hidden)").forEach(n=>n.classList.add("hidden"))})}window._pages=window._pages||{};window._pages.sandbox={showTab:et,loadSidebar:ne,openConversation:Td,showNewConvModal:wd,createConversation:kd,sendMessage:md,rateTurn:hd,saveRating:bd,cancelRating:vd,archiveConversation:$d,deleteConversation:Sd,branchFrom:fd,submitBranch:yd,autoCustomer:xd,loadRegressionRuns:ms,showRegressionDetail:pn,replayConversation:_d,submitReplay:Cd,deleteRegressionRun:Ed,rateRegressionTurn:Id,setVerdict:Bd,showBatchReplayModal:Pd,submitBatchReplay:Ld,toggleBaseline:Ad,toggleMarking:sd,toggleTurnSelect:nd,showGroupModal:id,submitGroup:ld,onIntentChange:rd,selectPatternType:Po,deleteGroup:dd,showExportModal:cd,generateGuidance:Lo,submitExport:pd,loadPatterns:zt,showEditPatternModal:Dd,savePattern:Rd,togglePatternActive:Fd,deletePattern:Od,testSearch:Nd,changeModel:gd,loadPhrases:Ao,toggleBulkMode:zd,toggleBulkSelect:Vd,selectAll:jd,deselectAll:Wd,bulkDelete:Jd,loadStarters:Ge,showStarterModal:Kd,saveStarter:qd,deleteStarter:Ud,useStarter:Ho,useStarterByIndex:Gd,showImportCallModal:Qd,loadImportCalls:un,previewCall:Yd,importCallById:Xd};let ds=[],Rs=!1;async function ec(){try{ds=(await g("/admin/tenants?is_active=true&limit=100")).tenants||[]}catch{ds=[]}}function tc(){["onecPickupNetwork","onecStockNetwork"].forEach(s=>{const n=document.getElementById(s);if(!n||ds.length===0)return;const o=n.value;n.innerHTML="";for(const a of ds){if(!a.network_id)continue;const i=document.createElement("option");i.value=a.network_id,i.textContent=`${a.name} (${a.network_id})`,a.network_id===o&&(i.selected=!0),n.appendChild(i)}if(n.options.length===0){const a=document.createElement("option");a.value="ProKoleso",a.textContent="ProKoleso",n.appendChild(a)}})}function sc(s){var o;(o=window._app)!=null&&o.toggleAccordion&&window._app.toggleAccordion(s);const n=s.closest(".acc-section");if(n&&n.dataset.open==="true"){const a=n.querySelector(".acc-body");a!=null&&a.querySelector("#onecPickupContainer")&&!Rs&&(Rs=!0,gn())}}async function Sn(){Rs=!1,await ec(),tc(),await nc()}async function nc(){const s=document.getElementById("onecStatusContainer");if(s){s.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;try{const n=await g("/admin/onec/status");let o;n.status==="reachable"?o=`<span class="${L}">${e("onec.connected")}</span>`:n.status==="not_configured"?o=`<span class="${M}">${e("onec.notConfigured")}</span>`:o=`<span class="${D}">${e("onec.disconnected")}</span>`;let a="";const i=Object.keys(n.pickup_cache||{});if(i.length>0){const r=i.map(l=>{const p=n.pickup_cache[l],m=(n.stock_cache||{})[l],h=p?Mo(p.cache_age_seconds):"—",v=p?p.count:0,x=m?m.count:0;return`<tr class="${_}">
                    <td class="${u} font-medium">${d(l)}</td>
                    <td class="${u}">${v}</td>
                    <td class="${u}">${x}</td>
                    <td class="${u}">${h}</td>
                </tr>`}).join("");a=`
                <table class="${A} mt-3">
                    <thead><tr>
                        <th class="${b}">${e("onec.network")}</th>
                        <th class="${b}">${e("onec.pickupPoints")}</th>
                        <th class="${b}">SKU</th>
                        <th class="${b}">${e("onec.cacheAge")}</th>
                    </tr></thead>
                    <tbody>${r}</tbody>
                </table>`}s.innerHTML=`
            <div class="flex items-center gap-3 mb-2">
                <span class="text-sm text-neutral-500 dark:text-neutral-400">${e("onec.status")}:</span>
                ${o}
                ${n.error?`<span class="text-xs text-red-500">${d(n.error)}</span>`:""}
            </div>
            ${a}
        `,oc(n)}catch(n){s.innerHTML=`<div class="${k}">${e("common.failedToLoad",{error:n.message})}</div>`}}}function _n(s){return s==="reachable"?`<span class="${L}">${e("onec.connected")}</span>`:s==="not_configured"?`<span class="${M}">${e("onec.notConfigured")}</span>`:s==="unreachable"?`<span class="${D}">${e("onec.disconnected")}</span>`:`<span class="${q}">${d(s)}</span>`}function oc(s){const n=document.getElementById("onecSoapStatusContainer");if(!n)return;if(!s.soap_status&&s.ai_orders_total==null){n.innerHTML="";return}const o=s.ai_orders_total!=null?s.ai_orders_total:"—";let a='<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3">';s.soap_status&&(a+=`<div class="rounded-lg border border-neutral-200 dark:border-neutral-700 p-3">
            <div class="text-xs text-neutral-500 dark:text-neutral-400 mb-1">${e("onec.soapStatus")}</div>
            <div class="text-sm font-medium mb-1">${_n(s.soap_status)}</div>
            ${s.soap_endpoint?`<div class="text-xs text-neutral-400 dark:text-neutral-500 font-mono truncate" title="${d(s.soap_endpoint)}">${d(s.soap_endpoint)}</div>`:""}
        </div>`),s.rest_endpoint&&(a+=`<div class="rounded-lg border border-neutral-200 dark:border-neutral-700 p-3">
            <div class="text-xs text-neutral-500 dark:text-neutral-400 mb-1">${e("onec.restStatus")}</div>
            <div class="text-sm font-medium mb-1">${_n(s.status||"not_configured")}</div>
            <div class="text-xs text-neutral-400 dark:text-neutral-500 font-mono truncate" title="${d(s.rest_endpoint)}">${d(s.rest_endpoint)}</div>
        </div>`),a+=`<div class="rounded-lg border border-neutral-200 dark:border-neutral-700 p-3">
        <div class="text-xs text-neutral-500 dark:text-neutral-400 mb-1">${e("onec.aiOrders")}</div>
        <div class="text-2xl font-bold text-neutral-900 dark:text-neutral-50">${d(String(o))}</div>
        <div class="text-xs text-neutral-400 dark:text-neutral-500">${e("onec.aiOrdersHint")}</div>
    </div>`,s.soap_timeout&&(a+=`<div class="rounded-lg border border-neutral-200 dark:border-neutral-700 p-3">
            <div class="text-xs text-neutral-500 dark:text-neutral-400 mb-1">${e("onec.soapTimeout")}</div>
            <div class="text-2xl font-bold text-neutral-900 dark:text-neutral-50">${s.soap_timeout}<span class="text-sm font-normal text-neutral-400 ml-1">${e("common.seconds")}</span></div>
        </div>`),a+="</div>",n.innerHTML=a}function Mo(s){return s==null?"—":s<60?`${s}s`:s<3600?`${Math.floor(s/60)}m`:`${Math.floor(s/3600)}h ${Math.floor(s%3600/60)}m`}async function gn(){var a,i;const s=document.getElementById("onecPickupContainer");if(!s)return;s.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;const n=((a=document.getElementById("onecPickupNetwork"))==null?void 0:a.value)||"ProKoleso",o=((i=document.getElementById("onecPickupCity"))==null?void 0:i.value)||"";try{const r=new URLSearchParams({network:n});o&&r.set("city",o);const l=await g(`/admin/onec/pickup-points?${r}`);if(!l.points||l.points.length===0){s.innerHTML=`<div class="${k}">${e("onec.noData")}</div>`;return}const p=l.source==="cache"?`<span class="${M}">cache</span>`:l.source==="live"?`<span class="${L}">live</span>`:`<span class="${D}">${l.source}</span>`,m=l.cache_age_seconds!=null?`<span class="text-xs text-neutral-400 ml-2">${e("onec.cacheAge")}: ${Mo(l.cache_age_seconds)}</span>`:"",h=l.points.map(v=>`
            <tr class="${_}">
                <td class="${u} font-mono text-xs">${d(v.id||"")}</td>
                <td class="${u}">${d(v.address||"")}</td>
                <td class="${u}">${d(v.city||"")}</td>
                <td class="${u}">${d(v.type||"")}</td>
            </tr>
        `).join("");s.innerHTML=`
            <div class="flex items-center gap-2 mb-2">
                <span class="text-sm text-neutral-500 dark:text-neutral-400">${e("common.showing",{shown:l.points.length,total:l.total})}</span>
                ${p}
                ${m}
            </div>
            <div class="overflow-x-auto">
                <table class="${A}">
                    <thead><tr>
                        <th class="${b}">ID</th>
                        <th class="${b}">${e("onec.address")}</th>
                        <th class="${b}">${e("onec.city")}</th>
                        <th class="${b}">${e("onec.type")}</th>
                    </tr></thead>
                    <tbody>${h}</tbody>
                </table>
            </div>
        `}catch(r){s.innerHTML=`<div class="${k}">${e("common.failedToLoad",{error:r.message})}</div>`}}async function ac(){var a,i;const s=((a=document.getElementById("onecPickupNetwork"))==null?void 0:a.value)||"ProKoleso",n=((i=document.getElementById("onecPickupCity"))==null?void 0:i.value)||"",o=document.getElementById("onecPickupContainer");o&&(o.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`);try{const r=new URLSearchParams({network:s});n&&r.set("city",n);const l=await g(`/admin/onec/pickup-points?${r}`);c(`${e("onec.pickupPoints")}: ${l.total} (${l.source})`,"success")}catch(r){c(e("common.failedToLoad",{error:r.message}),"error")}await gn()}async function rc(){var a,i,r;const s=document.getElementById("onecStockResult");if(!s)return;const n=((a=document.getElementById("onecStockNetwork"))==null?void 0:a.value)||"ProKoleso",o=(r=(i=document.getElementById("onecStockSku"))==null?void 0:i.value)==null?void 0:r.trim();if(!o){s.innerHTML=`<div class="${k}">${e("onec.skuPlaceholder")}</div>`;return}s.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;try{const l=new URLSearchParams({network:n,sku:o}),p=await g(`/admin/onec/stock-lookup?${l}`);if(!p.found){s.innerHTML=`<div class="${k}">${e("onec.notFound")} — ${d(o)}</div>`;return}const m=p.data||{},h=[["SKU",o],[e("onec.price"),m.price!=null?`${m.price} грн`:"—"],[e("onec.quantity"),m.quantity!=null?m.quantity:m.qty!=null?m.qty:"—"],[e("onec.country"),m.country||m.Country||"—"],[e("onec.year"),m.year||m.Year||"—"]],v=new Set(["price","quantity","qty","country","Country","year","Year"]);for(const[f,y]of Object.entries(m))!v.has(f)&&y!=null&&y!==""&&h.push([f,typeof y=="object"?JSON.stringify(y):String(y)]);const x=h.map(([f,y])=>`
            <div class="flex items-center gap-3 py-1.5 border-b border-neutral-100 dark:border-neutral-800">
                <span class="text-xs text-neutral-500 dark:text-neutral-400 w-24 shrink-0">${d(f)}</span>
                <span class="text-sm text-neutral-800 dark:text-neutral-200 font-medium">${d(String(y))}</span>
            </div>
        `).join("");s.innerHTML=`<div class="mt-2">${x}</div>`}catch(l){s.innerHTML=`<div class="${k}">${e("common.failedToLoad",{error:l.message})}</div>`}}function ic(){j("onec-data",Sn),window._pages=window._pages||{},window._pages["onec-data"]={loadOnecData:Sn,loadPickupPoints:gn,refreshPickupFromOnec:ac,lookupStock:rc,toggleSection:sc}}let ze=null,_e="base",be=[],ve=[],Fs="",Os="",Ns="",ce={},Ks="";async function Vt(){const s=document.getElementById("sttHintsContent");if(s){s.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;try{const[n,o]=await Promise.all([g("/admin/stt/phrase-hints"),g("/admin/stt/word-overrides")]);ze=n,be=[...ze.base_phrases||[]],ve=[...ze.custom_phrases||[]],ce=o.overrides||{},oe()}catch(n){s.innerHTML=`<div class="${k}">${e("sttHints.loadFailed",{error:d(n.message)})}</div>`}}}function oe(){const s=document.getElementById("sttHintsContent");if(!s||!ze)return;const n=ze.stats||{},o=n.google_limit?Math.round(n.total/n.google_limit*100):0,a=n.updated_at?new Date(n.updated_at).toLocaleString():e("sttHints.neverSynced"),i=n.base_customized?`<span class="${q} ml-1">${e("sttHints.modified")}</span>`:"";let r=`
        <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-4">
            <div class="bg-neutral-50 dark:bg-neutral-800 rounded-lg p-3 text-center">
                <div class="text-lg font-bold text-neutral-900 dark:text-neutral-100">${n.base_count||0}</div>
                <div class="text-xs text-neutral-500 dark:text-neutral-400">${e("sttHints.base")}${i}</div>
            </div>
            <div class="bg-neutral-50 dark:bg-neutral-800 rounded-lg p-3 text-center">
                <div class="text-lg font-bold text-neutral-900 dark:text-neutral-100">${n.auto_count||0}</div>
                <div class="text-xs text-neutral-500 dark:text-neutral-400">${e("sttHints.auto")}</div>
            </div>
            <div class="bg-neutral-50 dark:bg-neutral-800 rounded-lg p-3 text-center">
                <div class="text-lg font-bold text-neutral-900 dark:text-neutral-100">${n.custom_count||0}</div>
                <div class="text-xs text-neutral-500 dark:text-neutral-400">${e("sttHints.custom")}</div>
            </div>
            <div class="bg-neutral-50 dark:bg-neutral-800 rounded-lg p-3 text-center">
                <div class="text-lg font-bold ${o>90?"text-red-600":"text-neutral-900 dark:text-neutral-100"}">${n.total||0} / ${n.google_limit||5e3}</div>
                <div class="text-xs text-neutral-500 dark:text-neutral-400">${e("sttHints.total")} (${o}%)</div>
            </div>
        </div>
        <div class="text-xs text-neutral-500 dark:text-neutral-400 mb-4">
            ${e("sttHints.lastSync")}: ${d(a)}
        </div>`;r+=`<div class="${xa}">
        <button class="${kt} ${_e==="base"?"border-blue-600 text-blue-600 dark:text-blue-400 dark:border-blue-400 font-semibold":""}" onclick="window._pages.sttHints.switchTab('base')">${e("sttHints.tabBase")} (${be.length})</button>
        <button class="${kt} ${_e==="auto"?"border-blue-600 text-blue-600 dark:text-blue-400 dark:border-blue-400 font-semibold":""}" onclick="window._pages.sttHints.switchTab('auto')">${e("sttHints.tabAuto")} (${(ze.auto_phrases||[]).length})</button>
        <button class="${kt} ${_e==="custom"?"border-blue-600 text-blue-600 dark:text-blue-400 dark:border-blue-400 font-semibold":""}" onclick="window._pages.sttHints.switchTab('custom')">${e("sttHints.tabCustom")} (${ve.length})</button>
        <button class="${kt} ${_e==="overrides"?"border-blue-600 text-blue-600 dark:text-blue-400 dark:border-blue-400 font-semibold":""}" onclick="window._pages.sttHints.switchTab('overrides')">${e("sttHints.tabOverrides")} (${Object.keys(ce).length})</button>
    </div>`,_e==="base"?r+=lc():_e==="auto"?r+=dc():_e==="overrides"?r+=pc():r+=cc(),s.innerHTML=r}function mn(s,n){if(!n)return s;const o=n.toLowerCase();return s.filter(a=>a.toLowerCase().includes(o))}function lc(){const s=mn(be,Fs);let n=`
        <div class="flex flex-wrap items-center gap-2 mb-3">
            <input type="text" id="sttBaseSearch" class="${Ie} flex-1 min-w-48" placeholder="${e("sttHints.searchPlaceholder")}" value="${d(Fs)}" oninput="window._pages.sttHints.filterBase(this.value)">
            <span class="text-xs text-neutral-400">${s.length} / ${be.length}</span>
        </div>
        <div class="flex items-center gap-2 mb-3">
            <input type="text" id="sttBaseNewPhrase" class="${Ie} flex-1" placeholder="${e("sttHints.addPhrasePlaceholder")}" onkeydown="if(event.key==='Enter')window._pages.sttHints.addBasePhrase()">
            <button class="${E} ${T}" onclick="window._pages.sttHints.addBasePhrase()">${e("common.add")}</button>
        </div>
        <div class="max-h-96 overflow-y-auto border border-neutral-200 dark:border-neutral-700 rounded-lg mb-3">`;if(s.length===0)n+=`<div class="${k}">${e("sttHints.noResults")}</div>`;else{n+='<ul class="divide-y divide-neutral-100 dark:divide-neutral-800">';for(const o of s)n+=`<li class="flex items-center justify-between px-3 py-1.5 text-sm text-neutral-700 dark:text-neutral-300 hover:bg-neutral-50 dark:hover:bg-neutral-800/50">
                <span class="font-mono text-xs">${d(o)}</span>
                <button class="text-neutral-400 hover:text-red-500 text-xs ml-2 shrink-0" onclick="window._pages.sttHints.removeBasePhrase('${d(o.replace(/'/g,"\\'"))}')" title="${e("common.delete")}">&#10005;</button>
            </li>`;n+="</ul>"}return n+="</div>",n+=`<div class="flex flex-wrap items-center gap-2">
        <button class="${E} ${T}" onclick="window._pages.sttHints.saveBase()">${e("sttHints.saveBase")}</button>
        <button class="${T} text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20" onclick="window._pages.sttHints.resetBase()">${e("sttHints.resetBase")}</button>
    </div>`,n}function dc(){const s=ze.auto_phrases||[],n=mn(s,Os);let o=`
        <div class="flex flex-wrap items-center gap-2 mb-3">
            <input type="text" id="sttAutoSearch" class="${Ie} flex-1 min-w-48" placeholder="${e("sttHints.searchPlaceholder")}" value="${d(Os)}" oninput="window._pages.sttHints.filterAuto(this.value)">
            <span class="text-xs text-neutral-400">${n.length} / ${s.length}</span>
        </div>
        <div class="max-h-96 overflow-y-auto border border-neutral-200 dark:border-neutral-700 rounded-lg mb-3">`;if(n.length===0)o+=`<div class="${k}">${e("sttHints.noResults")}</div>`;else{o+='<ul class="divide-y divide-neutral-100 dark:divide-neutral-800">';for(const a of n)o+=`<li class="px-3 py-1.5 text-sm text-neutral-700 dark:text-neutral-300">
                <span class="font-mono text-xs">${d(a)}</span>
            </li>`;o+="</ul>"}return o+="</div>",o+=`<div class="flex flex-wrap items-center gap-2">
        <button class="${T} border border-neutral-300 dark:border-neutral-600 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-800" onclick="window._pages.sttHints.refreshFromCatalog()">${e("sttHints.refreshCatalog")}</button>
    </div>`,o}function cc(){const s=mn(ve,Ns);let n=`
        <div class="flex flex-wrap items-center gap-2 mb-3">
            <input type="text" id="sttCustomSearch" class="${Ie} flex-1 min-w-48" placeholder="${e("sttHints.searchPlaceholder")}" value="${d(Ns)}" oninput="window._pages.sttHints.filterCustom(this.value)">
            <span class="text-xs text-neutral-400">${s.length} / ${ve.length}</span>
        </div>
        <div class="flex items-center gap-2 mb-3">
            <input type="text" id="sttCustomNewPhrase" class="${Ie} flex-1" placeholder="${e("sttHints.addPhrasePlaceholder")}" onkeydown="if(event.key==='Enter')window._pages.sttHints.addCustomPhrase()">
            <button class="${E} ${T}" onclick="window._pages.sttHints.addCustomPhrase()">${e("common.add")}</button>
        </div>
        <div class="text-[11px] text-neutral-400 dark:text-neutral-500 mb-3">${e("sttHints.customHint")}</div>
        <div class="max-h-96 overflow-y-auto border border-neutral-200 dark:border-neutral-700 rounded-lg mb-3">`;if(s.length===0)n+=`<div class="${k}">${e("sttHints.noResults")}</div>`;else{n+='<ul class="divide-y divide-neutral-100 dark:divide-neutral-800">';for(const o of s)n+=`<li class="flex items-center justify-between px-3 py-1.5 text-sm text-neutral-700 dark:text-neutral-300 hover:bg-neutral-50 dark:hover:bg-neutral-800/50">
                <span class="font-mono text-xs">${d(o)}</span>
                <button class="text-neutral-400 hover:text-red-500 text-xs ml-2 shrink-0" onclick="window._pages.sttHints.removeCustomPhrase('${d(o.replace(/'/g,"\\'"))}')" title="${e("common.delete")}">&#10005;</button>
            </li>`;n+="</ul>"}return n+="</div>",n+=`<div class="flex flex-wrap items-center gap-2">
        <button class="${E} ${T}" onclick="window._pages.sttHints.saveCustom()">${e("sttHints.saveCustom")}</button>
    </div>`,n}function pc(){const s=Object.entries(ce),n=Ks.toLowerCase(),o=n?s.filter(([i,r])=>i.includes(n)||r.toLowerCase().includes(n)):s;o.sort((i,r)=>i[0].localeCompare(r[0]));let a=`
        <div class="flex flex-wrap items-center gap-2 mb-3">
            <input type="text" id="sttOverridesSearch" class="${Ie} flex-1 min-w-48" placeholder="${e("sttHints.searchPlaceholder")}" value="${d(Ks)}" oninput="window._pages.sttHints.filterOverrides(this.value)">
            <span class="text-xs text-neutral-400">${o.length} / ${s.length}</span>
        </div>
        <div class="flex items-center gap-2 mb-3">
            <input type="text" id="sttOverrideKeyInput" class="${Ie} w-48" placeholder="${e("sttHints.overrideLatin")}" onkeydown="if(event.key==='Enter')window._pages.sttHints.addOverride()">
            <input type="text" id="sttOverrideValInput" class="${Ie} w-48" placeholder="${e("sttHints.overrideCyrillic")}" onkeydown="if(event.key==='Enter')window._pages.sttHints.addOverride()">
            <button class="${E} ${T}" onclick="window._pages.sttHints.addOverride()">${e("common.add")}</button>
        </div>
        <div class="text-[11px] text-neutral-400 dark:text-neutral-500 mb-3">${e("sttHints.overridesHint")}</div>
        <div class="max-h-96 overflow-y-auto border border-neutral-200 dark:border-neutral-700 rounded-lg mb-3">`;if(o.length===0)a+=`<div class="${k}">${e("sttHints.noResults")}</div>`;else{a+=`<table class="w-full text-sm">
            <thead class="bg-neutral-50 dark:bg-neutral-800 sticky top-0">
                <tr>
                    <th class="text-left px-3 py-1.5 font-medium text-neutral-500 dark:text-neutral-400">English</th>
                    <th class="text-left px-3 py-1.5 font-medium text-neutral-500 dark:text-neutral-400">${e("sttHints.overrideCyrillic")}</th>
                    <th class="w-8"></th>
                </tr>
            </thead>
            <tbody class="divide-y divide-neutral-100 dark:divide-neutral-800">`;for(const[i,r]of o)a+=`<tr class="hover:bg-neutral-50 dark:hover:bg-neutral-800/50">
                <td class="px-3 py-1.5 font-mono text-xs text-neutral-700 dark:text-neutral-300">${d(i)}</td>
                <td class="px-3 py-1.5 font-mono text-xs text-neutral-700 dark:text-neutral-300">${d(r)}</td>
                <td class="px-1 py-1.5"><button class="text-neutral-400 hover:text-red-500 text-xs" onclick="window._pages.sttHints.removeOverride('${d(i.replace(/'/g,"\\'"))}')" title="${e("common.delete")}">&#10005;</button></td>
            </tr>`;a+="</tbody></table>"}return a+="</div>",a+=`<div class="flex flex-wrap items-center gap-2">
        <button class="${E} ${T}" onclick="window._pages.sttHints.saveOverrides()">${e("sttHints.saveCustom")}</button>
        <button class="${T} text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20" onclick="window._pages.sttHints.resetOverrides()">${e("sttHints.resetBase")}</button>
    </div>`,a}function uc(s){_e=s,oe()}function gc(s){Fs=s,oe()}function mc(s){Os=s,oe()}function hc(s){Ns=s,oe()}function bc(){const s=document.getElementById("sttBaseNewPhrase");if(!s)return;const n=s.value.trim();if(n){if(be.includes(n)){c(e("sttHints.duplicatePhrase"),"error");return}be.push(n),s.value="",oe()}}function vc(s){be=be.filter(n=>n!==s),oe()}async function fc(){try{await g("/admin/stt/phrase-hints/base",{method:"PATCH",body:JSON.stringify({phrases:be})}),c(e("sttHints.baseSaved",{count:be.length}),"success"),await Vt()}catch(s){c(e("sttHints.saveFailed",{error:s.message}),"error")}}async function yc(){if(confirm(e("sttHints.resetBaseConfirm")))try{await g("/admin/stt/phrase-hints/base/reset",{method:"POST"}),c(e("sttHints.resetBaseDone"),"success"),await Vt()}catch(s){c(e("sttHints.saveFailed",{error:s.message}),"error")}}function xc(){const s=document.getElementById("sttCustomNewPhrase");if(!s)return;const n=s.value.trim();if(n){if(ve.includes(n)){c(e("sttHints.duplicatePhrase"),"error");return}ve.push(n),s.value="",oe()}}function $c(s){ve=ve.filter(n=>n!==s),oe()}async function wc(){try{await g("/admin/stt/phrase-hints/custom",{method:"PATCH",body:JSON.stringify({phrases:ve})}),c(e("sttHints.customSaved",{count:ve.length}),"success"),await Vt()}catch(s){c(e("sttHints.saveFailed",{error:s.message}),"error")}}function kc(s){Ks=s,oe()}function Tc(){const s=document.getElementById("sttOverrideKeyInput"),n=document.getElementById("sttOverrideValInput");if(!s||!n)return;const o=s.value.trim().toLowerCase(),a=n.value.trim();if(!(!o||!a)){if(!/^[a-z]+$/.test(o)){c(e("sttHints.overridesLatinOnly"),"error");return}if(ce[o]!==void 0){c(e("sttHints.duplicateOverride"),"error");return}ce[o]=a,s.value="",n.value="",oe()}}function Sc(s){delete ce[s],oe()}async function _c(){try{ce=(await g("/admin/stt/word-overrides",{method:"PATCH",body:JSON.stringify({overrides:ce})})).overrides||ce,c(e("sttHints.overridesSaved",{count:Object.keys(ce).length}),"success"),oe()}catch(s){c(e("sttHints.overridesSaveFailed",{error:s.message}),"error")}}async function Cc(){if(confirm(e("sttHints.overridesResetConfirm")))try{ce=(await g("/admin/stt/word-overrides/reset",{method:"POST"})).overrides||{},c(e("sttHints.overridesResetDone"),"success"),oe()}catch(s){c(e("sttHints.overridesSaveFailed",{error:s.message}),"error")}}async function Ec(){c(e("sttHints.refreshing"),"info");try{await g("/admin/stt/phrase-hints/refresh",{method:"POST"}),c(e("sttHints.refreshed"),"success"),await Vt()}catch(s){c(e("sttHints.refreshFailed",{error:s.message}),"error")}}function Ic(){j("stt-hints",Vt)}window._pages=window._pages||{};window._pages.sttHints={switchTab:uc,filterBase:gc,filterAuto:mc,filterCustom:hc,addBasePhrase:bc,removeBasePhrase:vc,saveBase:fc,resetBase:yc,addCustomPhrase:xc,removeCustomPhrase:$c,saveCustom:wc,refreshFromCatalog:Ec,filterOverrides:kc,addOverride:Tc,removeOverride:Sc,saveOverrides:_c,resetOverrides:Cc};let pe={},Pe=[],ue={},Le=[];function Do(s,n,o,a){document.getElementById("pointHintEditType").value=s,document.getElementById("pointHintEditId").value=n,document.getElementById("pointHintModalTitle").textContent=e("pointHints.editHint"),document.getElementById("pointHintModalSubtitle").textContent=o,document.getElementById("pointHintDistrict").value=a.district||"",document.getElementById("pointHintLandmarks").value=a.landmarks||"",document.getElementById("pointHintDescription").value=a.description||"",document.getElementById("pointHintModal").classList.add("show"),document.getElementById("pointHintDistrict").focus()}async function Bc(){const s=document.getElementById("pointHintEditType").value,n=document.getElementById("pointHintEditId").value,o=document.getElementById("pointHintDistrict").value.trim(),a=document.getElementById("pointHintLandmarks").value.trim(),i=document.getElementById("pointHintDescription").value.trim();if(s==="fitting"){if(!o&&!a&&!i){pe[n]&&await Oo(n),F("pointHintModal");return}try{await g(`/admin/fitting/station-hints/${encodeURIComponent(n)}`,{method:"PUT",body:JSON.stringify({district:o,landmarks:a,description:i})}),pe[n]={district:o,landmarks:a,description:i},hs(),c(e("pointHints.saved"),"success"),F("pointHintModal")}catch(r){c(e("pointHints.saveFailed",{error:r.message}),"error")}}else{if(!o&&!a&&!i){ue[n]&&await Ko(n),F("pointHintModal");return}try{await g(`/admin/fitting/pickup-hints/${encodeURIComponent(n)}`,{method:"PUT",body:JSON.stringify({district:o,landmarks:a,description:i})}),ue[n]={district:o,landmarks:a,description:i},bs(),c(e("pointHints.saved"),"success"),F("pointHintModal")}catch(r){c(e("pointHints.saveFailed",{error:r.message}),"error")}}}function Ro(s){document.querySelectorAll("#pointHintsTabs .tab-btn").forEach(n=>{const o=n.dataset.tab===s;n.className=`${kt} ${o?"border-blue-600 text-blue-600 dark:text-blue-400 dark:border-blue-400 font-semibold":""}`}),document.getElementById("pointHintsContent-fitting").style.display=s==="fitting"?"":"none",document.getElementById("pointHintsContent-pickup").style.display=s==="pickup"?"":"none",s==="fitting"&&Pe.length===0&&Object.keys(pe).length===0&&Fo(),s==="pickup"&&Le.length===0&&Object.keys(ue).length===0&&No()}async function Fo(){const s=document.getElementById("pointHintsContent-fitting");if(s){s.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;try{const n=await g("/admin/fitting/station-hints");pe=n.hints||{},Pe=n.stations||[],hs()}catch(n){s.innerHTML=`<div class="${k}">${e("pointHints.loadFailed",{error:d(n.message)})}</div>`}}}function mt(s,n){if(!s)return'<span class="text-neutral-400 dark:text-neutral-600">—</span>';const o=d(s);return s.length<=n?o:`<span title="${o}">${d(s.slice(0,n))}…</span>`}function hs(){const s=document.getElementById("pointHintsContent-fitting");if(!s)return;const n={};for(const r of Pe){const l=r.station_id||r.id||"";l&&(n[l]=r)}const o=new Set(Object.keys(n));for(const r of Object.keys(pe))o.add(r);if(o.size===0){s.innerHTML=`<div class="${k}">
            <p>${e("pointHints.noStations")}</p>
            <button class="${E} ${T} mt-3" onclick="window._pages.pointHints.refreshStations()">${e("pointHints.refreshFromOnec")}</button>
        </div>`;return}let a=`<div class="flex items-center justify-end mb-3">
        <button class="${T} border border-neutral-300 dark:border-neutral-600 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-800" onclick="window._pages.pointHints.refreshStations()">${e("pointHints.refreshFromOnec")}</button>
    </div>`;a+=`<div class="overflow-x-auto"><table class="${A}">
        <thead><tr>
            <th class="${b}">${e("pointHints.name")}</th>
            <th class="${b}">${e("pointHints.address")}</th>
            <th class="${b}">${e("pointHints.district")}</th>
            <th class="${b}">${e("pointHints.landmarks")}</th>
            <th class="${b}">${e("pointHints.description")}</th>
            <th class="${b}">${e("pointHints.actions")}</th>
        </tr></thead><tbody>`;const i=[...o].sort((r,l)=>{const p=pe[r]?1:0;return(pe[l]?1:0)-p});for(const r of i){const l=n[r]||{},p=pe[r]||{},m=p.district||"",h=p.landmarks||"",v=p.description||"",x=l.name||"",f=l.address||"",y=!!(m||h||v);a+=`<tr class="${_}">
            <td class="${u}" data-label="${e("pointHints.name")}"><strong>${d(x||r)}</strong><div class="text-[10px] text-neutral-400 font-mono">${d(r)}</div></td>
            <td class="${u}" data-label="${e("pointHints.address")}">${d(f)}</td>
            <td class="${u}" data-label="${e("pointHints.district")}">${mt(m,30)}</td>
            <td class="${u}" data-label="${e("pointHints.landmarks")}">${mt(h,40)}</td>
            <td class="${u}" data-label="${e("pointHints.description")}">${mt(v,40)}</td>
            <td class="${V}" data-label="${e("pointHints.actions")}">
                <button class="${E} ${T}" onclick="window._pages.pointHints.editStationHint('${d(r)}')">${e("common.edit")}</button>
                ${y?`<button class="${T} text-red-600 dark:text-red-400 ml-1" onclick="window._pages.pointHints.deleteStationHint('${d(r)}')">${e("common.delete")}</button>`:""}
            </td>
        </tr>`}a+="</tbody></table></div>",s.innerHTML=a}function Pc(s){const n=Pe.find(i=>(i.station_id||i.id)===s),o=n?`${n.name||""} — ${n.address||""}`:s,a=pe[s]||{};Do("fitting",s,o,a)}async function Oo(s){try{await g(`/admin/fitting/station-hints/${encodeURIComponent(s)}`,{method:"DELETE"}),delete pe[s],hs(),c(e("pointHints.deleted"),"success")}catch(n){c(e("pointHints.deleteFailed",{error:n.message}),"error")}}async function No(){const s=document.getElementById("pointHintsContent-pickup");if(s){s.innerHTML=`<div class="${H}"><div class="spinner"></div></div>`;try{const n=await g("/admin/fitting/pickup-hints");ue=n.hints||{},Le=n.points||[],bs()}catch(n){s.innerHTML=`<div class="${k}">${e("pointHints.loadFailed",{error:d(n.message)})}</div>`}}}function bs(){const s=document.getElementById("pointHintsContent-pickup");if(!s)return;const n={};for(const r of Le){const l=r.id||"";l&&(n[l]=r)}const o=new Set(Object.keys(n));for(const r of Object.keys(ue))o.add(r);if(o.size===0){s.innerHTML=`<div class="${k}">
            <p>${e("pointHints.noPoints")}</p>
            <button class="${E} ${T} mt-3" onclick="window._pages.pointHints.refreshPickupPoints()">${e("pointHints.refreshFromOnec")}</button>
        </div>`;return}let a=`<div class="flex items-center justify-end mb-3">
        <button class="${T} border border-neutral-300 dark:border-neutral-600 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-800" onclick="window._pages.pointHints.refreshPickupPoints()">${e("pointHints.refreshFromOnec")}</button>
    </div>`;a+=`<div class="overflow-x-auto"><table class="${A}">
        <thead><tr>
            <th class="${b}">${e("pointHints.address")}</th>
            <th class="${b}">${e("pointHints.city")}</th>
            <th class="${b}">${e("pointHints.district")}</th>
            <th class="${b}">${e("pointHints.landmarks")}</th>
            <th class="${b}">${e("pointHints.description")}</th>
            <th class="${b}">${e("pointHints.actions")}</th>
        </tr></thead><tbody>`;const i=[...o].sort((r,l)=>{const p=ue[r]?1:0;return(ue[l]?1:0)-p});for(const r of i){const l=n[r]||{},p=ue[r]||{},m=p.district||"",h=p.landmarks||"",v=p.description||"",x=l.address||"",f=l.city||"",y=!!(m||h||v);a+=`<tr class="${_}">
            <td class="${u}" data-label="${e("pointHints.address")}"><strong>${d(x||r)}</strong><div class="text-[10px] text-neutral-400 font-mono">${d(r)}</div></td>
            <td class="${u}" data-label="${e("pointHints.city")}">${d(f)}</td>
            <td class="${u}" data-label="${e("pointHints.district")}">${mt(m,30)}</td>
            <td class="${u}" data-label="${e("pointHints.landmarks")}">${mt(h,40)}</td>
            <td class="${u}" data-label="${e("pointHints.description")}">${mt(v,40)}</td>
            <td class="${V}" data-label="${e("pointHints.actions")}">
                <button class="${E} ${T}" onclick="window._pages.pointHints.editPickupHint('${d(r)}')">${e("common.edit")}</button>
                ${y?`<button class="${T} text-red-600 dark:text-red-400 ml-1" onclick="window._pages.pointHints.deletePickupHint('${d(r)}')">${e("common.delete")}</button>`:""}
            </td>
        </tr>`}a+="</tbody></table></div>",s.innerHTML=a}function Lc(s){const n=Le.find(i=>i.id===s),o=n?`${n.address||""} (${n.city||""})`:s,a=ue[s]||{};Do("pickup",s,o,a)}async function Ko(s){try{await g(`/admin/fitting/pickup-hints/${encodeURIComponent(s)}`,{method:"DELETE"}),delete ue[s],bs(),c(e("pointHints.deleted"),"success")}catch(n){c(e("pointHints.deleteFailed",{error:n.message}),"error")}}async function Ac(){c(e("pointHints.refreshing"),"info");try{const s=await g("/admin/fitting/stations/refresh",{method:"POST"});Pe=s.stations||[],c(e("pointHints.refreshed",{count:s.total||0}),"success");try{const n=await g("/admin/fitting/station-hints");pe=n.hints||{},Pe=n.stations||Pe}catch{}hs()}catch(s){c(e("pointHints.refreshFailed",{error:s.message}),"error")}}async function Hc(){c(e("pointHints.refreshing"),"info");try{const s=await g("/admin/fitting/pickup-points/refresh",{method:"POST"});Le=s.points||[],c(e("pointHints.refreshed",{count:s.total||0}),"success");try{const n=await g("/admin/fitting/pickup-hints");ue=n.hints||{},Le=n.points||Le}catch{}bs()}catch(s){c(e("pointHints.refreshFailed",{error:s.message}),"error")}}function Mc(){j("point-hints",()=>{Pe=[],Le=[],Ro("fitting")})}window._pages=window._pages||{};window._pages.pointHints={switchTab:Ro,loadStationHints:Fo,editStationHint:Pc,deleteStationHint:Oo,refreshStations:Ac,loadPickupHints:No,editPickupHint:Lc,deletePickupHint:Ko,refreshPickupPoints:Hc,saveHintFromModal:Bc};let qs=[],ks=null;function Dc(){var r,l,p,m;const s=new URLSearchParams,n=(r=document.getElementById("costDateFrom"))==null?void 0:r.value,o=(l=document.getElementById("costDateTo"))==null?void 0:l.value,a=(p=document.getElementById("costTaskType"))==null?void 0:p.value,i=(m=document.getElementById("costTenant"))==null?void 0:m.value;return n&&s.set("date_from",n),o&&s.set("date_to",o),a&&s.set("task_type",a),i&&s.set("tenant_id",i),s.toString()}async function jt(){try{const s=await g("/admin/llm-costs/catalog/new-count"),n=document.getElementById("costNewModelsBanner"),o=document.getElementById("costNewModelsText");if(!n||!o)return;s.count>0?(o.textContent=e("costs.newModelsFound",{count:s.count}),n.style.display=""):n.style.display="none"}catch{}}function qo(s){const n=document.getElementById("costMyModelsTab"),o=document.getElementById("costCatalogTab"),a=document.getElementById("costTabMyModels"),i=document.getElementById("costTabCatalog");if(!n||!o)return;const r="pb-2 text-sm font-medium border-b-2 border-blue-600 text-blue-600 dark:text-blue-400 dark:border-blue-400",l="pb-2 text-sm font-medium border-b-2 border-transparent text-neutral-500 dark:text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200";s==="catalog"?(n.style.display="none",o.style.display="",a.className=l,i.className=r,De()):(n.style.display="",o.style.display="none",a.className=r,i.className=l)}function Rc(){qo("catalog")}async function Qe(){try{qs=(await g("/admin/llm-costs/pricing")).items||[],Fc(qs)}catch(s){c(s.message,"error")}}function Fc(s){const n=document.getElementById("pricingTableBody");if(n){if(!s.length){n.innerHTML=`<tr><td colspan="8" class="px-3 py-8 text-center text-neutral-400">${e("costs.noData")}</td></tr>`;return}n.innerHTML=s.map(o=>`
        <tr class="border-b border-neutral-100 dark:border-neutral-800 hover:bg-neutral-50 dark:hover:bg-neutral-800/50">
            <td class="px-3 py-2.5 text-sm font-mono">${W(o.provider_key)}</td>
            <td class="px-3 py-2.5 text-sm">${W(o.display_name)}</td>
            <td class="px-3 py-2.5 text-sm text-neutral-500 dark:text-neutral-400">${W(o.model_name)}</td>
            <td class="px-3 py-2.5 text-sm text-right font-mono">$${o.input_price_per_1m.toFixed(2)}</td>
            <td class="px-3 py-2.5 text-sm text-right font-mono">$${o.output_price_per_1m.toFixed(2)}</td>
            <td class="px-3 py-2.5 text-sm text-center">
                <input type="checkbox" ${o.include_in_comparison?"checked":""}
                    onchange="window._pages.costAnalysis.toggleComparison('${o.id}', this.checked)"
                    class="w-4 h-4 rounded border-neutral-300 dark:border-neutral-600 text-blue-600 focus:ring-blue-500">
            </td>
            <td class="px-3 py-2.5 text-sm text-center">${o.is_system?'<span class="text-blue-600 dark:text-blue-400">&#10003;</span>':""}</td>
            <td class="px-3 py-2.5 text-sm text-right">
                <button onclick="window._pages.costAnalysis.showEditDialog('${o.id}')" class="text-blue-600 dark:text-blue-400 hover:underline text-xs mr-2">${e("costs.edit")}</button>
                ${o.is_system?"":`<button onclick="window._pages.costAnalysis.deletePricing('${o.id}')" class="text-red-600 dark:text-red-400 hover:underline text-xs">${e("costs.delete")}</button>`}
            </td>
        </tr>
    `).join("")}}async function Oc(s,n){try{await g(`/admin/llm-costs/pricing/${s}`,{method:"PATCH",body:JSON.stringify({include_in_comparison:n})})}catch(o){c(o.message,"error"),await Qe()}}async function Nc(){try{const s=await g("/admin/llm-costs/pricing/sync-system",{method:"POST"});c(s.message,"success"),await Qe()}catch(s){c(s.message,"error")}}async function Kc(s){if(confirm(e("costs.confirmDelete")))try{await g(`/admin/llm-costs/pricing/${s}`,{method:"DELETE"}),c(e("costs.deleted"),"success"),await Qe()}catch(n){c(n.message,"error")}}function qc(){Uo(null)}function Uc(s){const n=qs.find(o=>o.id===s);n&&Uo(n)}function Uo(s){var i;const n=!!s,o=e(n?"costs.edit":"costs.addModel");(i=document.getElementById("costPricingDialog"))==null||i.remove();const a=document.createElement("div");a.id="costPricingDialog",a.className="fixed inset-0 bg-black/50 flex items-center justify-center z-50",a.innerHTML=`
        <div class="bg-white dark:bg-neutral-900 rounded-lg shadow-xl max-w-md w-full mx-4 overflow-hidden flex flex-col max-h-[80vh]">
            <div class="modal-fixed-header">
                <h3 class="text-lg font-semibold text-neutral-900 dark:text-neutral-50">${o}</h3>
                <span class="cursor-pointer text-lg text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-200 transition-colors leading-none shrink-0" onclick="document.getElementById('costPricingDialog').remove()">&times;</span>
            </div>
            <div class="modal-body">
            <div class="space-y-3">
                <div>
                    <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1">${e("costs.providerKey")}</label>
                    <input type="text" id="dlgProviderKey" value="${W((s==null?void 0:s.provider_key)||"")}" ${n?"disabled":""}
                        class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 disabled:opacity-50">
                </div>
                <div>
                    <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1">${e("costs.modelName")}</label>
                    <input type="text" id="dlgModelName" value="${W((s==null?void 0:s.model_name)||"")}"
                        class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100">
                </div>
                <div>
                    <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1">${e("costs.displayName")}</label>
                    <input type="text" id="dlgDisplayName" value="${W((s==null?void 0:s.display_name)||"")}"
                        class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100">
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1">${e("costs.inputPrice")}</label>
                        <input type="number" step="0.01" id="dlgInputPrice" value="${(s==null?void 0:s.input_price_per_1m)??""}"
                            class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1">${e("costs.outputPrice")}</label>
                        <input type="number" step="0.01" id="dlgOutputPrice" value="${(s==null?void 0:s.output_price_per_1m)??""}"
                            class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100">
                    </div>
                </div>
            </div>
            <div class="flex justify-end gap-2 mt-5">
                <button onclick="document.getElementById('costPricingDialog').remove()"
                    class="px-4 py-2 text-sm font-medium rounded-md border border-neutral-300 dark:border-neutral-600 text-neutral-700 dark:text-neutral-200 hover:bg-neutral-50 dark:hover:bg-neutral-800">${e("costs.cancel")}</button>
                <button id="dlgSaveBtn"
                    class="px-4 py-2 text-sm font-medium rounded-md bg-blue-600 text-white hover:bg-blue-700">${e("costs.save")}</button>
            </div>
            </div>
        </div>
    `,document.body.appendChild(a),a.addEventListener("click",r=>{r.target===a&&a.remove()}),document.getElementById("dlgSaveBtn").addEventListener("click",async()=>{const r={model_name:document.getElementById("dlgModelName").value.trim(),display_name:document.getElementById("dlgDisplayName").value.trim(),input_price_per_1m:parseFloat(document.getElementById("dlgInputPrice").value),output_price_per_1m:parseFloat(document.getElementById("dlgOutputPrice").value)};try{n?(await g(`/admin/llm-costs/pricing/${s.id}`,{method:"PATCH",body:JSON.stringify(r)}),c(e("costs.updated"),"success")):(r.provider_key=document.getElementById("dlgProviderKey").value.trim(),await g("/admin/llm-costs/pricing",{method:"POST",body:JSON.stringify(r)}),c(e("costs.created"),"success")),a.remove(),await Qe()}catch(l){c(l.message,"error")}})}async function De(){var r,l,p;const s=new URLSearchParams,n=(r=document.getElementById("catalogProviderFilter"))==null?void 0:r.value,o=(l=document.getElementById("catalogSearch"))==null?void 0:l.value,a=(p=document.getElementById("catalogShowHidden"))==null?void 0:p.checked;n&&s.set("provider_type",n),o&&s.set("search",o),a&&s.set("include_hidden","true");const i=s.toString();try{const[m,h]=await Promise.all([g(`/admin/llm-costs/catalog${i?"?"+i:""}`),g("/admin/llm-costs/catalog/sync-status")]);Gc(m.items||[]),zc(h.last_sync_at)}catch(m){c(m.message,"error")}}function Gc(s){const n=document.getElementById("catalogTableBody");if(n){if(!s.length){n.innerHTML=`<tr><td colspan="7" class="px-3 py-8 text-center text-neutral-400">${e("costs.noData")}</td></tr>`;return}n.innerHTML=s.map(o=>{const a=o.max_input_tokens?Vc(o.max_input_tokens):"—";let i;o.is_hidden?i=`<span class="text-neutral-400 dark:text-neutral-500 text-xs font-medium">${e("costs.hidden")}</span>`:o.is_added?i=`<span class="text-green-600 dark:text-green-400 text-xs font-medium">${e("costs.added")}</span>`:o.is_new?i=`<span class="text-blue-600 dark:text-blue-400 text-xs font-medium">${e("costs.new")}</span>`:i='<span class="text-neutral-400 text-xs">—</span>';let r="";return o.is_hidden?r=`<button onclick="window._pages.costAnalysis.unhideModel('${W(o.model_key)}')" class="text-blue-600 dark:text-blue-400 hover:underline text-xs">${e("costs.unhide")}</button>`:o.is_added||(r=`<button onclick="window._pages.costAnalysis.showCatalogAddDialog('${W(o.model_key)}')" class="text-blue-600 dark:text-blue-400 hover:underline text-xs mr-2">${e("costs.addToPricing")}</button>`,o.is_new&&(r+=`<button onclick="window._pages.costAnalysis.dismissModel('${W(o.model_key)}')" class="text-neutral-500 hover:underline text-xs mr-2">${e("costs.dismiss")}</button>`),r+=`<button onclick="window._pages.costAnalysis.hideModel('${W(o.model_key)}')" class="text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-300 hover:underline text-xs">${e("costs.hide")}</button>`),`
            <tr class="${o.is_hidden?"opacity-50 ":""}border-b border-neutral-100 dark:border-neutral-800 hover:bg-neutral-50 dark:hover:bg-neutral-800/50">
                <td class="px-3 py-2.5 text-sm font-mono">${W(o.model_key)}</td>
                <td class="px-3 py-2.5 text-sm">${W(o.display_name)}</td>
                <td class="px-3 py-2.5 text-sm text-right font-mono">$${o.input_price_per_1m.toFixed(2)}</td>
                <td class="px-3 py-2.5 text-sm text-right font-mono">$${o.output_price_per_1m.toFixed(2)}</td>
                <td class="px-3 py-2.5 text-sm text-right font-mono">${a}</td>
                <td class="px-3 py-2.5 text-sm text-center">${i}</td>
                <td class="px-3 py-2.5 text-sm text-right">${r}</td>
            </tr>
        `}).join("")}}function zc(s){const n=document.getElementById("catalogLastSync");if(n)if(s){const o=new Date(s);n.textContent=`${e("costs.lastSync")}: ${o.toLocaleDateString()} ${o.toLocaleTimeString()}`}else n.textContent=e("costs.neverSynced")}function Vc(s){return s>=1e6?(s/1e6).toFixed(0)+"M":s>=1e3?(s/1e3).toFixed(0)+"K":String(s)}function jc(){ks&&clearTimeout(ks),ks=setTimeout(()=>De(),300)}async function Wc(){try{const s=await g("/admin/llm-costs/catalog/sync",{method:"POST"});c(e("costs.catalogSyncStarted"),"success"),setTimeout(()=>De(),2e3)}catch(s){c(s.message,"error")}}function Jc(s){var o;(o=document.getElementById("costCatalogAddDialog"))==null||o.remove();const n=document.createElement("div");n.id="costCatalogAddDialog",n.className="fixed inset-0 bg-black/50 flex items-center justify-center z-50",n.innerHTML=`
        <div class="bg-white dark:bg-neutral-900 rounded-lg shadow-xl max-w-md w-full mx-4 overflow-hidden flex flex-col max-h-[80vh]">
            <div class="modal-fixed-header">
                <h3 class="text-lg font-semibold text-neutral-900 dark:text-neutral-50">${e("costs.addToPricing")}</h3>
                <span class="cursor-pointer text-lg text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-200 transition-colors leading-none shrink-0" onclick="document.getElementById('costCatalogAddDialog').remove()">&times;</span>
            </div>
            <div class="modal-body">
            <div class="space-y-3">
                <div>
                    <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1">Model Key</label>
                    <input type="text" value="${W(s)}" disabled
                        class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-neutral-50 dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 opacity-60">
                </div>
                <div>
                    <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1">${e("costs.providerKey")}</label>
                    <input type="text" id="dlgCatalogProviderKey" value="${W(s)}"
                        class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100">
                    <p class="text-xs text-neutral-400 mt-1">${e("costs.providerKeyHint")}</p>
                </div>
            </div>
            <div class="flex justify-end gap-2 mt-5">
                <button onclick="document.getElementById('costCatalogAddDialog').remove()"
                    class="px-4 py-2 text-sm font-medium rounded-md border border-neutral-300 dark:border-neutral-600 text-neutral-700 dark:text-neutral-200 hover:bg-neutral-50 dark:hover:bg-neutral-800">${e("costs.cancel")}</button>
                <button id="dlgCatalogAddBtn"
                    class="px-4 py-2 text-sm font-medium rounded-md bg-blue-600 text-white hover:bg-blue-700">${e("costs.save")}</button>
            </div>
            </div>
        </div>
    `,document.body.appendChild(n),n.addEventListener("click",a=>{a.target===n&&n.remove()}),document.getElementById("dlgCatalogAddBtn").addEventListener("click",async()=>{const a=document.getElementById("dlgCatalogProviderKey").value.trim();if(a)try{await g("/admin/llm-costs/catalog/add",{method:"POST",body:JSON.stringify({model_key:s,provider_key:a})}),c(e("costs.modelAdded"),"success"),n.remove(),await Promise.all([De(),Qe(),jt()])}catch(i){c(i.message,"error")}})}async function Qc(s){try{await g("/admin/llm-costs/catalog/dismiss",{method:"POST",body:JSON.stringify({model_keys:[s]})}),c(e("costs.modelsDismissed"),"success"),await Promise.all([De(),jt()])}catch(n){c(n.message,"error")}}async function Yc(s){try{await g("/admin/llm-costs/catalog/hide",{method:"POST",body:JSON.stringify({model_keys:[s]})}),c(e("costs.modelsHidden"),"success"),await Promise.all([De(),jt()])}catch(n){c(n.message,"error")}}async function Xc(s){try{await g("/admin/llm-costs/catalog/unhide",{method:"POST",body:JSON.stringify({model_keys:[s]})}),c(e("costs.modelUnhidden"),"success"),await Promise.all([De(),jt()])}catch(n){c(n.message,"error")}}async function Cn(){const s=Dc();try{const[n,o]=await Promise.all([g(`/admin/llm-costs/usage/summary${s?"?"+s:""}`),g(`/admin/llm-costs/usage/model-comparison${s?"?"+s:""}`)]);Zc(n.items||[]),ep(o)}catch(n){c(n.message,"error")}}function Zc(s){const n=document.getElementById("usageSummaryBody");if(n){if(!s.length){n.innerHTML=`<tr><td colspan="7" class="px-3 py-8 text-center text-neutral-400">${e("costs.noData")}</td></tr>`;return}n.innerHTML=s.map(o=>`
        <tr class="border-b border-neutral-100 dark:border-neutral-800">
            <td class="px-3 py-2.5 text-sm">${W(o.task_type)}</td>
            <td class="px-3 py-2.5 text-sm font-mono">${W(o.provider_key)}</td>
            <td class="px-3 py-2.5 text-sm text-right">${o.call_count.toLocaleString()}</td>
            <td class="px-3 py-2.5 text-sm text-right font-mono">${o.total_input_tokens.toLocaleString()}</td>
            <td class="px-3 py-2.5 text-sm text-right font-mono">${o.total_output_tokens.toLocaleString()}</td>
            <td class="px-3 py-2.5 text-sm text-right">${o.avg_latency_ms!=null?Math.round(o.avg_latency_ms):"—"}</td>
            <td class="px-3 py-2.5 text-sm text-right font-mono font-semibold">$${o.total_cost.toFixed(4)}</td>
        </tr>
    `).join("")}}function ep(s){const n=document.getElementById("comparisonContent");if(!n)return;if(!s.comparisons||!s.comparisons.length){n.innerHTML=`<p class="text-neutral-400 text-sm py-4 text-center">${e("costs.noData")}</p>`;return}const o=s.actual_cost||0,a=s.comparisons.map(i=>{const r=o>0?i.cost-o:0,l=o>0?(r/o*100).toFixed(1):"0.0",p=r<0?"text-green-600 dark:text-green-400":r>0?"text-red-600 dark:text-red-400":"",m=r>0?"+":"",h=i.is_actual?"bg-blue-50 dark:bg-blue-900/20":"",v=i.is_actual?`<span class="ml-1 text-xs text-blue-600 dark:text-blue-400">(${e("costs.actual")})</span>`:"";return`
            <tr class="border-b border-neutral-100 dark:border-neutral-800 ${h}">
                <td class="px-3 py-2.5 text-sm">${W(i.display_name)}${v}</td>
                <td class="px-3 py-2.5 text-sm text-right font-mono font-semibold">$${i.cost.toFixed(4)}</td>
                <td class="px-3 py-2.5 text-sm text-right font-mono ${p}">${i.is_actual?"—":`${m}$${r.toFixed(4)} (${m}${l}%)`}</td>
            </tr>
        `}).join("");n.innerHTML=`
        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4 text-sm">
            <div class="bg-neutral-50 dark:bg-neutral-800 rounded-lg p-3">
                <div class="text-neutral-500 dark:text-neutral-400">${e("costs.provider")}</div>
                <div class="font-mono font-semibold">${W(s.actual_provider||"—")}</div>
            </div>
            <div class="bg-neutral-50 dark:bg-neutral-800 rounded-lg p-3">
                <div class="text-neutral-500 dark:text-neutral-400">${e("costs.totalCost")}</div>
                <div class="font-mono font-semibold">$${o.toFixed(4)}</div>
            </div>
            <div class="bg-neutral-50 dark:bg-neutral-800 rounded-lg p-3">
                <div class="text-neutral-500 dark:text-neutral-400">${e("costs.totalInputTokens")}</div>
                <div class="font-mono font-semibold">${(s.total_input_tokens||0).toLocaleString()}</div>
            </div>
            <div class="bg-neutral-50 dark:bg-neutral-800 rounded-lg p-3">
                <div class="text-neutral-500 dark:text-neutral-400">${e("costs.totalOutputTokens")}</div>
                <div class="font-mono font-semibold">${(s.total_output_tokens||0).toLocaleString()}</div>
            </div>
        </div>
        <div class="overflow-x-auto">
            <table class="w-full text-sm">
                <thead>
                    <tr>
                        <th class="px-3 py-2.5 text-left text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider border-b border-neutral-200 dark:border-neutral-700">${e("costs.displayName")}</th>
                        <th class="px-3 py-2.5 text-right text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider border-b border-neutral-200 dark:border-neutral-700">${e("costs.cost")}</th>
                        <th class="px-3 py-2.5 text-right text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider border-b border-neutral-200 dark:border-neutral-700">${e("costs.difference")}</th>
                    </tr>
                </thead>
                <tbody>${a}</tbody>
            </table>
        </div>
    `}async function tp(){try{const s=await g("/admin/tenants"),n=document.getElementById("costTenant");if(!n||!s.tenants)return;s.tenants.forEach(o=>{const a=document.createElement("option");a.value=o.id,a.textContent=o.name||o.slug,n.appendChild(a)})}catch{}}function W(s){if(!s)return"";const n=document.createElement("div");return n.textContent=s,n.innerHTML}function sp(){j("cost-analysis",async()=>{const s=new Date,n=document.getElementById("costDateFrom"),o=document.getElementById("costDateTo");n&&!n.value&&(n.value=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-01`),o&&!o.value&&(o.value=s.toISOString().slice(0,10)),await Promise.all([Qe(),tp(),jt()]),await Cn()}),window._pages=window._pages||{},window._pages.costAnalysis={loadPricing:Qe,loadUsage:Cn,syncSystem:Nc,deletePricing:Kc,showAddDialog:qc,showEditDialog:Uc,toggleComparison:Oc,switchPricingTab:qo,switchToCatalog:Rc,loadCatalog:De,debounceCatalogSearch:jc,syncCatalog:Wc,showCatalogAddDialog:Jc,dismissModel:Qc,hideModel:Yc,unhideModel:Xc}}Zo();Pa();An();ga();Ha();Ta();Da();za();nr();Tr();di();Ci();Pi();Ri();Ni();vl();$l();Cl();Bl();Kl();ql();Zl();Zd();ic();Ic();Mc();sp();la(s=>{const n=localStorage.getItem("admin_active_page")||"dashboard";(s.type==="call:started"||s.type==="call:ended"||s.type==="call:transferred")&&(n==="dashboard"&&window._pages.dashboard.loadDashboard(),n==="calls"&&window._pages.calls.loadCalls(sr())),s.type==="operator:status_changed"&&n==="operators"&&(window._pages.operators.loadOperators(),window._pages.operators.loadQueueStatus()),s.type==="dashboard:metrics_updated"&&n==="dashboard"&&window._pages.dashboard.loadDashboard()});setInterval(Un,6e4);let Ve=localStorage.getItem("admin_active_page");Ve==="training"&&(Ve="prompts",localStorage.setItem("admin_active_page",Ve));Ve==="settings"&&(Ve="monitoring",localStorage.setItem("admin_active_page",Ve));ht()&&(Un(),ht()&&(document.getElementById("loginContainer").style.display="none",document.getElementById("app").style.display="block",Nn().then(()=>{Kn(),Gs();const s=Lt();je(s||Ve||"dashboard")})));function Go(s){let n=document.getElementById("offlineBanner");s&&!n?(n=document.createElement("div"),n.id="offlineBanner",n.className="fixed top-0 left-0 right-0 z-[70] bg-amber-500 text-white text-center text-sm py-2 font-medium",n.setAttribute("role","alert"),n.textContent=t("common.offline"),document.body.prepend(n)):!s&&n&&(n.remove(),showToast(t("common.backOnline"),"info"))}window.addEventListener("offline",()=>Go(!0));window.addEventListener("online",()=>Go(!1));document.getElementById("loginPassword").addEventListener("keypress",s=>{s.key==="Enter"&&qn()});document.addEventListener("keydown",s=>{s.key==="Escape"&&wa()});const Yt=new Map,np=new MutationObserver(s=>{for(const n of s){if(n.type!=="attributes"||n.attributeName!=="class")continue;const o=n.target;if(!o.classList.contains("modal-overlay"))continue;const a=o.id;if(o.classList.contains("show"))Yt.has(a)||Yt.set(a,zn(o));else{const i=Yt.get(a);i&&(i(),Yt.delete(a))}}});requestAnimationFrame(()=>{document.querySelectorAll(".modal-overlay").forEach(s=>{np.observe(s,{attributes:!0,attributeFilter:["class"]})})});function op(){document.getElementById("sidebar").classList.toggle("open")}var In;(In=document.getElementById("sidebarBackdrop"))==null||In.addEventListener("click",()=>{document.getElementById("sidebar").classList.remove("open")});function ap(){const s=document.getElementById("sidebar"),n=document.querySelector(".main-content"),o=s.classList.toggle("expanded");n&&(n.style.marginLeft=o?"14rem":""),localStorage.setItem("sidebar_expanded",o?"1":"0")}var Bn;if(localStorage.getItem("sidebar_expanded")==="1"){(Bn=document.getElementById("sidebar"))==null||Bn.classList.add("expanded");const s=document.querySelector(".main-content");s&&(s.style.marginLeft="14rem")}document.querySelectorAll("a[data-page]").forEach(s=>{const n=s.dataset.page;s.href="#/"+n,s.removeAttribute("onclick"),s.addEventListener("click",o=>{o.preventDefault(),je(n),window.innerWidth<=768&&document.getElementById("sidebar").classList.remove("open")})});var Pn;(Pn=document.getElementById("sidebar"))==null||Pn.addEventListener("keydown",s=>{if(!["ArrowDown","ArrowUp","ArrowRight","ArrowLeft"].includes(s.key))return;const n=[...document.querySelectorAll("#sidebar .nav-item, #sidebar .nav-group-trigger, #sidebar .nav-flyout-link")].filter(a=>a.offsetParent!==null),o=n.indexOf(document.activeElement);if(o!==-1){if(s.preventDefault(),s.key==="ArrowDown")n[(o+1)%n.length].focus();else if(s.key==="ArrowUp")n[(o-1+n.length)%n.length].focus();else if(s.key==="ArrowRight"){const a=document.activeElement.closest(".nav-group");a&&!a.classList.contains("open")&&(Ss(a.dataset.group),requestAnimationFrame(()=>{const i=a.querySelector(".nav-flyout-link");i&&i.focus()}))}else if(s.key==="ArrowLeft"){const a=document.activeElement.closest(".nav-group");if(a&&a.classList.contains("open")){Ss(a.dataset.group);const i=a.querySelector(".nav-group-trigger");i&&i.focus()}}}});window.addEventListener("langchange",()=>{Aa(),pa();const s=localStorage.getItem("admin_active_page")||"dashboard";je(s)});function rp(s){const n=s.closest(".acc-section")||s.closest(".onec-accordion");if(!n)return;const o=n.querySelector(".acc-body")||n.querySelector(".onec-section-body"),a=n.querySelector(".acc-chevron")||n.querySelector(".onec-chevron");n.dataset.open==="true"?(o.style.display="none",a&&a.classList.add("rotate-[-90deg]"),n.dataset.open="false"):(o.style.display="",a&&a.classList.remove("rotate-[-90deg]"),n.dataset.open="true")}function ip(){document.querySelectorAll(".tab-bar").forEach(s=>{function n(){const{scrollLeft:o,scrollWidth:a,clientWidth:i}=s;if(a<=i)s.classList.add("no-overflow"),s.classList.remove("scrolled-end","scrolled-mid");else{s.classList.remove("no-overflow");const r=o+i>=a-4,l=o<=4;s.classList.toggle("scrolled-end",r&&!l),s.classList.toggle("scrolled-mid",!r&&!l)}}s.addEventListener("scroll",n,{passive:!0}),requestAnimationFrame(n),new MutationObserver(n).observe(s,{childList:!0})})}requestAnimationFrame(ip);window._app={login:qn,logout:Vs,showPage:je,closeModal:F,toggleSidebar:op,toggleSidebarExpand:ap,toggleTheme:La,toggleLang:ea,toggleSidebarGroup:Ss,openHelp:Ma,closeHelp:Cs,toggleAccordion:rp};
