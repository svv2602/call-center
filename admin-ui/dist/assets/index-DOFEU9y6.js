(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function s(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(n){if(n.ep)return;n.ep=!0;const r=s(n);fetch(n.href,r)}})();function l(t,a="success"){const s=document.getElementById("toastContainer"),o=document.createElement("div"),n=a==="error"?"bg-red-600":"bg-emerald-600";o.className=`toast px-4 py-2.5 rounded-lg text-sm text-white shadow-lg ${n}`,o.textContent=t,s.appendChild(o),setTimeout(()=>o.remove(),4e3)}const Mt={"common.retry":"Повторить","common.save":"Сохранить","common.cancel":"Отмена","common.add":"Добавить","common.create":"Создать","common.edit":"Редактировать","common.delete":"Удалить","common.filter":"Фильтровать","common.yes":"Да","common.no":"Нет","common.loading":"Загрузка...","common.failedToLoad":"Ошибка загрузки: {error}","common.activate":"Активировать","common.deactivate":"Деактивировать","common.select":"Выбрать","common.pageInfo":"Стр. {current} из {total}","common.all":"Все","common.allStatuses":"Все статусы","common.searchPlaceholder":"Поиск...","common.showing":"Показано: {shown} из {total}","login.title":"Call Center AI","login.error":"Неверные учётные данные","login.username":"Имя пользователя","login.password":"Пароль","login.submit":"Войти","nav.dashboard":"Дашборд","nav.calls":"Журнал звонков","nav.training":"Обучение агента","nav.operators":"Операторы","nav.system":"Система","nav.users":"Пользователи","nav.prompts":"Промпты","nav.knowledge":"База знаний","nav.scenarios":"Сценарии","nav.tools":"Инструменты","nav.monitoring":"Мониторинг","nav.configuration":"Конфигурация","nav.notifications":"Уведомления","nav.audit":"Аудит","nav.logout":"Выход","theme.dark":"Тёмная","theme.light":"Светлая","ws.live":"Онлайн","ws.reconnecting":"Переподключение...","ws.offline":"Оффлайн","api.sessionExpired":"Сессия истекла. Пожалуйста, войдите снова.","api.unauthorized":"Не авторизован","dashboard.breadcrumb":"Дашборд","dashboard.title":"Дашборд","dashboard.callsToday":"Звонков сегодня","dashboard.resolvedByBot":"Решено ботом","dashboard.transferred":"Переведено","dashboard.avgQuality":"Средн. качество","dashboard.costToday":"Стоимость сегодня","dashboard.exportCSV":"Экспорт CSV","dashboard.downloadPDF":"Скачать PDF","dashboard.grafana":"Grafana в реальном времени","dashboard.csvExported":"CSV экспортирован","dashboard.exportFailed":"Ошибка экспорта: {error}","dashboard.pdfDownloaded":"PDF-отчёт скачан","dashboard.pdfFailed":"Ошибка скачивания PDF: {error}","dashboard.failedToLoad":"Не удалось загрузить дашборд: {error}","calls.breadcrumb":"Журнал звонков","calls.title":"Журнал звонков","calls.allScenarios":"Все сценарии","calls.tireSearch":"Поиск шин","calls.availability":"Наличие","calls.order":"Заказ","calls.fitting":"Шиномонтаж","calls.consultation":"Консультация","calls.all":"Все","calls.transferred":"Переведено","calls.resolvedByBot":"Решено ботом","calls.searchPlaceholder":"Поиск в транскрипции...","calls.qualityBelow":"Качество ниже","calls.exportCSV":"Экспорт CSV","calls.csvExported":"CSV экспортирован","calls.exportFailed":"Ошибка экспорта: {error}","calls.noCalls":"Звонки не найдены","calls.failedToLoad":"Не удалось загрузить звонки: {error}","calls.date":"Дата","calls.caller":"Звонящий","calls.scenario":"Сценарий","calls.duration":"Длительность","calls.quality":"Качество","calls.cost":"Стоимость","calls.status":"Статус","calls.statusTransferred":"Переведён","calls.statusResolved":"Решён","calls.detailTitle":"Детали звонка","calls.detailCaller":"Звонящий:","calls.detailScenario":"Сценарий:","calls.detailDuration":"Длительность:","calls.detailQuality":"Качество:","calls.detailCost":"Стоимость:","calls.detailPrompt":"Промпт:","calls.qualityBreakdown":"Разбивка качества","calls.transcription":"Транскрипция","calls.noTranscription":"Транскрипция недоступна","calls.customer":"Клиент","calls.bot":"Бот","calls.toolCalls":"Вызовы инструментов","calls.toolName":"Инструмент","calls.toolSuccess":"Успех","calls.toolDuration":"Длительность","calls.failedToLoadDetail":"Не удалось загрузить детали звонка: {error}","prompts.breadcrumb":"Промпты","prompts.title":"Управление промптами","prompts.versions":"Версии","prompts.abTests":"A/B-тесты","prompts.newVersion":"+ Новая версия","prompts.noVersions":"Версии промптов не найдены","prompts.name":"Название","prompts.active":"Активный","prompts.activeLabel":"Активен","prompts.created":"Создан","prompts.action":"Действие","prompts.activateBtn":"Активировать","prompts.failedToLoad":"Не удалось загрузить промпты: {error}","prompts.createTitle":"Создание новой версии промпта","prompts.nameLabel":"Название","prompts.namePlaceholder":"напр. v2.0-improved-search","prompts.systemPromptLabel":"Системный промпт","prompts.systemPromptPlaceholder":"Введите текст системного промпта...","prompts.nameRequired":"Название и системный промпт обязательны","prompts.created_toast":"Версия промпта создана","prompts.createFailed":"Не удалось создать промпт: {error}","prompts.activateConfirm":"Активировать эту версию промпта? Все звонки будут использовать её.","prompts.activated":"Версия промпта активирована","prompts.activateFailed":"Не удалось активировать промпт: {error}","prompts.noABTests":"A/B-тесты не найдены","prompts.testName":"Тест","prompts.variantA":"Вариант A","prompts.variantB":"Вариант B","prompts.callsAB":"Звонки A/B","prompts.qualityAB":"Качество A/B","prompts.abStatus":"Статус","prompts.abAction":"Действие","prompts.stopBtn":"Остановить","prompts.stopConfirm":"Остановить этот A/B-тест?","prompts.stopped":"A/B-тест остановлен","prompts.stopFailed":"Не удалось остановить тест: {error}","prompts.failedToLoadAB":"Не удалось загрузить A/B-тесты: {error}","prompts.newABTest":"+ Новый A/B-тест","prompts.createABTestTitle":"Создание A/B-теста","prompts.testNameLabel":"Название теста","prompts.testNameRequired":"Название теста обязательно","prompts.variantALabel":"Вариант A","prompts.variantBLabel":"Вариант B","prompts.trafficSplitLabel":"Разделение трафика (% вариант A)","prompts.variantsRequired":"Выберите оба варианта","prompts.variantsMustDiffer":"Варианты A и B должны различаться","prompts.abTestCreated":"A/B-тест создан","prompts.abTestCreateFailed":"Не удалось создать A/B-тест: {error}","prompts.deleteABTestConfirm":"Удалить A/B-тест «{name}»?","prompts.abTestDeleted":"A/B-тест удалён","prompts.abTestDeleteFailed":"Не удалось удалить A/B-тест: {error}","prompts.recommended":"Рекомендован: {variant}","prompts.noSignificance":"Нет значимой разницы","prompts.notEnoughData":"Мало данных","prompts.stoppedWithResult":"Тест остановлен. {result}","prompts.abReportTitle":"Отчёт A/B-теста","prompts.reportSummary":"Сводка","prompts.reportCriteria":"По критериям","prompts.reportScenarios":"По сценариям","prompts.reportDaily":"Динамика по дням","prompts.reportCalls":"Звонки","prompts.reportQuality":"Качество","prompts.reportAvgDuration":"Средн. длительность","prompts.reportTransferRate":"Перевод на оператора","prompts.reportCriterion":"Критерий","prompts.reportDelta":"Дельта","prompts.reportScenario":"Сценарий","prompts.exportCSV":"Экспорт CSV","prompts.csvExported":"CSV экспортирован","prompts.exportFailed":"Ошибка экспорта: {error}","prompts.reportFailedToLoad":"Не удалось загрузить отчёт: {error}","prompts.reportNoData":"Нет данных для отчёта","prompts.criterionAccuracy":"Точность","prompts.criterionCompleteness":"Полнота","prompts.criterionPoliteness":"Вежливость","prompts.criterionResponseTime":"Время ответа","prompts.criterionProblemResolution":"Решение проблемы","prompts.criterionLanguageQuality":"Качество речи","prompts.criterionToolUsage":"Использование инструментов","prompts.criterionScenarioAdherence":"Следование сценарию","prompts.viewTitle":"Просмотр промпта","prompts.loadDefault":"Загрузить системный","prompts.resetToDefault":"Сброс к заводским","prompts.resetConfirm":"Создать новую версию из заводского промпта и активировать?","prompts.resetDone":"Промпт сброшен к заводским настройкам","prompts.resetFailed":"Ошибка сброса: {error}","prompts.deleteConfirm":"Удалить промпт «{name}»?","prompts.deleted":"Промпт удалён","prompts.deleteFailed":"Не удалось удалить промпт: {error}","knowledge.breadcrumb":"База знаний","knowledge.title":"База знаний","knowledge.allCategories":"Все категории","knowledge.searchPlaceholder":"Поиск...","knowledge.allActive":"Все","knowledge.activeOnly":"Активные","knowledge.inactiveOnly":"Неактивные","knowledge.newArticle":"+ Новая статья","knowledge.reindexAll":"Переиндексировать всё","knowledge.importDocuments":"Импорт документов","knowledge.noArticles":"Статьи не найдены","knowledge.articleTitle":"Название","knowledge.category":"Категория","knowledge.embedding":"Эмбеддинг","knowledge.activeCol":"Активен","knowledge.updated":"Обновлён","knowledge.actions":"Действия","knowledge.editBtn":"Ред.","knowledge.reindexBtn":"Переиндекс.","knowledge.deleteBtn":"Удалить","knowledge.total":"Всего: {count} статей","knowledge.failedToLoad":"Не удалось загрузить статьи: {error}","knowledge.newArticleTitle":"Новая статья","knowledge.editArticleTitle":"Редактирование статьи","knowledge.titleLabel":"Название","knowledge.titlePlaceholder":"Название статьи","knowledge.categoryLabel":"Категория","knowledge.contentLabel":"Содержание (Markdown)","knowledge.contentPlaceholder":"Содержание статьи в формате Markdown...","knowledge.titleRequired":"Название и содержание обязательны","knowledge.articleUpdated":"Статья обновлена","knowledge.articleCreated":"Статья создана","knowledge.saveFailed":"Не удалось сохранить статью: {error}","knowledge.articleDeactivated":"Статья деактивирована","knowledge.articleActivated":"Статья активирована","knowledge.toggleFailed":"Не удалось обновить статью: {error}","knowledge.deleteConfirm":'Удалить статью "{title}"?',"knowledge.articleDeleted":"Статья удалена","knowledge.deleteFailed":"Не удалось удалить статью: {error}","knowledge.reindexQueued":"Переиндексация поставлена в очередь","knowledge.reindexFailed":"Ошибка переиндексации: {error}","knowledge.reindexAllConfirm":"Переиндексировать все статьи? Это может занять время.","knowledge.reindexAllDispatched":"Переиндексация всех статей запущена","knowledge.reindexAllFailed":"Ошибка переиндексации: {error}","knowledge.loadFailed":"Не удалось загрузить статью: {error}","knowledge.importTitle":"Импорт документов","knowledge.importFilesLabel":"Файлы (MD, PDF, DOCX)","knowledge.importCategoryLabel":"Категория (необязательно, авто-определение если пусто)","knowledge.importAutoDetect":"Авто-определение по имени файла","knowledge.importBtn":"Импортировать","knowledge.importNoFiles":"Пожалуйста, выберите файлы для импорта","knowledge.importResult":"Импортировано: {imported}","knowledge.importErrors":"Ошибки: {errors}","knowledge.importFailed":"Ошибка импорта: {error}","operators.breadcrumb":"Операторы","operators.title":"Операторы","operators.online":"Операторов онлайн","operators.transfers1h":"Переводов (1ч)","operators.queueUnavailable":"Статус очереди недоступен","operators.newOperator":"+ Новый оператор","operators.searchPlaceholder":"Поиск по имени/номеру...","operators.allStatuses":"Все статусы","operators.noOperators":"Операторы не найдены","operators.name":"Имя","operators.extension":"Внутр. номер","operators.status":"Статус","operators.skills":"Навыки","operators.shift":"Смена","operators.activeCol":"Активен","operators.actionsCol":"Действия","operators.statusSelect":"Статус...","operators.statusOnline":"Онлайн","operators.statusOffline":"Оффлайн","operators.statusBusy":"Занят","operators.statusBreak":"Перерыв","operators.editBtn":"Ред.","operators.deactivateBtn":"Деактив.","operators.failedToLoad":"Не удалось загрузить операторов: {error}","operators.newOperatorTitle":"Новый оператор","operators.editOperatorTitle":"Редактирование оператора","operators.nameLabel":"Имя","operators.namePlaceholder":"ФИО","operators.extensionLabel":"Внутр. номер (SIP)","operators.extensionPlaceholder":"напр. 101","operators.skillsLabel":"Навыки (через запятую)","operators.skillsPlaceholder":"шины, заказы, шиномонтаж","operators.shiftStartLabel":"Начало смены","operators.shiftEndLabel":"Конец смены","operators.nameRequired":"Имя и внутр. номер обязательны","operators.operatorUpdated":"Оператор обновлён","operators.operatorCreated":"Оператор создан","operators.saveFailed":"Не удалось сохранить оператора: {error}","operators.statusChanged":"Статус изменён на {status}","operators.statusFailed":"Не удалось изменить статус: {error}","operators.deactivateConfirm":'Деактивировать оператора "{name}"?',"operators.operatorDeactivated":"Оператор деактивирован","operators.deactivateFailed":"Не удалось деактивировать: {error}","operators.notFound":"Оператор не найден","operators.loadFailed":"Не удалось загрузить оператора: {error}","settings.breadcrumb":"Система","settings.title":"Статус системы","settings.healthCheck":"Проверка здоровья","settings.refresh":"Обновить","settings.extendedStatus":"Расширенный статус","settings.clickToLoad":"Нажмите для загрузки","settings.loadStatus":"Загрузить статус","settings.configuration":"Конфигурация","settings.configDescription":"Перезагрузить безопасные параметры конфигурации (качество, фича-флаги, логирование) без перезапуска.","settings.reloadConfig":"Перезагрузить конфиг","settings.externalTools":"Внешние инструменты","settings.openGrafana":"Открыть Grafana","settings.openPrometheus":"Открыть Prometheus","settings.openFlower":"Открыть Flower","settings.appInfo":"Информация о приложении","settings.version":"Версия","settings.status":"Статус","settings.activeCalls":"Активные звонки","settings.redis":"Redis","settings.storeAPI":"Store API","settings.claudeAPI":"Claude API","settings.googleSTT":"Google STT","settings.ttsEngine":"TTS Engine","settings.failedToLoad":"Не удалось загрузить системную информацию: {error}","settings.extVersion":"Версия","settings.uptime":"Аптайм","settings.uptimeValue":"{hours}ч {minutes}м","settings.pgDbSize":"Размер БД PostgreSQL","settings.pgConnections":"Подключения PostgreSQL","settings.redisMemory":"Память Redis","settings.celeryWorkers":"Celery workers","settings.lastBackup":"Последний бэкап","settings.extFailed":"Ошибка: {error}","settings.reloadConfirm":"Перезагрузить конфигурацию из окружения?","settings.configReloaded":`Конфигурация перезагружена:
`,"settings.reloadFailed":"Ошибка перезагрузки: {error}","settings.llmRouting":"Маршрутизация LLM","settings.llmRoutingDesc":"Мультипровайдерный роутинг LLM: управление провайдерами, задачами и fallback-цепочками.","settings.llmLoadConfig":"Загрузить конфигурацию","settings.llmProvider":"Провайдер","settings.llmType":"Тип","settings.llmModel":"Модель","settings.llmApiKey":"API-ключ","settings.llmEnabled":"Включён","settings.llmHealth":"Здоровье","settings.llmActions":"Действия","settings.llmTest":"Тест","settings.llmTaskRouting":"Маршрутизация задач","settings.llmTask":"Задача","settings.llmPrimary":"Основной","settings.llmFallbacks":"Запасные","settings.llmAddProvider":"Добавить провайдер","settings.llmAddFillRequired":"Укажите модель","settings.llmProviderAdded":"Провайдер {key} добавлен","settings.llmModelUpdated":"{key}: модель изменена на {model}","settings.llmProviderToggled":"Провайдер {key}: {state}","settings.llmRouteUpdated":"Задача {task} → {provider}","settings.llmTaskDesc_agent":"Основной ИИ-агент: ведёт диалог с клиентом, вызывает инструменты (поиск шин, заказы, запись на шиномонтаж).","settings.llmTaskRec_agent":"Рекомендация: мощная модель (Sonnet, GPT-4o). Требуется tool calling, высокое качество диалога.","settings.llmTaskDesc_article_processor":"Обработка статей базы знаний: структурирование, очистка, извлечение ключевых фактов из импортированных документов.","settings.llmTaskRec_article_processor":"Рекомендация: быстрая/дешёвая модель (Haiku, GPT-4o-mini). Фоновая задача, не требует tool calling.","settings.llmTaskDesc_quality_scoring":"Оценка качества звонков: анализ транскрипции, выставление баллов по критериям (точность, вежливость, полнота).","settings.llmTaskRec_quality_scoring":"Рекомендация: быстрая/дешёвая модель (Haiku, GPT-4o-mini). Фоновая Celery-задача, пакетная обработка.","settings.llmTaskDesc_prompt_optimizer":"Оптимизация системного промпта: анализ результатов A/B-тестов, генерация улучшенных версий промпта.","settings.llmTaskRec_prompt_optimizer":"Рекомендация: быстрая/дешёвая модель (Haiku, GPT-4o-mini). Редкая фоновая задача.","settings.llmFbSelect":"Выбрать...","settings.llmFbMoveUp":"Переместить выше","settings.llmFbMoveDown":"Переместить ниже","settings.llmFallbacksUpdated":"Запасные для {task}: {count} шт.","settings.llmConfigFailed":"Ошибка сохранения конфигурации: {error}","settings.llmTesting":"Тестирование {key}...","settings.llmTestSuccess":"{key}: OK ({latency}ms)","settings.llmTestFailed":"{key}: ошибка — {error}","settings.llmLoadFailed":"Не удалось загрузить конфигурацию LLM: {error}","settings.telegram":"Уведомления Telegram","settings.telegramDesc":"Настройка Telegram-бота для получения алертов от Alertmanager.","settings.telegramLoadConfig":"Загрузить","settings.telegramStatus":"Токен","settings.telegramTokenSet":"настроен","settings.telegramTokenMissing":"не настроен","settings.telegramBotToken":"Bot Token","settings.telegramBotTokenPlaceholder":"Новый токен (оставьте пустым чтобы не менять)","settings.telegramChatId":"Chat ID","settings.telegramChatIdPlaceholder":"Числовой ID чата или группы","settings.telegramTestBtn":"Тест","settings.telegramSaved":"Telegram-конфиг сохранён","settings.telegramSaveFailed":"Ошибка сохранения: {error}","settings.telegramFillFields":"Укажите хотя бы токен или chat_id","settings.telegramTesting":"Отправка тестового сообщения...","settings.telegramTestSuccess":"Тест OK ({latency}ms)","settings.telegramTestFailed":"Ошибка: {error}","settings.telegramLoadFailed":"Не удалось загрузить конфиг Telegram: {error}","users.breadcrumb":"Пользователи","users.title":"Управление пользователями","users.newUser":"+ Новый пользователь","users.noUsers":"Пользователи не найдены","users.username":"Имя пользователя","users.role":"Роль","users.activeCol":"Активен","users.lastLogin":"Последний вход","users.actionsCol":"Действия","users.changeRole":"Изменить роль...","users.roleAdmin":"Админ","users.roleAnalyst":"Аналитик","users.roleOperator":"Оператор","users.resetPwd":"Сброс пароля","users.failedToLoad":"Не удалось загрузить пользователей: {error}","users.createTitle":"Создание нового пользователя","users.usernameLabel":"Имя пользователя","users.usernamePlaceholder":"имя пользователя","users.passwordLabel":"Пароль","users.passwordPlaceholder":"пароль","users.roleLabel":"Роль","users.usernameRequired":"Имя пользователя и пароль обязательны","users.userCreated":"Пользователь создан","users.createFailed":"Не удалось создать пользователя: {error}","users.roleUpdated":"Роль обновлена","users.roleFailed":"Не удалось обновить роль: {error}","users.userDeactivated":"Пользователь деактивирован","users.userActivated":"Пользователь активирован","users.toggleFailed":"Не удалось обновить пользователя: {error}","users.newPasswordPrompt":"Новый пароль для {username}:","users.passwordReset":"Пароль сброшен","users.resetFailed":"Не удалось сбросить пароль: {error}","training.breadcrumb":"Обучение агента","training.title":"Обучение агента","training.tabPrompts":"Промпты","training.tabKnowledge":"База знаний","training.tabTemplates":"Шаблоны ответов","training.tabDialogues":"Сценарии диалогов","training.tabSafety":"Правила безопасности","training.tabTools":"Инструменты","training.activeCol":"Активен","training.actions":"Действия","training.loadFailed":"Не удалось загрузить: {error}","training.saveFailed":"Не удалось сохранить: {error}","training.deleteFailed":"Не удалось удалить: {error}","training.deleteConfirm":'Удалить "{title}"?',"training.titleRequired":"Название обязательно","training.titleContentRequired":"Название и содержание обязательны","training.fieldsRequired":"Все обязательные поля должны быть заполнены","training.keyRequired":"Ключ шаблона обязателен","training.newTemplate":"+ Новый шаблон","training.editTemplate":"Редактирование шаблона","training.addVariantTitle":"Добавить вариант ответа","training.noTemplates":"Шаблоны не найдены","training.templateKey":"Ключ","training.templateTitle":"Название","training.content":"Содержание","training.description":"Описание","training.templateSaved":"Шаблон сохранён","training.addVariant":"+ Вариант","training.variantCount":"вар.","training.variantsHint":"Несколько вариантов на ключ — агент выбирает случайный при каждом звонке","training.deleteVariantConfirm":'Удалить вариант "{title}"?',"training.variantDeleted":"Вариант удалён","training.allTemplateKeys":"Все ключи","training.searchTemplates":"Поиск шаблонов...","training.filterScenario":"Сценарий","training.allScenarios":"Все сценарии","training.filterPhase":"Фаза","training.allPhases":"Все фазы","training.filterActive":"Статус","training.allActive":"Все","training.activeOnly":"Активные","training.inactiveOnly":"Неактивные","training.newDialogue":"+ Новый сценарий","training.editDialogue":"Редактирование сценария","training.noDialogues":"Сценарии не найдены","training.dialogueTitle":"Название","training.dialogueTitlePlaceholder":"Название сценария","training.scenario":"Сценарий","training.phase":"Фаза","training.tools":"Инструменты","training.dialogueJSON":"Диалог (JSON)","training.invalidJSON":"Некорректный JSON","training.dialogueSaved":"Сценарий сохранён","training.dialogueDeleted":"Сценарий удалён","training.filterRuleType":"Тип правила","training.allRuleTypes":"Все типы","training.filterSeverity":"Серьёзность","training.allSeverities":"Все","training.newSafetyRule":"+ Новое правило","training.editSafetyRule":"Редактирование правила","training.noSafetyRules":"Правила не найдены","training.ruleTitle":"Название","training.ruleType":"Тип правила","training.severity":"Серьёзность","training.triggerInput":"Триггер (ввод клиента)","training.expectedBehavior":"Ожидаемое поведение","training.safetyRuleSaved":"Правило сохранено","training.safetyRuleDeleted":"Правило удалено","training.toolName":"Инструмент","training.override":"Переопределение","training.overridden":"Переопределён","training.default":"По умолчанию","training.editTool":"Редактирование инструмента","training.originalDescription":"Описание по умолчанию","training.overrideDescription":"Переопределённое описание","training.descriptionRequired":"Описание обязательно","training.toolOverrideSaved":"Переопределение сохранено","training.toolOverrideReset":"Переопределение сброшено","training.reset":"Сбросить","training.resetConfirm":"Сбросить переопределение для {name}?","training.resetFailed":"Не удалось сбросить: {error}","training.toolNotFound":"Инструмент не найден","training.tabSources":"Источники","sources.enabled":"Скрапер включён","sources.autoApprove":"Авто-публикация","sources.runNow":"Запустить сейчас","sources.schedule":"Расписание","sources.noSources":"Источники не найдены","sources.allStatuses":"Все статусы","sources.url":"URL","sources.originalTitle":"Оригинальное название","sources.status":"Статус","sources.date":"Дата","sources.actions":"Действия","sources.approve":"Одобрить","sources.reject":"Отклонить","sources.viewArticle":"Статья","sources.total":"Всего: {count}","sources.configUpdated":"Конфигурация обновлена","sources.configUpdateFailed":"Ошибка обновления: {error}","sources.configLoadFailed":"Ошибка загрузки конфигурации: {error}","sources.runDispatched":"Скрапер запущен","sources.runFailed":"Не удалось запустить скрапер: {error}","sources.approved":"Статья одобрена и активирована","sources.approveFailed":"Ошибка одобрения: {error}","sources.rejected":"Источник отклонён","sources.rejectFailed":"Ошибка отклонения: {error}","sources.rejectConfirm":"Отклонить этот источник?","sources.failedToLoad":"Не удалось загрузить источники: {error}","sources.minDate":"С даты","sources.minDateHint":"Пусто = последние 14 дней (авторежим)","sources.maxDate":"По дату","sources.maxDateHint":"Пусто = без ограничения (до сегодня)","sources.dedupLlmCheck":"LLM-проверка дубликатов","sources.dedupLlmCheckHint":"Использовать LLM для пограничных случаев (0.80–0.90 сходство)","sources.duplicate":"дубликат","sources.duplicateSuspect":"возможный дубликат","sources.watchedPagesTitle":"Отслеживаемые страницы","sources.watchedPagesHint":"Страницы сайта, которые периодически пересканируются для обновления базы знаний агента.","sources.addWatchedPage":"Добавить страницу","sources.noWatchedPages":"Отслеживаемые страницы не добавлены","sources.watchedUrl":"URL","sources.watchedCategory":"Категория","sources.watchedInterval":"Интервал (ч)","sources.watchedStatus":"Статус","sources.watchedLastScraped":"Последний скан","sources.watchedNextScrape":"Следующий скан","sources.watchedArticle":"Статья","sources.watchedActions":"Действия","sources.scrapeNow":"Сканировать","sources.deleteWatched":"Удалить","sources.watchedPageAdded":"Страница добавлена","sources.watchedPageAddFailed":"Ошибка добавления: {error}","sources.watchedPageDeleted":"Страница удалена","sources.watchedPageDeleteFailed":"Ошибка удаления: {error}","sources.watchedPageDeleteConfirm":"Удалить отслеживание этой страницы?","sources.watchedPageUpdated":"Настройки обновлены","sources.watchedPageUpdateFailed":"Ошибка обновления: {error}","sources.scrapeNowRunning":"Сканирование...","sources.scrapeNowDone":"Сканирование завершено: {status}","sources.scrapeNowUnchanged":"Контент не изменился","sources.scrapeNowDiscoveryDone":"Discovery: найдено {discovered} стр., создано {created}, обновлено {updated}","sources.scrapeNowFailed":"Ошибка сканирования: {error}","sources.watchedFailedToLoad":"Не удалось загрузить: {error}","sources.urlRequired":"Укажите URL страницы","sources.categoryRequired":"Выберите категорию","sources.intervalRequired":"Выберите интервал","sources.urlPlaceholder":"https://prokoleso.ua/ua/...","sources.neverScraped":"ещё не сканировалась","sources.discoveryLabel":"Страница-каталог","sources.discoveryBadge":"каталог","sources.discoveryHint":"Страница со списком ссылок (напр. акции). Автоматически находит все дочерние страницы и сканирует каждую отдельно.","sources.childCount":"{count} дочерних","sources.intervalHours.6":"Каждые 6 ч","sources.intervalHours.12":"Каждые 12 ч","sources.intervalHours.24":"Раз в сутки","sources.intervalHours.168":"Раз в неделю","sources.tabConfigs":"Конфигурации","sources.tabScraper":"Скрапер","sources.tabWatched":"Отслеживаемые","sources.sourceConfigsTitle":"Источники контента","sources.sourceConfigsHint":"Внешние сайты для сбора статей в базу знаний.","sources.scraperConfigTitle":"ProKoleso — ручной импорт","sources.addSource":"Добавить источник","sources.editSource":"Редактировать источник","sources.sourceName":"Название","sources.sourceType":"Тип","sources.sourceUrl":"URL","sources.sourceLanguage":"Язык","sources.maxArticles":"Макс. статей","sources.lastRun":"Последний запуск","sources.runSource":"Запустить","sources.deleteSource":"Удалить","sources.settingsJson":"Настройки (JSON)","sources.noSourceConfigs":"Источники контента не настроены","sources.sourceConfigSaved":"Источник сохранён","sources.sourceConfigSaveFailed":"Ошибка сохранения: {error}","sources.sourceConfigDeleted":"Источник удалён","sources.sourceConfigDeleteFailed":"Ошибка удаления: {error}","sources.deleteSourceConfirm":"Удалить источник «{name}»?","sources.nameUrlRequired":"Укажите название и URL","sources.invalidSettingsJson":"Некорректный JSON в настройках","sources.processed":"Обработано","nav.vehicles":"База авто","vehicles.breadcrumb":"База авто","vehicles.title":"База автомобилей","vehicles.searchPlaceholder":"Поиск по названию...","vehicles.brands":"Марки","vehicles.models":"Модели","vehicles.kits":"Комплектации","vehicles.tireSizes":"Размеры шин","vehicles.lastImport":"Последний импорт","vehicles.brand":"Марка","vehicles.model":"Модель","vehicles.year":"Год","vehicles.trim":"Комплектация","vehicles.pcd":"PCD","vehicles.bolts":"Болты","vehicles.dia":"DIA","vehicles.size":"Размер","vehicles.type":"Тип","vehicles.axle":"Ось","vehicles.stock":"Заводской","vehicles.tuning":"Тюнинг","vehicles.front":"Перед","vehicles.rear":"Зад","vehicles.all":"Все","vehicles.back":"← Назад","vehicles.noData":"Нет данных","vehicles.failedToLoad":"Не удалось загрузить: {error}","vehicles.neverImported":"Импорт не выполнялся","vehicles.importButton":"Обновить БД","vehicles.importTitle":"Обновление базы автомобилей","vehicles.importInstructions":"Разместите 4 CSV-файла в директории на сервере:","vehicles.importWarning":"Импорт удалит текущие данные и загрузит новые. Операция занимает ~30-60 секунд.","vehicles.importPathLabel":"Путь к директории с CSV","vehicles.importPathRequired":"Укажите путь к директории","vehicles.importBtn":"Импортировать","vehicles.importSuccess":"Импорт завершён: {brands} марок, {models} моделей, {kits} комплектаций, {tireSizes} размеров шин","vehicles.importFailed":"Ошибка импорта: {error}","common.search":"Поиск","audit.breadcrumb":"Аудит","audit.title":"Журнал аудита","audit.allActions":"Все действия","audit.noEntries":"Записи аудита не найдены","audit.date":"Дата","audit.user":"Пользователь","audit.action":"Действие","audit.resource":"Ресурс","audit.ip":"IP","audit.failedToLoad":"Не удалось загрузить журнал аудита: {error}"},Rt={"common.retry":"Retry","common.save":"Save","common.cancel":"Cancel","common.add":"Add","common.create":"Create","common.edit":"Edit","common.delete":"Delete","common.filter":"Filter","common.yes":"Yes","common.no":"No","common.loading":"Loading...","common.failedToLoad":"Failed to load: {error}","common.activate":"Activate","common.deactivate":"Deactivate","common.select":"Select","common.pageInfo":"Page {current} of {total}","common.all":"All","common.allStatuses":"All statuses","common.searchPlaceholder":"Search...","common.showing":"Showing: {shown} of {total}","login.title":"Call Center AI","login.error":"Invalid credentials","login.username":"Username","login.password":"Password","login.submit":"Login","nav.dashboard":"Dashboard","nav.calls":"Call Journal","nav.training":"Agent Training","nav.operators":"Operators","nav.system":"System","nav.users":"Users","nav.prompts":"Prompts","nav.knowledge":"Knowledge Base","nav.scenarios":"Scenarios","nav.tools":"Tools","nav.monitoring":"Monitoring","nav.configuration":"Configuration","nav.notifications":"Notifications","nav.audit":"Audit Log","nav.logout":"Logout","theme.dark":"Dark","theme.light":"Light","ws.live":"Live","ws.reconnecting":"Reconnecting...","ws.offline":"Offline","api.sessionExpired":"Session expired. Please login again.","api.unauthorized":"Unauthorized","dashboard.breadcrumb":"Dashboard","dashboard.title":"Dashboard","dashboard.callsToday":"Calls today","dashboard.resolvedByBot":"Resolved by bot","dashboard.transferred":"Transferred","dashboard.avgQuality":"Avg quality","dashboard.costToday":"Cost today","dashboard.exportCSV":"Export Stats CSV","dashboard.downloadPDF":"Download PDF","dashboard.grafana":"Grafana Real-time","dashboard.csvExported":"CSV exported","dashboard.exportFailed":"Export failed: {error}","dashboard.pdfDownloaded":"PDF report downloaded","dashboard.pdfFailed":"PDF download failed: {error}","dashboard.failedToLoad":"Failed to load dashboard: {error}","calls.breadcrumb":"Call Journal","calls.title":"Call Journal","calls.allScenarios":"All scenarios","calls.tireSearch":"Tire search","calls.availability":"Availability","calls.order":"Order","calls.fitting":"Fitting","calls.consultation":"Consultation","calls.all":"All","calls.transferred":"Transferred","calls.resolvedByBot":"Resolved by bot","calls.searchPlaceholder":"Search transcription...","calls.qualityBelow":"Quality below","calls.exportCSV":"Export CSV","calls.csvExported":"CSV exported","calls.exportFailed":"Export failed: {error}","calls.noCalls":"No calls found","calls.failedToLoad":"Failed to load calls: {error}","calls.date":"Date","calls.caller":"Caller","calls.scenario":"Scenario","calls.duration":"Duration","calls.quality":"Quality","calls.cost":"Cost","calls.status":"Status","calls.statusTransferred":"Transferred","calls.statusResolved":"Resolved","calls.detailTitle":"Call Details","calls.detailCaller":"Caller:","calls.detailScenario":"Scenario:","calls.detailDuration":"Duration:","calls.detailQuality":"Quality:","calls.detailCost":"Cost:","calls.detailPrompt":"Prompt:","calls.qualityBreakdown":"Quality Breakdown","calls.transcription":"Transcription","calls.noTranscription":"No transcription available","calls.customer":"Customer","calls.bot":"Bot","calls.toolCalls":"Tool Calls","calls.toolName":"Tool","calls.toolSuccess":"Success","calls.toolDuration":"Duration","calls.failedToLoadDetail":"Failed to load call details: {error}","prompts.breadcrumb":"Prompts","prompts.title":"Prompt Management","prompts.versions":"Versions","prompts.abTests":"A/B Tests","prompts.newVersion":"+ New Version","prompts.noVersions":"No prompt versions found","prompts.name":"Name","prompts.active":"Active","prompts.activeLabel":"Active","prompts.created":"Created","prompts.action":"Action","prompts.activateBtn":"Activate","prompts.failedToLoad":"Failed to load prompts: {error}","prompts.createTitle":"Create New Prompt Version","prompts.nameLabel":"Name","prompts.namePlaceholder":"e.g. v2.0-improved-search","prompts.systemPromptLabel":"System Prompt","prompts.systemPromptPlaceholder":"Enter system prompt text...","prompts.nameRequired":"Name and system prompt are required","prompts.created_toast":"Prompt version created","prompts.createFailed":"Failed to create prompt: {error}","prompts.activateConfirm":"Activate this prompt version? All calls will use it.","prompts.activated":"Prompt version activated","prompts.activateFailed":"Failed to activate prompt: {error}","prompts.noABTests":"No A/B tests found","prompts.testName":"Test","prompts.variantA":"Variant A","prompts.variantB":"Variant B","prompts.callsAB":"Calls A/B","prompts.qualityAB":"Quality A/B","prompts.abStatus":"Status","prompts.abAction":"Action","prompts.stopBtn":"Stop","prompts.stopConfirm":"Stop this A/B test?","prompts.stopped":"A/B test stopped","prompts.stopFailed":"Failed to stop test: {error}","prompts.failedToLoadAB":"Failed to load A/B tests: {error}","prompts.newABTest":"+ New A/B Test","prompts.createABTestTitle":"Create A/B Test","prompts.testNameLabel":"Test name","prompts.testNameRequired":"Test name is required","prompts.variantALabel":"Variant A","prompts.variantBLabel":"Variant B","prompts.trafficSplitLabel":"Traffic split (% variant A)","prompts.variantsRequired":"Select both variants","prompts.variantsMustDiffer":"Variants A and B must be different","prompts.abTestCreated":"A/B test created","prompts.abTestCreateFailed":"Failed to create A/B test: {error}","prompts.deleteABTestConfirm":'Delete A/B test "{name}"?',"prompts.abTestDeleted":"A/B test deleted","prompts.abTestDeleteFailed":"Failed to delete A/B test: {error}","prompts.recommended":"Recommended: {variant}","prompts.noSignificance":"No significant difference","prompts.notEnoughData":"Not enough data","prompts.stoppedWithResult":"Test stopped. {result}","prompts.abReportTitle":"A/B Test Report","prompts.reportSummary":"Summary","prompts.reportCriteria":"By Criteria","prompts.reportScenarios":"By Scenario","prompts.reportDaily":"Daily Dynamics","prompts.reportCalls":"Calls","prompts.reportQuality":"Quality","prompts.reportAvgDuration":"Avg Duration","prompts.reportTransferRate":"Transfer Rate","prompts.reportCriterion":"Criterion","prompts.reportDelta":"Delta","prompts.reportScenario":"Scenario","prompts.exportCSV":"Export CSV","prompts.csvExported":"CSV exported","prompts.exportFailed":"Export failed: {error}","prompts.reportFailedToLoad":"Failed to load report: {error}","prompts.reportNoData":"No data for report","prompts.criterionAccuracy":"Accuracy","prompts.criterionCompleteness":"Completeness","prompts.criterionPoliteness":"Politeness","prompts.criterionResponseTime":"Response Time","prompts.criterionProblemResolution":"Problem Resolution","prompts.criterionLanguageQuality":"Language Quality","prompts.criterionToolUsage":"Tool Usage","prompts.criterionScenarioAdherence":"Scenario Adherence","prompts.viewTitle":"View Prompt","prompts.loadDefault":"Load default","prompts.resetToDefault":"Reset to factory","prompts.resetConfirm":"Create a new version from the factory prompt and activate it?","prompts.resetDone":"Prompt reset to factory defaults","prompts.resetFailed":"Reset failed: {error}","prompts.deleteConfirm":'Delete prompt "{name}"?',"prompts.deleted":"Prompt deleted","prompts.deleteFailed":"Failed to delete prompt: {error}","knowledge.breadcrumb":"Knowledge Base","knowledge.title":"Knowledge Base","knowledge.allCategories":"All categories","knowledge.searchPlaceholder":"Search...","knowledge.allActive":"All","knowledge.activeOnly":"Active only","knowledge.inactiveOnly":"Inactive only","knowledge.newArticle":"+ New Article","knowledge.reindexAll":"Reindex All","knowledge.importDocuments":"Import Documents","knowledge.noArticles":"No articles found","knowledge.articleTitle":"Title","knowledge.category":"Category","knowledge.embedding":"Embedding","knowledge.activeCol":"Active","knowledge.updated":"Updated","knowledge.actions":"Actions","knowledge.editBtn":"Edit","knowledge.reindexBtn":"Reindex","knowledge.deleteBtn":"Delete","knowledge.total":"Total: {count} articles","knowledge.failedToLoad":"Failed to load articles: {error}","knowledge.newArticleTitle":"New Article","knowledge.editArticleTitle":"Edit Article","knowledge.titleLabel":"Title","knowledge.titlePlaceholder":"Article title","knowledge.categoryLabel":"Category","knowledge.contentLabel":"Content (Markdown)","knowledge.contentPlaceholder":"Article content in Markdown...","knowledge.titleRequired":"Title and content are required","knowledge.articleUpdated":"Article updated","knowledge.articleCreated":"Article created","knowledge.saveFailed":"Failed to save article: {error}","knowledge.articleDeactivated":"Article deactivated","knowledge.articleActivated":"Article activated","knowledge.toggleFailed":"Failed to update article: {error}","knowledge.deleteConfirm":'Delete article "{title}"?',"knowledge.articleDeleted":"Article deleted","knowledge.deleteFailed":"Failed to delete article: {error}","knowledge.reindexQueued":"Reindex queued","knowledge.reindexFailed":"Reindex failed: {error}","knowledge.reindexAllConfirm":"Reindex all articles? This may take a while.","knowledge.reindexAllDispatched":"Reindex-all dispatched","knowledge.reindexAllFailed":"Reindex-all failed: {error}","knowledge.loadFailed":"Failed to load article: {error}","knowledge.importTitle":"Import Documents","knowledge.importFilesLabel":"Files (MD, PDF, DOCX)","knowledge.importCategoryLabel":"Category (optional, auto-detect if empty)","knowledge.importAutoDetect":"Auto-detect from filename","knowledge.importBtn":"Import","knowledge.importNoFiles":"Please select files to import","knowledge.importResult":"Imported: {imported}","knowledge.importErrors":"Errors: {errors}","knowledge.importFailed":"Import failed: {error}","operators.breadcrumb":"Operators","operators.title":"Operators","operators.online":"Operators Online","operators.transfers1h":"Transfers (1h)","operators.queueUnavailable":"Queue status unavailable","operators.newOperator":"+ New Operator","operators.searchPlaceholder":"Search by name/extension...","operators.allStatuses":"All statuses","operators.noOperators":"No operators found","operators.name":"Name","operators.extension":"Extension","operators.status":"Status","operators.skills":"Skills","operators.shift":"Shift","operators.activeCol":"Active","operators.actionsCol":"Actions","operators.statusSelect":"Status...","operators.statusOnline":"Online","operators.statusOffline":"Offline","operators.statusBusy":"Busy","operators.statusBreak":"Break","operators.editBtn":"Edit","operators.deactivateBtn":"Deactivate","operators.failedToLoad":"Failed to load operators: {error}","operators.newOperatorTitle":"New Operator","operators.editOperatorTitle":"Edit Operator","operators.nameLabel":"Name","operators.namePlaceholder":"Full name","operators.extensionLabel":"Extension (SIP)","operators.extensionPlaceholder":"e.g. 101","operators.skillsLabel":"Skills (comma-separated)","operators.skillsPlaceholder":"tires, orders, fitting","operators.shiftStartLabel":"Shift Start","operators.shiftEndLabel":"Shift End","operators.nameRequired":"Name and extension are required","operators.operatorUpdated":"Operator updated","operators.operatorCreated":"Operator created","operators.saveFailed":"Failed to save operator: {error}","operators.statusChanged":"Status changed to {status}","operators.statusFailed":"Failed to change status: {error}","operators.deactivateConfirm":'Deactivate operator "{name}"?',"operators.operatorDeactivated":"Operator deactivated","operators.deactivateFailed":"Failed to deactivate: {error}","operators.notFound":"Operator not found","operators.loadFailed":"Failed to load operator: {error}","settings.breadcrumb":"System","settings.title":"System Status","settings.healthCheck":"Health Check","settings.refresh":"Refresh","settings.extendedStatus":"Extended Status","settings.clickToLoad":"Click to load","settings.loadStatus":"Load Status","settings.configuration":"Configuration","settings.configDescription":"Reload safe config parameters (quality, feature flags, logging) without restart.","settings.reloadConfig":"Reload Config","settings.externalTools":"External Tools","settings.openGrafana":"Open Grafana","settings.openPrometheus":"Open Prometheus","settings.openFlower":"Open Flower","settings.appInfo":"Application Info","settings.version":"Version","settings.status":"Status","settings.activeCalls":"Active calls","settings.redis":"Redis","settings.storeAPI":"Store API","settings.claudeAPI":"Claude API","settings.googleSTT":"Google STT","settings.ttsEngine":"TTS Engine","settings.failedToLoad":"Failed to load system info: {error}","settings.extVersion":"Version","settings.uptime":"Uptime","settings.uptimeValue":"{hours}h {minutes}m","settings.pgDbSize":"PostgreSQL DB size","settings.pgConnections":"PostgreSQL connections","settings.redisMemory":"Redis memory","settings.celeryWorkers":"Celery workers","settings.lastBackup":"Last backup","settings.extFailed":"Failed: {error}","settings.reloadConfirm":"Reload configuration from environment?","settings.configReloaded":`Config reloaded:
`,"settings.reloadFailed":"Reload failed: {error}","settings.llmRouting":"LLM Routing","settings.llmRoutingDesc":"Multi-provider LLM routing: manage providers, tasks, and fallback chains.","settings.llmLoadConfig":"Load Configuration","settings.llmProvider":"Provider","settings.llmType":"Type","settings.llmModel":"Model","settings.llmApiKey":"API Key","settings.llmEnabled":"Enabled","settings.llmHealth":"Health","settings.llmActions":"Actions","settings.llmTest":"Test","settings.llmTaskRouting":"Task Routing","settings.llmTask":"Task","settings.llmPrimary":"Primary","settings.llmFallbacks":"Fallbacks","settings.llmAddProvider":"Add provider","settings.llmAddFillRequired":"Model name is required","settings.llmProviderAdded":"Provider {key} added","settings.llmModelUpdated":"{key}: model changed to {model}","settings.llmProviderToggled":"Provider {key}: {state}","settings.llmRouteUpdated":"Task {task} → {provider}","settings.llmTaskDesc_agent":"Main AI agent: handles customer dialogue, calls tools (tire search, orders, fitting booking).","settings.llmTaskRec_agent":"Recommendation: powerful model (Sonnet, GPT-4o). Requires tool calling, high dialogue quality.","settings.llmTaskDesc_article_processor":"Knowledge base article processing: structuring, cleanup, key fact extraction from imported documents.","settings.llmTaskRec_article_processor":"Recommendation: fast/cheap model (Haiku, GPT-4o-mini). Background task, no tool calling needed.","settings.llmTaskDesc_quality_scoring":"Call quality scoring: transcription analysis, rating by criteria (accuracy, politeness, completeness).","settings.llmTaskRec_quality_scoring":"Recommendation: fast/cheap model (Haiku, GPT-4o-mini). Background Celery task, batch processing.","settings.llmTaskDesc_prompt_optimizer":"System prompt optimization: A/B test results analysis, improved prompt version generation.","settings.llmTaskRec_prompt_optimizer":"Recommendation: fast/cheap model (Haiku, GPT-4o-mini). Rare background task.","settings.llmFbSelect":"Select...","settings.llmFbMoveUp":"Move up","settings.llmFbMoveDown":"Move down","settings.llmFallbacksUpdated":"Fallbacks for {task}: {count}","settings.llmConfigFailed":"Config save failed: {error}","settings.llmTesting":"Testing {key}...","settings.llmTestSuccess":"{key}: OK ({latency}ms)","settings.llmTestFailed":"{key}: failed — {error}","settings.llmLoadFailed":"Failed to load LLM config: {error}","settings.telegram":"Telegram Notifications","settings.telegramDesc":"Configure Telegram bot for receiving Alertmanager alerts.","settings.telegramLoadConfig":"Load","settings.telegramStatus":"Token","settings.telegramTokenSet":"configured","settings.telegramTokenMissing":"not configured","settings.telegramBotToken":"Bot Token","settings.telegramBotTokenPlaceholder":"New token (leave empty to keep current)","settings.telegramChatId":"Chat ID","settings.telegramChatIdPlaceholder":"Numeric chat or group ID","settings.telegramTestBtn":"Test","settings.telegramSaved":"Telegram config saved","settings.telegramSaveFailed":"Save failed: {error}","settings.telegramFillFields":"Enter at least token or chat_id","settings.telegramTesting":"Sending test message...","settings.telegramTestSuccess":"Test OK ({latency}ms)","settings.telegramTestFailed":"Error: {error}","settings.telegramLoadFailed":"Failed to load Telegram config: {error}","users.breadcrumb":"Users","users.title":"User Management","users.newUser":"+ New User","users.noUsers":"No users found","users.username":"Username","users.role":"Role","users.activeCol":"Active","users.lastLogin":"Last Login","users.actionsCol":"Actions","users.changeRole":"Change role...","users.roleAdmin":"Admin","users.roleAnalyst":"Analyst","users.roleOperator":"Operator","users.resetPwd":"Reset pwd","users.failedToLoad":"Failed to load users: {error}","users.createTitle":"Create New User","users.usernameLabel":"Username","users.usernamePlaceholder":"username","users.passwordLabel":"Password","users.passwordPlaceholder":"password","users.roleLabel":"Role","users.usernameRequired":"Username and password are required","users.userCreated":"User created","users.createFailed":"Failed to create user: {error}","users.roleUpdated":"Role updated","users.roleFailed":"Failed to update role: {error}","users.userDeactivated":"User deactivated","users.userActivated":"User activated","users.toggleFailed":"Failed to update user: {error}","users.newPasswordPrompt":"New password for {username}:","users.passwordReset":"Password reset","users.resetFailed":"Failed to reset password: {error}","training.breadcrumb":"Agent Training","training.title":"Agent Training","training.tabPrompts":"Prompts","training.tabKnowledge":"Knowledge Base","training.tabTemplates":"Response Templates","training.tabDialogues":"Dialogue Scenarios","training.tabSafety":"Safety Rules","training.tabTools":"Tools","training.activeCol":"Active","training.actions":"Actions","training.loadFailed":"Failed to load: {error}","training.saveFailed":"Failed to save: {error}","training.deleteFailed":"Failed to delete: {error}","training.deleteConfirm":'Delete "{title}"?',"training.titleRequired":"Title is required","training.titleContentRequired":"Title and content are required","training.fieldsRequired":"All required fields must be filled","training.keyRequired":"Template key is required","training.newTemplate":"+ New Template","training.editTemplate":"Edit Template","training.addVariantTitle":"Add Response Variant","training.noTemplates":"No templates found","training.templateKey":"Key","training.templateTitle":"Title","training.content":"Content","training.description":"Description","training.templateSaved":"Template saved","training.addVariant":"+ Variant","training.variantCount":"var.","training.variantsHint":"Multiple variants per key — agent randomly picks one for each call","training.deleteVariantConfirm":'Delete variant "{title}"?',"training.variantDeleted":"Variant deleted","training.allTemplateKeys":"All keys","training.searchTemplates":"Search templates...","training.filterScenario":"Scenario","training.allScenarios":"All scenarios","training.filterPhase":"Phase","training.allPhases":"All phases","training.filterActive":"Status","training.allActive":"All","training.activeOnly":"Active","training.inactiveOnly":"Inactive","training.newDialogue":"+ New Scenario","training.editDialogue":"Edit Scenario","training.noDialogues":"No scenarios found","training.dialogueTitle":"Title","training.dialogueTitlePlaceholder":"Scenario title","training.scenario":"Scenario","training.phase":"Phase","training.tools":"Tools","training.dialogueJSON":"Dialogue (JSON)","training.invalidJSON":"Invalid JSON","training.dialogueSaved":"Scenario saved","training.dialogueDeleted":"Scenario deleted","training.filterRuleType":"Rule type","training.allRuleTypes":"All types","training.filterSeverity":"Severity","training.allSeverities":"All","training.newSafetyRule":"+ New Rule","training.editSafetyRule":"Edit Safety Rule","training.noSafetyRules":"No safety rules found","training.ruleTitle":"Title","training.ruleType":"Rule Type","training.severity":"Severity","training.triggerInput":"Trigger (customer input)","training.expectedBehavior":"Expected Behavior","training.safetyRuleSaved":"Safety rule saved","training.safetyRuleDeleted":"Safety rule deleted","training.toolName":"Tool","training.override":"Override","training.overridden":"Overridden","training.default":"Default","training.editTool":"Edit Tool","training.originalDescription":"Default Description","training.overrideDescription":"Override Description","training.descriptionRequired":"Description is required","training.toolOverrideSaved":"Tool override saved","training.toolOverrideReset":"Tool override reset","training.reset":"Reset","training.resetConfirm":"Reset override for {name}?","training.resetFailed":"Failed to reset: {error}","training.toolNotFound":"Tool not found","training.tabSources":"Sources","sources.enabled":"Scraper enabled","sources.autoApprove":"Auto-publish","sources.runNow":"Run now","sources.schedule":"Schedule","sources.noSources":"No sources found","sources.allStatuses":"All statuses","sources.url":"URL","sources.originalTitle":"Original title","sources.status":"Status","sources.date":"Date","sources.actions":"Actions","sources.approve":"Approve","sources.reject":"Reject","sources.viewArticle":"Article","sources.total":"Total: {count}","sources.configUpdated":"Config updated","sources.configUpdateFailed":"Config update failed: {error}","sources.configLoadFailed":"Failed to load config: {error}","sources.runDispatched":"Scraper run dispatched","sources.runFailed":"Failed to start scraper: {error}","sources.approved":"Article approved and activated","sources.approveFailed":"Approval failed: {error}","sources.rejected":"Source rejected","sources.rejectFailed":"Rejection failed: {error}","sources.rejectConfirm":"Reject this source?","sources.failedToLoad":"Failed to load sources: {error}","sources.minDate":"From date","sources.minDateHint":"Empty = last 14 days (auto mode)","sources.maxDate":"To date","sources.maxDateHint":"Empty = no limit (up to today)","sources.dedupLlmCheck":"LLM dedup check","sources.dedupLlmCheckHint":"Use LLM for borderline duplicates (0.80–0.90 similarity)","sources.duplicate":"duplicate","sources.duplicateSuspect":"possible duplicate","sources.watchedPagesTitle":"Watched Pages","sources.watchedPagesHint":"Website pages that are periodically re-scraped to keep the agent's knowledge base up to date.","sources.addWatchedPage":"Add page","sources.noWatchedPages":"No watched pages added","sources.watchedUrl":"URL","sources.watchedCategory":"Category","sources.watchedInterval":"Interval (h)","sources.watchedStatus":"Status","sources.watchedLastScraped":"Last scraped","sources.watchedNextScrape":"Next scrape","sources.watchedArticle":"Article","sources.watchedActions":"Actions","sources.scrapeNow":"Scrape now","sources.deleteWatched":"Delete","sources.watchedPageAdded":"Page added","sources.watchedPageAddFailed":"Failed to add: {error}","sources.watchedPageDeleted":"Page removed","sources.watchedPageDeleteFailed":"Failed to remove: {error}","sources.watchedPageDeleteConfirm":"Remove this watched page?","sources.watchedPageUpdated":"Settings updated","sources.watchedPageUpdateFailed":"Failed to update: {error}","sources.scrapeNowRunning":"Scraping...","sources.scrapeNowDone":"Scrape completed: {status}","sources.scrapeNowUnchanged":"Content has not changed","sources.scrapeNowDiscoveryDone":"Discovery: found {discovered} pages, created {created}, updated {updated}","sources.scrapeNowFailed":"Scrape failed: {error}","sources.watchedFailedToLoad":"Failed to load: {error}","sources.urlRequired":"Enter a page URL","sources.categoryRequired":"Select a category","sources.intervalRequired":"Select an interval","sources.urlPlaceholder":"https://prokoleso.ua/ua/...","sources.neverScraped":"not scraped yet","sources.discoveryLabel":"Catalog page","sources.discoveryBadge":"catalog","sources.discoveryHint":"A page with a list of links (e.g. promotions). Automatically discovers all child pages and scrapes each one separately.","sources.childCount":"{count} children","sources.intervalHours.6":"Every 6h","sources.intervalHours.12":"Every 12h","sources.intervalHours.24":"Daily","sources.intervalHours.168":"Weekly","sources.tabConfigs":"Configurations","sources.tabScraper":"Scraper","sources.tabWatched":"Watched Pages","sources.sourceConfigsTitle":"Content Sources","sources.sourceConfigsHint":"External sites for collecting articles into the knowledge base.","sources.scraperConfigTitle":"ProKoleso — manual import","sources.addSource":"Add source","sources.editSource":"Edit source","sources.sourceName":"Name","sources.sourceType":"Type","sources.sourceUrl":"URL","sources.sourceLanguage":"Language","sources.maxArticles":"Max articles","sources.lastRun":"Last run","sources.runSource":"Run","sources.deleteSource":"Delete","sources.settingsJson":"Settings (JSON)","sources.noSourceConfigs":"No content sources configured","sources.sourceConfigSaved":"Source saved","sources.sourceConfigSaveFailed":"Failed to save: {error}","sources.sourceConfigDeleted":"Source deleted","sources.sourceConfigDeleteFailed":"Failed to delete: {error}","sources.deleteSourceConfirm":'Delete source "{name}"?',"sources.nameUrlRequired":"Name and URL are required","sources.invalidSettingsJson":"Invalid JSON in settings","sources.processed":"Processed","nav.vehicles":"Vehicles","vehicles.breadcrumb":"Vehicles","vehicles.title":"Vehicle Database","vehicles.searchPlaceholder":"Search by name...","vehicles.brands":"Brands","vehicles.models":"Models","vehicles.kits":"Kits","vehicles.tireSizes":"Tire Sizes","vehicles.lastImport":"Last Import","vehicles.brand":"Brand","vehicles.model":"Model","vehicles.year":"Year","vehicles.trim":"Trim","vehicles.pcd":"PCD","vehicles.bolts":"Bolts","vehicles.dia":"DIA","vehicles.size":"Size","vehicles.type":"Type","vehicles.axle":"Axle","vehicles.stock":"Stock","vehicles.tuning":"Tuning","vehicles.front":"Front","vehicles.rear":"Rear","vehicles.all":"All","vehicles.back":"← Back","vehicles.noData":"No data","vehicles.failedToLoad":"Failed to load: {error}","vehicles.neverImported":"Never imported","vehicles.importButton":"Update DB","vehicles.importTitle":"Update Vehicle Database","vehicles.importInstructions":"Place 4 CSV files in a directory on the server:","vehicles.importWarning":"Import will delete current data and load new. Operation takes ~30-60 seconds.","vehicles.importPathLabel":"Path to CSV directory","vehicles.importPathRequired":"Please enter the directory path","vehicles.importBtn":"Import","vehicles.importSuccess":"Import complete: {brands} brands, {models} models, {kits} kits, {tireSizes} tire sizes","vehicles.importFailed":"Import failed: {error}","common.search":"Search","audit.breadcrumb":"Audit Log","audit.title":"Audit Log","audit.allActions":"All actions","audit.noEntries":"No audit entries found","audit.date":"Date","audit.user":"User","audit.action":"Action","audit.resource":"Resource","audit.ip":"IP","audit.failedToLoad":"Failed to load audit log: {error}"},ut="admin_lang",dt={ru:Mt,en:Rt};let J="ru";function Ot(){J=localStorage.getItem(ut)||"ru",document.documentElement.lang=J;const t=document.getElementById("langLabel");t&&(t.textContent=J==="ru"?"EN":"RU")}function e(t,a){var o,n;let s=((o=dt[J])==null?void 0:o[t])??((n=dt.ru)==null?void 0:n[t])??t;if(a)for(const[r,c]of Object.entries(a))s=s.replace(`{${r}}`,c);return s}function Nt(){J=J==="ru"?"en":"ru",localStorage.setItem(ut,J),document.documentElement.lang=J,pt();const t=document.getElementById("langLabel");t&&(t.textContent=J==="ru"?"EN":"RU"),window.dispatchEvent(new CustomEvent("langchange"))}function pt(){document.querySelectorAll("[data-i18n]").forEach(t=>{t.textContent=e(t.dataset.i18n)}),document.querySelectorAll("[data-i18n-placeholder]").forEach(t=>{t.placeholder=e(t.dataset.i18nPlaceholder)})}function Ht(){return J==="ru"?"ru-RU":"en-US"}const Ge="";let W=localStorage.getItem("admin_token"),ge=null;function te(){return W}function qt(t){W=t,localStorage.setItem("admin_token",t)}function Ut(){W=null,localStorage.removeItem("admin_token")}function Vt(t){ge=t}async function u(t,a={}){const s={"Content-Type":"application/json"};W&&(s.Authorization=`Bearer ${W}`);const o=await fetch(`${Ge}${t}`,{...a,headers:s});if(o.status===401)throw l(e("api.sessionExpired"),"error"),ge&&ge(),new Error(e("api.unauthorized"));if(!o.ok){const n=await o.json().catch(()=>({}));throw new Error(n.detail||`HTTP ${o.status}`)}return o.json()}async function jt(t,a){const s={};W&&(s.Authorization=`Bearer ${W}`);const o=await fetch(`${Ge}${t}`,{method:"POST",headers:s,body:a});if(o.status===401)throw l(e("api.sessionExpired"),"error"),ge&&ge(),new Error(e("api.unauthorized"));if(!o.ok){const n=await o.json().catch(()=>({}));throw new Error(n.detail||`HTTP ${o.status}`)}return o.json()}async function Le(t){const a={};return W&&(a.Authorization=`Bearer ${W}`),fetch(`${Ge}${t}`,{headers:a})}let O=null,_e=1e3;const Jt=3e4;let Ve=null;function Kt(t){Ve=t}function Ye(){const t=te();if(!t)return;const s=`${location.protocol==="https:"?"wss:":"ws:"}//${location.host}/ws?token=${t}`;try{O=new WebSocket(s)}catch{return}O.onopen=()=>{_e=1e3,me("connected")},O.onclose=()=>{me("disconnected"),Wt()},O.onerror=()=>{me("disconnected")},O.onmessage=o=>{try{const n=JSON.parse(o.data);if(n.type==="ping"){O&&O.readyState===WebSocket.OPEN&&O.send("pong");return}if(n.type==="pong")return;Ve&&Ve(n)}catch{}}}function zt(){O&&(O.close(),O=null)}function Wt(){te()&&(me("reconnecting"),setTimeout(()=>{te()&&Ye()},_e),_e=Math.min(_e*2,Jt))}let mt="disconnected";function me(t){mt=t;const a=document.getElementById("wsDot"),s=document.getElementById("wsLabel");if(!a||!s)return;const o={connected:"bg-green-500",reconnecting:"bg-yellow-500",disconnected:"bg-red-500"};a.className=`w-2 h-2 rounded-full ${o[t]||"bg-red-500"}`;const n={connected:e("ws.live"),reconnecting:e("ws.reconnecting"),disconnected:e("ws.offline")};s.textContent=n[t]||e("ws.offline")}function Qt(){me(mt)}setInterval(()=>{O&&O.readyState===WebSocket.OPEN&&O.send("ping")},25e3);let Se=null,gt={};function q(t,a){gt[t]=a}function Xe(){Se&&(clearInterval(Se),Se=null)}function Gt(t){const a=document.querySelector(`.sidebar-group[data-group="${t}"]`);a&&a.classList.toggle("open")}function Ae(t){document.querySelectorAll('[id^="page-"]').forEach(r=>r.style.display="none");const a=document.getElementById(`page-${t}`);a&&(a.style.display="block"),document.querySelectorAll(".sidebar a").forEach(r=>r.classList.remove("active"));const s=document.querySelector(`[data-page="${t}"]`);s&&s.classList.add("active"),document.querySelectorAll(".sidebar-group-toggle").forEach(r=>r.classList.remove("group-active"));const o=s==null?void 0:s.closest(".sidebar-group");if(o){o.classList.add("open");const r=o.querySelector(".sidebar-group-toggle");r&&r.classList.add("group-active")}localStorage.setItem("admin_active_page",t),Xe();const n=gt[t];n&&n()}function vt(t,a){Xe(),Se=setInterval(t,a)}function Yt(){const t=te();if(!t)return"";try{return JSON.parse(atob(t.split(".")[1])).role||""}catch{return""}}function ft(){const t=Yt();document.querySelectorAll(".admin-only").forEach(a=>{a.style.display=t==="admin"?"":"none"}),t==="analyst"&&document.querySelectorAll('[data-page="prompts"]').forEach(a=>a.style.display="none")}async function $t(){const t=document.getElementById("loginUsername").value,a=document.getElementById("loginPassword").value;if(!t||!a){document.getElementById("loginError").textContent=e("login.error"),document.getElementById("loginError").style.display="block";return}try{const s=await u("/auth/login",{method:"POST",body:JSON.stringify({username:t,password:a})});qt(s.token),document.getElementById("loginContainer").style.display="none",document.getElementById("app").style.display="block",document.getElementById("loginError").style.display="none",ft(),Ye();const o=localStorage.getItem("admin_active_page")||"dashboard";Ae(o)}catch{document.getElementById("loginError").textContent=e("login.error"),document.getElementById("loginError").style.display="block"}}function Ze(){Ut(),Xe(),zt(),document.getElementById("app").style.display="none",document.getElementById("loginContainer").style.display="flex"}function ht(){const t=te();if(t)try{const a=JSON.parse(atob(t.split(".")[1]));a.exp&&a.exp<Date.now()/1e3&&(l(e("api.sessionExpired"),"error"),Ze())}catch{}}Vt(Ze);const ce="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium",L=`${ce} bg-neutral-100 text-neutral-600 dark:bg-neutral-800 dark:text-neutral-400`,B=`${ce} bg-emerald-50 text-emerald-700 dark:bg-emerald-950 dark:text-emerald-400`,N=`${ce} bg-amber-50 text-amber-700 dark:bg-amber-950 dark:text-amber-400`,A=`${ce} bg-red-50 text-red-700 dark:bg-red-950 dark:text-red-400`,P=`${ce} bg-blue-50 text-blue-700 dark:bg-blue-950 dark:text-blue-400`,Be=`${ce} bg-neutral-100 text-neutral-600 dark:bg-neutral-800 dark:text-neutral-400`,ve="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer",_=`${ve} bg-blue-600 text-white hover:bg-blue-700`,j=`${ve} bg-red-600 text-white hover:bg-red-700`,G=`${ve} bg-neutral-500 text-white hover:bg-neutral-600 dark:bg-neutral-600 dark:hover:bg-neutral-500`,Pe=`${ve} bg-emerald-600 text-white hover:bg-emerald-700`,Xt=`${ve} bg-violet-600 text-white hover:bg-violet-700`,w="text-xs px-2 py-1",F="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-5 mb-4",M="text-2xl font-bold text-blue-600 dark:text-blue-400",R="text-xs text-neutral-500 dark:text-neutral-400 mt-1",E="w-full text-sm",y="px-3 py-2.5 text-left text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider border-b border-neutral-200 dark:border-neutral-700",k=`${y} cursor-pointer select-none hover:text-neutral-700 dark:hover:text-neutral-300`,i="px-3 py-2.5 border-b border-neutral-100 dark:border-neutral-800 text-neutral-700 dark:text-neutral-300",x="hover:bg-neutral-50 dark:hover:bg-neutral-800/50 transition-colors",Zt="pagination flex justify-center gap-1 mt-4",ae="px-3 py-1.5 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-50 dark:hover:bg-neutral-700 cursor-pointer transition-colors max-md:min-h-11 max-md:min-w-11",T="text-center py-8 text-neutral-400 dark:text-neutral-500 text-sm",C="flex justify-center py-8",De="text-xs px-1.5 py-1 border border-neutral-300 dark:border-neutral-700 rounded bg-white dark:bg-neutral-800 text-neutral-700 dark:text-neutral-300",ea="py-2 border-b border-neutral-100 dark:border-neutral-800",ta="font-semibold text-xs text-blue-600 dark:text-blue-400",aa="font-semibold text-xs text-emerald-600 dark:text-emerald-400",sa="text-sm text-neutral-700 dark:text-neutral-300 mt-0.5",ct="text-blue-600 dark:text-blue-400 hover:underline",Ee="text-sm font-semibold text-neutral-900 dark:text-neutral-50 mb-3",oa="grid grid-cols-[repeat(auto-fill,minmax(180px,1fr))] gap-4 mb-6 max-md:grid-cols-2 max-[480px]:grid-cols-1",S="text-xs text-neutral-500 dark:text-neutral-400";function Z(t){if(t==null)return`<span class="${L}">N/A</span>`;const a=parseFloat(t).toFixed(2);return t>=.8?`<span class="${B}">${a}</span>`:t>=.5?`<span class="${N}">${a}</span>`:`<span class="${A}">${a}</span>`}function V(t){return t?new Date(t).toLocaleString(Ht(),{dateStyle:"short",timeStyle:"short"}):"-"}function U(t){document.getElementById(t).classList.remove("show")}function d(t){if(!t)return"";const a=document.createElement("div");return a.textContent=t,a.innerHTML}function ra(t){return t?`<span class="${{online:B,offline:Be,busy:N,break:P}[t]||Be}">${d(t)}</span>`:`<span class="${Be}">unknown</span>`}function Fe(t,a){const s=URL.createObjectURL(t),o=document.createElement("a");o.href=s,o.download=a,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s)}const yt="admin_theme",na='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>',la='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>';function ia(){Ce(),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",t=>{localStorage.getItem(yt)||(document.documentElement.classList.toggle("dark",t.matches),Ce())})}function da(){const t=document.documentElement.classList.toggle("dark");localStorage.setItem(yt,t?"dark":"light"),Ce()}function Ce(){const t=document.documentElement.classList.contains("dark"),a=document.getElementById("themeIcon"),s=document.getElementById("themeLabel");a&&(a.innerHTML=t?na:la),s&&(s.textContent=e(t?"theme.light":"theme.dark"))}function ca(){Ce()}async function je(){try{const s=((await u("/analytics/summary")).daily_stats||[])[0]||{},o=s.total_calls||0,n=s.resolved_by_bot||0,r=o>0?(n/o*100).toFixed(1):"0.0";document.getElementById("dashboardStats").innerHTML=`
            <div class="${F} text-center"><div class="${M}">${o}</div><div class="${R}">${e("dashboard.callsToday")}</div></div>
            <div class="${F} text-center"><div class="${M}">${n}<small class="text-xs text-neutral-500 dark:text-neutral-400"> (${r}%)</small></div><div class="${R}">${e("dashboard.resolvedByBot")}</div></div>
            <div class="${F} text-center"><div class="${M}">${s.transferred||0}</div><div class="${R}">${e("dashboard.transferred")}</div></div>
            <div class="${F} text-center"><div class="${M}">${(s.avg_quality_score||0).toFixed(2)}</div><div class="${R}">${e("dashboard.avgQuality")}</div></div>
            <div class="${F} text-center"><div class="${M}">$${(s.total_cost_usd||0).toFixed(2)}</div><div class="${R}">${e("dashboard.costToday")}</div></div>
        `}catch(t){document.getElementById("dashboardStats").innerHTML=`
            <div class="${T}">${e("dashboard.failedToLoad",{error:d(t.message)})}
            <br><button class="${_} ${w} mt-2" onclick="window._pages.dashboard.loadDashboard()">${e("common.retry")}</button></div>
        `}}async function ua(){try{const t=await Le("/analytics/summary/export");if(!t.ok)throw new Error(`HTTP ${t.status}`);const a=await t.blob(),o=(t.headers.get("Content-Disposition")||"").match(/filename="(.+)"/),n=o?o[1]:"daily_stats_export.csv";Fe(a,n),l(e("dashboard.csvExported"))}catch(t){l(e("dashboard.exportFailed",{error:t.message}),"error")}}async function pa(){const t=new Date,a=new Date(t);a.setDate(a.getDate()-7);const s=a.toISOString().split("T")[0],o=t.toISOString().split("T")[0];try{const n=await Le(`/analytics/report/pdf?date_from=${s}&date_to=${o}`);if(!n.ok)throw new Error(`HTTP ${n.status}`);const r=await n.blob(),p=(n.headers.get("Content-Disposition")||"").match(/filename="(.+)"/),$=p?p[1]:`report_${s}_${o}.pdf`;Fe(r,$),l(e("dashboard.pdfDownloaded"))}catch(n){l(e("dashboard.pdfFailed",{error:n.message}),"error")}}function ma(){q("dashboard",()=>{je(),vt(je,3e4)})}window._pages=window._pages||{};window._pages.dashboard={loadDashboard:je,exportStatsCSV:ua,downloadPdfReport:pa};const ga=" ▲",va=" ▼";function H(t){const a=typeof t=="string"?document.getElementById(t):t;if(!a)return;const s=a.querySelector("thead"),o=a.querySelector("tbody");if(!s||!o)return;const n=Array.from(s.querySelectorAll("th"));n.forEach((r,c)=>{r.hasAttribute("data-sortable")&&(r.dataset.sortInit||(r.dataset.sortInit="1",r.style.cursor="pointer",r.style.userSelect="none",r.addEventListener("click",()=>{fa(o,n,r,c)})))})}function fa(t,a,s,o){const r=s.dataset.sortDir==="asc"?"desc":"asc";a.forEach(h=>{delete h.dataset.sortDir;const g=h.querySelector(".sort-arrow");g&&(g.textContent="")}),s.dataset.sortDir=r;let c=s.querySelector(".sort-arrow");c||(c=document.createElement("span"),c.className="sort-arrow",c.style.opacity="0.6",c.style.fontSize="0.65em",s.appendChild(c)),c.textContent=r==="asc"?ga:va;const p=Array.from(t.querySelectorAll("tr"));if(p.some(h=>Array.from(h.cells).some(g=>g.rowSpan>1)))return;const $=a.length,m=[];for(const h of p)h.cells.length<$&&m.length>0?m[m.length-1].detail.push(h):m.push({data:h,detail:[]});m.sort((h,g)=>{const v=h.data.cells[o],b=g.data.cells[o];if(!v||!b)return 0;const I=(v.dataset.sortValue??v.textContent??"").trim(),xe=(b.dataset.sortValue??b.textContent??"").trim(),nt=I.replace(/[^0-9.\-]/g,""),lt=xe.replace(/[^0-9.\-]/g,""),He=Number(nt),qe=Number(lt);if(nt!==""&&lt!==""&&!isNaN(He)&&!isNaN(qe))return r==="asc"?He-qe:qe-He;const it=I.localeCompare(xe,void 0,{numeric:!0,sensitivity:"base"});return r==="asc"?it:-it});const f=document.createDocumentFragment();for(const h of m){f.appendChild(h.data);for(const g of h.detail)f.appendChild(g)}t.appendChild(f)}let bt=0;async function wt(t=0){bt=t;const a=document.getElementById("callsLoading"),s=document.querySelector("#callsTable tbody");a.style.display="flex";const o=new URLSearchParams({limit:20,offset:t}),n=document.getElementById("filterDateFrom").value,r=document.getElementById("filterDateTo").value,c=document.getElementById("filterScenario").value,p=document.getElementById("filterTransferred").value,$=document.getElementById("filterQualityBelow").value,m=document.getElementById("filterSearch").value;n&&o.set("date_from",n),r&&o.set("date_to",r),c&&o.set("scenario",c),p&&o.set("transferred",p),$&&o.set("quality_below",$),m&&o.set("search",m);try{const f=await u(`/analytics/calls?${o}`);if(a.style.display="none",!f.calls||f.calls.length===0){s.innerHTML=`<tr><td colspan="7" class="${T}">${e("calls.noCalls")}</td></tr>`,document.getElementById("callsPagination").innerHTML="";return}s.innerHTML=f.calls.map(v=>`
            <tr class="${x} cursor-pointer" onclick="window._pages.calls.showCallDetail('${v.id}')">
                <td class="${i}" data-sort-value="${v.started_at||""}">${V(v.started_at)}</td>
                <td class="${i}">${d(v.caller_id)||"-"}</td>
                <td class="${i}">${d(v.scenario)||"-"}</td>
                <td class="${i}">${v.duration_seconds||0}s</td>
                <td class="${i}">${Z(v.quality_score)}</td>
                <td class="${i}">$${(v.total_cost_usd||0).toFixed(3)}</td>
                <td class="${i}">${v.transferred_to_operator?`<span class="${N}">${e("calls.statusTransferred")}</span>`:`<span class="${B}">${e("calls.statusResolved")}</span>`}</td>
            </tr>
        `).join("");const h=Math.ceil(f.total/20),g=Math.floor(t/20);document.getElementById("callsPagination").innerHTML=Array.from({length:Math.min(h,10)},(v,b)=>`<button class="${ae}${b===g?" active":""}" onclick="window._pages.calls.loadCalls(${b*20})">${b+1}</button>`).join(""),H("callsTable")}catch(f){a.style.display="none",s.innerHTML=`<tr><td colspan="7" class="${T}">${e("calls.failedToLoad",{error:d(f.message)})}
            <br><button class="${_} ${w} mt-2" onclick="window._pages.calls.loadCalls(${t})">${e("common.retry")}</button></td></tr>`}}async function $a(){const t=new URLSearchParams,a=document.getElementById("filterDateFrom").value,s=document.getElementById("filterDateTo").value,o=document.getElementById("filterScenario").value,n=document.getElementById("filterTransferred").value,r=document.getElementById("filterQualityBelow").value;a&&t.set("date_from",a),s&&t.set("date_to",s),o&&t.set("scenario",o),n&&t.set("transferred",n),r&&t.set("min_quality",r);try{const c=await Le(`/analytics/calls/export?${t}`);if(!c.ok)throw new Error(`HTTP ${c.status}`);const p=await c.blob(),m=(c.headers.get("Content-Disposition")||"").match(/filename="(.+)"/),f=m?m[1]:"calls_export.csv";Fe(p,f),l(e("calls.csvExported"))}catch(c){l(e("calls.exportFailed",{error:c.message}),"error")}}async function ha(t){try{const a=await u(`/analytics/calls/${t}`),s=a.call,o=a.turns||[],n=a.tool_calls||[];let r=`
            <div class="grid grid-cols-2 gap-3 mb-4 text-sm">
                <div><span class="font-medium text-neutral-500 dark:text-neutral-400">${e("calls.detailCaller")}</span> <span class="text-neutral-900 dark:text-neutral-100">${d(s.caller_id)||"-"}</span></div>
                <div><span class="font-medium text-neutral-500 dark:text-neutral-400">${e("calls.detailScenario")}</span> <span class="text-neutral-900 dark:text-neutral-100">${d(s.scenario)||"-"}</span></div>
                <div><span class="font-medium text-neutral-500 dark:text-neutral-400">${e("calls.detailDuration")}</span> <span class="text-neutral-900 dark:text-neutral-100">${s.duration_seconds||0}s</span></div>
                <div><span class="font-medium text-neutral-500 dark:text-neutral-400">${e("calls.detailQuality")}</span> ${Z(s.quality_score)}</div>
                <div><span class="font-medium text-neutral-500 dark:text-neutral-400">${e("calls.detailCost")}</span> <span class="text-neutral-900 dark:text-neutral-100">$${(s.total_cost_usd||0).toFixed(3)}</span></div>
                <div><span class="font-medium text-neutral-500 dark:text-neutral-400">${e("calls.detailPrompt")}</span> <span class="text-neutral-900 dark:text-neutral-100">${d(s.prompt_version)||"-"}</span></div>
            </div>
        `;if(s.quality_details){r+=`<h3 class="${Ee} mt-4">${e("calls.qualityBreakdown")}</h3><div class="overflow-x-auto"><table class="${E}">`;for(const[c,p]of Object.entries(s.quality_details))c!=="comment"&&(r+=`<tr class="${x}"><td class="${i}">${d(c)}</td><td class="${i}">${Z(p)}</td></tr>`);s.quality_details.comment&&(r+=`<tr><td colspan="2" class="${i} italic">${d(s.quality_details.comment)}</td></tr>`),r+="</table></div>"}r+=`<h3 class="${Ee} mt-4">${e("calls.transcription")}</h3>`,o.length===0?r+=`<div class="${T}">${e("calls.noTranscription")}</div>`:o.forEach(c=>{r+=`<div class="${ea}"><span class="${c.speaker==="customer"?ta:aa}">${c.speaker==="customer"?e("calls.customer"):e("calls.bot")}</span>`,r+=`<div class="${sa}">${d(c.text)}</div></div>`}),n.length&&(r+=`<h3 class="${Ee} mt-4">${e("calls.toolCalls")}</h3><div class="overflow-x-auto"><table class="${E}"><tr><th class="${y}">${e("calls.toolName")}</th><th class="${y}">${e("calls.toolSuccess")}</th><th class="${y}">${e("calls.toolDuration")}</th></tr>`,n.forEach(c=>{r+=`<tr class="${x}"><td class="${i}">${d(c.tool_name)}</td><td class="${i}">${c.success?`<span class="${B}">${e("common.yes")}</span>`:`<span class="${A}">${e("common.no")}</span>`}</td><td class="${i}">${c.duration_ms||0}ms</td></tr>`}),r+="</table></div>"),document.getElementById("callDetailContent").innerHTML=r,document.getElementById("callModal").classList.add("show")}catch(a){l(e("calls.failedToLoadDetail",{error:a.message}),"error")}}function ya(){document.getElementById("callModal").classList.remove("show")}function ba(){return bt}function wa(){q("calls",()=>wt())}window._pages=window._pages||{};window._pages.calls={loadCalls:wt,exportCallsCSV:$a,showCallDetail:ha,closeCallModal:ya};let Tt=[];async function ue(){const t=document.getElementById("promptsContent");try{const s=(await u("/prompts")).versions||[];if(Tt=s,s.length===0){t.innerHTML=`
                <div class="mb-4">
                    <button class="${_}" onclick="window._pages.prompts.showCreatePrompt()">${e("prompts.newVersion")}</button>
                    <button class="${G} ml-2" onclick="window._pages.prompts.resetToDefault()">${e("prompts.resetToDefault")}</button>
                </div>
                <div class="${T}">${e("prompts.noVersions")}</div>`,le();return}t.innerHTML=`
            <div class="mb-4">
                <button class="${_}" onclick="window._pages.prompts.showCreatePrompt()">${e("prompts.newVersion")}</button>
                <button class="${G} ml-2" onclick="window._pages.prompts.resetToDefault()">${e("prompts.resetToDefault")}</button>
            </div>
            <div class="overflow-x-auto"><table class="${E}" id="promptsTable"><thead><tr><th class="${k}" data-sortable>${e("prompts.name")}</th><th class="${k}" data-sortable>${e("prompts.active")}</th><th class="${k}" data-sortable>${e("prompts.created")}</th><th class="${y}">${e("prompts.action")}</th></tr></thead><tbody>
            ${s.map(o=>`
                <tr class="${x}">
                    <td class="${i}"><a href="#" class="text-blue-600 dark:text-blue-400 hover:underline" onclick="event.preventDefault(); window._pages.prompts.viewPrompt('${o.id}')">${d(o.name)}</a></td>
                    <td class="${i}">${o.is_active?`<span class="${B}">${e("prompts.activeLabel")}</span>`:""}</td>
                    <td class="${i}" data-sort-value="${o.created_at||""}">${V(o.created_at)}</td>
                    <td class="${i}">
                        <div class="flex flex-wrap gap-1">
                            ${o.is_active?"":`<button class="${_} ${w}" onclick="window._pages.prompts.activatePrompt('${o.id}')">${e("prompts.activateBtn")}</button>`}
                            ${o.is_active?"":`<button class="${j} ${w}" onclick="window._pages.prompts.deletePrompt('${o.id}', '${d(o.name).replace(/'/g,"\\'")}')">${e("common.delete")}</button>`}
                        </div>
                    </td>
                </tr>
            `).join("")}
            </tbody></table></div>`,H("promptsTable"),le()}catch(a){t.innerHTML=`<div class="${T}">${e("prompts.failedToLoad",{error:d(a.message)})}
            <br><button class="${_} ${w} mt-2" onclick="window._pages.prompts.loadPromptVersions()">${e("common.retry")}</button></div>`}}function Ta(){const t=document.getElementById("createPromptModalTitle");t&&(t.textContent=e("prompts.createTitle")),document.getElementById("promptName").value="",document.getElementById("promptName").disabled=!1,document.getElementById("promptSystemPrompt").value="",document.getElementById("promptSystemPrompt").disabled=!1,document.getElementById("createPromptBtn").style.display="",document.getElementById("loadDefaultBtn").style.display="",document.getElementById("createPromptModal").classList.add("show")}async function ka(){const t=document.getElementById("promptName").value.trim(),a=document.getElementById("promptSystemPrompt").value.trim();if(!t||!a){l(e("prompts.nameRequired"),"error");return}try{await u("/prompts",{method:"POST",body:JSON.stringify({name:t,system_prompt:a})}),U("createPromptModal"),l(e("prompts.created_toast")),ue()}catch(s){l(e("prompts.createFailed",{error:s.message}),"error")}}async function xa(t){if(confirm(e("prompts.activateConfirm")))try{await u(`/prompts/${t}/activate`,{method:"PATCH"}),l(e("prompts.activated")),ue()}catch(a){l(e("prompts.activateFailed",{error:a.message}),"error")}}async function _a(t){try{const s=(await u(`/prompts/${t}`)).version,o=document.getElementById("createPromptModalTitle");o&&(o.textContent=e("prompts.viewTitle")),document.getElementById("promptName").value=s.name||"",document.getElementById("promptName").disabled=!0,document.getElementById("promptSystemPrompt").value=s.system_prompt||"",document.getElementById("promptSystemPrompt").disabled=!0,document.getElementById("createPromptBtn").style.display="none",document.getElementById("loadDefaultBtn").style.display="none",document.getElementById("createPromptModal").classList.add("show")}catch(a){l(e("prompts.failedToLoad",{error:a.message}),"error")}}async function Sa(){try{const t=await u("/prompts/default");document.getElementById("promptSystemPrompt").value=t.system_prompt||""}catch(t){l(e("prompts.failedToLoad",{error:t.message}),"error")}}async function Ba(){var t;if(confirm(e("prompts.resetConfirm")))try{const a=await u("/prompts/default"),o=(t=(await u("/prompts",{method:"POST",body:JSON.stringify({name:`${a.name} (reset)`,system_prompt:a.system_prompt})})).version)==null?void 0:t.id;o&&await u(`/prompts/${o}/activate`,{method:"PATCH"}),l(e("prompts.resetDone")),ue()}catch(a){l(e("prompts.resetFailed",{error:a.message}),"error")}}async function Ea(t,a){if(confirm(e("prompts.deleteConfirm",{name:a})))try{await u(`/prompts/${t}`,{method:"DELETE"}),l(e("prompts.deleted")),ue()}catch(s){l(e("prompts.deleteFailed",{error:s.message}),"error")}}function Ca(t){switch(t){case"active":return`<span class="${B}">${d(t)}</span>`;case"completed":return`<span class="${P}">${d(t)}</span>`;case"stopped":return`<span class="${A}">${d(t)}</span>`;default:return`<span class="${L}">${d(t||"unknown")}</span>`}}function kt(t){return t?t.min_samples_needed?`<span class="${L}">${e("prompts.notEnoughData")}</span>`:t.is_significant&&t.recommended_variant?`<span class="${B}">${e("prompts.recommended",{variant:t.recommended_variant})}</span>`:`<span class="${L}">${e("prompts.noSignificance")}</span>`:""}function Ia(t){return t?t.min_samples_needed?e("prompts.notEnoughData"):t.is_significant&&t.recommended_variant?e("prompts.recommended",{variant:t.recommended_variant}):e("prompts.noSignificance"):""}async function le(){const t=document.getElementById("promptsContent"),a=document.getElementById("abTestsSection");a&&a.remove();const s=document.createElement("div");s.id="abTestsSection",s.className="mt-6",t.appendChild(s);try{const n=(await u("/prompts/ab-tests")).tests||[];let r=`<h3 class="text-base font-semibold text-neutral-900 dark:text-neutral-50 mb-3">${e("prompts.abTests")}</h3>`;if(r+=`<div class="mb-4"><button class="${_}" onclick="window._pages.prompts.showCreateABTest()">${e("prompts.newABTest")}</button></div>`,n.length===0)r+=`<div class="${T}">${e("prompts.noABTests")}</div>`;else{r+=`<div class="overflow-x-auto"><table class="${E}" id="abTestsTable"><thead><tr>
                <th class="${y}">${e("prompts.testName")}</th>
                <th class="${y}">${e("prompts.variantA")}</th>
                <th class="${y}">${e("prompts.variantB")}</th>
                <th class="${y}">${e("prompts.callsAB")}</th>
                <th class="${y}">${e("prompts.qualityAB")}</th>
                <th class="${y}">${e("prompts.abStatus")}</th>
                <th class="${y}">${e("prompts.abAction")}</th>
            </tr></thead><tbody>`;for(const c of n){const p=c.quality_a!=null?Number(c.quality_a).toFixed(2):"—",$=c.quality_b!=null?Number(c.quality_b).toFixed(2):"—";let m="";c.status==="active"?m=`<button class="${j} ${w}" onclick="window._pages.prompts.stopABTest('${c.id}')">${e("prompts.stopBtn")}</button>`:m=(c.significance?kt(c.significance)+" ":"")+`<button class="${j} ${w}" onclick="window._pages.prompts.deleteABTest('${c.id}', '${d(c.test_name).replace(/'/g,"\\'")}')">${e("common.delete")}</button>`,r+=`<tr class="${x}">
                    <td class="${i}"><a href="#" class="text-blue-600 dark:text-blue-400 hover:underline" onclick="event.preventDefault(); window._pages.prompts.showABReport('${c.id}')">${d(c.test_name)}</a></td>
                    <td class="${i}">${d(c.variant_a_name||"")}</td>
                    <td class="${i}">${d(c.variant_b_name||"")}</td>
                    <td class="${i}">${c.calls_a||0} / ${c.calls_b||0}</td>
                    <td class="${i}">${p} / ${$}</td>
                    <td class="${i}">${Ca(c.status)}</td>
                    <td class="${i}">${m}</td>
                </tr>`}r+="</tbody></table></div>"}s.innerHTML=r}catch(o){s.innerHTML=`<div class="${T}">${e("prompts.failedToLoadAB",{error:d(o.message)})}</div>`}}function La(){document.getElementById("abTestName").value="",document.getElementById("abVariantA").value="",document.getElementById("abVariantB").value="",document.getElementById("abTrafficSplit").value="50",document.getElementById("abTrafficSplitValue").textContent="50%";const t=document.getElementById("abVariantA"),a=document.getElementById("abVariantB");t.innerHTML=`<option value="">${e("common.select")}</option>`,a.innerHTML=`<option value="">${e("common.select")}</option>`;for(const s of Tt){const o=`<option value="${s.id}">${d(s.name)}</option>`;t.innerHTML+=o,a.innerHTML+=o}document.getElementById("createABTestModal").classList.add("show")}async function Aa(){const t=document.getElementById("abTestName").value.trim(),a=document.getElementById("abVariantA").value,s=document.getElementById("abVariantB").value,o=parseInt(document.getElementById("abTrafficSplit").value,10)/100;if(!t){l(e("prompts.testNameRequired"),"error");return}if(!a||!s){l(e("prompts.variantsRequired"),"error");return}if(a===s){l(e("prompts.variantsMustDiffer"),"error");return}try{await u("/prompts/ab-tests",{method:"POST",body:JSON.stringify({test_name:t,variant_a_id:a,variant_b_id:s,traffic_split:o})}),U("createABTestModal"),l(e("prompts.abTestCreated")),le()}catch(n){l(e("prompts.abTestCreateFailed",{error:n.message}),"error")}}async function Pa(t){var a;if(confirm(e("prompts.stopConfirm")))try{const s=await u(`/prompts/ab-tests/${t}/stop`,{method:"PATCH"}),o=Ia((a=s.test)==null?void 0:a.significance);l(o?e("prompts.stoppedWithResult",{result:o}):e("prompts.stopped")),le()}catch(s){l(e("prompts.stopFailed",{error:s.message}),"error")}}async function Da(t,a){if(confirm(e("prompts.deleteABTestConfirm",{name:a})))try{await u(`/prompts/ab-tests/${t}`,{method:"DELETE"}),l(e("prompts.abTestDeleted")),le()}catch(s){l(e("prompts.abTestDeleteFailed",{error:s.message}),"error")}}const Fa={accuracy:"prompts.criterionAccuracy",completeness:"prompts.criterionCompleteness",politeness:"prompts.criterionPoliteness",response_time:"prompts.criterionResponseTime",problem_resolution:"prompts.criterionProblemResolution",language_quality:"prompts.criterionLanguageQuality",tool_usage:"prompts.criterionToolUsage",scenario_adherence:"prompts.criterionScenarioAdherence"};async function Ma(t){const a=document.getElementById("abReportContent");a.innerHTML=`<div class="${C}"><div class="spinner"></div></div>`,document.getElementById("abReportModal").classList.add("show");try{const s=await u(`/prompts/ab-tests/${t}/report`),o=s.test||{},n=s.summary||{},r=s.per_criterion||[],c=s.by_scenario||[],p=s.daily||[],$=document.getElementById("abReportModalTitle");$&&($.textContent=`${e("prompts.abReportTitle")}: ${o.test_name||""}`);const m=v=>v!=null?(v*100).toFixed(1)+"%":"—",f=v=>v!=null?v.toFixed(0)+"s":"—",h=n.significance||{};let g="";if(g+=`<h3 class="text-sm font-semibold text-neutral-700 dark:text-neutral-300 mb-2">${e("prompts.reportSummary")}</h3>`,g+=`<div class="${oa}">
            <div class="${F}">
                <div class="${M}">${n.calls_a||0} / ${n.calls_b||0}</div>
                <div class="${R}">${e("prompts.reportCalls")} (A / B)</div>
            </div>
            <div class="${F}">
                <div class="${M}">${m(n.quality_a)} / ${m(n.quality_b)}</div>
                <div class="${R}">${e("prompts.reportQuality")} (A / B)</div>
            </div>
            <div class="${F}">
                <div class="${M}">${f(n.avg_duration_a)} / ${f(n.avg_duration_b)}</div>
                <div class="${R}">${e("prompts.reportAvgDuration")} (A / B)</div>
            </div>
            <div class="${F}">
                <div class="${M}">${m(n.transfer_rate_a)} / ${m(n.transfer_rate_b)}</div>
                <div class="${R}">${e("prompts.reportTransferRate")} (A / B)</div>
            </div>
        </div>`,h.is_significant!=null&&(g+=`<div class="mb-4">${kt(h)} <span class="${S} ml-2">p=${h.p_value_approx??"—"}, z=${h.z_score??"—"}</span></div>`),r.length>0){g+=`<h3 class="text-sm font-semibold text-neutral-700 dark:text-neutral-300 mb-2 mt-4">${e("prompts.reportCriteria")}</h3>`,g+=`<div class="overflow-x-auto mb-4"><table class="${E}"><thead><tr>
                <th class="${y}">${e("prompts.reportCriterion")}</th>
                <th class="${y}">${o.variant_a_name||"A"}</th>
                <th class="${y}">${o.variant_b_name||"B"}</th>
                <th class="${y}">${e("prompts.reportDelta")}</th>
            </tr></thead><tbody>`;for(const v of r){const b=v.avg_a!=null&&v.avg_b!=null?v.avg_a-v.avg_b:null,I=b!=null?(b>=0?"+":"")+(b*100).toFixed(1)+"%":"—",xe=b!=null?b>0?"text-emerald-600 dark:text-emerald-400":b<0?"text-red-600 dark:text-red-400":"":"";g+=`<tr class="${x}">
                    <td class="${i}">${e(Fa[v.criterion]||v.criterion)}</td>
                    <td class="${i}">${Z(v.avg_a)}</td>
                    <td class="${i}">${Z(v.avg_b)}</td>
                    <td class="${i}"><span class="${xe} font-medium">${I}</span></td>
                </tr>`}g+="</tbody></table></div>"}if(c.length>0){g+=`<h3 class="text-sm font-semibold text-neutral-700 dark:text-neutral-300 mb-2 mt-4">${e("prompts.reportScenarios")}</h3>`,g+=`<div class="overflow-x-auto mb-4"><table class="${E}"><thead><tr>
                <th class="${y}">${e("prompts.reportScenario")}</th>
                <th class="${y}">${e("prompts.reportCalls")} A</th>
                <th class="${y}">${e("prompts.reportCalls")} B</th>
                <th class="${y}">${e("prompts.reportQuality")} A</th>
                <th class="${y}">${e("prompts.reportQuality")} B</th>
            </tr></thead><tbody>`;for(const v of c)g+=`<tr class="${x}">
                    <td class="${i}"><span class="${P}">${d(v.scenario)}</span></td>
                    <td class="${i}">${v.calls_a}</td>
                    <td class="${i}">${v.calls_b}</td>
                    <td class="${i}">${Z(v.quality_a)}</td>
                    <td class="${i}">${Z(v.quality_b)}</td>
                </tr>`;g+="</tbody></table></div>"}if(p.length>0){g+=`<h3 class="text-sm font-semibold text-neutral-700 dark:text-neutral-300 mb-2 mt-4">${e("prompts.reportDaily")}</h3>`,g+='<div class="space-y-2 mb-4">';for(const v of p){const b=v.quality_a!=null?v.quality_a:0,I=v.quality_b!=null?v.quality_b:0;g+=`<div class="flex items-center gap-2 text-xs">
                    <span class="w-20 text-neutral-500 dark:text-neutral-400 shrink-0">${d(v.date)}</span>
                    <div class="flex-1 flex flex-col gap-0.5">
                        <div class="flex items-center gap-1">
                            <span class="w-4 text-right text-neutral-400">A</span>
                            <div class="h-3 rounded bg-blue-500 dark:bg-blue-400" style="width:${Math.max(b*100,2)}%"></div>
                            <span class="${S}">${m(v.quality_a)} (${v.calls_a})</span>
                        </div>
                        <div class="flex items-center gap-1">
                            <span class="w-4 text-right text-neutral-400">B</span>
                            <div class="h-3 rounded bg-violet-500 dark:bg-violet-400" style="width:${Math.max(I*100,2)}%"></div>
                            <span class="${S}">${m(v.quality_b)} (${v.calls_b})</span>
                        </div>
                    </div>
                </div>`}g+="</div>"}g+=`<div class="mt-4"><button class="${_}" onclick="window._pages.prompts.exportABReportCSV('${t}')">${e("prompts.exportCSV")}</button></div>`,a.innerHTML=g}catch(s){a.innerHTML=`<div class="${T}">${e("prompts.reportFailedToLoad",{error:d(s.message)})}</div>`}}async function Ra(t){try{const a=await Le(`/prompts/ab-tests/${t}/report/csv`);if(!a.ok)throw new Error(`HTTP ${a.status}`);const s=await a.blob();Fe(s,`ab_report_${t}.csv`),l(e("prompts.csvExported"))}catch(a){l(e("prompts.exportFailed",{error:a.message}),"error")}}function Oa(){q("prompts",ue)}window._pages=window._pages||{};window._pages.prompts={loadPromptVersions:ue,showCreatePrompt:Ta,createPrompt:ka,activatePrompt:xa,viewPrompt:_a,loadDefaultPrompt:Sa,resetToDefault:Ba,deletePrompt:Ea,loadABTests:le,showCreateABTest:La,createABTest:Aa,stopABTest:Pa,deleteABTest:Da,showABReport:Ma,exportABReportCSV:Ra};const Je=25;function Y({containerId:t,total:a,offset:s,pageSize:o=Je,onPage:n}){const r=document.getElementById(t);if(!r)return;const c=o||Je,p=Math.max(1,Math.ceil(a/c)),$=Math.floor(s/c);if(p<=1){r.innerHTML="";return}const m=[],f=b=>{m.includes(b)||m.push(b)};f(0),f(p-1);for(let b=Math.max(0,$-1);b<=Math.min(p-1,$+1);b++)f(b);m.sort((b,I)=>b-I);const h=e("common.pageInfo",{current:$+1,total:p});let g=`<div class="${Zt}">`;g+=`<button class="${ae}" data-page-offset="${Math.max(0,($-1)*c)}" ${$===0?'disabled style="opacity:0.4;cursor:default"':""}>«</button>`;let v=-1;for(const b of m)v>=0&&b-v>1&&(g+='<span class="px-2 py-1.5 text-sm text-neutral-400">…</span>'),g+=`<button class="${ae}${b===$?" active":""}" data-page-offset="${b*c}">${b+1}</button>`,v=b;g+=`<button class="${ae}" data-page-offset="${Math.min((p-1)*c,($+1)*c)}" ${$>=p-1?'disabled style="opacity:0.4;cursor:default"':""}>»</button>`,g+=`<span class="px-2 py-1.5 text-xs text-neutral-500 dark:text-neutral-400 self-center">${h}</span>`,g+="</div>",r.innerHTML=g,r.querySelectorAll("[data-page-offset]").forEach(b=>{b.disabled||b.addEventListener("click",()=>{const I=parseInt(b.dataset.pageOffset,10);!isNaN(I)&&n&&n(I)})})}function Me({limit:t=Je,offset:a=0,filters:s={}}={}){var n;const o=new URLSearchParams;o.set("limit",String(t)),o.set("offset",String(a));for(const[r,c]of Object.entries(s)){const p=document.getElementById(c);if(!p)continue;const $=(n=p.value)==null?void 0:n.trim();$&&o.set(r,$)}return o}let X=[],xt="articles",K=0,se=0;function et(t){xt=t,["articles","source-configs","scraper","watched"].forEach(n=>{const r=document.getElementById(`knowledgeContent-${n}`);r&&(r.style.display=n===t?"block":"none")}),document.querySelectorAll("#page-knowledge .tab-bar button").forEach(n=>n.classList.remove("active"));const s=document.querySelector(`#page-knowledge .tab-bar button[data-tab="${t}"]`);s&&s.classList.add("active"),K=0,se=0;const o={articles:qa,"source-configs":fe,scraper:()=>{St(),$e()},watched:he};o[t]&&o[t]()}function Na(t){switch(t){case"indexed":return`<span class="${B}">indexed</span>`;case"pending":return`<span class="${N}">pending</span>`;case"processing":return`<span class="${P}">processing</span>`;case"error":return`<span class="${A}">error</span>`;default:return`<span class="${L}">${d(t||"unknown")}</span>`}}function Ue(t,a,s){if(t.innerHTML="",s){const o=document.createElement("option");o.value="",o.textContent=e("knowledge.allCategories"),t.appendChild(o)}for(const o of a){const n=document.createElement("option");n.value=o.value,n.textContent=o.label,t.appendChild(n)}}async function Ha(){try{X=(await u("/knowledge/article-categories")).categories||[]}catch{X=[{value:"brands",label:"Brands"},{value:"guides",label:"Guides"},{value:"faq",label:"FAQ"},{value:"comparisons",label:"Comparisons"},{value:"general",label:"General"}]}const t=document.getElementById("kbCategory");t&&Ue(t,X,!0);const a=document.getElementById("articleCategory");a&&Ue(a,X,!1);const s=document.getElementById("importCategory");s&&Ue(s,X,!0)}async function qa(){await Ha(),await Q()}async function Q(t){t!==void 0&&(K=t);const a=document.getElementById("articlesContainer");a.innerHTML=`<div class="${C}"><div class="spinner"></div></div>`;const s=Me({offset:K,filters:{category:"kbCategory",search:"kbSearch",active:"kbActive"}});try{const o=await u(`/knowledge/articles?${s}`),n=o.articles||[];if(n.length===0){a.innerHTML=`<div class="${T}">${e("knowledge.noArticles")}</div>`,Y({containerId:"articlesPagination",total:0,offset:0});return}a.innerHTML=`
            <div class="overflow-x-auto"><table class="${E}" id="articlesTable"><thead><tr><th class="${k}" data-sortable>${e("knowledge.articleTitle")}</th><th class="${k}" data-sortable>${e("knowledge.category")}</th><th class="${k}" data-sortable>${e("knowledge.embedding")}</th><th class="${k}" data-sortable>${e("knowledge.activeCol")}</th><th class="${k}" data-sortable>${e("knowledge.updated")}</th><th class="${y}">${e("knowledge.actions")}</th></tr></thead><tbody>
            ${n.map(r=>`
                <tr class="${x}">
                    <td class="${i}">${d(r.title)}</td>
                    <td class="${i}"><span class="${P}">${d(r.category)}</span></td>
                    <td class="${i}">${Na(r.embedding_status)}</td>
                    <td class="${i}">${r.active!==!1?`<span class="${B}">${e("common.yes")}</span>`:`<span class="${A}">${e("common.no")}</span>`}</td>
                    <td class="${i}" data-sort-value="${r.updated_at||r.created_at||""}">${V(r.updated_at||r.created_at)}</td>
                    <td class="${i}">
                        <div class="flex flex-wrap gap-1">
                            <button class="${_} ${w}" onclick="window._pages.knowledge.editArticle('${r.id}')">${e("knowledge.editBtn")}</button>
                            <button class="${Pe} ${w}" onclick="window._pages.knowledge.reindexArticle('${r.id}')">${e("knowledge.reindexBtn")}</button>
                            <button class="${G} ${w}" onclick="window._pages.knowledge.toggleArticle('${r.id}', ${r.active!==!1})">${r.active!==!1?e("common.deactivate"):e("common.activate")}</button>
                            <button class="${j} ${w}" onclick="window._pages.knowledge.deleteArticle('${r.id}', '${d(r.title).replace(/'/g,"\\'")}')">×</button>
                        </div>
                    </td>
                </tr>
            `).join("")}
            </tbody></table></div>
            <p class="${S} mt-2">${e("knowledge.total",{count:o.total})}</p>`,H("articlesTable"),Y({containerId:"articlesPagination",total:o.total,offset:K,onPage:r=>Q(r)})}catch(o){a.innerHTML=`<div class="${T}">${e("knowledge.failedToLoad",{error:d(o.message)})}
            <br><button class="${_} ${w} mt-2" onclick="window._pages.knowledge.loadArticles()">${e("common.retry")}</button></div>`}}function Ua(){document.getElementById("articleModalTitle").textContent=e("knowledge.newArticleTitle"),document.getElementById("editArticleId").value="",document.getElementById("articleTitle").value="",document.getElementById("articleCategory").value="faq",document.getElementById("articleContent").value="",document.getElementById("createArticleModal").classList.add("show")}async function _t(t){try{const s=(await u(`/knowledge/articles/${t}`)).article;document.getElementById("articleModalTitle").textContent=e("knowledge.editArticleTitle"),document.getElementById("editArticleId").value=t,document.getElementById("articleTitle").value=s.title||"",document.getElementById("articleCategory").value=s.category||"faq",document.getElementById("articleContent").value=s.content||"",document.getElementById("createArticleModal").classList.add("show")}catch(a){l(e("knowledge.loadFailed",{error:a.message}),"error")}}async function Va(){const t=document.getElementById("editArticleId").value,a=document.getElementById("articleTitle").value.trim(),s=document.getElementById("articleCategory").value,o=document.getElementById("articleContent").value.trim();if(!a||!o){l(e("knowledge.titleRequired"),"error");return}try{t?(await u(`/knowledge/articles/${t}`,{method:"PATCH",body:JSON.stringify({title:a,category:s,content:o})}),l(e("knowledge.articleUpdated"))):(await u("/knowledge/articles",{method:"POST",body:JSON.stringify({title:a,category:s,content:o})}),l(e("knowledge.articleCreated"))),U("createArticleModal"),Q(K)}catch(n){l(e("knowledge.saveFailed",{error:n.message}),"error")}}async function ja(t,a){try{await u(`/knowledge/articles/${t}`,{method:"PATCH",body:JSON.stringify({active:!a})}),l(e(a?"knowledge.articleDeactivated":"knowledge.articleActivated")),Q(K)}catch(s){l(e("knowledge.toggleFailed",{error:s.message}),"error")}}async function Ja(t,a){if(confirm(e("knowledge.deleteConfirm",{title:a})))try{await u(`/knowledge/articles/${t}`,{method:"DELETE"}),l(e("knowledge.articleDeleted")),Q(K)}catch(s){l(e("knowledge.deleteFailed",{error:s.message}),"error")}}async function Ka(t){try{const a=await u(`/knowledge/articles/${t}/reindex`,{method:"POST"});l(a.message||e("knowledge.reindexQueued")),Q(K)}catch(a){l(e("knowledge.reindexFailed",{error:a.message}),"error")}}async function za(){if(confirm(e("knowledge.reindexAllConfirm")))try{const t=await u("/knowledge/reindex-all",{method:"POST"});l(t.message||e("knowledge.reindexAllDispatched")),Q(K)}catch(t){l(e("knowledge.reindexAllFailed",{error:t.message}),"error")}}function Wa(){document.getElementById("importFiles").value="";const t=document.getElementById("importCategory");t&&(t.value=""),document.getElementById("importDocumentsModal").classList.add("show")}async function Qa(){const t=document.getElementById("importFiles"),a=document.getElementById("importCategory"),s=t.files;if(!s||s.length===0){l(e("knowledge.importNoFiles"),"error");return}const o=new FormData;for(const c of s)o.append("files",c);let n="/knowledge/articles/import";const r=a?a.value:"";r&&(n+=`?category=${encodeURIComponent(r)}`);try{const c=await jt(n,o),p=[e("knowledge.importResult",{imported:c.imported})];if(c.errors>0&&p.push(e("knowledge.importErrors",{errors:c.errors})),l(p.join(", "),c.errors>0?"warning":"success"),c.error_details&&c.error_details.length>0)for(const $ of c.error_details)l(`${$.filename}: ${$.error}`,"error");U("importDocumentsModal"),Q(K)}catch(c){l(e("knowledge.importFailed",{error:c.message}),"error")}}function Ke(t){switch(t){case"processed":return`<span class="${B}">${d(t)}</span>`;case"processing":return`<span class="${P}">${d(t)}</span>`;case"new":return`<span class="${N}">${d(t)}</span>`;case"skipped":return`<span class="${L}">${d(t)}</span>`;case"error":return`<span class="${A}">${d(t)}</span>`;case"duplicate":return`<span class="${L}">${e("sources.duplicate")}</span>`;case"duplicate_suspect":return`<span class="${N}">${e("sources.duplicateSuspect")}</span>`;default:return`<span class="${L}">${d(t||"unknown")}</span>`}}async function St(){const t=document.getElementById("scraperConfigCard");if(t)try{const s=(await u("/admin/scraper/config")).config||{};t.innerHTML=`
            <div class="flex flex-wrap items-center gap-4 mb-2">
                <label class="flex items-center gap-2 text-sm cursor-pointer">
                    <input type="checkbox" id="scraperEnabled" ${s.enabled?"checked":""} onchange="window._pages.knowledge.toggleScraperEnabled()">
                    <span>${e("sources.enabled")}</span>
                </label>
                <label class="flex items-center gap-2 text-sm cursor-pointer">
                    <input type="checkbox" id="scraperAutoApprove" ${s.auto_approve?"checked":""} onchange="window._pages.knowledge.toggleAutoApprove()">
                    <span>${e("sources.autoApprove")}</span>
                </label>
                <label class="flex items-center gap-2 text-sm cursor-pointer">
                    <input type="checkbox" id="scraperDedupLlm" ${s.dedup_llm_check?"checked":""} onchange="window._pages.knowledge.toggleDedupLlm()">
                    <span title="${e("sources.dedupLlmCheckHint")}">${e("sources.dedupLlmCheck")}</span>
                </label>
                <button class="${_} ${w}" onclick="window._pages.knowledge.runScraperNow()">${e("sources.runNow")}</button>
            </div>
            <div class="flex flex-wrap items-center gap-4">
                <label class="flex items-center gap-2 text-sm">
                    <span>${e("sources.minDate")}</span>
                    <input type="date" id="scraperMinDate" value="${d(s.min_date||"")}" class="border rounded px-2 py-1 text-sm dark:bg-gray-700 dark:border-gray-600" onchange="window._pages.knowledge.updateMinDate()">
                    <span class="${S} text-xs" title="${e("sources.minDateHint")}">?</span>
                </label>
                <label class="flex items-center gap-2 text-sm">
                    <span>${e("sources.maxDate")}</span>
                    <input type="date" id="scraperMaxDate" value="${d(s.max_date||"")}" class="border rounded px-2 py-1 text-sm dark:bg-gray-700 dark:border-gray-600" onchange="window._pages.knowledge.updateMaxDate()">
                    <span class="${S} text-xs" title="${e("sources.maxDateHint")}">?</span>
                </label>
            </div>`}catch(a){t.innerHTML=`<div class="${S}">${e("sources.configLoadFailed",{error:d(a.message)})}</div>`}}function Ga(t){switch(t){case"prokoleso":return`<span class="${P}">ProKoleso</span>`;case"rss":return`<span class="${N}">RSS</span>`;case"generic_html":return`<span class="${L}">HTML</span>`;default:return`<span class="${L}">${d(t)}</span>`}}function Ya(t){return`<span class="${L}">${{uk:"🇺🇦 UK",de:"🇩🇪 DE",en:"🇬🇧 EN",fr:"🇫🇷 FR"}[t]||t}</span>`}function Xa(t){if(!t)return`<span class="${S} text-xs">—</span>`;switch(t){case"ok":return`<span class="${B}">ok</span>`;case"error":return`<span class="${A}">error</span>`;case"disabled":return`<span class="${L}">disabled</span>`;default:return`<span class="${L}">${d(t)}</span>`}}async function fe(){const t=document.getElementById("sourceConfigsContainer");if(t){t.innerHTML=`<div class="${C}"><div class="spinner"></div></div>`;try{const s=(await u("/admin/scraper/source-configs")).configs||[];let o=`
            <div class="mb-4">
                <button class="${_}" onclick="window._pages.knowledge.showAddSourceConfig()">${e("sources.addSource")}</button>
            </div>`;if(s.length===0)o+=`<div class="${T}">${e("sources.noSourceConfigs")}</div>`;else{const n={monday:e("sources.scheduleDays.monday"),tuesday:e("sources.scheduleDays.tuesday"),wednesday:e("sources.scheduleDays.wednesday"),thursday:e("sources.scheduleDays.thursday"),friday:e("sources.scheduleDays.friday"),saturday:e("sources.scheduleDays.saturday"),sunday:e("sources.scheduleDays.sunday")};o+=`
            <div class="overflow-x-auto"><table class="${E}" id="sourceConfigsTable"><thead><tr>
                <th class="${k}" data-sortable>${e("sources.sourceName")}</th>
                <th class="${y}">${e("sources.sourceType")}</th>
                <th class="${y}">${e("sources.sourceLanguage")}</th>
                <th class="${k}" data-sortable>${e("sources.enabled")}</th>
                <th class="${y}">${e("sources.schedule")}</th>
                <th class="${k}" data-sortable>${e("sources.lastRun")}</th>
                <th class="${y}">${e("sources.actions")}</th>
            </tr></thead><tbody>
            ${s.map(r=>{const c=r.schedule_enabled?`${n[r.schedule_day_of_week]||r.schedule_day_of_week} ${String(r.schedule_hour).padStart(2,"0")}:00`:e("common.no"),p=r.last_run_stats?`${e("sources.processed")}: ${r.last_run_stats.processed||0}`:"";return`
                <tr class="${x}">
                    <td class="${i}">
                        <div>${d(r.name)}</div>
                        <div class="${S} text-xs">${d((r.source_url||"").replace(/^https?:\/\//,"").substring(0,40))}</div>
                    </td>
                    <td class="${i}">${Ga(r.source_type)}</td>
                    <td class="${i}">${Ya(r.language)}</td>
                    <td class="${i}" data-sort-value="${r.enabled?1:0}">
                        <label class="inline-flex items-center cursor-pointer">
                            <input type="checkbox" ${r.enabled?"checked":""} onchange="window._pages.knowledge.toggleSourceConfigEnabled('${r.id}', this.checked)">
                        </label>
                    </td>
                    <td class="${i}"><span class="text-xs">${d(c)}</span></td>
                    <td class="${i}" data-sort-value="${r.last_run_at||""}">
                        ${Xa(r.last_run_status)}
                        ${r.last_run_at?`<br><span class="${S} text-xs">${V(r.last_run_at)}</span>`:""}
                        ${p?`<br><span class="${S} text-xs">${p}</span>`:""}
                    </td>
                    <td class="${i}">
                        <div class="flex flex-wrap gap-1">
                            <button class="${Pe} ${w}" onclick="window._pages.knowledge.runSourceConfig('${r.id}')">${e("sources.runSource")}</button>
                            <button class="${_} ${w}" onclick="window._pages.knowledge.editSourceConfig('${r.id}')">${e("common.edit")}</button>
                            <button class="${j} ${w}" onclick="window._pages.knowledge.deleteSourceConfig('${r.id}', '${d(r.name).replace(/'/g,"\\'")}')">${e("common.delete")}</button>
                        </div>
                    </td>
                </tr>`}).join("")}
            </tbody></table></div>`}t.innerHTML=o,H("sourceConfigsTable")}catch(a){t.innerHTML=`<div class="${T}">${e("sources.failedToLoad",{error:d(a.message)})}
            <br><button class="${_} ${w} mt-2" onclick="window._pages.knowledge.loadSourceConfigs()">${e("common.retry")}</button></div>`}}}function Za(){document.getElementById("sourceConfigModalTitle").textContent=e("sources.addSource"),document.getElementById("editSourceConfigId").value="",document.getElementById("sourceConfigName").value="",document.getElementById("sourceConfigType").value="generic_html",document.getElementById("sourceConfigLanguage").value="de",document.getElementById("sourceConfigUrl").value="",document.getElementById("sourceConfigMaxArticles").value="20",document.getElementById("sourceConfigDay").value="monday",document.getElementById("sourceConfigHour").value="6",document.getElementById("sourceConfigEnabled").checked=!1,document.getElementById("sourceConfigAutoApprove").checked=!1,document.getElementById("sourceConfigSettings").value="{}",document.getElementById("sourceConfigModal").classList.add("show")}async function es(t){try{const s=((await u("/admin/scraper/source-configs")).configs||[]).find(o=>o.id===t);if(!s){l(e("sources.configLoadFailed",{error:"Not found"}),"error");return}document.getElementById("sourceConfigModalTitle").textContent=e("sources.editSource"),document.getElementById("editSourceConfigId").value=t,document.getElementById("sourceConfigName").value=s.name||"",document.getElementById("sourceConfigType").value=s.source_type||"generic_html",document.getElementById("sourceConfigLanguage").value=s.language||"uk",document.getElementById("sourceConfigUrl").value=s.source_url||"",document.getElementById("sourceConfigMaxArticles").value=String(s.max_articles_per_run||20),document.getElementById("sourceConfigDay").value=s.schedule_day_of_week||"monday",document.getElementById("sourceConfigHour").value=String(s.schedule_hour??6),document.getElementById("sourceConfigEnabled").checked=!!s.enabled,document.getElementById("sourceConfigAutoApprove").checked=!!s.auto_approve,document.getElementById("sourceConfigSettings").value=JSON.stringify(s.settings||{},null,2),document.getElementById("sourceConfigModal").classList.add("show")}catch(a){l(e("sources.configLoadFailed",{error:a.message}),"error")}}async function ts(){const t=document.getElementById("editSourceConfigId").value,a=document.getElementById("sourceConfigName").value.trim(),s=document.getElementById("sourceConfigType").value,o=document.getElementById("sourceConfigLanguage").value,n=document.getElementById("sourceConfigUrl").value.trim(),r=parseInt(document.getElementById("sourceConfigMaxArticles").value,10),c=document.getElementById("sourceConfigDay").value,p=parseInt(document.getElementById("sourceConfigHour").value,10),$=document.getElementById("sourceConfigEnabled").checked,m=document.getElementById("sourceConfigAutoApprove").checked;let f;try{f=JSON.parse(document.getElementById("sourceConfigSettings").value)}catch{l(e("sources.invalidSettingsJson"),"error");return}if(!a||!n){l(e("sources.nameUrlRequired"),"error");return}const h={name:a,source_type:s,source_url:n,language:o,max_articles_per_run:r,schedule_day_of_week:c,schedule_hour:p,enabled:$,auto_approve:m,settings:f};try{t?await u(`/admin/scraper/source-configs/${t}`,{method:"PATCH",body:JSON.stringify(h)}):await u("/admin/scraper/source-configs",{method:"POST",body:JSON.stringify(h)}),U("sourceConfigModal"),l(e("sources.sourceConfigSaved")),fe()}catch(g){l(e("sources.sourceConfigSaveFailed",{error:g.message}),"error")}}async function as(t,a){try{await u(`/admin/scraper/source-configs/${t}`,{method:"PATCH",body:JSON.stringify({enabled:a})}),l(e("sources.configUpdated"))}catch(s){l(e("sources.configUpdateFailed",{error:s.message}),"error"),fe()}}async function ss(t){try{await u(`/admin/scraper/source-configs/${t}/run`,{method:"POST"}),l(e("sources.runDispatched"))}catch(a){l(e("sources.runFailed",{error:a.message}),"error")}}async function os(t,a){if(confirm(e("sources.deleteSourceConfirm",{name:a})))try{await u(`/admin/scraper/source-configs/${t}`,{method:"DELETE"}),l(e("sources.sourceConfigDeleted")),fe()}catch(s){l(e("sources.sourceConfigDeleteFailed",{error:s.message}),"error")}}async function $e(t){t!==void 0&&(se=t);const a=document.getElementById("sourcesContainer");a.innerHTML=`<div class="${C}"><div class="spinner"></div></div>`;const s=Me({offset:se,filters:{status:"sourcesStatusFilter"}});try{const o=await u(`/admin/scraper/sources?${s}`),n=o.sources||[];if(n.length===0){a.innerHTML=`<div class="${T}">${e("sources.noSources")}</div>`,Y({containerId:"sourcesPagination",total:0,offset:0});return}a.innerHTML=`
            <div class="overflow-x-auto"><table class="${E}" id="sourcesTable"><thead><tr><th class="${k}" data-sortable>${e("sources.url")}</th><th class="${k}" data-sortable>${e("sources.originalTitle")}</th><th class="${k}" data-sortable>${e("sources.status")}</th><th class="${k}" data-sortable>${e("sources.date")}</th><th class="${y}">${e("sources.actions")}</th></tr></thead><tbody>
            ${n.map(r=>`
                <tr class="${x}">
                    <td class="${i}"><a href="${d(r.url)}" target="_blank" class="text-blue-600 dark:text-blue-400 hover:underline text-xs">${d((r.url||"").replace(/^https?:\/\//,"").substring(0,50))}${(r.url||"").length>60?"...":""}</a></td>
                    <td class="${i}">${d(r.original_title||"-")}</td>
                    <td class="${i}" data-sort-value="${d(r.status||"")}">${Ke(r.status)}${r.skip_reason?`<br><span class="${S} text-xs">${d(r.skip_reason)}</span>`:""}</td>
                    <td class="${i}" data-sort-value="${r.created_at||""}">${V(r.created_at)}</td>
                    <td class="${i}">
                        <div class="flex flex-wrap gap-1">
                            ${r.status==="processed"&&r.article_id?`
                                <button class="${_} ${w}" onclick="window._pages.knowledge.viewSourceArticle('${r.article_id}')">${e("sources.viewArticle")}</button>
                                ${r.article_active===!1?`<button class="${Pe} ${w}" onclick="window._pages.knowledge.approveSource('${r.id}')">${e("sources.approve")}</button>`:""}
                                <button class="${j} ${w}" onclick="window._pages.knowledge.rejectSource('${r.id}')">${e("sources.reject")}</button>
                            `:""}
                        </div>
                    </td>
                </tr>
            `).join("")}
            </tbody></table></div>
            <p class="${S} mt-2">${e("sources.total",{count:o.total})}</p>`,H("sourcesTable"),Y({containerId:"sourcesPagination",total:o.total,offset:se,onPage:r=>$e(r)})}catch(o){a.innerHTML=`<div class="${T}">${e("sources.failedToLoad",{error:d(o.message)})}
            <br><button class="${_} ${w} mt-2" onclick="window._pages.knowledge.loadSources()">${e("common.retry")}</button></div>`}}async function rs(){const t=document.getElementById("scraperEnabled").checked;try{await u("/admin/scraper/config",{method:"PATCH",body:JSON.stringify({enabled:t})}),l(e("sources.configUpdated"))}catch(a){l(e("sources.configUpdateFailed",{error:a.message}),"error")}}async function ns(){const t=document.getElementById("scraperAutoApprove").checked;try{await u("/admin/scraper/config",{method:"PATCH",body:JSON.stringify({auto_approve:t})}),l(e("sources.configUpdated"))}catch(a){l(e("sources.configUpdateFailed",{error:a.message}),"error")}}async function ls(){const t=document.getElementById("scraperDedupLlm").checked;try{await u("/admin/scraper/config",{method:"PATCH",body:JSON.stringify({dedup_llm_check:t})}),l(e("sources.configUpdated"))}catch(a){l(e("sources.configUpdateFailed",{error:a.message}),"error")}}async function is(){const t=document.getElementById("scraperMinDate").value||"";try{await u("/admin/scraper/config",{method:"PATCH",body:JSON.stringify({min_date:t})}),l(e("sources.configUpdated"))}catch(a){l(e("sources.configUpdateFailed",{error:a.message}),"error")}}async function ds(){const t=document.getElementById("scraperMaxDate").value||"";try{await u("/admin/scraper/config",{method:"PATCH",body:JSON.stringify({max_date:t})}),l(e("sources.configUpdated"))}catch(a){l(e("sources.configUpdateFailed",{error:a.message}),"error")}}async function cs(){try{await u("/admin/scraper/run",{method:"POST"}),l(e("sources.runDispatched"))}catch(t){l(e("sources.runFailed",{error:t.message}),"error")}}async function us(t){try{await u(`/admin/scraper/sources/${t}/approve`,{method:"POST"}),l(e("sources.approved")),$e(se)}catch(a){l(e("sources.approveFailed",{error:a.message}),"error")}}async function ps(t){if(confirm(e("sources.rejectConfirm")))try{await u(`/admin/scraper/sources/${t}/reject`,{method:"POST"}),l(e("sources.rejected")),$e(se)}catch(a){l(e("sources.rejectFailed",{error:a.message}),"error")}}function ms(t){et("articles"),setTimeout(()=>_t(t),500)}const ze=[{value:6,label:()=>e("sources.intervalHours.6")},{value:12,label:()=>e("sources.intervalHours.12")},{value:24,label:()=>e("sources.intervalHours.24")},{value:168,label:()=>e("sources.intervalHours.168")}];function gs(t){const a=ze.find(s=>s.value===t);return a?a.label():`${t}h`}async function he(){const t=document.getElementById("watchedPagesContainer");if(t){t.innerHTML=`<div class="${C}"><div class="spinner"></div></div>`;try{const s=(await u("/admin/scraper/watched-pages")).pages||[],o=X.length?X:[{value:"delivery",label:"delivery"},{value:"warranty",label:"warranty"},{value:"returns",label:"returns"},{value:"policies",label:"policies"},{value:"general",label:"general"}],n=`<option value="" disabled selected>${e("common.select")}</option>`+o.map(p=>`<option value="${p.value}">${d(p.label)}</option>`).join(""),r=`<option value="" disabled selected>${e("common.select")}</option>`+ze.map(p=>`<option value="${p.value}">${p.label()}</option>`).join("");let c=`
            <div class="flex flex-wrap items-end gap-2 mb-4">
                <div class="flex-1 min-w-[250px]">
                    <label class="block text-xs ${S} mb-1">${e("sources.watchedUrl")}</label>
                    <input type="text" id="watchedPageUrl" placeholder="${e("sources.urlPlaceholder")}" class="w-full border rounded px-2 py-1.5 text-sm dark:bg-gray-700 dark:border-gray-600">
                </div>
                <div>
                    <label class="block text-xs ${S} mb-1">${e("sources.watchedCategory")}</label>
                    <select id="watchedPageCategory" class="border rounded px-2 py-1.5 text-sm dark:bg-gray-700 dark:border-gray-600">${n}</select>
                </div>
                <div>
                    <label class="block text-xs ${S} mb-1">${e("sources.watchedInterval")}</label>
                    <select id="watchedPageInterval" class="border rounded px-2 py-1.5 text-sm dark:bg-gray-700 dark:border-gray-600">${r}</select>
                </div>
                <div>
                    <label class="flex items-center gap-1.5 text-sm cursor-pointer pt-4">
                        <input type="checkbox" id="watchedPageDiscovery">
                        <span>${e("sources.discoveryLabel")}</span>
                        <span class="${S} text-xs cursor-help" title="${e("sources.discoveryHint")}">(?)</span>
                    </label>
                </div>
                <button class="${_} ${w}" onclick="window._pages.knowledge.addWatchedPage()">${e("sources.addWatchedPage")}</button>
            </div>`;if(s.length===0)c+=`<div class="${T}">${e("sources.noWatchedPages")}</div>`;else{const p=s.filter(h=>!h.parent_id),$=s.filter(h=>h.parent_id),m={};for(const h of $){const g=h.parent_id;m[g]||(m[g]=[]),m[g].push(h)}let f="";for(const h of p){const g=h.is_discovery,v=m[h.id]||[];f+=`
                <tr class="${x}">
                    <td class="${i}">
                        <a href="${d(h.url)}" target="_blank" class="text-blue-600 dark:text-blue-400 hover:underline text-xs">${d((h.url||"").replace(/^https?:\/\//,"").substring(0,50))}</a>
                        ${g?`<br><span class="${N} text-xs">${e("sources.discoveryBadge")}</span> <span class="${S} text-xs">${e("sources.childCount",{count:h.child_count||0})}</span>`:""}
                    </td>
                    <td class="${i}"><span class="${P}">${d(h.article_category||"-")}</span></td>
                    <td class="${i}">
                        <select class="border rounded px-1 py-0.5 text-xs dark:bg-gray-700 dark:border-gray-600"
                            onchange="window._pages.knowledge.updateWatchedInterval('${h.id}', parseInt(this.value))">
                            ${ze.map(b=>`<option value="${b.value}" ${b.value===h.rescrape_interval_hours?"selected":""}>${b.label()}</option>`).join("")}
                        </select>
                    </td>
                    <td class="${i}">${Ke(h.status)}</td>
                    <td class="${i}">${h.fetched_at?V(h.fetched_at):`<span class="${S} text-xs">${e("sources.neverScraped")}</span>`}</td>
                    <td class="${i}">${h.next_scrape_at?V(h.next_scrape_at):"-"}</td>
                    <td class="${i}">
                        <div class="flex flex-wrap gap-1">
                            ${!g&&h.article_id?`<button class="${_} ${w}" onclick="window._pages.knowledge.viewSourceArticle('${h.article_id}')">${e("sources.watchedArticle")}</button>`:""}
                            <button class="${Pe} ${w}" onclick="window._pages.knowledge.scrapeWatchedNow('${h.id}')">${e("sources.scrapeNow")}</button>
                            <button class="${j} ${w}" onclick="window._pages.knowledge.deleteWatchedPage('${h.id}')">${e("sources.deleteWatched")}</button>
                        </div>
                    </td>
                </tr>`;for(const b of v)f+=`
                    <tr class="${x} opacity-80">
                        <td class="${i} pl-8">
                            <span class="${S}">↳</span>
                            <a href="${d(b.url)}" target="_blank" class="text-blue-600 dark:text-blue-400 hover:underline text-xs">${d((b.url||"").replace(/^https?:\/\//,"").substring(0,50))}</a>
                        </td>
                        <td class="${i}"><span class="${P}">${d(b.article_category||"-")}</span></td>
                        <td class="${i}"><span class="text-xs">${gs(b.rescrape_interval_hours)}</span></td>
                        <td class="${i}">${Ke(b.status)}</td>
                        <td class="${i}">${b.fetched_at?V(b.fetched_at):`<span class="${S} text-xs">${e("sources.neverScraped")}</span>`}</td>
                        <td class="${i}">${b.next_scrape_at?V(b.next_scrape_at):"-"}</td>
                        <td class="${i}">
                            <div class="flex flex-wrap gap-1">
                                ${b.article_id?`<button class="${_} ${w}" onclick="window._pages.knowledge.viewSourceArticle('${b.article_id}')">${e("sources.watchedArticle")}</button>`:""}
                            </div>
                        </td>
                    </tr>`}c+=`
            <div class="overflow-x-auto"><table class="${E}" id="watchedPagesTable"><thead><tr>
                <th class="${y}">${e("sources.watchedUrl")}</th>
                <th class="${y}">${e("sources.watchedCategory")}</th>
                <th class="${y}">${e("sources.watchedInterval")}</th>
                <th class="${y}">${e("sources.watchedStatus")}</th>
                <th class="${y}">${e("sources.watchedLastScraped")}</th>
                <th class="${y}">${e("sources.watchedNextScrape")}</th>
                <th class="${y}">${e("sources.watchedActions")}</th>
            </tr></thead><tbody>
            ${f}
            </tbody></table></div>`}t.innerHTML=c}catch(a){t.innerHTML=`<div class="${T}">${e("sources.watchedFailedToLoad",{error:d(a.message)})}
            <br><button class="${_} ${w} mt-2" onclick="window._pages.knowledge.loadWatchedPages()">${e("common.retry")}</button></div>`}}}async function vs(){var r,c,p,$,m;const t=(c=(r=document.getElementById("watchedPageUrl"))==null?void 0:r.value)==null?void 0:c.trim(),a=(p=document.getElementById("watchedPageCategory"))==null?void 0:p.value,s=($=document.getElementById("watchedPageInterval"))==null?void 0:$.value,o=parseInt(s,10),n=((m=document.getElementById("watchedPageDiscovery"))==null?void 0:m.checked)||!1;if(!t){l(e("sources.urlRequired"),"error");return}if(!a){l(e("sources.categoryRequired"),"error");return}if(!s){l(e("sources.intervalRequired"),"error");return}try{await u("/admin/scraper/watched-pages",{method:"POST",body:JSON.stringify({url:t,category:a,rescrape_interval_hours:o,is_discovery:n})}),l(e("sources.watchedPageAdded")),document.getElementById("watchedPageUrl").value="",he()}catch(f){l(e("sources.watchedPageAddFailed",{error:f.message}),"error")}}async function fs(t,a){try{await u(`/admin/scraper/watched-pages/${t}`,{method:"PATCH",body:JSON.stringify({rescrape_interval_hours:a})}),l(e("sources.watchedPageUpdated"))}catch(s){l(e("sources.watchedPageUpdateFailed",{error:s.message}),"error")}}async function $s(t){try{l(e("sources.scrapeNowRunning"),"info");const a=await u(`/admin/scraper/watched-pages/${t}/scrape-now`,{method:"POST"});a.status==="unchanged"?l(e("sources.scrapeNowUnchanged")):a.status==="ok"&&a.discovered!==void 0?l(e("sources.scrapeNowDiscoveryDone",{discovered:a.discovered,created:a.created||0,updated:a.updated||0})):l(e("sources.scrapeNowDone",{status:a.status||"ok"})),he()}catch(a){l(e("sources.scrapeNowFailed",{error:a.message}),"error")}}async function hs(t){if(confirm(e("sources.watchedPageDeleteConfirm")))try{await u(`/admin/scraper/watched-pages/${t}`,{method:"DELETE"}),l(e("sources.watchedPageDeleted")),he()}catch(a){l(e("sources.watchedPageDeleteFailed",{error:a.message}),"error")}}function ys(){q("knowledge",()=>et(xt))}window._pages=window._pages||{};window._pages.knowledge={showTab:et,loadArticles:Q,showCreateArticle:Ua,editArticle:_t,saveArticle:Va,toggleArticle:ja,deleteArticle:Ja,reindexArticle:Ka,reindexAll:za,showImportModal:Wa,importDocuments:Qa,loadSourceConfigs:fe,showAddSourceConfig:Za,editSourceConfig:es,saveSourceConfig:ts,toggleSourceConfigEnabled:as,runSourceConfig:ss,deleteSourceConfig:os,loadScraperConfig:St,loadSources:$e,toggleScraperEnabled:rs,toggleAutoApprove:ns,toggleDedupLlm:ls,updateMinDate:is,updateMaxDate:ds,runScraperNow:cs,approveSource:us,rejectSource:ps,viewSourceArticle:ms,loadWatchedPages:he,addWatchedPage:vs,updateWatchedInterval:fs,scrapeWatchedNow:$s,deleteWatchedPage:hs};let Bt="templates",oe=0,re=0;function Et(t){Bt=t,["templates","dialogues","safety"].forEach(n=>{const r=document.getElementById(`scenariosContent-${n}`);r&&(r.style.display=n===t?"block":"none")}),document.querySelectorAll("#page-scenarios .tab-bar button").forEach(n=>n.classList.remove("active"));const s=document.querySelector(`#page-scenarios .tab-bar button[data-tab="${t}"]`);s&&s.classList.add("active"),oe=0,re=0;const o={templates:Re,dialogues:ye,safety:be};o[t]&&o[t]()}async function Re(){var a,s;const t=document.getElementById("templatesContainer")||document.getElementById("scenariosContent-templates");t.innerHTML=`<div class="${C}"><div class="spinner"></div></div>`;try{let n=(await u("/training/templates/")).items||[];const r=document.getElementById("templateFilterKey");if(r){const f=r.value,h=[...new Set(n.map(g=>g.template_key))].sort();r.innerHTML=`<option value="">${e("training.allTemplateKeys")}</option>`+h.map(g=>`<option value="${d(g)}"${g===f?" selected":""}>${d(g)}</option>`).join("")}const c=((a=document.getElementById("templateFilterKey"))==null?void 0:a.value)||"",p=(((s=document.getElementById("templateSearch"))==null?void 0:s.value)||"").toLowerCase().trim();if(c&&(n=n.filter(f=>f.template_key===c)),p&&(n=n.filter(f=>(f.title||"").toLowerCase().includes(p)||(f.content||"").toLowerCase().includes(p)||(f.template_key||"").toLowerCase().includes(p))),n.length===0){t.innerHTML=`
                <div class="mb-4"><button class="${_}" onclick="window._pages.scenarios.showCreateTemplate()">${e("training.newTemplate")}</button></div>
                <div class="${T}">${e("training.noTemplates")}</div>`;return}const $={};for(const f of n)$[f.template_key]||($[f.template_key]=[]),$[f.template_key].push(f);let m="";for(const[f,h]of Object.entries($))for(let g=0;g<h.length;g++){const v=h[g],b=g===0,I=h.length;m+=`
                <tr class="${x}">
                    ${b?`<td class="${i}" rowspan="${I}"><span class="${P}">${d(f)}</span><br><span class="${S} text-xs">${I} ${e("training.variantCount",{count:I})}</span><br><button class="${_} ${w} mt-1" onclick="window._pages.scenarios.addVariant('${d(f)}')">${e("training.addVariant")}</button></td>`:""}
                    <td class="${i}"><span class="${L}">#${v.variant_number}</span></td>
                    <td class="${i}">${d(v.title)}</td>
                    <td class="${i}"><span class="${S}">${d((v.content||"").substring(0,80))}${(v.content||"").length>80?"...":""}</span></td>
                    <td class="${i}">${v.is_active!==!1?`<span class="${B}">${e("common.yes")}</span>`:`<span class="${A}">${e("common.no")}</span>`}</td>
                    <td class="${i}">
                        <div class="flex flex-wrap gap-1">
                            <button class="${_} ${w}" onclick="window._pages.scenarios.editTemplate('${v.id}')">${e("common.edit")}</button>
                            ${I>1?`<button class="${j} ${w}" onclick="window._pages.scenarios.deleteTemplate('${v.id}', '${d(v.title).replace(/'/g,"\\'")}')">${e("common.delete")}</button>`:""}
                        </div>
                    </td>
                </tr>`}t.innerHTML=`
            <div class="mb-4">
                <button class="${_}" onclick="window._pages.scenarios.showCreateTemplate()">${e("training.newTemplate")}</button>
                <span class="${S} ml-3 text-sm">${e("training.variantsHint")}</span>
            </div>
            <div class="overflow-x-auto"><table class="${E}"><thead><tr><th class="${y}">${e("training.templateKey")}</th><th class="${y}">#</th><th class="${y}">${e("training.templateTitle")}</th><th class="${y}">${e("training.content")}</th><th class="${y}">${e("training.activeCol")}</th><th class="${y}">${e("training.actions")}</th></tr></thead><tbody>
            ${m}
            </tbody></table></div>`}catch(o){t.innerHTML=`<div class="${T}">${e("training.loadFailed",{error:d(o.message)})}</div>`}}function bs(){document.getElementById("templateModalTitle").textContent=e("training.newTemplate"),document.getElementById("editTemplateId").value="",document.getElementById("templateKey").value="",document.getElementById("templateKey").disabled=!1,document.getElementById("templateTitle").value="",document.getElementById("templateContent").value="",document.getElementById("templateDescription").value="",document.getElementById("responseTemplateModal").classList.add("show")}function ws(t){document.getElementById("templateModalTitle").textContent=e("training.addVariantTitle"),document.getElementById("editTemplateId").value="",document.getElementById("templateKey").value=t,document.getElementById("templateKey").disabled=!0,document.getElementById("templateTitle").value="",document.getElementById("templateContent").value="",document.getElementById("templateDescription").value="",document.getElementById("responseTemplateModal").classList.add("show")}async function Ts(t){try{const s=(await u(`/training/templates/${t}`)).item;document.getElementById("templateModalTitle").textContent=e("training.editTemplate"),document.getElementById("editTemplateId").value=t,document.getElementById("templateKey").value=s.template_key||"",document.getElementById("templateKey").disabled=!0,document.getElementById("templateTitle").value=s.title||"",document.getElementById("templateContent").value=s.content||"",document.getElementById("templateDescription").value=s.description||"",document.getElementById("responseTemplateModal").classList.add("show")}catch(a){l(e("training.loadFailed",{error:a.message}),"error")}}async function ks(){const t=document.getElementById("editTemplateId").value,a=document.getElementById("templateKey").value.trim(),s=document.getElementById("templateTitle").value.trim(),o=document.getElementById("templateContent").value.trim(),n=document.getElementById("templateDescription").value.trim();if(!s||!o){l(e("training.titleContentRequired"),"error");return}try{if(t)await u(`/training/templates/${t}`,{method:"PATCH",body:JSON.stringify({title:s,content:o,description:n||null})});else{if(!a){l(e("training.keyRequired"),"error");return}await u("/training/templates/",{method:"POST",body:JSON.stringify({template_key:a,title:s,content:o,description:n||null})})}U("responseTemplateModal"),l(e("training.templateSaved")),Re()}catch(r){l(e("training.saveFailed",{error:r.message}),"error")}}async function xs(t,a){if(confirm(e("training.deleteVariantConfirm",{title:a})))try{await u(`/training/templates/${t}`,{method:"DELETE"}),l(e("training.variantDeleted")),Re()}catch(s){l(e("training.deleteFailed",{error:s.message}),"error")}}async function ye(t){t!==void 0&&(oe=t);const a=document.getElementById("dialoguesContainer")||document.getElementById("scenariosContent-dialogues");a.innerHTML=`<div class="${C}"><div class="spinner"></div></div>`;const s=Me({offset:oe,filters:{scenario_type:"dialogueFilterScenario",phase:"dialogueFilterPhase",is_active:"dialogueFilterActive"}});try{const o=await u(`/training/dialogues/?${s}`),n=o.items||[];if(n.length===0){a.innerHTML=`
                <div class="mb-4"><button class="${_}" onclick="window._pages.scenarios.showCreateDialogue()">${e("training.newDialogue")}</button></div>
                <div class="${T}">${e("training.noDialogues")}</div>`,Y({containerId:"dialoguesPagination",total:0,offset:0});return}a.innerHTML=`
            <div class="mb-4"><button class="${_}" onclick="window._pages.scenarios.showCreateDialogue()">${e("training.newDialogue")}</button></div>
            <div class="overflow-x-auto"><table class="${E}" id="dialoguesTable"><thead><tr><th class="${k}" data-sortable>${e("training.dialogueTitle")}</th><th class="${k}" data-sortable>${e("training.scenario")}</th><th class="${k}" data-sortable>${e("training.phase")}</th><th class="${y}">${e("training.tools")}</th><th class="${k}" data-sortable>${e("training.activeCol")}</th><th class="${y}">${e("training.actions")}</th></tr></thead><tbody>
            ${n.map(r=>`
                <tr class="${x}">
                    <td class="${i}">${d(r.title)}</td>
                    <td class="${i}"><span class="${P}">${d(r.scenario_type)}</span></td>
                    <td class="${i}"><span class="${L}">${d(r.phase)}</span></td>
                    <td class="${i}">${(r.tools_used||[]).map(c=>`<span class="${Be}">${d(c)}</span>`).join(" ")}</td>
                    <td class="${i}">${r.is_active!==!1?`<span class="${B}">${e("common.yes")}</span>`:`<span class="${A}">${e("common.no")}</span>`}</td>
                    <td class="${i}">
                        <div class="flex flex-wrap gap-1">
                            <button class="${_} ${w}" onclick="window._pages.scenarios.editDialogue('${r.id}')">${e("common.edit")}</button>
                            <button class="${j} ${w}" onclick="window._pages.scenarios.deleteDialogue('${r.id}', '${d(r.title).replace(/'/g,"\\'")}')">${e("common.delete")}</button>
                        </div>
                    </td>
                </tr>
            `).join("")}
            </tbody></table></div>`,H("dialoguesTable"),Y({containerId:"dialoguesPagination",total:o.total,offset:oe,onPage:r=>ye(r)})}catch(o){a.innerHTML=`<div class="${T}">${e("training.loadFailed",{error:d(o.message)})}</div>`}}function _s(){document.getElementById("dialogueModalTitle").textContent=e("training.newDialogue"),document.getElementById("editDialogueId").value="",document.getElementById("dialogueTitle").value="",document.getElementById("dialogueScenarioType").value="tire_search",document.getElementById("dialoguePhase").value="mvp",document.getElementById("dialogueJSON").value=`[
  {"role": "customer", "text": ""},
  {"role": "agent", "text": ""}
]`,document.getElementById("dialogueDescription").value="",document.getElementById("dialogueModal").classList.add("show")}async function Ss(t){try{const s=(await u(`/training/dialogues/${t}`)).item;document.getElementById("dialogueModalTitle").textContent=e("training.editDialogue"),document.getElementById("editDialogueId").value=t,document.getElementById("dialogueTitle").value=s.title||"",document.getElementById("dialogueScenarioType").value=s.scenario_type||"tire_search",document.getElementById("dialoguePhase").value=s.phase||"mvp",document.getElementById("dialogueJSON").value=JSON.stringify(s.dialogue||[],null,2),document.getElementById("dialogueDescription").value=s.description||"",document.getElementById("dialogueModal").classList.add("show")}catch(a){l(e("training.loadFailed",{error:a.message}),"error")}}async function Bs(){const t=document.getElementById("editDialogueId").value,a=document.getElementById("dialogueTitle").value.trim(),s=document.getElementById("dialogueScenarioType").value,o=document.getElementById("dialoguePhase").value,n=document.getElementById("dialogueDescription").value.trim();let r;try{r=JSON.parse(document.getElementById("dialogueJSON").value)}catch{l(e("training.invalidJSON"),"error");return}if(!a){l(e("training.titleRequired"),"error");return}const c=[...new Set(r.filter($=>$.tool_calls).flatMap($=>$.tool_calls.map(m=>m.name)))],p={title:a,scenario_type:s,phase:o,dialogue:r,tools_used:c,description:n||null};try{t?await u(`/training/dialogues/${t}`,{method:"PATCH",body:JSON.stringify(p)}):await u("/training/dialogues/",{method:"POST",body:JSON.stringify(p)}),U("dialogueModal"),l(e("training.dialogueSaved")),ye(oe)}catch($){l(e("training.saveFailed",{error:$.message}),"error")}}async function Es(t,a){if(confirm(e("training.deleteConfirm",{title:a})))try{await u(`/training/dialogues/${t}`,{method:"DELETE"}),l(e("training.dialogueDeleted")),ye(oe)}catch(s){l(e("training.deleteFailed",{error:s.message}),"error")}}const Cs={critical:4,high:3,medium:2,low:1};function Is(t){switch(t){case"critical":return`<span class="${A}">${d(t)}</span>`;case"high":return`<span class="${N}">${d(t)}</span>`;case"medium":return`<span class="${P}">${d(t)}</span>`;default:return`<span class="${L}">${d(t)}</span>`}}async function be(t){t!==void 0&&(re=t);const a=document.getElementById("safetyRulesContainer")||document.getElementById("scenariosContent-safety");a.innerHTML=`<div class="${C}"><div class="spinner"></div></div>`;const s=Me({offset:re,filters:{rule_type:"safetyFilterType",severity:"safetyFilterSeverity",is_active:"safetyFilterActive"}});try{const o=await u(`/training/safety-rules/?${s}`),n=o.items||[];if(n.length===0){a.innerHTML=`
                <div class="mb-4"><button class="${_}" onclick="window._pages.scenarios.showCreateSafetyRule()">${e("training.newSafetyRule")}</button></div>
                <div class="${T}">${e("training.noSafetyRules")}</div>`,Y({containerId:"safetyPagination",total:0,offset:0});return}a.innerHTML=`
            <div class="mb-4"><button class="${_}" onclick="window._pages.scenarios.showCreateSafetyRule()">${e("training.newSafetyRule")}</button></div>
            <div class="overflow-x-auto"><table class="${E}" id="safetyRulesTable"><thead><tr><th class="${k}" data-sortable>${e("training.ruleTitle")}</th><th class="${k}" data-sortable>${e("training.ruleType")}</th><th class="${k}" data-sortable>${e("training.severity")}</th><th class="${y}">${e("training.triggerInput")}</th><th class="${k}" data-sortable>${e("training.activeCol")}</th><th class="${y}">${e("training.actions")}</th></tr></thead><tbody>
            ${n.map(r=>`
                <tr class="${x}">
                    <td class="${i}">${d(r.title)}</td>
                    <td class="${i}"><span class="${P}">${d(r.rule_type)}</span></td>
                    <td class="${i}" data-sort-value="${Cs[r.severity]||0}">${Is(r.severity)}</td>
                    <td class="${i}"><span class="${S}">${d((r.trigger_input||"").substring(0,60))}${(r.trigger_input||"").length>60?"...":""}</span></td>
                    <td class="${i}">${r.is_active!==!1?`<span class="${B}">${e("common.yes")}</span>`:`<span class="${A}">${e("common.no")}</span>`}</td>
                    <td class="${i}">
                        <div class="flex flex-wrap gap-1">
                            <button class="${_} ${w}" onclick="window._pages.scenarios.editSafetyRule('${r.id}')">${e("common.edit")}</button>
                            <button class="${j} ${w}" onclick="window._pages.scenarios.deleteSafetyRule('${r.id}', '${d(r.title).replace(/'/g,"\\'")}')">${e("common.delete")}</button>
                        </div>
                    </td>
                </tr>
            `).join("")}
            </tbody></table></div>`,H("safetyRulesTable"),Y({containerId:"safetyPagination",total:o.total,offset:re,onPage:r=>be(r)})}catch(o){a.innerHTML=`<div class="${T}">${e("training.loadFailed",{error:d(o.message)})}</div>`}}function Ls(){document.getElementById("safetyRuleModalTitle").textContent=e("training.newSafetyRule"),document.getElementById("editSafetyRuleId").value="",document.getElementById("safetyRuleTitle").value="",document.getElementById("safetyRuleType").value="behavioral",document.getElementById("safetyRuleSeverity").value="medium",document.getElementById("safetyTriggerInput").value="",document.getElementById("safetyExpectedBehavior").value="",document.getElementById("safetyRuleModal").classList.add("show")}async function As(t){try{const s=(await u(`/training/safety-rules/${t}`)).item;document.getElementById("safetyRuleModalTitle").textContent=e("training.editSafetyRule"),document.getElementById("editSafetyRuleId").value=t,document.getElementById("safetyRuleTitle").value=s.title||"",document.getElementById("safetyRuleType").value=s.rule_type||"behavioral",document.getElementById("safetyRuleSeverity").value=s.severity||"medium",document.getElementById("safetyTriggerInput").value=s.trigger_input||"",document.getElementById("safetyExpectedBehavior").value=s.expected_behavior||"",document.getElementById("safetyRuleModal").classList.add("show")}catch(a){l(e("training.loadFailed",{error:a.message}),"error")}}async function Ps(){const t=document.getElementById("editSafetyRuleId").value,a=document.getElementById("safetyRuleTitle").value.trim(),s=document.getElementById("safetyRuleType").value,o=document.getElementById("safetyRuleSeverity").value,n=document.getElementById("safetyTriggerInput").value.trim(),r=document.getElementById("safetyExpectedBehavior").value.trim();if(!a||!n||!r){l(e("training.fieldsRequired"),"error");return}const c={title:a,rule_type:s,severity:o,trigger_input:n,expected_behavior:r};try{t?await u(`/training/safety-rules/${t}`,{method:"PATCH",body:JSON.stringify(c)}):await u("/training/safety-rules/",{method:"POST",body:JSON.stringify(c)}),U("safetyRuleModal"),l(e("training.safetyRuleSaved")),be(re)}catch(p){l(e("training.saveFailed",{error:p.message}),"error")}}async function Ds(t,a){if(confirm(e("training.deleteConfirm",{title:a})))try{await u(`/training/safety-rules/${t}`,{method:"DELETE"}),l(e("training.safetyRuleDeleted")),be(re)}catch(s){l(e("training.deleteFailed",{error:s.message}),"error")}}function Fs(){q("scenarios",()=>Et(Bt))}window._pages=window._pages||{};window._pages.scenarios={showTab:Et,loadTemplates:Re,showCreateTemplate:bs,addVariant:ws,editTemplate:Ts,saveTemplate:ks,deleteTemplate:xs,loadDialogues:ye,showCreateDialogue:_s,editDialogue:Ss,saveDialogue:Bs,deleteDialogue:Es,loadSafetyRules:be,showCreateSafetyRule:Ls,editSafetyRule:As,saveSafetyRule:Ps,deleteSafetyRule:Ds};async function Oe(){const t=document.getElementById("toolsContent");t.innerHTML=`<div class="${C}"><div class="spinner"></div></div>`;try{const s=(await u("/training/tools/")).items||[];t.innerHTML=`
            <div class="overflow-x-auto"><table class="${E}" id="toolsTable"><thead><tr><th class="${k}" data-sortable>${e("training.toolName")}</th><th class="${y}">${e("training.description")}</th><th class="${k}" data-sortable>${e("training.override")}</th><th class="${y}">${e("training.actions")}</th></tr></thead><tbody>
            ${s.map(o=>`
                <tr class="${x}">
                    <td class="${i}"><span class="${P}">${d(o.name)}</span></td>
                    <td class="${i}"><span class="${S}">${d((o.effective_description||"").substring(0,100))}${(o.effective_description||"").length>100?"...":""}</span></td>
                    <td class="${i}">${o.has_override?`<span class="${N}">${e("training.overridden")}</span>`:`<span class="${L}">${e("training.default")}</span>`}</td>
                    <td class="${i}">
                        <div class="flex flex-wrap gap-1">
                            <button class="${_} ${w}" onclick="window._pages.tools.editToolOverride('${d(o.name)}')">${e("common.edit")}</button>
                            ${o.has_override?`<button class="${j} ${w}" onclick="window._pages.tools.resetToolOverride('${d(o.name)}')">${e("training.reset")}</button>`:""}
                        </div>
                    </td>
                </tr>
            `).join("")}
            </tbody></table></div>`,H("toolsTable")}catch(a){t.innerHTML=`<div class="${T}">${e("training.loadFailed",{error:d(a.message)})}</div>`}}async function Ms(t){try{const s=((await u("/training/tools/")).items||[]).find(o=>o.name===t);if(!s){l(e("training.toolNotFound"),"error");return}document.getElementById("toolOverrideModalTitle").textContent=`${e("training.editTool")}: ${t}`,document.getElementById("editToolName").value=t,document.getElementById("toolOriginalDescription").textContent=s.description,document.getElementById("toolOverrideDescription").value=s.override&&s.override.description||s.description,document.getElementById("toolOverrideModal").classList.add("show")}catch(a){l(e("training.loadFailed",{error:a.message}),"error")}}async function Rs(){const t=document.getElementById("editToolName").value,a=document.getElementById("toolOverrideDescription").value.trim();if(!a){l(e("training.descriptionRequired"),"error");return}try{await u(`/training/tools/${t}`,{method:"PATCH",body:JSON.stringify({description:a})}),U("toolOverrideModal"),l(e("training.toolOverrideSaved")),Oe()}catch(s){l(e("training.saveFailed",{error:s.message}),"error")}}async function Os(t){if(confirm(e("training.resetConfirm",{name:t})))try{await u(`/training/tools/${t}`,{method:"DELETE"}),l(e("training.toolOverrideReset")),Oe()}catch(a){l(e("training.resetFailed",{error:a.message}),"error")}}function Ns(){q("tools",Oe)}window._pages=window._pages||{};window._pages.tools={loadTools:Oe,editToolOverride:Ms,saveToolOverride:Rs,resetToolOverride:Os};async function ie(){var s,o;const t=document.getElementById("operatorsLoading"),a=document.querySelector("#operatorsTable tbody");t.style.display="flex";try{const n=await u("/operators");t.style.display="none";let r=n.operators||[];const c=r.length,p=(((s=document.getElementById("operatorSearch"))==null?void 0:s.value)||"").toLowerCase().trim(),$=((o=document.getElementById("operatorFilterStatus"))==null?void 0:o.value)||"";if(p&&(r=r.filter(m=>(m.name||"").toLowerCase().includes(p)||(m.extension||"").toLowerCase().includes(p))),$&&(r=r.filter(m=>m.current_status===$)),r.length===0){a.innerHTML=`<tr><td colspan="7" class="${T}">${e("operators.noOperators")}</td></tr>`;return}a.innerHTML=r.map(m=>`
            <tr class="${x}">
                <td class="${i}">${d(m.name)}</td>
                <td class="${i}">${d(m.extension)}</td>
                <td class="${i}">${ra(m.current_status)}</td>
                <td class="${i}">${(m.skills||[]).map(f=>`<span class="${P}">${d(f)}</span>`).join(" ")}</td>
                <td class="${i}">${m.shift_start||"09:00"} - ${m.shift_end||"18:00"}</td>
                <td class="${i}">${m.is_active?`<span class="${B}">${e("common.yes")}</span>`:`<span class="${A}">${e("common.no")}</span>`}</td>
                <td class="${i}">
                    <div class="flex flex-wrap items-center gap-1">
                        <select onchange="window._pages.operators.changeOperatorStatus('${m.id}', this.value); this.selectedIndex=0" class="${De}">
                            <option value="">${e("operators.statusSelect")}</option>
                            <option value="online">${e("operators.statusOnline")}</option>
                            <option value="offline">${e("operators.statusOffline")}</option>
                            <option value="busy">${e("operators.statusBusy")}</option>
                            <option value="break">${e("operators.statusBreak")}</option>
                        </select>
                        <button class="${_} ${w}" onclick="window._pages.operators.editOperator('${m.id}')">${e("operators.editBtn")}</button>
                        ${m.is_active?`<button class="${j} ${w}" onclick="window._pages.operators.deactivateOperator('${m.id}', '${d(m.name).replace(/'/g,"\\'")}')">×</button>`:""}
                    </div>
                </td>
            </tr>
        `).join(""),r.length<c&&(a.innerHTML+=`<tr><td colspan="7" class="${S} text-center py-2">${e("common.showing",{shown:r.length,total:c})}</td></tr>`),H("operatorsTable")}catch(n){t.style.display="none",a.innerHTML=`<tr><td colspan="7" class="${T}">${e("operators.failedToLoad",{error:d(n.message)})}
            <br><button class="${_} ${w} mt-2" onclick="window._pages.operators.loadOperators()">${e("common.retry")}</button></td></tr>`}}async function We(){try{const t=await u("/operators/queue");document.getElementById("operatorQueueStats").innerHTML=`
            <div class="${F} text-center"><div class="${M}">${t.operators_online||0}</div><div class="${R}">${e("operators.online")}</div></div>
            <div class="${F} text-center"><div class="${M}">${t.transfers_last_hour||0}</div><div class="${R}">${e("operators.transfers1h")}</div></div>
        `}catch{document.getElementById("operatorQueueStats").innerHTML=`<div class="${T}">${e("operators.queueUnavailable")}</div>`}}function Hs(){document.getElementById("operatorModalTitle").textContent=e("operators.newOperatorTitle"),document.getElementById("editOperatorId").value="",document.getElementById("operatorName").value="",document.getElementById("operatorExtension").value="",document.getElementById("operatorSkills").value="",document.getElementById("operatorShiftStart").value="09:00",document.getElementById("operatorShiftEnd").value="18:00",document.getElementById("operatorModal").classList.add("show")}async function qs(t){try{const s=((await u("/operators")).operators||[]).find(o=>o.id===t);if(!s){l(e("operators.notFound"),"error");return}document.getElementById("operatorModalTitle").textContent=e("operators.editOperatorTitle"),document.getElementById("editOperatorId").value=t,document.getElementById("operatorName").value=s.name||"",document.getElementById("operatorExtension").value=s.extension||"",document.getElementById("operatorSkills").value=(s.skills||[]).join(", "),document.getElementById("operatorShiftStart").value=s.shift_start||"09:00",document.getElementById("operatorShiftEnd").value=s.shift_end||"18:00",document.getElementById("operatorModal").classList.add("show")}catch(a){l(e("operators.loadFailed",{error:a.message}),"error")}}async function Us(){const t=document.getElementById("editOperatorId").value,a=document.getElementById("operatorName").value.trim(),s=document.getElementById("operatorExtension").value.trim(),o=document.getElementById("operatorSkills").value.trim(),n=o?o.split(",").map(p=>p.trim()).filter(Boolean):[],r=document.getElementById("operatorShiftStart").value,c=document.getElementById("operatorShiftEnd").value;if(!a||!s){l(e("operators.nameRequired"),"error");return}try{t?(await u(`/operators/${t}`,{method:"PATCH",body:JSON.stringify({name:a,extension:s,skills:n,shift_start:r,shift_end:c})}),l(e("operators.operatorUpdated"))):(await u("/operators",{method:"POST",body:JSON.stringify({name:a,extension:s,skills:n,shift_start:r,shift_end:c})}),l(e("operators.operatorCreated"))),U("operatorModal"),ie()}catch(p){l(e("operators.saveFailed",{error:p.message}),"error")}}async function Vs(t,a){if(a)try{await u(`/operators/${t}/status`,{method:"PATCH",body:JSON.stringify({status:a})}),l(e("operators.statusChanged",{status:a})),ie()}catch(s){l(e("operators.statusFailed",{error:s.message}),"error")}}async function js(t,a){if(confirm(e("operators.deactivateConfirm",{name:a})))try{await u(`/operators/${t}`,{method:"DELETE"}),l(e("operators.operatorDeactivated")),ie()}catch(s){l(e("operators.deactivateFailed",{error:s.message}),"error")}}function Js(){q("operators",()=>{ie(),We(),vt(()=>{ie(),We()},1e4)})}window._pages=window._pages||{};window._pages.operators={loadOperators:ie,loadQueueStatus:We,showCreateOperator:Hs,editOperator:qs,saveOperator:Us,changeOperatorStatus:Vs,deactivateOperator:js};async function Ct(){const t=document.getElementById("systemInfo");t.innerHTML=`<div class="${C}"><div class="spinner"></div></div>`;try{const[a,s]=await Promise.all([fetch("/health").then(n=>n.json()),fetch("/health/ready").then(n=>n.json()).catch(()=>null)]);let o=`<div class="overflow-x-auto"><table class="${E}">
            <tr class="${x}"><td class="${i}">${e("settings.status")}</td><td class="${i}"><span class="${B}">${a.status}</span></td></tr>
            <tr class="${x}"><td class="${i}">${e("settings.activeCalls")}</td><td class="${i}">${a.active_calls}</td></tr>
            <tr class="${x}"><td class="${i}">${e("settings.redis")}</td><td class="${i}"><span class="${a.redis==="connected"?B:A}">${a.redis}</span></td></tr>
        `;s&&(s.store_api&&(o+=`<tr class="${x}"><td class="${i}">${e("settings.storeAPI")}</td><td class="${i}"><span class="${s.store_api==="reachable"?B:A}">${s.store_api}</span></td></tr>`),s.claude_api&&(o+=`<tr class="${x}"><td class="${i}">${e("settings.claudeAPI")}</td><td class="${i}"><span class="${s.claude_api==="reachable"?B:A}">${s.claude_api}</span></td></tr>`),s.google_stt&&(o+=`<tr class="${x}"><td class="${i}">${e("settings.googleSTT")}</td><td class="${i}"><span class="${s.google_stt==="credentials_present"?B:N}">${s.google_stt}</span></td></tr>`),s.tts_engine&&(o+=`<tr class="${x}"><td class="${i}">${e("settings.ttsEngine")}</td><td class="${i}"><span class="${s.tts_engine==="initialized"?B:N}">${s.tts_engine}</span></td></tr>`)),o+="</table></div>",t.innerHTML=o}catch(a){t.innerHTML=`<div class="${T}">${e("settings.failedToLoad",{error:d(a.message)})}
            <br><button class="${_} ${w} mt-2" onclick="window._pages.monitoring.loadSettings()">${e("common.retry")}</button></div>`}}async function Ks(){const t=document.getElementById("extendedStatus");t.innerHTML=`<div class="${C}"><div class="spinner"></div></div>`;try{const a=await u("/admin/system-status"),s=Math.floor(a.uptime_seconds/3600),o=Math.floor(a.uptime_seconds%3600/60);let n=`<div class="overflow-x-auto"><table class="${E}">`;if(n+=`<tr class="${x}"><td class="${i}">${e("settings.extVersion")}</td><td class="${i}">${d(a.version||"unknown")}</td></tr>`,n+=`<tr class="${x}"><td class="${i}">${e("settings.uptime")}</td><td class="${i}">${e("settings.uptimeValue",{hours:s,minutes:o})}</td></tr>`,a.postgres_db_size_bytes){const r=(a.postgres_db_size_bytes/1048576).toFixed(1);n+=`<tr class="${x}"><td class="${i}">${e("settings.pgDbSize")}</td><td class="${i}">${r} MB</td></tr>`}if(a.postgres_connections!==void 0&&(n+=`<tr class="${x}"><td class="${i}">${e("settings.pgConnections")}</td><td class="${i}">${a.postgres_connections}</td></tr>`),a.redis_used_memory&&(n+=`<tr class="${x}"><td class="${i}">${e("settings.redisMemory")}</td><td class="${i}">${d(a.redis_used_memory)}</td></tr>`),n+=`<tr class="${x}"><td class="${i}">${e("settings.celeryWorkers")}</td><td class="${i}"><span class="${a.celery_workers_online>0?B:A}">${a.celery_workers_online}</span></td></tr>`,a.last_backup){const r=(a.last_backup.size_bytes/1048576).toFixed(1);n+=`<tr class="${x}"><td class="${i}">${e("settings.lastBackup")}</td><td class="${i}">${d(a.last_backup.file)} (${r} MB, ${d(a.last_backup.modified)})</td></tr>`}n+="</table></div>",t.innerHTML=n}catch(a){t.innerHTML=`<div class="${T}">${e("settings.extFailed",{error:d(a.message)})}</div>`}}function zs(){q("monitoring",()=>Ct())}window._pages=window._pages||{};window._pages.monitoring={loadSettings:Ct,loadSystemStatus:Ks};let D=null;async function Ws(){if(confirm(e("settings.reloadConfirm")))try{const t=await u("/admin/config/reload",{method:"POST"});let a=e("settings.configReloaded");if(t.changes)for(const[s,o]of Object.entries(t.changes))a+=`${s}: ${o}
`;l(a,"success")}catch(t){l(e("settings.reloadFailed",{error:t.message}),"error")}}async function pe(){const t=document.getElementById("llmProvidersContainer"),a=document.getElementById("llmTasksContainer");t.innerHTML=`<div class="${C}"><div class="spinner"></div></div>`,a.innerHTML="";try{const[s,o]=await Promise.all([u("/admin/llm/config"),u("/admin/llm/providers")]);D=s.config;const n={};for(const r of o.providers)n[r.key]=r;Qs(D,n),It(D)}catch(s){t.innerHTML=`<div class="${T}">${e("settings.llmLoadFailed",{error:d(s.message)})}</div>`}}function Qs(t,a){const s=document.getElementById("llmProvidersContainer"),o=t.providers||{};let n=`<div class="overflow-x-auto"><table class="${E}">
        <thead><tr>
            <th class="${y}">${e("settings.llmProvider")}</th>
            <th class="${y}">${e("settings.llmType")}</th>
            <th class="${y}">${e("settings.llmModel")}</th>
            <th class="${y}">${e("settings.llmApiKey")}</th>
            <th class="${y}">${e("settings.llmEnabled")}</th>
            <th class="${y}">${e("settings.llmHealth")}</th>
            <th class="${y}">${e("settings.llmActions")}</th>
        </tr></thead><tbody>`;for(const[r,c]of Object.entries(o)){const p=a[r]||{},$=c.enabled?"checked":"",m=p.healthy===!0?`<span class="${B}">OK</span>`:p.healthy===!1?`<span class="${A}">DOWN</span>`:`<span class="${L}">—</span>`,f=c.api_key_set?`<span class="${B}">set</span>`:`<span class="${N}">missing</span>`;n+=`<tr class="${x}">
            <td class="${i}"><strong>${d(r)}</strong></td>
            <td class="${i}">${d(c.type||"")}</td>
            <td class="${i}"><input type="text" value="${d(c.model||"")}" class="text-xs font-mono bg-transparent border border-neutral-300 dark:border-neutral-700 rounded px-1.5 py-0.5 w-48 focus:outline-none focus:border-blue-500" onchange="window._pages.configuration.updateLLMModel('${d(r)}', this.value)"></td>
            <td class="${i}">${f}</td>
            <td class="${i}"><input type="checkbox" ${$} onchange="window._pages.configuration.toggleLLMProvider('${d(r)}', this.checked)"></td>
            <td class="${i}">${m}</td>
            <td class="${i}"><button class="${_} ${w}" onclick="window._pages.configuration.testLLMProvider('${d(r)}')">${e("settings.llmTest")}</button></td>
        </tr>`}n+=`<tr id="llm-add-row" style="display:none" class="${x}">
            <td class="${i}"><span id="llm-add-key-preview" class="text-xs font-mono text-neutral-400">—</span></td>
            <td class="${i}"><select id="llm-add-type" class="${De}" onchange="window._pages.configuration.onAddTypeChange(this.value)">
                <option value="anthropic">anthropic</option>
                <option value="openai">openai</option>
                <option value="deepseek">deepseek</option>
                <option value="gemini">gemini</option>
            </select></td>
            <td class="${i}"><input id="llm-add-model" type="text" placeholder="claude-opus-4-20250115" class="text-xs font-mono bg-transparent border border-neutral-300 dark:border-neutral-700 rounded px-1.5 py-0.5 w-48 focus:outline-none focus:border-blue-500" oninput="window._pages.configuration.onAddModelInput()"></td>
            <td class="${i}"><span id="llm-add-env-preview" class="text-xs font-mono text-neutral-500">ANTHROPIC_API_KEY</span></td>
            <td colspan="3" class="${i}">
                <button class="${_} ${w}" onclick="window._pages.configuration.saveNewProvider()">${e("common.save")}</button>
                <button class="${w} ml-1 text-neutral-500" onclick="document.getElementById('llm-add-row').style.display='none'">${e("common.cancel")}</button>
            </td>
        </tr>`,n+="</tbody></table></div>",n+=`<button class="${_} ${w} mt-2" onclick="document.getElementById('llm-add-row').style.display=''">${e("settings.llmAddProvider")}</button>`,s.innerHTML=n}function Gs(t){const a=`settings.llmTaskDesc_${t}`,s=`settings.llmTaskRec_${t}`,o=e(a),n=e(s);return o===a?"":`<span class="relative group ml-1 cursor-help">
        <span class="inline-flex items-center justify-center w-4 h-4 rounded-full border border-neutral-400 dark:border-neutral-500 text-neutral-400 dark:text-neutral-500 text-[10px] font-bold leading-none">?</span>
        <span class="pointer-events-none absolute z-50 left-5 -top-1 w-64 p-2 rounded shadow-lg border text-xs bg-white dark:bg-neutral-800 text-neutral-700 dark:text-neutral-200 border-neutral-200 dark:border-neutral-700 opacity-0 group-hover:opacity-100 transition-opacity">
            <span class="block font-semibold mb-1">${d(o)}</span>
            ${n!==s?`<span class="block text-neutral-500 dark:text-neutral-400">${d(n)}</span>`:""}
        </span>
    </span>`}function It(t){const a=document.getElementById("llmTasksContainer"),s=t.tasks||{},o=Object.keys(t.providers||{});let n=`<h4 class="${Ee}">${e("settings.llmTaskRouting")}</h4>`;n+=`<div class="overflow-x-auto"><table class="${E}">
        <thead><tr>
            <th class="${y}">${e("settings.llmTask")}</th>
            <th class="${y}">${e("settings.llmPrimary")}</th>
            <th class="${y}">${e("settings.llmFallbacks")}</th>
        </tr></thead><tbody>`;for(const[r,c]of Object.entries(s)){const p=c.primary||"",$=c.fallbacks||[],m=o.map(g=>`<option value="${d(g)}" ${g===p?"selected":""}>${d(g)}</option>`).join("");let f='<div class="space-y-1">';$.length>0&&(f+='<ol class="list-none p-0 m-0 space-y-1">',$.forEach((g,v)=>{const b=v===0,I=v===$.length-1;f+=`<li class="flex items-center gap-1 text-xs">
                    <span class="inline-flex items-center justify-center w-4 h-4 rounded-full bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 text-[10px] font-bold flex-shrink-0">${v+1}</span>
                    <span class="font-mono text-neutral-700 dark:text-neutral-300">${d(g)}</span>
                    <span class="inline-flex gap-0.5 ml-auto flex-shrink-0">
                        <button class="px-0.5 text-neutral-400 hover:text-blue-600 disabled:opacity-30 disabled:cursor-default" ${b?"disabled":""} onclick="window._pages.configuration.moveFallback('${d(r)}', ${v}, -1)" title="${e("settings.llmFbMoveUp")}">&#9650;</button>
                        <button class="px-0.5 text-neutral-400 hover:text-blue-600 disabled:opacity-30 disabled:cursor-default" ${I?"disabled":""} onclick="window._pages.configuration.moveFallback('${d(r)}', ${v}, 1)" title="${e("settings.llmFbMoveDown")}">&#9660;</button>
                        <button class="px-0.5 text-neutral-400 hover:text-red-600" onclick="window._pages.configuration.removeFallback('${d(r)}', '${d(g)}')" title="${e("common.delete")}">&#10005;</button>
                    </span>
                </li>`}),f+="</ol>");const h=o.filter(g=>g!==p&&!$.includes(g));if(h.length>0){const g=h.map(v=>`<option value="${d(v)}">${d(v)}</option>`).join("");f+=`<div class="flex items-center gap-1 mt-1">
                <select id="fb-add-${d(r)}" class="text-xs bg-white dark:bg-neutral-800 text-neutral-800 dark:text-neutral-200 border border-neutral-300 dark:border-neutral-600 rounded px-1 py-0.5">
                    <option value="" disabled selected>${e("settings.llmFbSelect")}</option>
                    ${g}
                </select>
                <button class="text-xs text-blue-600 hover:text-blue-800 dark:text-blue-400" onclick="window._pages.configuration.addFallback('${d(r)}')">+ ${e("common.add")}</button>
            </div>`}f+="</div>",n+=`<tr class="${x}">
            <td class="${i}"><strong>${d(r)}</strong>${Gs(r)}</td>
            <td class="${i}"><select class="${De}" onchange="window._pages.configuration.updateTaskRoute('${d(r)}', this.value)">${m}</select></td>
            <td class="${i}">${f}</td>
        </tr>`}n+="</tbody></table></div>",a.innerHTML=n}const Qe={anthropic:{api_key_env:"ANTHROPIC_API_KEY"},openai:{api_key_env:"OPENAI_API_KEY",base_url:"https://api.openai.com/v1"},deepseek:{api_key_env:"DEEPSEEK_API_KEY",base_url:"https://api.deepseek.com/v1"},gemini:{api_key_env:"GEMINI_API_KEY",base_url:"https://generativelanguage.googleapis.com/v1beta/openai"}};function Lt(){const t=document.getElementById("llm-add-type").value,a=document.getElementById("llm-add-model").value.trim();if(!a)return"";const s=a.replace(/^claude-/,"").replace(/^gpt-/,"gpt").split("-")[0]||a;return`${t}-${s}`}function At(){const t=Lt(),a=document.getElementById("llm-add-type").value,s=Qe[a]||{};document.getElementById("llm-add-key-preview").textContent=t||"—",document.getElementById("llm-add-env-preview").textContent=s.api_key_env||""}function Ys(){At()}function Xs(){At()}async function Zs(){var c;const t=document.getElementById("llm-add-type").value,a=document.getElementById("llm-add-model").value.trim(),s=Lt(),o=((c=Qe[t])==null?void 0:c.api_key_env)||"";if(!a){l(e("settings.llmAddFillRequired"),"error");return}const n={type:t,model:a,api_key_env:o,enabled:!1},r=Qe[t];r!=null&&r.base_url&&(n.base_url=r.base_url);try{await u("/admin/llm/config",{method:"PATCH",body:JSON.stringify({providers:{[s]:n}})}),l(e("settings.llmProviderAdded",{key:s}),"success"),pe()}catch(p){l(e("settings.llmConfigFailed",{error:p.message}),"error")}}async function eo(t,a){if(a.trim())try{await u("/admin/llm/config",{method:"PATCH",body:JSON.stringify({providers:{[t]:{model:a.trim()}}})}),l(e("settings.llmModelUpdated",{key:t,model:a.trim()}),"success")}catch(s){l(e("settings.llmConfigFailed",{error:s.message}),"error"),pe()}}async function to(t,a){try{await u("/admin/llm/config",{method:"PATCH",body:JSON.stringify({providers:{[t]:{enabled:a}}})}),l(e("settings.llmProviderToggled",{key:t,state:a?"ON":"OFF"}),"success")}catch(s){l(e("settings.llmConfigFailed",{error:s.message}),"error"),pe()}}async function ao(t,a){try{await u("/admin/llm/config",{method:"PATCH",body:JSON.stringify({tasks:{[t]:{primary:a,fallbacks:[]}}})}),l(e("settings.llmRouteUpdated",{task:t,provider:a}),"success"),pe()}catch(s){l(e("settings.llmConfigFailed",{error:s.message}),"error")}}async function tt(t,a){try{await u("/admin/llm/config",{method:"PATCH",body:JSON.stringify({tasks:{[t]:{fallbacks:a}}})}),D&&D.tasks&&D.tasks[t]&&(D.tasks[t].fallbacks=a),It(D),l(e("settings.llmFallbacksUpdated",{task:t,count:a.length}),"success")}catch(s){l(e("settings.llmConfigFailed",{error:s.message}),"error")}}async function so(t){var n,r;const a=document.getElementById(`fb-add-${t}`);if(!a)return;const s=a.value;if(!s)return;const o=(((r=(n=D==null?void 0:D.tasks)==null?void 0:n[t])==null?void 0:r.fallbacks)||[]).slice();o.includes(s)||(o.push(s),await tt(t,o))}async function oo(t,a){var o,n;const s=(((n=(o=D==null?void 0:D.tasks)==null?void 0:o[t])==null?void 0:n.fallbacks)||[]).filter(r=>r!==a);await tt(t,s)}async function ro(t,a,s){var r,c;const o=(((c=(r=D==null?void 0:D.tasks)==null?void 0:r[t])==null?void 0:c.fallbacks)||[]).slice(),n=a+s;n<0||n>=o.length||([o[a],o[n]]=[o[n],o[a]],await tt(t,o))}async function no(t){l(e("settings.llmTesting",{key:t}),"info");try{const a=await u(`/admin/llm/providers/${encodeURIComponent(t)}/test`,{method:"POST"});a.success?l(e("settings.llmTestSuccess",{key:t,latency:a.latency_ms}),"success"):l(e("settings.llmTestFailed",{key:t,error:a.error||"Unknown"}),"error")}catch(a){l(e("settings.llmTestFailed",{key:t,error:a.message}),"error")}}function lo(){q("configuration",pe)}window._pages=window._pages||{};window._pages.configuration={reloadConfig:Ws,loadLLMConfig:pe,toggleLLMProvider:to,updateLLMModel:eo,onAddTypeChange:Ys,onAddModelInput:Xs,saveNewProvider:Zs,updateTaskRoute:ao,addFallback:so,removeFallback:oo,moveFallback:ro,testLLMProvider:no};async function at(){const t=document.getElementById("telegramConfigContainer");t.innerHTML=`<div class="${C}"><div class="spinner"></div></div>`;try{const a=await u("/admin/notifications/telegram");let s;a.token_set?(s=`<span class="${B}">${e("settings.telegramTokenSet")}</span>`,a.token_hint&&(s+=` <span class="text-xs text-neutral-400 font-mono">...${d(a.token_hint)}</span>`)):s=`<span class="${N}">${e("settings.telegramTokenMissing")}</span>`;const o=a.source==="redis"?"Redis":a.source==="env"?"ENV":"—";let n=`<div class="space-y-3">
            <div class="flex items-center gap-2 text-sm">
                <span class="text-neutral-500 dark:text-neutral-400">${e("settings.telegramStatus")}:</span>
                ${s}
                <span class="${L}">${o}</span>
            </div>
            <div>
                <label class="block text-xs font-medium text-neutral-600 dark:text-neutral-400 mb-1">${e("settings.telegramBotToken")}</label>
                <input id="tgBotToken" type="password" placeholder="${e("settings.telegramBotTokenPlaceholder")}" class="w-full text-sm font-mono bg-white dark:bg-neutral-800 text-neutral-800 dark:text-neutral-200 border border-neutral-300 dark:border-neutral-600 rounded px-2 py-1.5 focus:outline-none focus:border-blue-500">
            </div>
            <div>
                <label class="block text-xs font-medium text-neutral-600 dark:text-neutral-400 mb-1">${e("settings.telegramChatId")}</label>
                <input id="tgChatId" type="text" value="${d(a.chat_id||"")}" placeholder="${e("settings.telegramChatIdPlaceholder")}" class="w-full text-sm font-mono bg-white dark:bg-neutral-800 text-neutral-800 dark:text-neutral-200 border border-neutral-300 dark:border-neutral-600 rounded px-2 py-1.5 focus:outline-none focus:border-blue-500">
            </div>
            <div class="flex gap-2">
                <button class="${_} ${w}" onclick="window._pages.notifications.saveTelegramConfig()">${e("common.save")}</button>
                <button class="${w} border border-neutral-300 dark:border-neutral-600 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-800" onclick="window._pages.notifications.testTelegram()">${e("settings.telegramTestBtn")}</button>
            </div>
        </div>`;t.innerHTML=n}catch(a){t.innerHTML=`<div class="${T}">${e("settings.telegramLoadFailed",{error:d(a.message)})}</div>`}}async function io(){var o,n,r,c;const t=((n=(o=document.getElementById("tgBotToken"))==null?void 0:o.value)==null?void 0:n.trim())||"",a=((c=(r=document.getElementById("tgChatId"))==null?void 0:r.value)==null?void 0:c.trim())||"";if(!t&&!a){l(e("settings.telegramFillFields"),"error");return}const s={};t&&(s.bot_token=t),a&&(s.chat_id=a);try{await u("/admin/notifications/telegram",{method:"PATCH",body:JSON.stringify(s)}),l(e("settings.telegramSaved"),"success"),at()}catch(p){l(e("settings.telegramSaveFailed",{error:p.message}),"error")}}async function co(){l(e("settings.telegramTesting"),"info");try{const t=await u("/admin/notifications/telegram/test",{method:"POST"});t.success?l(e("settings.telegramTestSuccess",{latency:t.latency_ms}),"success"):l(e("settings.telegramTestFailed",{error:t.error||"Unknown"}),"error")}catch(t){l(e("settings.telegramTestFailed",{error:t.message}),"error")}}function uo(){q("notifications",at)}window._pages=window._pages||{};window._pages.notifications={loadTelegramConfig:at,saveTelegramConfig:io,testTelegram:co};async function we(){const t=document.getElementById("usersContainer");t.innerHTML=`<div class="${C}"><div class="spinner"></div></div>`;try{const s=(await u("/admin/users")).users||[];if(s.length===0){t.innerHTML=`<div class="${T}">${e("users.noUsers")}</div>`;return}t.innerHTML=`
            <div class="overflow-x-auto"><table class="${E}" id="usersTable"><thead><tr><th class="${k}" data-sortable>${e("users.username")}</th><th class="${k}" data-sortable>${e("users.role")}</th><th class="${k}" data-sortable>${e("users.activeCol")}</th><th class="${k}" data-sortable>${e("users.lastLogin")}</th><th class="${y}">${e("users.actionsCol")}</th></tr></thead><tbody>
            ${s.map(o=>`
                <tr class="${x}">
                    <td class="${i}">${d(o.username)}</td>
                    <td class="${i}"><span class="${P}">${d(o.role)}</span></td>
                    <td class="${i}">${o.is_active?`<span class="${B}">${e("common.yes")}</span>`:`<span class="${A}">${e("common.no")}</span>`}</td>
                    <td class="${i}" data-sort-value="${o.last_login_at||""}">${V(o.last_login_at)}</td>
                    <td class="${i}">
                        <div class="flex flex-wrap items-center gap-1">
                            <select onchange="window._pages.users.changeRole('${o.id}', this.value)" class="${De}">
                                <option value="">${e("users.changeRole")}</option>
                                <option value="admin">${e("users.roleAdmin")}</option>
                                <option value="analyst">${e("users.roleAnalyst")}</option>
                                <option value="operator">${e("users.roleOperator")}</option>
                            </select>
                            <button class="${G} ${w}" onclick="window._pages.users.toggleUser('${o.id}', ${o.is_active})">${o.is_active?e("common.deactivate"):e("common.activate")}</button>
                            <button class="${Xt} ${w}" onclick="window._pages.users.resetUserPassword('${o.id}', '${d(o.username)}')">${e("users.resetPwd")}</button>
                        </div>
                    </td>
                </tr>
            `).join("")}
            </tbody></table></div>
        `,H("usersTable")}catch(a){t.innerHTML=`<div class="${T}">${e("users.failedToLoad",{error:d(a.message)})}</div>`}}function po(){document.getElementById("newUsername").value="",document.getElementById("newPassword").value="",document.getElementById("newRole").value="operator",document.getElementById("createUserModal").classList.add("show")}async function mo(){const t=document.getElementById("newUsername").value.trim(),a=document.getElementById("newPassword").value,s=document.getElementById("newRole").value;if(!t||!a){l(e("users.usernameRequired"),"error");return}try{await u("/admin/users",{method:"POST",body:JSON.stringify({username:t,password:a,role:s})}),U("createUserModal"),l(e("users.userCreated")),we()}catch(o){l(e("users.createFailed",{error:o.message}),"error")}}async function go(t,a){if(a)try{await u(`/admin/users/${t}`,{method:"PATCH",body:JSON.stringify({role:a})}),l(e("users.roleUpdated")),we()}catch(s){l(e("users.roleFailed",{error:s.message}),"error")}}async function vo(t,a){try{await u(`/admin/users/${t}`,{method:"PATCH",body:JSON.stringify({is_active:!a})}),l(e(a?"users.userDeactivated":"users.userActivated")),we()}catch(s){l(e("users.toggleFailed",{error:s.message}),"error")}}async function fo(t,a){const s=prompt(e("users.newPasswordPrompt",{username:a}));if(s)try{await u(`/admin/users/${t}/reset-password`,{method:"POST",body:JSON.stringify({new_password:s})}),l(e("users.passwordReset"))}catch(o){l(e("users.resetFailed",{error:o.message}),"error")}}function $o(){q("users",()=>we())}window._pages=window._pages||{};window._pages.users={loadUsers:we,showCreateUser:po,createUser:mo,changeRole:go,toggleUser:vo,resetUserPassword:fo};async function Pt(t=0){const a=document.getElementById("auditContainer");a.innerHTML=`<div class="${C}"><div class="spinner"></div></div>`;const s=new URLSearchParams({limit:50,offset:t}),o=document.getElementById("auditDateFrom").value,n=document.getElementById("auditDateTo").value,r=document.getElementById("auditAction").value;o&&s.set("date_from",o),n&&s.set("date_to",n),r&&s.set("action",r);try{const c=await u(`/admin/audit-log?${s}`),p=c.entries||[];if(p.length===0){a.innerHTML=`<div class="${T}">${e("audit.noEntries")}</div>`,document.getElementById("auditPagination").innerHTML="";return}a.innerHTML=`
            <div class="overflow-x-auto"><table class="${E}" id="auditTable"><thead><tr><th class="${k}" data-sortable>${e("audit.date")}</th><th class="${k}" data-sortable>${e("audit.user")}</th><th class="${k}" data-sortable>${e("audit.action")}</th><th class="${k}" data-sortable>${e("audit.resource")}</th><th class="${y}">${e("audit.ip")}</th></tr></thead><tbody>
            ${p.map(f=>`
                <tr class="${x}">
                    <td class="${i}" data-sort-value="${f.created_at||""}">${V(f.created_at)}</td>
                    <td class="${i}">${d(f.username)||"-"}</td>
                    <td class="${i}"><span class="${P}">${d(f.action)}</span></td>
                    <td class="${i}">${d(f.resource_type||"")}${f.resource_id?"/"+d(f.resource_id):""}</td>
                    <td class="${i}">${d(f.ip_address)||"-"}</td>
                </tr>
            `).join("")}
            </tbody></table></div>
        `,H("auditTable");const $=Math.ceil(c.total/50),m=Math.floor(t/50);document.getElementById("auditPagination").innerHTML=Array.from({length:Math.min($,10)},(f,h)=>`<button class="${ae}${h===m?" active":""}" onclick="window._pages.audit.loadAuditLog(${h*50})">${h+1}</button>`).join("")}catch(c){a.innerHTML=`<div class="${T}">${e("audit.failedToLoad",{error:d(c.message)})}</div>`}}function ho(){q("audit",()=>Pt())}window._pages=window._pages||{};window._pages.audit={loadAuditLog:Pt};let z="brands",Ne=null,de="",Dt=null,Ie="";const ne=50;async function Ft(){const t=document.getElementById("vehiclesStats");t.innerHTML=`<div class="${C}"><div class="spinner"></div></div>`;try{const a=await u("/admin/vehicles/stats");a.source_path&&(t.dataset.lastSourcePath=a.source_path),t.innerHTML=`
            <div class="${F}"><div class="${M}">${a.brand_count??0}</div><div class="${R}">${e("vehicles.brands")}</div></div>
            <div class="${F}"><div class="${M}">${a.model_count??0}</div><div class="${R}">${e("vehicles.models")}</div></div>
            <div class="${F}"><div class="${M}">${a.kit_count??0}</div><div class="${R}">${e("vehicles.kits")}</div></div>
            <div class="${F}"><div class="${M}">${a.tire_size_count??0}</div><div class="${R}">${e("vehicles.tireSizes")}</div></div>
            <div class="${F}"><div class="${M}">${a.imported_at?V(a.imported_at):e("vehicles.neverImported")}</div><div class="${R}">${e("vehicles.lastImport")}</div></div>
        `}catch(a){t.innerHTML=`<div class="${T}">${e("vehicles.failedToLoad",{error:d(a.message)})}</div>`}}function st(){const t=document.getElementById("vehiclesBreadcrumb");if(z==="brands"){t.style.display="none";return}t.style.display="";let a=`<a href="#" class="${ct}" onclick="window._pages.vehicles.goToBrands()">${e("vehicles.brands")}</a>`;(z==="models"||z==="kits")&&(a+=` / <span>${d(de)}</span>`),z==="kits"&&(a+=` / <a href="#" class="${ct}" onclick="window._pages.vehicles.goToModels()">${e("vehicles.models")}</a>`,a+=` / <span>${d(Ie)}</span>`),t.innerHTML=a}async function Te(t=0){z="brands",st();const a=document.getElementById("vehiclesContainer");a.innerHTML=`<div class="${C}"><div class="spinner"></div></div>`;const s=new URLSearchParams({limit:ne,offset:t}),o=document.getElementById("vehiclesSearch").value.trim();o&&s.set("search",o);try{const n=await u(`/admin/vehicles/brands?${s}`),r=n.items||[];if(r.length===0){a.innerHTML=`<div class="${T}">${e("vehicles.noData")}</div>`,document.getElementById("vehiclesPagination").innerHTML="";return}a.innerHTML=`
            <div class="overflow-x-auto"><table class="${E}" id="brandsTable">
            <thead><tr>
                <th class="${k}" data-sortable>${e("vehicles.brand")}</th>
                <th class="${k}" data-sortable>${e("vehicles.models")}</th>
            </tr></thead>
            <tbody>
            ${r.map(c=>`
                <tr class="${x} cursor-pointer" onclick="window._pages.vehicles.selectBrand(${c.id}, '${d(c.name).replace(/'/g,"\\'")}')">
                    <td class="${i}">${d(c.name)}</td>
                    <td class="${i}">${c.model_count}</td>
                </tr>
            `).join("")}
            </tbody></table></div>
        `,H("brandsTable"),rt(n.total,t,"loadBrands")}catch(n){a.innerHTML=`<div class="${T}">${e("vehicles.failedToLoad",{error:d(n.message)})}</div>`}}async function ke(t,a,s=0){Ne=t,de=a||de,z="models",st();const o=document.getElementById("vehiclesContainer");o.innerHTML=`<div class="${C}"><div class="spinner"></div></div>`;const n=new URLSearchParams({limit:ne,offset:s}),r=document.getElementById("vehiclesSearch").value.trim();r&&n.set("search",r);try{const c=await u(`/admin/vehicles/brands/${t}/models?${n}`),p=c.items||[];if(p.length===0){o.innerHTML=`
                <button class="${G} mb-3" onclick="window._pages.vehicles.goToBrands()">${e("vehicles.back")}</button>
                <div class="${T}">${e("vehicles.noData")}</div>
            `,document.getElementById("vehiclesPagination").innerHTML="";return}o.innerHTML=`
            <button class="${G} mb-3" onclick="window._pages.vehicles.goToBrands()">${e("vehicles.back")}</button>
            <div class="overflow-x-auto"><table class="${E}" id="modelsTable">
            <thead><tr>
                <th class="${k}" data-sortable>${e("vehicles.model")}</th>
                <th class="${k}" data-sortable>${e("vehicles.kits")}</th>
            </tr></thead>
            <tbody>
            ${p.map($=>`
                <tr class="${x} cursor-pointer" onclick="window._pages.vehicles.selectModel(${$.id}, '${d($.name).replace(/'/g,"\\'")}')">
                    <td class="${i}">${d($.name)}</td>
                    <td class="${i}">${$.kit_count}</td>
                </tr>
            `).join("")}
            </tbody></table></div>
        `,H("modelsTable"),rt(c.total,s,"loadModelsPage")}catch(c){o.innerHTML=`<div class="${T}">${e("vehicles.failedToLoad",{error:d(c.message)})}</div>`}}async function ot(t,a,s=0){Dt=t,Ie=a||Ie,z="kits",st();const o=document.getElementById("vehiclesContainer");o.innerHTML=`<div class="${C}"><div class="spinner"></div></div>`;const n=new URLSearchParams({limit:ne,offset:s});try{const r=await u(`/admin/vehicles/models/${t}/kits?${n}`),c=r.items||[];if(c.length===0){o.innerHTML=`
                <button class="${G} mb-3" onclick="window._pages.vehicles.goToModels()">${e("vehicles.back")}</button>
                <div class="${T}">${e("vehicles.noData")}</div>
            `,document.getElementById("vehiclesPagination").innerHTML="";return}o.innerHTML=`
            <button class="${G} mb-3" onclick="window._pages.vehicles.goToModels()">${e("vehicles.back")}</button>
            <div class="overflow-x-auto"><table class="${E}" id="kitsTable">
            <thead><tr>
                <th class="${k}" data-sortable>${e("vehicles.year")}</th>
                <th class="${k}" data-sortable>${e("vehicles.trim")}</th>
                <th class="${k}" data-sortable>${e("vehicles.pcd")}</th>
                <th class="${k}" data-sortable>${e("vehicles.bolts")}</th>
                <th class="${k}" data-sortable>${e("vehicles.dia")}</th>
                <th class="${k}" data-sortable>${e("vehicles.tireSizes")}</th>
                <th class="${y}"></th>
            </tr></thead>
            <tbody>
            ${c.map(p=>`
                <tr class="${x}">
                    <td class="${i}">${p.year}</td>
                    <td class="${i}">${d(p.name||"-")}</td>
                    <td class="${i}">${p.pcd??"-"}</td>
                    <td class="${i}" data-sort-value="${p.bolt_count??0}">${p.bolt_count??"-"}${p.bolt_size?" / "+d(p.bolt_size):""}</td>
                    <td class="${i}">${p.dia??"-"}</td>
                    <td class="${i}">${p.tire_size_count}</td>
                    <td class="${i}">
                        <button class="${_} ${w}" onclick="window._pages.vehicles.toggleTireSizes(this, ${p.id})">${e("vehicles.tireSizes")}</button>
                    </td>
                </tr>
                <tr class="tire-sizes-row" id="tire-sizes-${p.id}" style="display:none">
                    <td colspan="7" class="${i} bg-neutral-50 dark:bg-neutral-800/50"></td>
                </tr>
            `).join("")}
            </tbody></table></div>
        `,H("kitsTable"),rt(r.total,s,"loadKitsPage")}catch(r){o.innerHTML=`<div class="${T}">${e("vehicles.failedToLoad",{error:d(r.message)})}</div>`}}async function yo(t,a){const s=document.getElementById(`tire-sizes-${a}`);if(!s)return;if(s.style.display!=="none"){s.style.display="none";return}s.style.display="";const o=s.querySelector("td");o.innerHTML=`<div class="${C}"><div class="spinner"></div></div>`;try{const r=(await u(`/admin/vehicles/kits/${a}/tire-sizes`)).items||[];if(r.length===0){o.innerHTML=`<div class="${T}">${e("vehicles.noData")}</div>`;return}const c=m=>e(m===1?"vehicles.stock":"vehicles.tuning"),p=m=>m===1?B:P,$=m=>e(m===1?"vehicles.front":m===2?"vehicles.rear":"vehicles.all");o.innerHTML=`
            <table class="${E}">
            <thead><tr>
                <th class="${y}">${e("vehicles.size")}</th>
                <th class="${y}">${e("vehicles.type")}</th>
                <th class="${y}">${e("vehicles.axle")}</th>
            </tr></thead>
            <tbody>
            ${r.map(m=>`
                <tr class="${x}">
                    <td class="${i}">${m.width}/${m.height} R${m.diameter}</td>
                    <td class="${i}"><span class="${p(m.type)}">${c(m.type)}</span></td>
                    <td class="${i}">${$(m.axle)}</td>
                </tr>
            `).join("")}
            </tbody></table>
        `}catch(n){o.innerHTML=`<div class="${T}">${e("vehicles.failedToLoad",{error:d(n.message)})}</div>`}}function rt(t,a,s){const o=Math.ceil(t/ne),n=Math.floor(a/ne);document.getElementById("vehiclesPagination").innerHTML=Array.from({length:Math.min(o,10)},(r,c)=>`<button class="${ae}${c===n?" active":""}" onclick="window._pages.vehicles.${s}(${c*ne})">${c+1}</button>`).join("")}function bo(t,a){document.getElementById("vehiclesSearch").value="",ke(t,a)}function wo(t,a){document.getElementById("vehiclesSearch").value="",ot(t,a)}function To(){document.getElementById("vehiclesSearch").value="",Te()}function ko(){document.getElementById("vehiclesSearch").value="",ke(Ne,de)}function xo(t){ke(Ne,de,t)}function _o(t){ot(Dt,Ie,t)}function So(){z==="brands"?Te():z==="models"&&ke(Ne,de)}function Bo(){var o;const t=document.getElementById("vehiclesStats"),a=(o=t==null?void 0:t.dataset)==null?void 0:o.lastSourcePath,s=document.getElementById("vehicleImportPath");s&&a&&(s.value=a),document.getElementById("vehicleImportModal").classList.add("show")}async function Eo(){const t=document.getElementById("vehicleImportPath").value.trim();if(!t){l(e("vehicles.importPathRequired"),"error");return}const a=document.getElementById("vehicleImportBtn"),s=a.textContent;a.disabled=!0,a.textContent=e("common.loading");try{const o=await u("/admin/vehicles/import",{method:"POST",body:JSON.stringify({csv_dir:t})});U("vehicleImportModal"),l(e("vehicles.importSuccess",{brands:o.brand_count??0,models:o.model_count??0,kits:o.kit_count??0,tireSizes:o.tire_size_count??0})),Ft(),Te()}catch(o){l(e("vehicles.importFailed",{error:d(o.message)}),"error")}finally{a.disabled=!1,a.textContent=s}}function Co(){q("vehicles",()=>{Ft(),Te()})}window._pages=window._pages||{};window._pages.vehicles={loadBrands:Te,loadModels:ke,loadKits:ot,loadModelsPage:xo,loadKitsPage:_o,selectBrand:bo,selectModel:wo,goToBrands:To,goToModels:ko,toggleTireSizes:yo,search:So,openImportModal:Bo,runImport:Eo};Ot();ia();pt();ma();wa();Oa();ys();Fs();Ns();Js();zs();lo();uo();$o();ho();Co();Kt(t=>{const a=localStorage.getItem("admin_active_page")||"dashboard";(t.type==="call:started"||t.type==="call:ended"||t.type==="call:transferred")&&(a==="dashboard"&&window._pages.dashboard.loadDashboard(),a==="calls"&&window._pages.calls.loadCalls(ba())),t.type==="operator:status_changed"&&a==="operators"&&(window._pages.operators.loadOperators(),window._pages.operators.loadQueueStatus()),t.type==="dashboard:metrics_updated"&&a==="dashboard"&&window._pages.dashboard.loadDashboard()});setInterval(ht,6e4);let ee=localStorage.getItem("admin_active_page");ee==="training"&&(ee="prompts",localStorage.setItem("admin_active_page",ee));ee==="settings"&&(ee="monitoring",localStorage.setItem("admin_active_page",ee));te()&&(ht(),te()&&(document.getElementById("loginContainer").style.display="none",document.getElementById("app").style.display="block",ft(),Ye(),Ae(ee||"dashboard")));document.getElementById("loginPassword").addEventListener("keypress",t=>{t.key==="Enter"&&$t()});document.addEventListener("keydown",t=>{t.key==="Escape"&&document.querySelectorAll(".modal-overlay.show").forEach(a=>a.classList.remove("show"))});function Io(){document.getElementById("sidebar").classList.toggle("open")}document.querySelectorAll(".sidebar a").forEach(t=>{t.addEventListener("click",()=>{window.innerWidth<=768&&document.getElementById("sidebar").classList.remove("open")})});window.addEventListener("langchange",()=>{ca(),Qt();const t=localStorage.getItem("admin_active_page")||"dashboard";Ae(t)});window._app={login:$t,logout:Ze,showPage:Ae,closeModal:U,toggleSidebar:Io,toggleTheme:da,toggleLang:Nt,toggleSidebarGroup:Gt};
