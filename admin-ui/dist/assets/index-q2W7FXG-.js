(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function a(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=a(r);fetch(r.href,o)}})();function d(t,s="success"){const a=document.getElementById("toastContainer"),n=document.createElement("div"),r=s==="error"?"bg-red-600":"bg-emerald-600";n.className=`toast px-4 py-2.5 rounded-lg text-sm text-white shadow-lg ${r}`,n.textContent=t,a.appendChild(n),setTimeout(()=>n.remove(),4e3)}const ca={"common.retry":"Повторить","common.save":"Сохранить","common.cancel":"Отмена","common.add":"Добавить","common.create":"Создать","common.edit":"Редактировать","common.delete":"Удалить","common.filter":"Фильтровать","common.yes":"Да","common.no":"Нет","common.loading":"Загрузка...","common.failedToLoad":"Ошибка загрузки: {error}","common.activate":"Активировать","common.deactivate":"Деактивировать","common.select":"Выбрать","common.pageInfo":"Стр. {current} из {total}","common.all":"Все","common.allStatuses":"Все статусы","common.searchPlaceholder":"Поиск...","common.showing":"Показано: {shown} из {total}","common.filters":"Фильтры","common.actions":"Действия","login.title":"Call Center AI","login.error":"Неверные учётные данные","login.username":"Имя пользователя","login.password":"Пароль","login.submit":"Войти","nav.dashboard":"Дашборд","nav.calls":"Журнал звонков","nav.training":"Обучение агента","nav.operators":"Операторы","nav.system":"Система","nav.users":"Пользователи","nav.prompts":"Промпты","nav.knowledge":"База знаний","nav.scenarios":"Сценарии","nav.tools":"Инструменты","nav.monitoring":"Мониторинг","nav.configuration":"Конфигурация","nav.tenants":"Сети","nav.notifications":"Уведомления","nav.audit":"Аудит","nav.logout":"Выход","theme.dark":"Тёмная","theme.light":"Светлая","ws.live":"Онлайн","ws.reconnecting":"Переподключение...","ws.offline":"Оффлайн","api.sessionExpired":"Сессия истекла. Пожалуйста, войдите снова.","api.unauthorized":"Не авторизован","api.requestTimeout":"Превышено время ожидания ответа сервера","api.networkError":"Нет соединения с сервером","dashboard.breadcrumb":"Дашборд","dashboard.title":"Дашборд","dashboard.callsToday":"Звонков сегодня","dashboard.resolvedByBot":"Решено ботом","dashboard.transferred":"Переведено","dashboard.avgQuality":"Средн. качество","dashboard.costToday":"Стоимость сегодня","dashboard.exportCSV":"Экспорт CSV","dashboard.downloadPDF":"Скачать PDF","dashboard.grafana":"Grafana в реальном времени","dashboard.csvExported":"CSV экспортирован","dashboard.exportFailed":"Ошибка экспорта: {error}","dashboard.pdfDownloaded":"PDF-отчёт скачан","dashboard.pdfFailed":"Ошибка скачивания PDF: {error}","dashboard.failedToLoad":"Не удалось загрузить дашборд: {error}","dashboard.filterByNetwork":"Сеть:","dashboard.allNetworks":"Все сети","dashboard.noAnalyticsAccess":"У вас нет доступа к аналитике. Перейдите в доступный раздел через меню навигации.","calls.breadcrumb":"Журнал звонков","calls.title":"Журнал звонков","calls.allScenarios":"Все сценарии","calls.tireSearch":"Поиск шин","calls.availability":"Наличие","calls.order":"Заказ","calls.fitting":"Шиномонтаж","calls.consultation":"Консультация","calls.all":"Все","calls.transferred":"Переведено","calls.resolvedByBot":"Решено ботом","calls.searchPlaceholder":"Поиск в транскрипции...","calls.qualityBelow":"Качество ниже","calls.exportCSV":"Экспорт CSV","calls.csvExported":"CSV экспортирован","calls.exportFailed":"Ошибка экспорта: {error}","calls.noCalls":"Звонки не найдены","calls.failedToLoad":"Не удалось загрузить звонки: {error}","calls.date":"Дата","calls.caller":"Звонящий","calls.scenario":"Сценарий","calls.duration":"Длительность","calls.quality":"Качество","calls.cost":"Стоимость","calls.status":"Статус","calls.statusTransferred":"Переведён","calls.statusResolved":"Решён","calls.detailTitle":"Детали звонка","calls.detailCaller":"Звонящий:","calls.detailScenario":"Сценарий:","calls.detailDuration":"Длительность:","calls.detailQuality":"Качество:","calls.detailCost":"Стоимость:","calls.detailPrompt":"Промпт:","calls.qualityBreakdown":"Разбивка качества","calls.transcription":"Транскрипция","calls.noTranscription":"Транскрипция недоступна","calls.customer":"Клиент","calls.bot":"Бот","calls.toolCalls":"Вызовы инструментов","calls.toolName":"Инструмент","calls.toolSuccess":"Успех","calls.toolDuration":"Длительность","calls.downloadTranscript":"Скачать расшифровку","calls.transcriptDownloaded":"Расшифровка скачана","calls.transcriptFailed":"Ошибка скачивания: {error}","calls.failedToLoadDetail":"Не удалось загрузить детали звонка: {error}","prompts.breadcrumb":"Промпты","prompts.title":"Управление промптами","prompts.versions":"Версии","prompts.abTests":"A/B-тесты","prompts.newVersion":"+ Новая версия","prompts.noVersions":"Версии промптов не найдены","prompts.name":"Название","prompts.active":"Активный","prompts.activeLabel":"Активен","prompts.created":"Создан","prompts.action":"Действие","prompts.activateBtn":"Активировать","prompts.failedToLoad":"Не удалось загрузить промпты: {error}","prompts.createTitle":"Создание новой версии промпта","prompts.nameLabel":"Название","prompts.namePlaceholder":"напр. v2.0-improved-search","prompts.systemPromptLabel":"Системный промпт","prompts.systemPromptPlaceholder":"Введите текст системного промпта...","prompts.nameRequired":"Название и системный промпт обязательны","prompts.created_toast":"Версия промпта создана","prompts.createFailed":"Не удалось создать промпт: {error}","prompts.activateConfirm":"Активировать эту версию промпта? Все звонки будут использовать её.","prompts.activated":"Версия промпта активирована","prompts.activateFailed":"Не удалось активировать промпт: {error}","prompts.noABTests":"A/B-тесты не найдены","prompts.testName":"Тест","prompts.variantA":"Вариант A","prompts.variantB":"Вариант B","prompts.callsAB":"Звонки A/B","prompts.qualityAB":"Качество A/B","prompts.abStatus":"Статус","prompts.abAction":"Действие","prompts.stopBtn":"Остановить","prompts.stopConfirm":"Остановить этот A/B-тест?","prompts.stopped":"A/B-тест остановлен","prompts.stopFailed":"Не удалось остановить тест: {error}","prompts.failedToLoadAB":"Не удалось загрузить A/B-тесты: {error}","prompts.newABTest":"+ Новый A/B-тест","prompts.createABTestTitle":"Создание A/B-теста","prompts.testNameLabel":"Название теста","prompts.testNameRequired":"Название теста обязательно","prompts.variantALabel":"Вариант A","prompts.variantBLabel":"Вариант B","prompts.trafficSplitLabel":"Разделение трафика (% вариант A)","prompts.variantsRequired":"Выберите оба варианта","prompts.variantsMustDiffer":"Варианты A и B должны различаться","prompts.abTestCreated":"A/B-тест создан","prompts.abTestCreateFailed":"Не удалось создать A/B-тест: {error}","prompts.deleteABTestConfirm":"Удалить A/B-тест «{name}»?","prompts.abTestDeleted":"A/B-тест удалён","prompts.abTestDeleteFailed":"Не удалось удалить A/B-тест: {error}","prompts.recommended":"Рекомендован: {variant}","prompts.noSignificance":"Нет значимой разницы","prompts.notEnoughData":"Мало данных","prompts.stoppedWithResult":"Тест остановлен. {result}","prompts.abReportTitle":"Отчёт A/B-теста","prompts.reportSummary":"Сводка","prompts.reportCriteria":"По критериям","prompts.reportScenarios":"По сценариям","prompts.reportDaily":"Динамика по дням","prompts.reportCalls":"Звонки","prompts.reportQuality":"Качество","prompts.reportAvgDuration":"Средн. длительность","prompts.reportTransferRate":"Перевод на оператора","prompts.reportCriterion":"Критерий","prompts.reportDelta":"Дельта","prompts.reportScenario":"Сценарий","prompts.exportCSV":"Экспорт CSV","prompts.csvExported":"CSV экспортирован","prompts.exportFailed":"Ошибка экспорта: {error}","prompts.reportFailedToLoad":"Не удалось загрузить отчёт: {error}","prompts.reportNoData":"Нет данных для отчёта","prompts.criterionGreeting":"Приветствие","prompts.criterionIntent":"Понимание намерения","prompts.criterionToolUsage":"Использование инструментов","prompts.criterionAccuracy":"Точность информации","prompts.criterionConfirmation":"Подтверждение действий","prompts.criterionConciseness":"Лаконичность","prompts.criterionResolution":"Решение без оператора","prompts.criterionSatisfaction":"Удовлетворённость клиента","prompts.viewTitle":"Просмотр промпта","prompts.loadDefault":"Загрузить системный","prompts.resetToDefault":"Сброс к заводским","prompts.resetConfirm":"Создать новую версию из заводского промпта и активировать?","prompts.resetDone":"Промпт сброшен к заводским настройкам","prompts.resetFailed":"Ошибка сброса: {error}","prompts.deleteConfirm":"Удалить промпт «{name}»?","prompts.deleted":"Промпт удалён","prompts.deleteFailed":"Не удалось удалить промпт: {error}","prompts.pronunciationRules":"Правила произношения","prompts.pronunciationRulesDesc":"Правила произношения для TTS — добавляются в конец системного промпта агента. Используйте для коррекции произношения размеров, брендов, моделей шин и т.д.","prompts.pronunciationRulesSave":"Сохранить","prompts.pronunciationRulesSaved":"Правила произношения сохранены","prompts.pronunciationRulesSaveFailed":"Ошибка сохранения: {error}","prompts.pronunciationRulesReset":"Сбросить к заводским","prompts.pronunciationRulesResetConfirm":"Сбросить правила произношения к заводским настройкам?","prompts.pronunciationRulesResetDone":"Правила произношения сброшены к заводским","prompts.pronunciationRulesSource":"Источник: {source}","prompts.pronunciationRulesSourceRedis":"Redis (пользовательские)","prompts.pronunciationRulesSourceDefault":"заводские (по умолчанию)","prompts.optimizer":"Оптимизатор промптов","prompts.optimizerRuns":"запусков","prompts.optimizerDesc":"Автоматический анализ неудачных звонков и рекомендации по улучшению промпта.","prompts.optimizerRun":"Запустить анализ","prompts.optimizerRunning":"Запуск...","prompts.optimizerStarted":"Анализ запущен (task: {taskId})","prompts.optimizerRunFailed":"Не удалось запустить: {error}","prompts.optimizerDate":"Дата","prompts.optimizerCalls":"Звонков","prompts.optimizerPatterns":"Паттернов","prompts.optimizerStatus":"Статус","prompts.optimizerTriggered":"Инициатор","prompts.optimizerCompleted":"Готово","prompts.optimizerError":"Ошибка","prompts.optimizerView":"Подробнее","prompts.optimizerNoResults":"Нет результатов анализа","prompts.optimizerLoadFailed":"Не удалось загрузить: {error}","prompts.optimizerDetailTitle":"Результаты анализа","prompts.optimizerRecommendation":"Рекомендация","prompts.optimizerPattern":"Паттерн","prompts.optimizerSeverity":"Важность","prompts.optimizerFrequency":"Частота","prompts.optimizerSuggestion":"Предложение","prompts.action":"Действия","knowledge.breadcrumb":"База знаний","knowledge.title":"База знаний","knowledge.allCategories":"Все категории","knowledge.searchPlaceholder":"Поиск...","knowledge.allActive":"Все","knowledge.activeOnly":"Активные","knowledge.inactiveOnly":"Неактивные","knowledge.newArticle":"+ Новая статья","knowledge.reindexAll":"Переиндексировать всё","knowledge.importDocuments":"Импорт документов","knowledge.noArticles":"Статьи не найдены","knowledge.articleTitle":"Название","knowledge.category":"Категория","knowledge.embedding":"Эмбеддинг","knowledge.activeCol":"Активен","knowledge.updated":"Обновлён","knowledge.expiresAt":"Срок действия","knowledge.expired":"Истёк","knowledge.expiresAtLabel":"Срок действия (необязательно)","knowledge.expiresAtHint":"Статья автоматически скроется после этой даты. Пусто = бессрочно.","knowledge.actions":"Действия","knowledge.editBtn":"Ред.","knowledge.reindexBtn":"Переиндекс.","knowledge.deleteBtn":"Удалить","knowledge.total":"Всего: {count} статей","knowledge.failedToLoad":"Не удалось загрузить статьи: {error}","knowledge.newArticleTitle":"Новая статья","knowledge.editArticleTitle":"Редактирование статьи","knowledge.titleLabel":"Название","knowledge.titlePlaceholder":"Название статьи","knowledge.categoryLabel":"Категория","knowledge.contentLabel":"Содержание (Markdown)","knowledge.contentPlaceholder":"Содержание статьи в формате Markdown...","knowledge.titleRequired":"Название и содержание обязательны","knowledge.articleUpdated":"Статья обновлена","knowledge.articleCreated":"Статья создана","knowledge.saveFailed":"Не удалось сохранить статью: {error}","knowledge.articleDeactivated":"Статья деактивирована","knowledge.articleActivated":"Статья активирована","knowledge.toggleFailed":"Не удалось обновить статью: {error}","knowledge.deleteConfirm":'Удалить статью "{title}"?',"knowledge.articleDeleted":"Статья удалена","knowledge.deleteFailed":"Не удалось удалить статью: {error}","knowledge.reindexQueued":"Переиндексация поставлена в очередь","knowledge.reindexFailed":"Ошибка переиндексации: {error}","knowledge.reindexAllConfirm":"Переиндексировать все статьи? Это может занять время.","knowledge.reindexAllDispatched":"Переиндексация всех статей запущена","knowledge.reindexAllFailed":"Ошибка переиндексации: {error}","knowledge.loadFailed":"Не удалось загрузить статью: {error}","knowledge.importTitle":"Импорт документов","knowledge.importFilesLabel":"Файлы (MD, PDF, DOCX)","knowledge.importCategoryLabel":"Категория (необязательно, авто-определение если пусто)","knowledge.importAutoDetect":"Авто-определение по имени файла","knowledge.importBtn":"Импортировать","knowledge.importNoFiles":"Пожалуйста, выберите файлы для импорта","knowledge.importResult":"Импортировано: {imported}","knowledge.importErrors":"Ошибки: {errors}","knowledge.importFailed":"Ошибка импорта: {error}","operators.breadcrumb":"Операторы","operators.title":"Операторы","operators.online":"Операторов онлайн","operators.transfers1h":"Переводов (1ч)","operators.queueUnavailable":"Статус очереди недоступен","operators.newOperator":"+ Новый оператор","operators.searchPlaceholder":"Поиск по имени/номеру...","operators.allStatuses":"Все статусы","operators.noOperators":"Операторы не найдены","operators.name":"Имя","operators.extension":"Внутр. номер","operators.status":"Статус","operators.skills":"Навыки","operators.shift":"Смена","operators.activeCol":"Активен","operators.actionsCol":"Действия","operators.statusSelect":"Статус...","operators.statusOnline":"Онлайн","operators.statusOffline":"Оффлайн","operators.statusBusy":"Занят","operators.statusBreak":"Перерыв","operators.editBtn":"Ред.","operators.deactivateBtn":"Деактив.","operators.failedToLoad":"Не удалось загрузить операторов: {error}","operators.newOperatorTitle":"Новый оператор","operators.editOperatorTitle":"Редактирование оператора","operators.nameLabel":"Имя","operators.namePlaceholder":"ФИО","operators.extensionLabel":"Внутр. номер (SIP)","operators.extensionPlaceholder":"напр. 101","operators.skillsLabel":"Навыки (через запятую)","operators.skillsPlaceholder":"шины, заказы, шиномонтаж","operators.shiftStartLabel":"Начало смены","operators.shiftEndLabel":"Конец смены","operators.nameRequired":"Имя и внутр. номер обязательны","operators.operatorUpdated":"Оператор обновлён","operators.operatorCreated":"Оператор создан","operators.saveFailed":"Не удалось сохранить оператора: {error}","operators.statusChanged":"Статус изменён на {status}","operators.statusFailed":"Не удалось изменить статус: {error}","operators.deactivateConfirm":'Деактивировать оператора "{name}"?',"operators.operatorDeactivated":"Оператор деактивирован","operators.deactivateFailed":"Не удалось деактивировать: {error}","operators.notFound":"Оператор не найден","operators.loadFailed":"Не удалось загрузить оператора: {error}","settings.breadcrumb":"Система","settings.title":"Статус системы","settings.healthCheck":"Проверка здоровья","settings.refresh":"Обновить","settings.extendedStatus":"Расширенный статус","settings.clickToLoad":"Нажмите для загрузки","settings.loadStatus":"Загрузить статус","settings.configuration":"Конфигурация","settings.configDescription":"Перезагрузить безопасные параметры конфигурации (качество, фича-флаги, логирование) без перезапуска.","settings.reloadConfig":"Перезагрузить конфиг","settings.externalTools":"Внешние инструменты","settings.openGrafana":"Открыть Grafana","settings.openPrometheus":"Открыть Prometheus","settings.openFlower":"Открыть Flower","settings.celeryTasks":"Задачи Celery (Flower)","settings.loadFlower":"Загрузить Flower","settings.appInfo":"Информация о приложении","settings.version":"Версия","settings.status":"Статус","settings.activeCalls":"Активные звонки","settings.redis":"Redis","settings.storeAPI":"Store API","settings.claudeAPI":"Claude API","settings.googleSTT":"Google STT","settings.ttsEngine":"TTS Engine","settings.failedToLoad":"Не удалось загрузить системную информацию: {error}","settings.extVersion":"Версия","settings.uptime":"Аптайм","settings.uptimeValue":"{hours}ч {minutes}м","settings.pgDbSize":"Размер БД PostgreSQL","settings.pgConnections":"Подключения PostgreSQL","settings.redisMemory":"Память Redis","settings.celeryWorkers":"Celery workers","settings.lastBackup":"Последний бэкап","settings.extFailed":"Ошибка: {error}","settings.reloadConfirm":"Перезагрузить конфигурацию из окружения?","settings.configReloaded":`Конфигурация перезагружена:
`,"settings.reloadFailed":"Ошибка перезагрузки: {error}","settings.llmRouting":"Маршрутизация LLM","settings.llmRoutingDesc":"Мультипровайдерный роутинг LLM: управление провайдерами, задачами и fallback-цепочками.","settings.llmLoadConfig":"Загрузить конфигурацию","settings.llmProvider":"Провайдер","settings.llmType":"Тип","settings.llmModel":"Модель","settings.llmApiKey":"API-ключ","settings.llmEnabled":"Включён","settings.llmHealth":"Здоровье","settings.llmActions":"Действия","settings.llmTest":"Тест","settings.llmTaskRouting":"Маршрутизация задач","settings.llmTask":"Задача","settings.llmPrimary":"Основной","settings.llmFallbacks":"Запасные","settings.llmAddProvider":"Добавить провайдер","settings.llmAddFillRequired":"Укажите модель","settings.llmProviderAdded":"Провайдер {key} добавлен","settings.llmModelUpdated":"{key}: модель изменена на {model}","settings.llmProviderToggled":"Провайдер {key}: {state}","settings.llmRouteUpdated":"Задача {task} → {provider}","settings.llmTaskDesc_agent":"Основной ИИ-агент: ведёт диалог с клиентом, вызывает инструменты (поиск шин, заказы, запись на шиномонтаж).","settings.llmTaskRec_agent":"Рекомендация: мощная модель (Sonnet, GPT-4o). Требуется tool calling, высокое качество диалога.","settings.llmTaskDesc_article_processor":"Обработка статей базы знаний: структурирование, очистка, извлечение ключевых фактов из импортированных документов.","settings.llmTaskRec_article_processor":"Рекомендация: быстрая/дешёвая модель (Haiku, GPT-4o-mini). Фоновая задача, не требует tool calling.","settings.llmTaskDesc_quality_scoring":"Оценка качества звонков: анализ транскрипции, выставление баллов по критериям (точность, вежливость, полнота).","settings.llmTaskRec_quality_scoring":"Рекомендация: быстрая/дешёвая модель (Haiku, GPT-4o-mini). Фоновая Celery-задача, пакетная обработка.","settings.llmTaskDesc_prompt_optimizer":"Оптимизация системного промпта: анализ результатов A/B-тестов, генерация улучшенных версий промпта.","settings.llmTaskRec_prompt_optimizer":"Рекомендация: быстрая/дешёвая модель (Haiku, GPT-4o-mini). Редкая фоновая задача.","settings.llmFbSelect":"Выбрать...","settings.llmFbMoveUp":"Переместить выше","settings.llmFbMoveDown":"Переместить ниже","settings.llmFallbacksUpdated":"Запасные для {task}: {count} шт.","settings.llmConfigFailed":"Ошибка сохранения конфигурации: {error}","settings.llmTesting":"Тестирование {key}...","settings.llmTestSuccess":"{key}: OK ({latency}ms)","settings.llmTestFailed":"{key}: ошибка — {error}","settings.llmLoadFailed":"Не удалось загрузить конфигурацию LLM: {error}","settings.telegram":"Уведомления Telegram","settings.telegramDesc":"Настройка Telegram-бота для получения алертов от Alertmanager.","settings.telegramLoadConfig":"Загрузить","settings.telegramStatus":"Токен","settings.telegramTokenSet":"настроен","settings.telegramTokenMissing":"не настроен","settings.telegramBotToken":"Bot Token","settings.telegramBotTokenPlaceholder":"Новый токен (оставьте пустым чтобы не менять)","settings.telegramChatId":"Chat ID","settings.telegramChatIdPlaceholder":"Числовой ID чата или группы","settings.telegramTestBtn":"Тест","settings.telegramSaved":"Telegram-конфиг сохранён","settings.telegramSaveFailed":"Ошибка сохранения: {error}","settings.telegramFillFields":"Укажите хотя бы токен или chat_id","settings.telegramTesting":"Отправка тестового сообщения...","settings.telegramTestSuccess":"Тест OK ({latency}ms)","settings.telegramTestFailed":"Ошибка: {error}","settings.telegramLoadFailed":"Не удалось загрузить конфиг Telegram: {error}","users.breadcrumb":"Пользователи","users.title":"Управление пользователями","users.newUser":"+ Новый пользователь","users.noUsers":"Пользователи не найдены","users.username":"Имя пользователя","users.role":"Роль","users.activeCol":"Активен","users.lastLogin":"Последний вход","users.actionsCol":"Действия","users.changeRole":"Изменить роль...","users.roleAdmin":"Админ","users.roleAnalyst":"Аналитик","users.roleOperator":"Оператор","users.resetPwd":"Сброс пароля","users.failedToLoad":"Не удалось загрузить пользователей: {error}","users.createTitle":"Создание нового пользователя","users.usernameLabel":"Имя пользователя","users.usernamePlaceholder":"имя пользователя","users.passwordLabel":"Пароль","users.passwordPlaceholder":"пароль","users.roleLabel":"Роль","users.usernameRequired":"Имя пользователя и пароль обязательны","users.userCreated":"Пользователь создан","users.createFailed":"Не удалось создать пользователя: {error}","users.roleUpdated":"Роль обновлена","users.roleFailed":"Не удалось обновить роль: {error}","users.userDeactivated":"Пользователь деактивирован","users.userActivated":"Пользователь активирован","users.toggleFailed":"Не удалось обновить пользователя: {error}","users.newPasswordPrompt":"Новый пароль для {username}:","users.passwordReset":"Пароль сброшен","users.resetFailed":"Не удалось сбросить пароль: {error}","users.roleContentManager":"Контент-менеджер","users.permissions":"Права доступа","users.useRoleDefaults":"По умолчанию для роли","users.customPermissions":"Индивидуальные","users.editPermissions":"Права доступа...","users.permissionsUpdated":"Права доступа обновлены","users.permissionsFailed":"Не удалось обновить права: {error}","training.breadcrumb":"Обучение агента","training.title":"Обучение агента","training.tabPrompts":"Промпты","training.tabKnowledge":"База знаний","training.tabTemplates":"Шаблоны ответов","training.tabDialogues":"Сценарии диалогов","training.tabSafety":"Правила безопасности","training.tabTools":"Инструменты","training.activeCol":"Активен","training.actions":"Действия","training.loadFailed":"Не удалось загрузить: {error}","training.saveFailed":"Не удалось сохранить: {error}","training.deleteFailed":"Не удалось удалить: {error}","training.deleteConfirm":'Удалить "{title}"?',"training.titleRequired":"Название обязательно","training.titleContentRequired":"Название и содержание обязательны","training.fieldsRequired":"Все обязательные поля должны быть заполнены","training.keyRequired":"Ключ шаблона обязателен","training.newTemplate":"+ Новый шаблон","training.editTemplate":"Редактирование шаблона","training.addVariantTitle":"Добавить вариант ответа","training.noTemplates":"Шаблоны не найдены","training.templateKey":"Ключ","training.templateTitle":"Название","training.content":"Содержание","training.description":"Описание","training.templateSaved":"Шаблон сохранён","training.addVariant":"+ Вариант","training.variantCount":"вар.","training.variantsHint":"Несколько вариантов на ключ — агент выбирает случайный при каждом звонке","training.deleteVariantConfirm":'Удалить вариант "{title}"?',"training.variantDeleted":"Вариант удалён","training.allTemplateKeys":"Все ключи","training.searchTemplates":"Поиск шаблонов...","training.filterScenario":"Сценарий","training.allScenarios":"Все сценарии","training.filterPhase":"Фаза","training.allPhases":"Все фазы","training.filterActive":"Статус","training.allActive":"Все","training.activeOnly":"Активные","training.inactiveOnly":"Неактивные","training.newDialogue":"+ Новый сценарий","training.editDialogue":"Редактирование сценария","training.noDialogues":"Сценарии не найдены","training.dialogueTitle":"Название","training.dialogueTitlePlaceholder":"Название сценария","training.scenario":"Сценарий","training.phase":"Фаза","training.tools":"Инструменты","training.dialogueJSON":"Диалог (JSON)","training.invalidJSON":"Некорректный JSON","training.dialogueSaved":"Сценарий сохранён","training.dialogueDeleted":"Сценарий удалён","training.filterRuleType":"Тип правила","training.allRuleTypes":"Все типы","training.filterSeverity":"Серьёзность","training.allSeverities":"Все","training.newSafetyRule":"+ Новое правило","training.editSafetyRule":"Редактирование правила","training.noSafetyRules":"Правила не найдены","training.ruleTitle":"Название","training.ruleType":"Тип правила","training.severity":"Серьёзность","training.triggerInput":"Триггер (ввод клиента)","training.expectedBehavior":"Ожидаемое поведение","training.safetyRuleSaved":"Правило сохранено","training.safetyRuleDeleted":"Правило удалено","training.regressionTest":"Тест правил","training.regressionRunning":"Тестирование...","training.regressionResults":"Результаты теста правил безопасности","training.regressionPassed":"Пройден","training.regressionFailed_label":"Не пройден","training.regressionFailed":"Ошибка теста: {error}","training.regressionPassedCount":"Пройдено: {count}","training.regressionFailedCount":"Не пройдено: {count}","training.regressionTotal":"Всего: {count}","training.regressionStatus":"Статус","training.regressionActual":"Ответ агента","training.regressionReason":"Причина","training.toolName":"Инструмент","training.override":"Переопределение","training.overridden":"Переопределён","training.default":"По умолчанию","training.editTool":"Редактирование инструмента","training.originalDescription":"Описание по умолчанию","training.overrideDescription":"Переопределённое описание","training.descriptionRequired":"Описание обязательно","training.toolOverrideSaved":"Переопределение сохранено","training.toolOverrideReset":"Переопределение сброшено","training.reset":"Сбросить","training.resetConfirm":"Сбросить переопределение для {name}?","training.resetFailed":"Не удалось сбросить: {error}","training.toolNotFound":"Инструмент не найден","training.tabSources":"Источники","sources.enabled":"Скрапер включён","sources.autoApprove":"Авто-публикация","sources.runNow":"Запустить сейчас","sources.schedule":"Расписание","sources.noSources":"Источники не найдены","sources.allStatuses":"Все статусы","sources.url":"URL","sources.originalTitle":"Оригинальное название","sources.status":"Статус","sources.date":"Дата","sources.actions":"Действия","sources.approve":"Одобрить","sources.reject":"Отклонить","sources.viewArticle":"Статья","sources.total":"Всего: {count}","sources.configUpdated":"Конфигурация обновлена","sources.configUpdateFailed":"Ошибка обновления: {error}","sources.configLoadFailed":"Ошибка загрузки конфигурации: {error}","sources.runDispatched":"Скрапер запущен","sources.runFailed":"Не удалось запустить скрапер: {error}","sources.approved":"Статья одобрена и активирована","sources.approveFailed":"Ошибка одобрения: {error}","sources.rejected":"Источник отклонён","sources.rejectFailed":"Ошибка отклонения: {error}","sources.rejectConfirm":"Отклонить этот источник?","sources.failedToLoad":"Не удалось загрузить источники: {error}","sources.minDate":"С даты","sources.minDateHint":"Пусто = последние 14 дней (авторежим)","sources.maxDate":"По дату","sources.maxDateHint":"Пусто = без ограничения (до сегодня)","sources.dedupLlmCheck":"LLM-проверка дубликатов","sources.dedupLlmCheckHint":"Использовать LLM для пограничных случаев (0.80–0.90 сходство)","sources.duplicate":"дубликат","sources.duplicateSuspect":"возможный дубликат","sources.watchedPagesTitle":"Отслеживаемые страницы","sources.watchedPagesHint":"Страницы сайта, которые периодически пересканируются для обновления базы знаний агента.","sources.addWatchedPage":"Добавить страницу","sources.noWatchedPages":"Отслеживаемые страницы не добавлены","sources.watchedUrl":"URL","sources.watchedCategory":"Категория","sources.watchedInterval":"Интервал (ч)","sources.watchedStatus":"Статус","sources.watchedLastScraped":"Последний скан","sources.watchedNextScrape":"Следующий скан","sources.watchedArticle":"Статья","sources.watchedActions":"Действия","sources.scrapeNow":"Сканировать","sources.deleteWatched":"Удалить","sources.watchedPageAdded":"Страница добавлена","sources.watchedPageAddFailed":"Ошибка добавления: {error}","sources.watchedPageDeleted":"Страница удалена","sources.watchedPageDeleteFailed":"Ошибка удаления: {error}","sources.watchedPageDeleteConfirm":"Удалить отслеживание этой страницы?","sources.watchedPageUpdated":"Настройки обновлены","sources.watchedPageUpdateFailed":"Ошибка обновления: {error}","sources.scrapeNowRunning":"Сканирование...","sources.scrapeNowDone":"Сканирование завершено: {status}","sources.scrapeNowUnchanged":"Контент не изменился","sources.scrapeNowDiscoveryDone":"Discovery: найдено {discovered} стр., создано {created}, обновлено {updated}","sources.scrapeNowFailed":"Ошибка сканирования: {error}","sources.watchedFailedToLoad":"Не удалось загрузить: {error}","sources.urlRequired":"Укажите URL страницы","sources.categoryRequired":"Выберите категорию","sources.intervalRequired":"Выберите интервал","sources.urlPlaceholder":"https://prokoleso.ua/ua/...","sources.neverScraped":"ещё не сканировалась","sources.filterByTenant":"Сеть:","sources.allTenants":"Все сети","sources.noTenant":"Без сети","sources.tenant":"Сеть","sources.discoveryLabel":"Страница-каталог","sources.discoveryBadge":"каталог","sources.discoveryHint":"Страница со списком ссылок (напр. акции). Автоматически находит все дочерние страницы и сканирует каждую отдельно.","sources.childCount":"{count} дочерних","sources.intervalHours.6":"Каждые 6 ч","sources.intervalHours.12":"Каждые 12 ч","sources.intervalHours.24":"Раз в сутки","sources.intervalHours.168":"Раз в неделю","sources.tabConfigs":"Конфигурации","sources.tabScraper":"Скрапер","sources.tabWatched":"Отслеживаемые","sources.sourceConfigsTitle":"Источники контента","sources.sourceConfigsHint":"Внешние сайты для сбора статей в базу знаний.","sources.scraperConfigTitle":"ProKoleso — ручной импорт","sources.addSource":"Добавить источник","sources.editSource":"Редактировать источник","sources.sourceName":"Название","sources.sourceType":"Тип","sources.sourceUrl":"URL","sources.sourceLanguage":"Язык","sources.maxArticles":"Макс. статей","sources.lastRun":"Последний запуск","sources.runSource":"Запустить","sources.deleteSource":"Удалить","sources.settingsJson":"Настройки (JSON)","sources.noSourceConfigs":"Источники контента не настроены","sources.sourceConfigSaved":"Источник сохранён","sources.sourceConfigSaveFailed":"Ошибка сохранения: {error}","sources.sourceConfigDeleted":"Источник удалён","sources.sourceConfigDeleteFailed":"Ошибка удаления: {error}","sources.deleteSourceConfirm":"Удалить источник «{name}»?","sources.nameUrlRequired":"Укажите название и URL","sources.invalidSettingsJson":"Некорректный JSON в настройках","sources.processed":"Обработано","sources.bulkImport":"Массовый импорт","sources.bulkImportTitle":"Массовый импорт отслеживаемых страниц","sources.bulkUrlsPlaceholder":"Введите URL-адреса (по одному на строку)...","sources.bulkImportResult":"Добавлено: {added}, пропущено: {skipped}","tenants.title":"Сети","tenants.newTenant":"+ Новая сеть","tenants.editTenant":"Редактирование сети","tenants.slug":"Slug","tenants.name":"Название","tenants.networkId":"Network ID","tenants.agentName":"Имя агента","tenants.greeting":"Приветствие","tenants.enabledTools":"Инструменты","tenants.promptSuffix":"Суффикс промпта","tenants.config":"Конфигурация (JSON)","tenants.statusCol":"Статус","tenants.actions":"Действия","tenants.active":"Активна","tenants.activeLabel":"Активна","tenants.inactive":"Неактивна","tenants.created":"Сеть создана","tenants.updated":"Сеть обновлена","tenants.deleted":"Сеть деактивирована","tenants.activated":"Сеть активирована","tenants.deactivated":"Сеть деактивирована","tenants.deleteConfirm":"Деактивировать сеть «{name}»?","tenants.saveFailed":"Не удалось сохранить: {error}","tenants.loadFailed":"Не удалось загрузить сети: {error}","tenants.noTenants":"Сети не найдены","tenants.nameRequired":"Название и Network ID обязательны","tenants.slugRequired":"Slug обязателен","tenants.invalidConfigJson":"Некорректный JSON в конфигурации","nav.vehicles":"База авто","vehicles.breadcrumb":"База авто","vehicles.title":"База автомобилей","vehicles.searchPlaceholder":"Поиск по названию...","vehicles.brands":"Марки","vehicles.models":"Модели","vehicles.kits":"Комплектации","vehicles.tireSizes":"Размеры шин","vehicles.lastImport":"Последний импорт","vehicles.brand":"Марка","vehicles.model":"Модель","vehicles.year":"Год","vehicles.trim":"Комплектация","vehicles.pcd":"PCD","vehicles.bolts":"Болты","vehicles.dia":"DIA","vehicles.size":"Размер","vehicles.type":"Тип","vehicles.axle":"Ось","vehicles.stock":"Заводской","vehicles.tuning":"Тюнинг","vehicles.front":"Перед","vehicles.rear":"Зад","vehicles.all":"Все","vehicles.back":"← Назад","vehicles.noData":"Нет данных","vehicles.failedToLoad":"Не удалось загрузить: {error}","vehicles.neverImported":"Импорт не выполнялся","vehicles.importButton":"Обновить БД","vehicles.importTitle":"Обновление базы автомобилей","vehicles.importInstructions":"Разместите 4 CSV-файла в директории на сервере:","vehicles.importWarning":"Импорт удалит текущие данные и загрузит новые. Операция занимает ~30-60 секунд.","vehicles.importPathLabel":"Путь к директории с CSV","vehicles.importPathRequired":"Укажите путь к директории","vehicles.importBtn":"Импортировать","vehicles.importSuccess":"Импорт завершён: {brands} марок, {models} моделей, {kits} комплектаций, {tireSizes} размеров шин","vehicles.importFailed":"Ошибка импорта: {error}","common.search":"Поиск","audit.breadcrumb":"Аудит","audit.title":"Журнал аудита","audit.allActions":"Все действия","audit.noEntries":"Записи аудита не найдены","audit.date":"Дата","audit.user":"Пользователь","audit.action":"Действие","audit.resource":"Ресурс","audit.ip":"IP","audit.failedToLoad":"Не удалось загрузить журнал аудита: {error}","nav.sandbox":"Песочница","sandbox.breadcrumb":"Песочница","sandbox.title":"Песочница агента","sandbox.tabChat":"Чат","sandbox.tabHistory":"История","sandbox.newConversation":"Новый диалог","sandbox.archiveConversation":"Архивировать","sandbox.sendMessage":"Отправить","sandbox.messagePlaceholder":"Введите сообщение клиента...","sandbox.noConversation":"Выберите или создайте диалог","sandbox.noConversations":"Нет диалогов","sandbox.noMessages":"Начните диалог — отправьте первое сообщение","sandbox.conversationTitle":"Название диалога","sandbox.promptVersion":"Версия промпта","sandbox.promptVersionDefault":"Активная версия","sandbox.toolMode":"Режим инструментов","sandbox.toolModeMock":"Мок (тестовые данные)","sandbox.toolModeLive":"Живой (Store API)","sandbox.scenarioType":"Тип сценария","sandbox.scenarioNone":"Без типа","sandbox.model":"Модель","sandbox.modelDefault":"По умолчанию","sandbox.changeModel":"Сменить модель","sandbox.modelChanged":"Модель изменена","sandbox.tags":"Теги (через запятую)","sandbox.createConversation":"Создать диалог","sandbox.created":"Диалог создан","sandbox.archived":"Диалог архивирован","sandbox.deleted":"Диалог удалён","sandbox.deleteConfirm":"Удалить диалог «{title}»? Все данные будут потеряны.","sandbox.deleteBlockedByRegression":"Диалог используется в regression-прогонах. Архивируйте его вместо удаления.","sandbox.ratingCommentPrompt":"Комментарий к оценке (необязательно):","sandbox.ratingSaved":"Оценка сохранена","sandbox.ratingFailed":"Не удалось сохранить оценку: {error}","sandbox.sendFailed":"Ошибка отправки: {error}","sandbox.llmError":"Ошибка LLM","sandbox.llmErrorHint":"LLM-вызов не выполнен (0 токенов). Проверьте API-ключ и логи сервера.","sandbox.loadFailed":"Ошибка загрузки: {error}","sandbox.customer":"Клиент","sandbox.agent":"Агент","sandbox.toolCalls":"Вызовы инструментов","sandbox.toolName":"Инструмент","sandbox.toolArgs":"Параметры","sandbox.toolResult":"Результат","sandbox.toolDuration":"Время","sandbox.mock":"мок","sandbox.live":"живой","sandbox.metrics":"{latency}мс | {input}→{output} токенов | {model}","sandbox.turnsCount":"Реплик","sandbox.avgRating":"Ср. оценка","sandbox.lastActivity":"Последняя активность","sandbox.status":"Статус","sandbox.active":"Активный","sandbox.archivedStatus":"Архив","sandbox.searchPlaceholder":"Поиск по названию...","sandbox.allScenarios":"Все сценарии","sandbox.rateComment":"Комментарий к оценке...","sandbox.branch":"Альтернатива","sandbox.branchFrom":"Ветвление от реплики #{turn}","sandbox.branchLabel":"Метка ветки","sandbox.autoCustomer":"Авто-клиент","sandbox.autoCustomerHint":"Сгенерировать ответ клиента через ИИ","sandbox.persona":"Персона","sandbox.personaNeutral":"Нейтральный","sandbox.personaImpatient":"Нетерпеливый","sandbox.personaConfused":"Растерянный","sandbox.personaAngry":"Злой","sandbox.personaExpert":"Эксперт","sandbox.contextHint":"Подсказка контекста","sandbox.starters":"Шаблоны старта","sandbox.newStarter":"Новый шаблон","sandbox.starterTitle":"Название шаблона","sandbox.firstMessage":"Первое сообщение","sandbox.starterSaved":"Шаблон сохранён","sandbox.starterDeleted":"Шаблон удалён","sandbox.useStarter":"Использовать","sandbox.generating":"Генерация...","sandbox.childBranches":"Ответвления","sandbox.tabRegression":"Регрессия","sandbox.regression":"Регрессионные тесты","sandbox.replay":"Воспроизвести","sandbox.replayHint":"Воспроизвести диалог с другим промптом","sandbox.selectPromptVersion":"Выберите версию промпта","sandbox.runRegression":"Запустить регрессию","sandbox.regressionStarted":"Регрессия запущена","sandbox.regressionFailed":"Ошибка регрессии: {error}","sandbox.noRegressions":"Нет регрессионных тестов","sandbox.turnsCompared":"Реплик сравнено","sandbox.sourceRating":"Ср. оценка (исходный)","sandbox.newRating":"Ср. оценка (новый)","sandbox.scoreDiff":"Разница","sandbox.sourceResponse":"Исходный ответ","sandbox.newResponse":"Новый ответ","sandbox.diffView":"Сравнение","sandbox.baseline":"Базовый","sandbox.markBaseline":"Отметить как базовый","sandbox.unmarkBaseline":"Снять отметку базовый","sandbox.pending":"Ожидание","sandbox.running":"Выполняется","sandbox.completed":"Завершено","sandbox.failed":"Ошибка","sandbox.exportDialogue":"Экспорт в обучение","sandbox.exported":"Экспортировано в обучающие данные","sandbox.markingMode":"Режим разметки","sandbox.createGroup":"Создать группу","sandbox.intentLabel":"Интент","sandbox.patternType":"Тип паттерна","sandbox.positive":"Положительный","sandbox.negative":"Отрицательный","sandbox.correction":"Исправление","sandbox.correctionHint":"Как агент должен был ответить...","sandbox.groupCreated":"Группа создана","sandbox.groupUpdated":"Группа обновлена","sandbox.groupDeleted":"Группа удалена","sandbox.turnGroups":"Группы реплик","sandbox.noGroups":"Нет групп","sandbox.turnsSelected":"{count} реплик выбрано","sandbox.exportToPatterns":"Экспорт в паттерны","sandbox.alreadyExported":"Экспортировано","sandbox.patterns":"Паттерны","sandbox.guidanceNote":"Инструкция для промпта","sandbox.guidanceHint":"Что именно инжектировать в system prompt агента...","sandbox.exportSuccess":"Паттерн экспортирован","sandbox.patternActive":"Активен","sandbox.patternInactive":"Неактивен","sandbox.timesUsed":"Использований","sandbox.testSearch":"Тест поиска","sandbox.testSearchHint":"Введите текст для поиска похожих паттернов...","sandbox.similarity":"Результаты","sandbox.noPatterns":"Нет паттернов","sandbox.customerMessages":"Сообщения клиента","sandbox.agentMessages":"Ответы агента","sandbox.sending":"Отправка...","sandbox.exitMarking":"Выйти из разметки","sandbox.markingHint":"Выберите ходы для создания группы","sandbox.error":"Ошибка","sandbox.openNewConversation":"Открыть новый диалог","sandbox.intentRequired":"Введите метку интента","sandbox.guidanceRequired":"Введите инструкцию для промпта","sandbox.titleRequired":"Введите название диалога","sandbox.ratingCommentPlaceholder":"Комментарий (Enter для сохранения)","sandbox.convInfo":"Параметры диалога","sandbox.routerModel":"router","sandbox.tabPhrases":"Фразы агента","sandbox.phrasesTitle":"Фразы агента (TTS без LLM)","sandbox.phrasesDescription":"Эти фразы озвучиваются TTS напрямую, без участия LLM. Шаблоны из БД имеют приоритет над захардкоженными — при каждом звонке выбирается случайный вариант.","sandbox.phrasesCategory":"Категория","sandbox.phrasesKey":"Контекст","sandbox.phrasesText":"Текст фразы","sandbox.phrasesSource":"Источник","sandbox.phrasesStatus":"Статус","sandbox.phrasesSourceCode":"код (prompts.py)","sandbox.phrasesSourceLLM":"LLM (генерация)","sandbox.phrasesActive":"активна","sandbox.phrasesOverridden":"переопределена из БД","sandbox.phrasesInactive":"выкл","sandbox.phrasesCatFixed":"Захардкоженные (fallback)","sandbox.phrasesCatWait":"Пулы ожидания (захардкоженные)","sandbox.phrasesPoolLabel":"пул ({count} вариантов, ротация)","sandbox.phrasesLoadFailed":"Не удалось загрузить фразы: {error}","sandbox.phrasesLlmNote":"Все остальные ответы агента генерируются LLM в реальном времени.","sandbox.phrasesDbTitle":"Шаблоны из БД (реально используются)","sandbox.phrasesDbDescription":"Эти фразы загружаются из таблицы response_templates и переопределяют захардкоженные. При каждом звонке случайно выбирается 1 активный вариант на ключ. Управление: Сценарии → Шаблоны.","sandbox.phrasesDbVariants":"{active} акт. из {total}","sandbox.branchMessage":"Сообщение для ветки","sandbox.branchFromTurn":"Ветка от хода {turn}","sandbox.submitBranch":"Отправить","sandbox.selectPromptForReplay":"Выберите версию промпта для регрессии","sandbox.submitReplay":"Запустить","sandbox.personaRushed":"Спешащий","sandbox.personaDetailed":"Дотошный","sandbox.tabStarters":"Шаблоны","sandbox.quickStart":"Быстрый старт","sandbox.manageStarters":"Управление шаблонами","sandbox.starterFirstMessage":"Первое сообщение","sandbox.starterDescription":"Описание","sandbox.starterPersona":"Персона","sandbox.noStarters":"Нет шаблонов старта","sandbox.deleteStarterConfirm":"Удалить шаблон «{title}»?","sandbox.starterTitleRequired":"Название и первое сообщение обязательны","sandbox.editStarter":"Редактирование шаблона","sandbox.bulkMode":"Массовое удаление","sandbox.selectAll":"Выбрать все","sandbox.deselectAll":"Снять все","sandbox.bulkDelete":"Удалить выбранные ({count})","sandbox.bulkDeleted":"Удалено: {deleted}, пропущено: {skipped}","sandbox.bulkDeleteConfirm":"Удалить {count} диалогов? Данные будут потеряны.","sandbox.bulkSkipped":"Некоторые диалоги защищены regression-прогонами и не были удалены.","help.close":"Закрыть справку","help.tipsTitle":"Полезные советы","help.scenarios.title":"Справка: Обучение агента","help.scenarios.overview":"<p>Управление обучающими данными AI-агента. Здесь настраиваются <strong>шаблоны ответов</strong> (готовые фразы), <strong>примеры диалогов</strong> (few-shot обучение) и <strong>правила безопасности</strong> (ограничения). Все изменения применяются <strong>мгновенно</strong> — при следующем звонке агент будет использовать обновлённые данные.</p>","help.scenarios.templates.title":"Что такое шаблоны ответов","help.scenarios.templates.content":"<p>Шаблоны — готовые фразы на украинском языке, которые агент произносит в типичных ситуациях. Каждый шаблон принадлежит одной из категорий:</p><ul><li><strong>greeting</strong> — приветствие при начале разговора</li><li><strong>farewell</strong> — прощание в конце разговора</li><li><strong>silence_prompt</strong> — фраза при молчании клиента</li><li><strong>transfer</strong> — сообщение при переводе на оператора</li><li><strong>error</strong> — фраза при технической ошибке</li><li><strong>wait</strong> — просьба подождать</li><li><strong>order_cancelled</strong> — сообщение об отмене заказа</li></ul><p>У каждой категории может быть <strong>несколько вариантов</strong> — агент случайно выбирает один из активных, чтобы речь звучала естественнее.</p>","help.scenarios.templates.steps":"Пошаговая инструкция: Шаблоны","help.scenarios.templates.stepsContent":"<p><strong>Создание нового шаблона:</strong></p><ol><li>Нажмите кнопку <strong>«Новый шаблон»</strong></li><li>Выберите <strong>категорию</strong> (greeting, farewell и т.д.)</li><li>Введите <strong>название</strong> — для вашего удобства, клиент его не видит</li><li>Введите <strong>текст</strong> — фраза на украинском языке, которую агент будет произносить</li><li>Нажмите <strong>«Сохранить»</strong></li></ol><p><strong>Добавление варианта к существующей категории:</strong></p><ol><li>Найдите нужную категорию в таблице</li><li>Нажмите кнопку <strong>«Добавить вариант»</strong> рядом с названием категории</li><li>Заполните название и текст нового варианта</li><li>Сохраните — вариант сразу доступен агенту</li></ol><p><strong>Редактирование / удаление:</strong></p><ol><li>Нажмите <strong>три точки (⋮)</strong> справа от шаблона</li><li>Выберите <strong>«Редактировать»</strong> или <strong>«Удалить»</strong></li><li>Удаление доступно только если у категории больше одного варианта</li></ol>","help.scenarios.dialogues.title":"Что такое сценарии диалогов","help.scenarios.dialogues.content":'<p>Сценарии — это <strong>примеры разговоров</strong> клиента с агентом (few-shot). Агент анализирует текущий разговор и подбирает наиболее похожий пример для формирования ответа.</p><ul><li><strong>Тип сценария</strong> — подбор шин, заказ, шиномонтаж, консультация и т.д.</li><li><strong>Фаза</strong> — этап разработки (mvp, orders, services)</li><li><strong>Формат</strong> — JSON-массив реплик: <code>[{"role": "user", "text": "..."}, {"role": "assistant", "text": "..."}]</code></li><li>Инструменты извлекаются автоматически из поля <code>tool_calls</code> в репликах</li></ul>',"help.scenarios.dialogues.steps":"Пошаговая инструкция: Диалоги","help.scenarios.dialogues.stepsContent":'<p><strong>Создание нового диалога:</strong></p><ol><li>Нажмите <strong>«Новый диалог»</strong></li><li>Введите <strong>название</strong> — описание сценария (напр. «Клиент ищет зимние шины 205/55 R16»)</li><li>Выберите <strong>тип сценария</strong> (tire_search, order_creation и т.д.)</li><li>Выберите <strong>фазу</strong> (mvp, orders, services)</li><li>Отредактируйте <strong>JSON-диалог</strong> — чередуйте реплики <code>user</code> и <code>assistant</code></li><li>Нажмите <strong>«Сохранить»</strong></li></ol><p><strong>Формат JSON-реплики:</strong></p><ul><li><code>{"role": "user", "text": "Доброго дня, мені потрібні шини"}</code></li><li><code>{"role": "assistant", "text": "Добрий день! Допоможу підібрати. Який розмір шин вам потрібен?"}</code></li></ul><p><strong>Фильтрация:</strong> используйте выпадающие списки над таблицей для фильтрации по типу сценария, фазе и статусу активности.</p>',"help.scenarios.safety.title":"Что такое правила безопасности","help.scenarios.safety.content":"<p>Правила безопасности задают <strong>ограничения и запреты</strong> для агента. Они всегда включаются в системный промпт и имеют наивысший приоритет.</p><ul><li><strong>Тип правила</strong> — prompt_injection, data_validation, off_topic, language, behavioral, escalation</li><li><strong>Серьёзность</strong> — critical (красный), high (жёлтый), medium (синий), low (серый)</li><li><strong>Триггер</strong> — сообщение клиента, которое должно активировать правило</li><li><strong>Ожидаемое поведение</strong> — как агент должен ответить на триггер</li></ul>","help.scenarios.safety.steps":"Пошаговая инструкция: Правила безопасности","help.scenarios.safety.stepsContent":"<p><strong>Создание правила:</strong></p><ol><li>Нажмите <strong>«Новое правило»</strong></li><li>Введите <strong>название</strong> (напр. «Запрет обсуждения конкурентов»)</li><li>Выберите <strong>тип</strong> и <strong>серьёзность</strong></li><li>В поле <strong>«Триггер»</strong> введите пример сообщения клиента, которое должно активировать правило</li><li>В поле <strong>«Ожидаемое поведение»</strong> опишите, как агент должен реагировать</li><li>Сохраните</li></ol><p><strong>Регрессионный тест:</strong></p><ol><li>Нажмите <strong>«Регрессионный тест»</strong> рядом с кнопкой создания</li><li>Система отправит триггеры всех активных правил агенту</li><li>В результатах увидите: прошёл / не прошёл, ожидаемое vs фактическое поведение</li><li>Исправьте правила, которые не прошли тест</li></ol>","help.scenarios.affects.title":"На что влияют изменения","help.scenarios.affects.content":'<div class="help-affects"><p><strong>Шаблоны ответов:</strong> влияют на <strong>конкретные фразы</strong> агента в стандартных ситуациях. Если вы измените шаблон приветствия — все новые звонки начнутся с нового текста.</p><p><strong>Сценарии диалогов:</strong> влияют на <strong>стиль ведения разговора</strong>. Агент ищет наиболее похожий пример и подражает ему. Больше хороших примеров = лучшее качество диалогов.</p><p><strong>Правила безопасности:</strong> влияют на <strong>запреты и ограничения</strong>. Критические правила агент не может нарушить. Если правило удалено — ограничение снято.</p></div><p><strong>Важно:</strong> все изменения применяются мгновенно. Рекомендуем сначала протестировать в <strong>Песочнице</strong>.</p>',"help.scenarios.tips":"<ul><li>Начните с просмотра существующих шаблонов и диалогов — они уже покрывают основные сценарии</li><li>Добавляйте по 2-3 варианта шаблонов для каждой категории — это делает речь агента естественнее</li><li>Новые диалоги <strong>мгновенно</strong> попадают в few-shot выборку агента</li><li>Перед важными изменениями запустите <strong>регрессионный тест</strong> правил безопасности</li><li>Правила с серьёзностью <strong>critical</strong> и <strong>high</strong> имеют абсолютный приоритет</li></ul>","help.knowledge.title":"Справка: База знаний","help.knowledge.overview":"<p>База знаний содержит статьи, по которым агент консультирует клиентов. Когда клиент задаёт вопрос о доставке, гарантии, возврате и т.д., агент ищет ответ в этих статьях через <strong>RAG-поиск</strong> (по смыслу, не по ключевым словам). Чем больше качественных статей — тем точнее консультации.</p>","help.knowledge.articles.title":"Что такое статьи","help.knowledge.articles.content":"<p>Статьи — основной контент базы знаний. Каждая статья имеет:</p><ul><li><strong>Категория</strong> — faq, guides, brands, comparisons, delivery, warranty, returns, policies, general и др.</li><li><strong>Контент</strong> — текст в формате Markdown (поддерживаются заголовки, списки, ссылки)</li><li><strong>Эмбеддинг</strong> — векторное представление для поиска по смыслу. Статус:<ul><li>Зелёный <strong>«indexed»</strong> — статья готова к поиску</li><li>Жёлтый <strong>«pending»</strong> — ожидает генерации (каждые 5 минут)</li><li>Красный <strong>«error»</strong> — ошибка, нужна переиндексация</li></ul></li><li><strong>Срок действия</strong> — можно установить дату, после которой статья автоматически скроется (полезно для акций)</li></ul>","help.knowledge.articles.steps":"Пошаговая инструкция: Статьи","help.knowledge.articles.stepsContent":"<p><strong>Создание статьи вручную:</strong></p><ol><li>Нажмите <strong>«+ Новая статья»</strong></li><li>Введите <strong>название</strong> — чёткое и описательное (напр. «Условия доставки по Украине»)</li><li>Выберите <strong>категорию</strong></li><li>Напишите <strong>контент</strong> в формате Markdown</li><li>При необходимости установите <strong>срок действия</strong></li><li>Нажмите <strong>«Сохранить»</strong> — через 5 минут статья будет проиндексирована</li></ol><p><strong>Импорт из файлов (быстрое пополнение):</strong></p><ol><li>Нажмите <strong>«Импорт документов»</strong></li><li>Выберите файлы (.md, .pdf, .docx) — можно несколько</li><li>При необходимости выберите категорию (если не выбрана — определится из имени файла)</li><li>Нажмите <strong>«Импортировать»</strong> — статьи создадутся автоматически</li></ol><p><strong>Переиндексация:</strong></p><ul><li><strong>Одна статья:</strong> меню ⋮ → «Переиндексировать»</li><li><strong>Все статьи:</strong> кнопка «Переиндексировать всё» (занимает время, используйте при массовых проблемах)</li></ul>","help.knowledge.sources.title":"Что такое конфигурации источников","help.knowledge.sources.content":"<p>Источники — внешние сайты, с которых система автоматически собирает статьи в базу знаний.</p><ul><li><strong>Тип</strong>:<ul><li><strong>HTML</strong> — обычные веб-страницы (извлечение текста через trafilatura)</li><li><strong>RSS</strong> — RSS/Atom-ленты (feedparser + trafilatura)</li><li><strong>ProKoleso</strong> — специализированный парсер для prokoleso.ua</li></ul></li><li><strong>Язык</strong> — язык источника (UK, DE, EN, FR). Контент на иностранном языке будет <strong>автоматически переведён</strong> на украинский через LLM</li><li><strong>Расписание</strong> — день и час автоматического запуска</li><li><strong>Auto-approve</strong> — если включено, статьи сразу активируются; если нет — требуют ручного одобрения</li></ul>","help.knowledge.sources.steps":"Пошаговая инструкция: Источники","help.knowledge.sources.stepsContent":"<p><strong>Добавление источника:</strong></p><ol><li>Перейдите на вкладку <strong>«Конфигурации»</strong></li><li>Нажмите <strong>«Добавить источник»</strong></li><li>Заполните:<ol><li><strong>Название</strong> — для вашего удобства</li><li><strong>Тип</strong> — HTML, RSS или ProKoleso</li><li><strong>Язык</strong> — язык источника (статьи будут переведены на украинский)</li><li><strong>URL</strong> — адрес сайта или RSS-ленты</li><li><strong>Макс. статей за запуск</strong> — ограничение на одну итерацию</li><li><strong>Расписание</strong> — день недели и час</li></ol></li><li>Нажмите <strong>«Сохранить»</strong></li></ol><p><strong>Ручной запуск:</strong> меню ⋮ → «Запустить» — немедленная загрузка статей из этого источника.</p><p><strong>Включение/выключение:</strong> переключатель в столбце «Enabled» — моментальное сохранение.</p>","help.knowledge.scraper.title":"Вкладка «Скрапер»","help.knowledge.scraper.content":"<p>Управление настройками скрапера и просмотр результатов загрузки.</p><p><strong>Настройки:</strong></p><ul><li><strong>Enabled</strong> — включить/выключить скрапер глобально</li><li><strong>Auto-approve</strong> — автоматически активировать загруженные статьи</li><li><strong>Dedup LLM check</strong> — проверка дубликатов через LLM (предотвращает повторные статьи)</li><li><strong>«Запустить»</strong> — немедленный запуск всех активных источников</li></ul><p><strong>Таблица результатов:</strong> показывает каждую загруженную страницу со статусом:</p><ul><li>Зелёный <strong>processed</strong> — успешно обработана</li><li>Жёлтый <strong>new</strong> — ещё не обработана</li><li>Серый <strong>skipped</strong> — пропущена (дубликат или нерелевантна)</li><li>Красный <strong>error</strong> — ошибка загрузки/обработки</li></ul><p>Для обработанных статей: меню ⋮ → «Просмотреть статью» или «Одобрить» / «Отклонить».</p>","help.knowledge.watched.title":"Что такое отслеживаемые страницы","help.knowledge.watched.content":"<p>Отслеживаемые страницы — URL, которые система периодически пересканирует. При обнаружении изменений контента статья <strong>автоматически обновляется</strong>.</p><ul><li><strong>Интервал</strong> — частота проверки: 6ч, 12ч, 24ч или 1 неделя</li><li><strong>Discovery</strong> — режим «обнаружения»: сканирует страницу на вложенные ссылки и автоматически добавляет дочерние страницы</li><li><strong>Массовый импорт</strong> — загрузка списка URL (по одному на строку)</li><li><strong>Привязка к тенанту</strong> — статьи могут принадлежать конкретной сети (ProKoleso / Твоя Шина)</li></ul>","help.knowledge.watched.steps":"Пошаговая инструкция: Отслеживаемые страницы","help.knowledge.watched.stepsContent":"<p><strong>Добавление страницы:</strong></p><ol><li>Перейдите на вкладку <strong>«Отслеживаемые»</strong></li><li>В поле <strong>URL</strong> введите адрес страницы</li><li>Выберите <strong>категорию</strong> и <strong>интервал</strong> проверки</li><li>При необходимости выберите <strong>тенант</strong></li><li>Отметьте <strong>Discovery</strong>, если хотите автоматически обнаружить дочерние страницы</li><li>Нажмите <strong>«Добавить»</strong></li></ol><p><strong>Массовый импорт:</strong></p><ol><li>Нажмите <strong>«Массовый импорт»</strong></li><li>Вставьте URL (по одному на строку)</li><li>Выберите категорию, интервал и тенант</li><li>Нажмите <strong>«Импортировать»</strong> — дубликаты автоматически пропускаются</li></ol><p><strong>Немедленное сканирование:</strong> меню ⋮ → «Сканировать сейчас». Результат: содержимое не изменилось / обновлено.</p>","help.knowledge.affects.title":"На что влияют изменения","help.knowledge.affects.content":'<div class="help-affects"><p><strong>Статьи</strong> — это контент, который агент цитирует при ответе на вопросы клиентов. Если статья удалена или деактивирована — агент <strong>не сможет ответить</strong> на связанные вопросы.</p><p><strong>Эмбеддинги</strong> — без них статья <strong>невидима</strong> для RAG-поиска. Новые статьи индексируются автоматически каждые 5 минут.</p><p><strong>Источники и отслеживаемые страницы</strong> — влияют на <strong>автоматическое обновление</strong> базы знаний. Если источник отключен — новые статьи с этого сайта не загружаются.</p></div>',"help.knowledge.tips":"<ul><li>Для быстрого пополнения используйте <strong>импорт .md файлов</strong> или <strong>массовый импорт URL</strong></li><li>Проверяйте столбец <strong>«Эмбеддинг»</strong> — статьи со статусом «pending» ещё не доступны для поиска</li><li>Устанавливайте <strong>срок действия</strong> для акционных статей — они автоматически скроются</li><li>Используйте режим <strong>Discovery</strong> для автоматического обнаружения новых страниц на сайте</li><li>Отслеживаемые страницы с интервалом <strong>24ч</strong> — оптимальный баланс между актуальностью и нагрузкой</li></ul>","help.prompts.title":"Справка: Промпты","help.prompts.overview":"<p>Промпт — это <strong>главная инструкция</strong> AI-агента: текст, определяющий его поведение, стиль общения, компетенции и ограничения. Промпт — самый влиятельный параметр: даже небольшое изменение может кардинально изменить качество диалогов.</p>","help.prompts.versions.title":"Что такое версии промптов","help.prompts.versions.content":"<p>Система хранит <strong>историю всех версий</strong> промпта. В каждый момент только одна версия <strong>активна</strong> (используется в реальных звонках). Остальные — черновики или архив.</p><ul><li><strong>Имя версии</strong> — уникальный идентификатор (напр. <code>v3.5-natural</code>)</li><li><strong>Статус Active</strong> — зелёный бейдж = используется прямо сейчас</li><li><strong>«Загрузить по умолчанию»</strong> — заполняет текстовое поле встроенным промптом (удобно как основа для новой версии)</li></ul>","help.prompts.versions.steps":"Пошаговая инструкция: Промпты","help.prompts.versions.stepsContent":"<p><strong>Создание новой версии:</strong></p><ol><li>Нажмите <strong>«Новая версия»</strong></li><li>Введите <strong>имя</strong> (напр. <code>v4.0-concise</code>)</li><li>Нажмите <strong>«Загрузить по умолчанию»</strong> если хотите начать с базового промпта</li><li>Отредактируйте <strong>текст промпта</strong> — это инструкция для агента на украинском языке</li><li>Нажмите <strong>«Создать»</strong></li></ol><p><strong>Активация версии:</strong></p><ol><li>Найдите нужную версию в таблице</li><li>Меню ⋮ → <strong>«Активировать»</strong></li><li>Подтвердите — <strong>все новые звонки</strong> сразу начнут использовать эту версию</li></ol><p><strong>Безопасный процесс обновления промпта:</strong></p><ol><li>Создайте новую версию</li><li>Протестируйте в <strong>Песочнице</strong> (выберите версию при создании разговора)</li><li>Убедитесь в качестве — проверьте несколько сценариев</li><li>Активируйте или запустите <strong>A/B тест</strong></li></ol>","help.prompts.ab.title":"Что такое A/B тесты","help.prompts.ab.content":"<p>A/B тест позволяет <strong>сравнить две версии промпта</strong> на реальном трафике. Звонки автоматически распределяются между вариантами, и система собирает метрики качества.</p><ul><li><strong>Распределение трафика</strong> — ползунок от 10% до 90% (рекомендуем начинать с 50/50)</li><li><strong>Метрики</strong> — качество, длительность, процент переводов на оператора</li><li><strong>Статистическая значимость</strong> — система рассчитывает p-value и z-score</li><li><strong>Отчёт</strong> — детальное сравнение по 8 критериям, разбивка по сценариям, дневная динамика</li></ul>","help.prompts.ab.steps":"Пошаговая инструкция: A/B тесты","help.prompts.ab.stepsContent":"<p><strong>Запуск A/B теста:</strong></p><ol><li>Убедитесь, что у вас есть <strong>минимум 2 версии</strong> промпта</li><li>Нажмите <strong>«Новый A/B тест»</strong></li><li>Введите <strong>название</strong> теста</li><li>Выберите <strong>вариант A</strong> и <strong>вариант B</strong></li><li>Настройте <strong>распределение трафика</strong> ползунком</li><li>Нажмите <strong>«Создать»</strong> — тест начнётся немедленно</li></ol><p><strong>Анализ результатов:</strong></p><ol><li>Нажмите на <strong>название теста</strong> в таблице для просмотра отчёта</li><li>Проверьте <strong>общие метрики</strong>: звонки, качество, длительность, переводы</li><li>Изучите <strong>разбивку по критериям</strong>: приветствие, определение намерения, использование инструментов и т.д.</li><li>Подождите статистической значимости (бейдж значимости)</li></ol><p><strong>Завершение теста:</strong></p><ol><li>Меню ⋮ → <strong>«Остановить»</strong></li><li>Активируйте версию-победителя через таблицу промптов</li></ol>","help.prompts.affects.title":"На что влияют изменения","help.prompts.affects.content":'<div class="help-affects"><p><strong>Активация промпта</strong> — мгновенно меняет поведение агента для <strong>всех новых звонков</strong>. Текущие звонки используют ту версию, с которой начались.</p><p><strong>A/B тест</strong> — разделяет трафик между двумя версиями. Во время теста агент может вести себя по-разному для разных клиентов.</p><p><strong>Промпт — самый влиятельный параметр.</strong> Небольшое изменение формулировки может кардинально изменить стиль общения, точность ответов и использование инструментов.</p></div>',"help.prompts.tips":"<ul><li><strong>Никогда</strong> не активируйте промпт без предварительного тестирования в Песочнице</li><li>Используйте A/B тесты для проверки гипотез — не меняйте промпт «на глаз»</li><li>Версионирование позволяет <strong>мгновенно откатиться</strong> к предыдущей версии при проблемах</li><li>Кнопка <strong>«Сбросить до стандартного»</strong> создаёт новую версию из встроенного промпта — полезно для отката</li><li>Экспортируйте отчёт A/B теста в CSV для детального анализа</li></ul>","help.sandbox.title":"Справка: Песочница","help.sandbox.overview":"<p>Песочница — среда для <strong>тестирования AI-агента</strong> без реальных звонков. Здесь можно вести диалог с агентом, оценивать качество ответов, запускать регрессионные тесты и экспортировать паттерны поведения. Это главный инструмент <strong>контроля качества</strong>.</p>","help.sandbox.chat.title":"Вкладка «Чат»","help.sandbox.chat.content":"<p>Интерактивный диалог с AI-агентом. Левая панель — список разговоров, правая — чат.</p><p><strong>Возможности:</strong></p><ul><li><strong>Режим инструментов:</strong> Mock (тестовые данные) или Live (реальные данные из Store API)</li><li><strong>Выбор промпта:</strong> можно тестировать любую версию, не только активную</li><li><strong>Выбор модели:</strong> разные LLM-модели (скорость / качество)</li><li><strong>Тип сценария:</strong> tire_search, order_creation, fitting_booking и др.</li><li><strong>Персона клиента:</strong> neutral, angry, confused, rushed, detailed — влияет на авто-генерацию сообщений</li><li><strong>Авто-клиент:</strong> кнопка «Auto customer» — LLM генерирует реалистичное сообщение клиента</li><li><strong>Оценка:</strong> звёздочки на каждом ответе агента (1-5) с комментарием</li><li><strong>Ветвление:</strong> кнопка «Branch» — попробовать альтернативное сообщение клиента с определённого момента</li></ul>","help.sandbox.chat.steps":"Пошаговая инструкция: Чат","help.sandbox.chat.stepsContent":"<p><strong>Начало тестирования:</strong></p><ol><li>Нажмите <strong>«+ Новый разговор»</strong></li><li>Если есть шаблоны быстрого старта — выберите один из них (разговор начнётся автоматически)</li><li>Или заполните вручную:<ol><li><strong>Название</strong> — для идентификации (напр. «Тест зимних шин»)</li><li><strong>Версия промпта</strong> — выберите нужную (активная отмечена *)</li><li><strong>Модель</strong> — LLM-модель</li><li><strong>Режим инструментов</strong> — Mock для тестов, Live для проверки с реальными данными</li><li><strong>Сценарий</strong> — тип диалога (необязательно)</li></ol></li><li>Нажмите <strong>«Создать»</strong></li></ol><p><strong>Оценка качества ответов:</strong></p><ol><li>Прочитайте ответ агента</li><li>Нажмите на <strong>звёздочки</strong> (1-5) для оценки</li><li>Добавьте <strong>комментарий</strong> — что хорошо / что нужно улучшить</li></ol><p><strong>Разметка групп реплик (для экспорта в паттерны):</strong></p><ol><li>Включите <strong>«Режим разметки»</strong> в шапке чата</li><li>Отметьте галочками реплики, которые хотите сгруппировать</li><li>Нажмите <strong>«Создать группу»</strong></li><li>Укажите <strong>интент</strong>, <strong>тип</strong> (позитивный/негативный) и <strong>оценку</strong></li><li>Для негативных групп укажите <strong>коррекцию</strong> — правильный ответ</li><li>Сохраните — группу можно экспортировать в паттерны</li></ol>","help.sandbox.regression.title":"Вкладка «Регрессия»","help.sandbox.regression.content":"<p>Автоматическое воспроизведение сохранённого разговора с новым промптом — для проверки, что изменения не ухудшили качество.</p><ul><li>Система берёт <strong>сообщения клиента</strong> из baseline-разговора</li><li>Отправляет их агенту с <strong>новой версией промпта</strong></li><li>Сравнивает ответы: <strong>исходный</strong> vs <strong>новый</strong> — показывает разницу</li></ul>","help.sandbox.regression.steps":"Пошаговая инструкция: Регрессия","help.sandbox.regression.stepsContent":"<p><strong>Подготовка:</strong></p><ol><li>Перейдите на вкладку <strong>«Чат»</strong></li><li>Найдите качественный разговор с хорошими оценками</li><li>Нажмите <strong>«Пометить как baseline»</strong> в шапке чата</li></ol><p><strong>Запуск регрессионного теста:</strong></p><ol><li>Перейдите на вкладку <strong>«Регрессия»</strong></li><li>Нажмите <strong>«Воспроизвести»</strong> рядом с baseline-разговором</li><li>Выберите <strong>версию промпта</strong> для тестирования</li><li>Дождитесь завершения (статус: pending → running → completed)</li></ol><p><strong>Анализ результатов:</strong></p><ol><li>Нажмите на строку в таблице для просмотра деталей</li><li>Сравните ответы <strong>попарно</strong>: исходный ответ слева, новый справа</li><li>Различия подсвечены — быстро видно, что изменилось</li><li>Если качество упало — не активируйте новый промпт</li></ol>","help.sandbox.patterns.title":"Вкладка «Паттерны»","help.sandbox.patterns.content":"<p>Паттерны — экспортированные группы реплик из чатов. Используются для автоматической оценки и обучения.</p><ul><li><strong>Создание:</strong> паттерны создаются через экспорт групп из вкладки «Чат» (не здесь)</li><li><strong>Поиск:</strong> семантический поиск по паттернам — введите запрос и нажмите «Тест поиска»</li><li><strong>Управление:</strong> активация/деактивация, удаление через меню ⋮</li></ul>","help.sandbox.phrases.title":"Вкладка «Фразы агента»","help.sandbox.phrases.content":"<p>Справочная вкладка (только просмотр) — показывает <strong>все фразы</strong>, которые агент может произнести.</p><ul><li><strong>Шаблоны из БД</strong> (фиолетовые) — переопределения из раздела «Сценарии → Шаблоны»</li><li><strong>Встроенные фразы</strong> — захардкоженные фразы-заглушки (используются если нет шаблонов)</li><li><strong>Пулы фраз</strong> — наборы вариантов для случайного выбора (ожидание, уточнение и т.д.)</li></ul><p>Для редактирования фраз перейдите в <strong>Сценарии → Шаблоны ответов</strong>.</p>","help.sandbox.starters.title":"Вкладка «Шаблоны старта»","help.sandbox.starters.content":"<p>Готовые сценарии для быстрого начала тестового разговора. Шаблоны отображаются как карточки при создании нового разговора.</p><ul><li><strong>Название</strong> — краткое описание сценария</li><li><strong>Первое сообщение</strong> — стартовая реплика клиента (отправляется автоматически)</li><li><strong>Сценарий</strong> — тип (tire_search, order_creation и т.д.)</li><li><strong>Персона</strong> — тип клиента (neutral, angry, confused, rushed, detailed)</li></ul><p>Создание: кнопка <strong>«Новый шаблон»</strong>. Редактирование / удаление через кнопки в строке таблицы.</p>","help.sandbox.workflow.title":"Рекомендуемый рабочий процесс","help.sandbox.workflow.content":"<p>Полный цикл контроля качества промпта:</p><ol><li><strong>Создайте шаблоны старта</strong> для типичных сценариев (вкладка «Шаблоны»)</li><li><strong>Проведите серию тестовых диалогов</strong> со старым промптом, оцените ответы звёздочками</li><li><strong>Пометьте лучшие разговоры как baseline</strong> (кнопка в шапке чата)</li><li><strong>Создайте новую версию промпта</strong> (раздел «Промпты»)</li><li><strong>Запустите регрессионные тесты</strong> — сравните ответы нового промпта с baseline</li><li><strong>Проведите новые тестовые диалоги</strong> с новым промптом</li><li><strong>Если качество устраивает</strong> — активируйте промпт или запустите A/B тест</li></ol>","help.sandbox.tips":"<ul><li>Перед изменением промпта <strong>пометьте лучшие разговоры как baseline</strong> — это ваша точка отсчёта</li><li>Используйте <strong>«Auto customer»</strong> для быстрой генерации реалистичных сообщений клиента</li><li>Режим <strong>Live Tools</strong> даёт реальные данные — полезно для финальной проверки перед продакшеном</li><li><strong>Ветвление</strong> позволяет попробовать «а что если клиент спросил иначе?»</li><li>Экспортируйте <strong>негативные группы</strong> в паттерны — это улучшит автоматическую оценку</li></ul>","help.tools.title":"Справка: Инструменты агента","help.tools.overview":"<p>Инструменты (tools) — это <strong>действия</strong>, которые AI-агент может выполнять во время разговора: искать шины, проверять наличие, оформлять заказ, записывать на шиномонтаж и т.д. Здесь вы можете <strong>изменить описание</strong> любого инструмента, чтобы повлиять на то, когда и как агент его использует.</p>","help.tools.overrides.title":"Что такое переопределения описаний","help.tools.overrides.content":"<p>Каждый инструмент имеет <strong>описание по умолчанию</strong> (захардкожено в коде). LLM читает это описание и решает, когда вызвать инструмент.</p><ul><li><strong>Переопределение</strong> — замена описания по умолчанию на кастомный текст</li><li>Бейдж <strong>«Overridden»</strong> (жёлтый) — описание изменено</li><li>Бейдж <strong>«Default»</strong> (серый) — используется стандартное описание</li><li><strong>Сброс</strong> — красная кнопка удаляет переопределение и возвращает стандартное описание</li></ul>","help.tools.overrides.steps":"Пошаговая инструкция: Изменение описания","help.tools.overrides.stepsContent":"<p><strong>Изменение описания инструмента:</strong></p><ol><li>Найдите нужный инструмент в таблице</li><li>Нажмите <strong>«Редактировать»</strong></li><li>В модальном окне вверху показано <strong>оригинальное описание</strong> (для справки)</li><li>В поле ниже отредактируйте <strong>текст описания</strong></li><li>Нажмите <strong>«Сохранить»</strong></li></ol><p><strong>Сброс к стандартному:</strong></p><ol><li>Нажмите красную кнопку <strong>«Сбросить»</strong> рядом с инструментом</li><li>Подтвердите — описание вернётся к стандартному из кода</li></ol><p><strong>Проверка изменений:</strong></p><ol><li>Перейдите в <strong>Песочницу</strong></li><li>Создайте тестовый разговор</li><li>Попросите агента выполнить действие, связанное с инструментом</li><li>Проверьте, что агент правильно выбирает инструмент</li></ol>","help.tools.list.title":"Список инструментов","help.tools.list.content":"<p>Доступные инструменты агента:</p><ul><li><code>get_vehicle_tire_sizes</code> — определение размера шин по марке/модели авто</li><li><code>search_tires</code> — поиск шин по параметрам (размер, бренд, сезон)</li><li><code>check_availability</code> — проверка наличия конкретной шины на складе</li><li><code>get_order_status</code> — проверка статуса заказа по номеру</li><li><code>create_order_draft</code> — создание черновика заказа</li><li><code>update_order_delivery</code> — выбор способа доставки</li><li><code>confirm_order</code> — подтверждение заказа</li><li><code>get_fitting_stations</code> — список станций шиномонтажа</li><li><code>get_fitting_slots</code> — свободные слоты для записи</li><li><code>book_fitting</code> — запись на шиномонтаж</li><li><code>get_pickup_points</code> — точки самовывоза</li><li><code>search_knowledge_base</code> — поиск по базе знаний (RAG)</li><li><code>transfer_to_operator</code> — перевод на живого оператора</li></ul>","help.tools.affects.title":"На что влияют изменения","help.tools.affects.content":'<div class="help-affects"><p><strong>Описание инструмента</strong> — это подсказка для LLM. Агент <strong>не знает</strong>, что делает инструмент — он полагается только на описание.</p><p>Если описание <strong>слишком расплывчатое</strong> — агент может вызывать инструмент в неподходящих ситуациях.</p><p>Если описание <strong>слишком узкое</strong> — агент может пропускать ситуации, когда инструмент нужен.</p><p><strong>Пример:</strong> если агент путает <code>search_tires</code> и <code>check_availability</code>, уточните в описании: «используй search_tires для подбора по параметрам, check_availability — только для проверки конкретного артикула».</p></div>',"help.tools.tips":"<ul><li>Изменяйте описания <strong>осторожно</strong> — они напрямую влияют на выбор инструмента агентом</li><li><strong>Всегда</strong> тестируйте изменения в Песочнице перед применением</li><li>Если агент путает два инструмента — добавьте в описание <strong>явное разграничение</strong></li><li>Описание пишите на <strong>английском языке</strong> — LLM лучше понимает инструкции на английском</li><li>Используйте кнопку <strong>«Сбросить»</strong> если изменение ухудшило качество</li></ul>"},ua={"common.retry":"Retry","common.save":"Save","common.cancel":"Cancel","common.add":"Add","common.create":"Create","common.edit":"Edit","common.delete":"Delete","common.filter":"Filter","common.yes":"Yes","common.no":"No","common.loading":"Loading...","common.failedToLoad":"Failed to load: {error}","common.activate":"Activate","common.deactivate":"Deactivate","common.select":"Select","common.pageInfo":"Page {current} of {total}","common.all":"All","common.allStatuses":"All statuses","common.searchPlaceholder":"Search...","common.showing":"Showing: {shown} of {total}","common.filters":"Filters","common.actions":"Actions","login.title":"Call Center AI","login.error":"Invalid credentials","login.username":"Username","login.password":"Password","login.submit":"Login","nav.dashboard":"Dashboard","nav.calls":"Call Journal","nav.training":"Agent Training","nav.operators":"Operators","nav.system":"System","nav.users":"Users","nav.prompts":"Prompts","nav.knowledge":"Knowledge Base","nav.scenarios":"Scenarios","nav.tools":"Tools","nav.monitoring":"Monitoring","nav.configuration":"Configuration","nav.tenants":"Networks","nav.notifications":"Notifications","nav.audit":"Audit Log","nav.logout":"Logout","theme.dark":"Dark","theme.light":"Light","ws.live":"Live","ws.reconnecting":"Reconnecting...","ws.offline":"Offline","api.sessionExpired":"Session expired. Please login again.","api.unauthorized":"Unauthorized","api.requestTimeout":"Server response timed out","api.networkError":"Unable to connect to server","dashboard.breadcrumb":"Dashboard","dashboard.title":"Dashboard","dashboard.callsToday":"Calls today","dashboard.resolvedByBot":"Resolved by bot","dashboard.transferred":"Transferred","dashboard.avgQuality":"Avg quality","dashboard.costToday":"Cost today","dashboard.exportCSV":"Export Stats CSV","dashboard.downloadPDF":"Download PDF","dashboard.grafana":"Grafana Real-time","dashboard.csvExported":"CSV exported","dashboard.exportFailed":"Export failed: {error}","dashboard.pdfDownloaded":"PDF report downloaded","dashboard.pdfFailed":"PDF download failed: {error}","dashboard.failedToLoad":"Failed to load dashboard: {error}","dashboard.filterByNetwork":"Network:","dashboard.allNetworks":"All networks","dashboard.noAnalyticsAccess":"You do not have access to analytics. Use the navigation menu to go to an available section.","calls.breadcrumb":"Call Journal","calls.title":"Call Journal","calls.allScenarios":"All scenarios","calls.tireSearch":"Tire search","calls.availability":"Availability","calls.order":"Order","calls.fitting":"Fitting","calls.consultation":"Consultation","calls.all":"All","calls.transferred":"Transferred","calls.resolvedByBot":"Resolved by bot","calls.searchPlaceholder":"Search transcription...","calls.qualityBelow":"Quality below","calls.exportCSV":"Export CSV","calls.csvExported":"CSV exported","calls.exportFailed":"Export failed: {error}","calls.noCalls":"No calls found","calls.failedToLoad":"Failed to load calls: {error}","calls.date":"Date","calls.caller":"Caller","calls.scenario":"Scenario","calls.duration":"Duration","calls.quality":"Quality","calls.cost":"Cost","calls.status":"Status","calls.statusTransferred":"Transferred","calls.statusResolved":"Resolved","calls.detailTitle":"Call Details","calls.detailCaller":"Caller:","calls.detailScenario":"Scenario:","calls.detailDuration":"Duration:","calls.detailQuality":"Quality:","calls.detailCost":"Cost:","calls.detailPrompt":"Prompt:","calls.qualityBreakdown":"Quality Breakdown","calls.transcription":"Transcription","calls.noTranscription":"No transcription available","calls.customer":"Customer","calls.bot":"Bot","calls.toolCalls":"Tool Calls","calls.toolName":"Tool","calls.toolSuccess":"Success","calls.toolDuration":"Duration","calls.downloadTranscript":"Download transcript","calls.transcriptDownloaded":"Transcript downloaded","calls.transcriptFailed":"Download failed: {error}","calls.failedToLoadDetail":"Failed to load call details: {error}","prompts.breadcrumb":"Prompts","prompts.title":"Prompt Management","prompts.versions":"Versions","prompts.abTests":"A/B Tests","prompts.newVersion":"+ New Version","prompts.noVersions":"No prompt versions found","prompts.name":"Name","prompts.active":"Active","prompts.activeLabel":"Active","prompts.created":"Created","prompts.action":"Action","prompts.activateBtn":"Activate","prompts.failedToLoad":"Failed to load prompts: {error}","prompts.createTitle":"Create New Prompt Version","prompts.nameLabel":"Name","prompts.namePlaceholder":"e.g. v2.0-improved-search","prompts.systemPromptLabel":"System Prompt","prompts.systemPromptPlaceholder":"Enter system prompt text...","prompts.nameRequired":"Name and system prompt are required","prompts.created_toast":"Prompt version created","prompts.createFailed":"Failed to create prompt: {error}","prompts.activateConfirm":"Activate this prompt version? All calls will use it.","prompts.activated":"Prompt version activated","prompts.activateFailed":"Failed to activate prompt: {error}","prompts.noABTests":"No A/B tests found","prompts.testName":"Test","prompts.variantA":"Variant A","prompts.variantB":"Variant B","prompts.callsAB":"Calls A/B","prompts.qualityAB":"Quality A/B","prompts.abStatus":"Status","prompts.abAction":"Action","prompts.stopBtn":"Stop","prompts.stopConfirm":"Stop this A/B test?","prompts.stopped":"A/B test stopped","prompts.stopFailed":"Failed to stop test: {error}","prompts.failedToLoadAB":"Failed to load A/B tests: {error}","prompts.newABTest":"+ New A/B Test","prompts.createABTestTitle":"Create A/B Test","prompts.testNameLabel":"Test name","prompts.testNameRequired":"Test name is required","prompts.variantALabel":"Variant A","prompts.variantBLabel":"Variant B","prompts.trafficSplitLabel":"Traffic split (% variant A)","prompts.variantsRequired":"Select both variants","prompts.variantsMustDiffer":"Variants A and B must be different","prompts.abTestCreated":"A/B test created","prompts.abTestCreateFailed":"Failed to create A/B test: {error}","prompts.deleteABTestConfirm":'Delete A/B test "{name}"?',"prompts.abTestDeleted":"A/B test deleted","prompts.abTestDeleteFailed":"Failed to delete A/B test: {error}","prompts.recommended":"Recommended: {variant}","prompts.noSignificance":"No significant difference","prompts.notEnoughData":"Not enough data","prompts.stoppedWithResult":"Test stopped. {result}","prompts.abReportTitle":"A/B Test Report","prompts.reportSummary":"Summary","prompts.reportCriteria":"By Criteria","prompts.reportScenarios":"By Scenario","prompts.reportDaily":"Daily Dynamics","prompts.reportCalls":"Calls","prompts.reportQuality":"Quality","prompts.reportAvgDuration":"Avg Duration","prompts.reportTransferRate":"Transfer Rate","prompts.reportCriterion":"Criterion","prompts.reportDelta":"Delta","prompts.reportScenario":"Scenario","prompts.exportCSV":"Export CSV","prompts.csvExported":"CSV exported","prompts.exportFailed":"Export failed: {error}","prompts.reportFailedToLoad":"Failed to load report: {error}","prompts.reportNoData":"No data for report","prompts.criterionGreeting":"Greeting","prompts.criterionIntent":"Intent Understanding","prompts.criterionToolUsage":"Tool Usage","prompts.criterionAccuracy":"Information Accuracy","prompts.criterionConfirmation":"Action Confirmation","prompts.criterionConciseness":"Conciseness","prompts.criterionResolution":"Resolution Without Operator","prompts.criterionSatisfaction":"Customer Satisfaction","prompts.viewTitle":"View Prompt","prompts.loadDefault":"Load default","prompts.resetToDefault":"Reset to factory","prompts.resetConfirm":"Create a new version from the factory prompt and activate it?","prompts.resetDone":"Prompt reset to factory defaults","prompts.resetFailed":"Reset failed: {error}","prompts.deleteConfirm":'Delete prompt "{name}"?',"prompts.deleted":"Prompt deleted","prompts.deleteFailed":"Failed to delete prompt: {error}","prompts.pronunciationRules":"Pronunciation Rules","prompts.pronunciationRulesDesc":"TTS pronunciation rules — appended to the agent system prompt. Use to correct pronunciation of tire sizes, brands, models, etc.","prompts.pronunciationRulesSave":"Save","prompts.pronunciationRulesSaved":"Pronunciation rules saved","prompts.pronunciationRulesSaveFailed":"Save failed: {error}","prompts.pronunciationRulesReset":"Reset to defaults","prompts.pronunciationRulesResetConfirm":"Reset pronunciation rules to factory defaults?","prompts.pronunciationRulesResetDone":"Pronunciation rules reset to defaults","prompts.pronunciationRulesSource":"Source: {source}","prompts.pronunciationRulesSourceRedis":"Redis (custom)","prompts.pronunciationRulesSourceDefault":"factory defaults","prompts.optimizer":"Prompt Optimizer","prompts.optimizerRuns":"runs","prompts.optimizerDesc":"Automatic analysis of failed calls with recommendations for prompt improvement.","prompts.optimizerRun":"Run Analysis","prompts.optimizerRunning":"Running...","prompts.optimizerStarted":"Analysis started (task: {taskId})","prompts.optimizerRunFailed":"Failed to start: {error}","prompts.optimizerDate":"Date","prompts.optimizerCalls":"Calls","prompts.optimizerPatterns":"Patterns","prompts.optimizerStatus":"Status","prompts.optimizerTriggered":"Triggered By","prompts.optimizerCompleted":"Completed","prompts.optimizerError":"Error","prompts.optimizerView":"Details","prompts.optimizerNoResults":"No analysis results yet","prompts.optimizerLoadFailed":"Failed to load: {error}","prompts.optimizerDetailTitle":"Analysis Results","prompts.optimizerRecommendation":"Recommendation","prompts.optimizerPattern":"Pattern","prompts.optimizerSeverity":"Severity","prompts.optimizerFrequency":"Frequency","prompts.optimizerSuggestion":"Suggestion","prompts.action":"Actions","knowledge.breadcrumb":"Knowledge Base","knowledge.title":"Knowledge Base","knowledge.allCategories":"All categories","knowledge.searchPlaceholder":"Search...","knowledge.allActive":"All","knowledge.activeOnly":"Active only","knowledge.inactiveOnly":"Inactive only","knowledge.newArticle":"+ New Article","knowledge.reindexAll":"Reindex All","knowledge.importDocuments":"Import Documents","knowledge.noArticles":"No articles found","knowledge.articleTitle":"Title","knowledge.category":"Category","knowledge.embedding":"Embedding","knowledge.activeCol":"Active","knowledge.updated":"Updated","knowledge.expiresAt":"Expires","knowledge.expired":"Expired","knowledge.expiresAtLabel":"Expires at (optional)","knowledge.expiresAtHint":"Article will auto-hide after this date. Empty = no expiration.","knowledge.actions":"Actions","knowledge.editBtn":"Edit","knowledge.reindexBtn":"Reindex","knowledge.deleteBtn":"Delete","knowledge.total":"Total: {count} articles","knowledge.failedToLoad":"Failed to load articles: {error}","knowledge.newArticleTitle":"New Article","knowledge.editArticleTitle":"Edit Article","knowledge.titleLabel":"Title","knowledge.titlePlaceholder":"Article title","knowledge.categoryLabel":"Category","knowledge.contentLabel":"Content (Markdown)","knowledge.contentPlaceholder":"Article content in Markdown...","knowledge.titleRequired":"Title and content are required","knowledge.articleUpdated":"Article updated","knowledge.articleCreated":"Article created","knowledge.saveFailed":"Failed to save article: {error}","knowledge.articleDeactivated":"Article deactivated","knowledge.articleActivated":"Article activated","knowledge.toggleFailed":"Failed to update article: {error}","knowledge.deleteConfirm":'Delete article "{title}"?',"knowledge.articleDeleted":"Article deleted","knowledge.deleteFailed":"Failed to delete article: {error}","knowledge.reindexQueued":"Reindex queued","knowledge.reindexFailed":"Reindex failed: {error}","knowledge.reindexAllConfirm":"Reindex all articles? This may take a while.","knowledge.reindexAllDispatched":"Reindex-all dispatched","knowledge.reindexAllFailed":"Reindex-all failed: {error}","knowledge.loadFailed":"Failed to load article: {error}","knowledge.importTitle":"Import Documents","knowledge.importFilesLabel":"Files (MD, PDF, DOCX)","knowledge.importCategoryLabel":"Category (optional, auto-detect if empty)","knowledge.importAutoDetect":"Auto-detect from filename","knowledge.importBtn":"Import","knowledge.importNoFiles":"Please select files to import","knowledge.importResult":"Imported: {imported}","knowledge.importErrors":"Errors: {errors}","knowledge.importFailed":"Import failed: {error}","operators.breadcrumb":"Operators","operators.title":"Operators","operators.online":"Operators Online","operators.transfers1h":"Transfers (1h)","operators.queueUnavailable":"Queue status unavailable","operators.newOperator":"+ New Operator","operators.searchPlaceholder":"Search by name/extension...","operators.allStatuses":"All statuses","operators.noOperators":"No operators found","operators.name":"Name","operators.extension":"Extension","operators.status":"Status","operators.skills":"Skills","operators.shift":"Shift","operators.activeCol":"Active","operators.actionsCol":"Actions","operators.statusSelect":"Status...","operators.statusOnline":"Online","operators.statusOffline":"Offline","operators.statusBusy":"Busy","operators.statusBreak":"Break","operators.editBtn":"Edit","operators.deactivateBtn":"Deactivate","operators.failedToLoad":"Failed to load operators: {error}","operators.newOperatorTitle":"New Operator","operators.editOperatorTitle":"Edit Operator","operators.nameLabel":"Name","operators.namePlaceholder":"Full name","operators.extensionLabel":"Extension (SIP)","operators.extensionPlaceholder":"e.g. 101","operators.skillsLabel":"Skills (comma-separated)","operators.skillsPlaceholder":"tires, orders, fitting","operators.shiftStartLabel":"Shift Start","operators.shiftEndLabel":"Shift End","operators.nameRequired":"Name and extension are required","operators.operatorUpdated":"Operator updated","operators.operatorCreated":"Operator created","operators.saveFailed":"Failed to save operator: {error}","operators.statusChanged":"Status changed to {status}","operators.statusFailed":"Failed to change status: {error}","operators.deactivateConfirm":'Deactivate operator "{name}"?',"operators.operatorDeactivated":"Operator deactivated","operators.deactivateFailed":"Failed to deactivate: {error}","operators.notFound":"Operator not found","operators.loadFailed":"Failed to load operator: {error}","settings.breadcrumb":"System","settings.title":"System Status","settings.healthCheck":"Health Check","settings.refresh":"Refresh","settings.extendedStatus":"Extended Status","settings.clickToLoad":"Click to load","settings.loadStatus":"Load Status","settings.configuration":"Configuration","settings.configDescription":"Reload safe config parameters (quality, feature flags, logging) without restart.","settings.reloadConfig":"Reload Config","settings.externalTools":"External Tools","settings.openGrafana":"Open Grafana","settings.openPrometheus":"Open Prometheus","settings.openFlower":"Open Flower","settings.celeryTasks":"Celery Tasks (Flower)","settings.loadFlower":"Load Flower","settings.appInfo":"Application Info","settings.version":"Version","settings.status":"Status","settings.activeCalls":"Active calls","settings.redis":"Redis","settings.storeAPI":"Store API","settings.claudeAPI":"Claude API","settings.googleSTT":"Google STT","settings.ttsEngine":"TTS Engine","settings.failedToLoad":"Failed to load system info: {error}","settings.extVersion":"Version","settings.uptime":"Uptime","settings.uptimeValue":"{hours}h {minutes}m","settings.pgDbSize":"PostgreSQL DB size","settings.pgConnections":"PostgreSQL connections","settings.redisMemory":"Redis memory","settings.celeryWorkers":"Celery workers","settings.lastBackup":"Last backup","settings.extFailed":"Failed: {error}","settings.reloadConfirm":"Reload configuration from environment?","settings.configReloaded":`Config reloaded:
`,"settings.reloadFailed":"Reload failed: {error}","settings.llmRouting":"LLM Routing","settings.llmRoutingDesc":"Multi-provider LLM routing: manage providers, tasks, and fallback chains.","settings.llmLoadConfig":"Load Configuration","settings.llmProvider":"Provider","settings.llmType":"Type","settings.llmModel":"Model","settings.llmApiKey":"API Key","settings.llmEnabled":"Enabled","settings.llmHealth":"Health","settings.llmActions":"Actions","settings.llmTest":"Test","settings.llmTaskRouting":"Task Routing","settings.llmTask":"Task","settings.llmPrimary":"Primary","settings.llmFallbacks":"Fallbacks","settings.llmAddProvider":"Add provider","settings.llmAddFillRequired":"Model name is required","settings.llmProviderAdded":"Provider {key} added","settings.llmModelUpdated":"{key}: model changed to {model}","settings.llmProviderToggled":"Provider {key}: {state}","settings.llmRouteUpdated":"Task {task} → {provider}","settings.llmTaskDesc_agent":"Main AI agent: handles customer dialogue, calls tools (tire search, orders, fitting booking).","settings.llmTaskRec_agent":"Recommendation: powerful model (Sonnet, GPT-4o). Requires tool calling, high dialogue quality.","settings.llmTaskDesc_article_processor":"Knowledge base article processing: structuring, cleanup, key fact extraction from imported documents.","settings.llmTaskRec_article_processor":"Recommendation: fast/cheap model (Haiku, GPT-4o-mini). Background task, no tool calling needed.","settings.llmTaskDesc_quality_scoring":"Call quality scoring: transcription analysis, rating by criteria (accuracy, politeness, completeness).","settings.llmTaskRec_quality_scoring":"Recommendation: fast/cheap model (Haiku, GPT-4o-mini). Background Celery task, batch processing.","settings.llmTaskDesc_prompt_optimizer":"System prompt optimization: A/B test results analysis, improved prompt version generation.","settings.llmTaskRec_prompt_optimizer":"Recommendation: fast/cheap model (Haiku, GPT-4o-mini). Rare background task.","settings.llmFbSelect":"Select...","settings.llmFbMoveUp":"Move up","settings.llmFbMoveDown":"Move down","settings.llmFallbacksUpdated":"Fallbacks for {task}: {count}","settings.llmConfigFailed":"Config save failed: {error}","settings.llmTesting":"Testing {key}...","settings.llmTestSuccess":"{key}: OK ({latency}ms)","settings.llmTestFailed":"{key}: failed — {error}","settings.llmLoadFailed":"Failed to load LLM config: {error}","settings.telegram":"Telegram Notifications","settings.telegramDesc":"Configure Telegram bot for receiving Alertmanager alerts.","settings.telegramLoadConfig":"Load","settings.telegramStatus":"Token","settings.telegramTokenSet":"configured","settings.telegramTokenMissing":"not configured","settings.telegramBotToken":"Bot Token","settings.telegramBotTokenPlaceholder":"New token (leave empty to keep current)","settings.telegramChatId":"Chat ID","settings.telegramChatIdPlaceholder":"Numeric chat or group ID","settings.telegramTestBtn":"Test","settings.telegramSaved":"Telegram config saved","settings.telegramSaveFailed":"Save failed: {error}","settings.telegramFillFields":"Enter at least token or chat_id","settings.telegramTesting":"Sending test message...","settings.telegramTestSuccess":"Test OK ({latency}ms)","settings.telegramTestFailed":"Error: {error}","settings.telegramLoadFailed":"Failed to load Telegram config: {error}","users.breadcrumb":"Users","users.title":"User Management","users.newUser":"+ New User","users.noUsers":"No users found","users.username":"Username","users.role":"Role","users.activeCol":"Active","users.lastLogin":"Last Login","users.actionsCol":"Actions","users.changeRole":"Change role...","users.roleAdmin":"Admin","users.roleAnalyst":"Analyst","users.roleOperator":"Operator","users.resetPwd":"Reset pwd","users.failedToLoad":"Failed to load users: {error}","users.createTitle":"Create New User","users.usernameLabel":"Username","users.usernamePlaceholder":"username","users.passwordLabel":"Password","users.passwordPlaceholder":"password","users.roleLabel":"Role","users.usernameRequired":"Username and password are required","users.userCreated":"User created","users.createFailed":"Failed to create user: {error}","users.roleUpdated":"Role updated","users.roleFailed":"Failed to update role: {error}","users.userDeactivated":"User deactivated","users.userActivated":"User activated","users.toggleFailed":"Failed to update user: {error}","users.newPasswordPrompt":"New password for {username}:","users.passwordReset":"Password reset","users.resetFailed":"Failed to reset password: {error}","users.roleContentManager":"Content Manager","users.permissions":"Permissions","users.useRoleDefaults":"Role defaults","users.customPermissions":"Custom","users.editPermissions":"Permissions...","users.permissionsUpdated":"Permissions updated","users.permissionsFailed":"Failed to update permissions: {error}","training.breadcrumb":"Agent Training","training.title":"Agent Training","training.tabPrompts":"Prompts","training.tabKnowledge":"Knowledge Base","training.tabTemplates":"Response Templates","training.tabDialogues":"Dialogue Scenarios","training.tabSafety":"Safety Rules","training.tabTools":"Tools","training.activeCol":"Active","training.actions":"Actions","training.loadFailed":"Failed to load: {error}","training.saveFailed":"Failed to save: {error}","training.deleteFailed":"Failed to delete: {error}","training.deleteConfirm":'Delete "{title}"?',"training.titleRequired":"Title is required","training.titleContentRequired":"Title and content are required","training.fieldsRequired":"All required fields must be filled","training.keyRequired":"Template key is required","training.newTemplate":"+ New Template","training.editTemplate":"Edit Template","training.addVariantTitle":"Add Response Variant","training.noTemplates":"No templates found","training.templateKey":"Key","training.templateTitle":"Title","training.content":"Content","training.description":"Description","training.templateSaved":"Template saved","training.addVariant":"+ Variant","training.variantCount":"var.","training.variantsHint":"Multiple variants per key — agent randomly picks one for each call","training.deleteVariantConfirm":'Delete variant "{title}"?',"training.variantDeleted":"Variant deleted","training.allTemplateKeys":"All keys","training.searchTemplates":"Search templates...","training.filterScenario":"Scenario","training.allScenarios":"All scenarios","training.filterPhase":"Phase","training.allPhases":"All phases","training.filterActive":"Status","training.allActive":"All","training.activeOnly":"Active","training.inactiveOnly":"Inactive","training.newDialogue":"+ New Scenario","training.editDialogue":"Edit Scenario","training.noDialogues":"No scenarios found","training.dialogueTitle":"Title","training.dialogueTitlePlaceholder":"Scenario title","training.scenario":"Scenario","training.phase":"Phase","training.tools":"Tools","training.dialogueJSON":"Dialogue (JSON)","training.invalidJSON":"Invalid JSON","training.dialogueSaved":"Scenario saved","training.dialogueDeleted":"Scenario deleted","training.filterRuleType":"Rule type","training.allRuleTypes":"All types","training.filterSeverity":"Severity","training.allSeverities":"All","training.newSafetyRule":"+ New Rule","training.editSafetyRule":"Edit Safety Rule","training.noSafetyRules":"No safety rules found","training.ruleTitle":"Title","training.ruleType":"Rule Type","training.severity":"Severity","training.triggerInput":"Trigger (customer input)","training.expectedBehavior":"Expected Behavior","training.safetyRuleSaved":"Safety rule saved","training.safetyRuleDeleted":"Safety rule deleted","training.regressionTest":"Test Rules","training.regressionRunning":"Testing...","training.regressionResults":"Safety Rules Test Results","training.regressionPassed":"Passed","training.regressionFailed_label":"Failed","training.regressionFailed":"Test failed: {error}","training.regressionPassedCount":"Passed: {count}","training.regressionFailedCount":"Failed: {count}","training.regressionTotal":"Total: {count}","training.regressionStatus":"Status","training.regressionActual":"Agent response","training.regressionReason":"Reason","training.toolName":"Tool","training.override":"Override","training.overridden":"Overridden","training.default":"Default","training.editTool":"Edit Tool","training.originalDescription":"Default Description","training.overrideDescription":"Override Description","training.descriptionRequired":"Description is required","training.toolOverrideSaved":"Tool override saved","training.toolOverrideReset":"Tool override reset","training.reset":"Reset","training.resetConfirm":"Reset override for {name}?","training.resetFailed":"Failed to reset: {error}","training.toolNotFound":"Tool not found","training.tabSources":"Sources","sources.enabled":"Scraper enabled","sources.autoApprove":"Auto-publish","sources.runNow":"Run now","sources.schedule":"Schedule","sources.noSources":"No sources found","sources.allStatuses":"All statuses","sources.url":"URL","sources.originalTitle":"Original title","sources.status":"Status","sources.date":"Date","sources.actions":"Actions","sources.approve":"Approve","sources.reject":"Reject","sources.viewArticle":"Article","sources.total":"Total: {count}","sources.configUpdated":"Config updated","sources.configUpdateFailed":"Config update failed: {error}","sources.configLoadFailed":"Failed to load config: {error}","sources.runDispatched":"Scraper run dispatched","sources.runFailed":"Failed to start scraper: {error}","sources.approved":"Article approved and activated","sources.approveFailed":"Approval failed: {error}","sources.rejected":"Source rejected","sources.rejectFailed":"Rejection failed: {error}","sources.rejectConfirm":"Reject this source?","sources.failedToLoad":"Failed to load sources: {error}","sources.minDate":"From date","sources.minDateHint":"Empty = last 14 days (auto mode)","sources.maxDate":"To date","sources.maxDateHint":"Empty = no limit (up to today)","sources.dedupLlmCheck":"LLM dedup check","sources.dedupLlmCheckHint":"Use LLM for borderline duplicates (0.80–0.90 similarity)","sources.duplicate":"duplicate","sources.duplicateSuspect":"possible duplicate","sources.watchedPagesTitle":"Watched Pages","sources.watchedPagesHint":"Website pages that are periodically re-scraped to keep the agent's knowledge base up to date.","sources.addWatchedPage":"Add page","sources.noWatchedPages":"No watched pages added","sources.watchedUrl":"URL","sources.watchedCategory":"Category","sources.watchedInterval":"Interval (h)","sources.watchedStatus":"Status","sources.watchedLastScraped":"Last scraped","sources.watchedNextScrape":"Next scrape","sources.watchedArticle":"Article","sources.watchedActions":"Actions","sources.scrapeNow":"Scrape now","sources.deleteWatched":"Delete","sources.watchedPageAdded":"Page added","sources.watchedPageAddFailed":"Failed to add: {error}","sources.watchedPageDeleted":"Page removed","sources.watchedPageDeleteFailed":"Failed to remove: {error}","sources.watchedPageDeleteConfirm":"Remove this watched page?","sources.watchedPageUpdated":"Settings updated","sources.watchedPageUpdateFailed":"Failed to update: {error}","sources.scrapeNowRunning":"Scraping...","sources.scrapeNowDone":"Scrape completed: {status}","sources.scrapeNowUnchanged":"Content has not changed","sources.scrapeNowDiscoveryDone":"Discovery: found {discovered} pages, created {created}, updated {updated}","sources.scrapeNowFailed":"Scrape failed: {error}","sources.watchedFailedToLoad":"Failed to load: {error}","sources.urlRequired":"Enter a page URL","sources.categoryRequired":"Select a category","sources.intervalRequired":"Select an interval","sources.urlPlaceholder":"https://prokoleso.ua/ua/...","sources.neverScraped":"not scraped yet","sources.filterByTenant":"Network:","sources.allTenants":"All networks","sources.noTenant":"No network","sources.tenant":"Network","sources.discoveryLabel":"Catalog page","sources.discoveryBadge":"catalog","sources.discoveryHint":"A page with a list of links (e.g. promotions). Automatically discovers all child pages and scrapes each one separately.","sources.childCount":"{count} children","sources.intervalHours.6":"Every 6h","sources.intervalHours.12":"Every 12h","sources.intervalHours.24":"Daily","sources.intervalHours.168":"Weekly","sources.tabConfigs":"Configurations","sources.tabScraper":"Scraper","sources.tabWatched":"Watched Pages","sources.sourceConfigsTitle":"Content Sources","sources.sourceConfigsHint":"External sites for collecting articles into the knowledge base.","sources.scraperConfigTitle":"ProKoleso — manual import","sources.addSource":"Add source","sources.editSource":"Edit source","sources.sourceName":"Name","sources.sourceType":"Type","sources.sourceUrl":"URL","sources.sourceLanguage":"Language","sources.maxArticles":"Max articles","sources.lastRun":"Last run","sources.runSource":"Run","sources.deleteSource":"Delete","sources.settingsJson":"Settings (JSON)","sources.noSourceConfigs":"No content sources configured","sources.sourceConfigSaved":"Source saved","sources.sourceConfigSaveFailed":"Failed to save: {error}","sources.sourceConfigDeleted":"Source deleted","sources.sourceConfigDeleteFailed":"Failed to delete: {error}","sources.deleteSourceConfirm":'Delete source "{name}"?',"sources.nameUrlRequired":"Name and URL are required","sources.invalidSettingsJson":"Invalid JSON in settings","sources.processed":"Processed","sources.bulkImport":"Bulk Import","sources.bulkImportTitle":"Bulk Import Watched Pages","sources.bulkUrlsPlaceholder":"Enter URLs (one per line)...","sources.bulkImportResult":"Added: {added}, skipped: {skipped}","tenants.title":"Networks","tenants.newTenant":"+ New Network","tenants.editTenant":"Edit Network","tenants.slug":"Slug","tenants.name":"Name","tenants.networkId":"Network ID","tenants.agentName":"Agent Name","tenants.greeting":"Greeting","tenants.enabledTools":"Enabled Tools","tenants.promptSuffix":"Prompt Suffix","tenants.config":"Configuration (JSON)","tenants.statusCol":"Status","tenants.actions":"Actions","tenants.active":"Active","tenants.activeLabel":"Active","tenants.inactive":"Inactive","tenants.created":"Network created","tenants.updated":"Network updated","tenants.deleted":"Network deactivated","tenants.activated":"Network activated","tenants.deactivated":"Network deactivated","tenants.deleteConfirm":'Deactivate network "{name}"?',"tenants.saveFailed":"Failed to save network: {error}","tenants.loadFailed":"Failed to load networks: {error}","tenants.noTenants":"No networks found","tenants.nameRequired":"Name and Network ID are required","tenants.slugRequired":"Slug is required","tenants.invalidConfigJson":"Invalid JSON in configuration","nav.vehicles":"Vehicles","vehicles.breadcrumb":"Vehicles","vehicles.title":"Vehicle Database","vehicles.searchPlaceholder":"Search by name...","vehicles.brands":"Brands","vehicles.models":"Models","vehicles.kits":"Kits","vehicles.tireSizes":"Tire Sizes","vehicles.lastImport":"Last Import","vehicles.brand":"Brand","vehicles.model":"Model","vehicles.year":"Year","vehicles.trim":"Trim","vehicles.pcd":"PCD","vehicles.bolts":"Bolts","vehicles.dia":"DIA","vehicles.size":"Size","vehicles.type":"Type","vehicles.axle":"Axle","vehicles.stock":"Stock","vehicles.tuning":"Tuning","vehicles.front":"Front","vehicles.rear":"Rear","vehicles.all":"All","vehicles.back":"← Back","vehicles.noData":"No data","vehicles.failedToLoad":"Failed to load: {error}","vehicles.neverImported":"Never imported","vehicles.importButton":"Update DB","vehicles.importTitle":"Update Vehicle Database","vehicles.importInstructions":"Place 4 CSV files in a directory on the server:","vehicles.importWarning":"Import will delete current data and load new. Operation takes ~30-60 seconds.","vehicles.importPathLabel":"Path to CSV directory","vehicles.importPathRequired":"Please enter the directory path","vehicles.importBtn":"Import","vehicles.importSuccess":"Import complete: {brands} brands, {models} models, {kits} kits, {tireSizes} tire sizes","vehicles.importFailed":"Import failed: {error}","common.search":"Search","audit.breadcrumb":"Audit Log","audit.title":"Audit Log","audit.allActions":"All actions","audit.noEntries":"No audit entries found","audit.date":"Date","audit.user":"User","audit.action":"Action","audit.resource":"Resource","audit.ip":"IP","audit.failedToLoad":"Failed to load audit log: {error}","nav.sandbox":"Sandbox","sandbox.breadcrumb":"Sandbox","sandbox.title":"Agent Sandbox","sandbox.tabChat":"Chat","sandbox.tabHistory":"History","sandbox.newConversation":"New Conversation","sandbox.archiveConversation":"Archive","sandbox.sendMessage":"Send","sandbox.messagePlaceholder":"Type a customer message...","sandbox.noConversation":"Select or create a conversation","sandbox.noConversations":"No conversations","sandbox.noMessages":"Start a conversation — send the first message","sandbox.conversationTitle":"Conversation title","sandbox.promptVersion":"Prompt version","sandbox.promptVersionDefault":"Active version","sandbox.toolMode":"Tool mode","sandbox.toolModeMock":"Mock (test data)","sandbox.toolModeLive":"Live (Store API)","sandbox.scenarioType":"Scenario type","sandbox.scenarioNone":"No type","sandbox.model":"Model","sandbox.modelDefault":"Default","sandbox.changeModel":"Change model","sandbox.modelChanged":"Model changed","sandbox.tags":"Tags (comma-separated)","sandbox.createConversation":"Create Conversation","sandbox.created":"Conversation created","sandbox.archived":"Conversation archived","sandbox.deleted":"Conversation deleted","sandbox.deleteConfirm":'Delete conversation "{title}"? All data will be lost.',"sandbox.deleteBlockedByRegression":"Conversation is referenced by regression runs. Archive it instead.","sandbox.ratingCommentPrompt":"Rating comment (optional):","sandbox.ratingSaved":"Rating saved","sandbox.ratingFailed":"Failed to save rating: {error}","sandbox.sendFailed":"Send failed: {error}","sandbox.llmError":"LLM error","sandbox.llmErrorHint":"LLM call failed (0 tokens). Check API key and server logs.","sandbox.loadFailed":"Failed to load: {error}","sandbox.customer":"Customer","sandbox.agent":"Agent","sandbox.toolCalls":"Tool Calls","sandbox.toolName":"Tool","sandbox.toolArgs":"Arguments","sandbox.toolResult":"Result","sandbox.toolDuration":"Duration","sandbox.mock":"mock","sandbox.live":"live","sandbox.metrics":"{latency}ms | {input}→{output} tokens | {model}","sandbox.turnsCount":"Turns","sandbox.avgRating":"Avg Rating","sandbox.lastActivity":"Last Activity","sandbox.status":"Status","sandbox.active":"Active","sandbox.archivedStatus":"Archived","sandbox.searchPlaceholder":"Search by title...","sandbox.allScenarios":"All scenarios","sandbox.rateComment":"Rating comment...","sandbox.branch":"Branch","sandbox.branchFrom":"Branch from turn #{turn}","sandbox.branchLabel":"Branch label","sandbox.autoCustomer":"Auto-customer","sandbox.autoCustomerHint":"Generate customer reply with AI","sandbox.persona":"Persona","sandbox.personaNeutral":"Neutral","sandbox.personaImpatient":"Impatient","sandbox.personaConfused":"Confused","sandbox.personaAngry":"Angry","sandbox.personaExpert":"Expert","sandbox.contextHint":"Context hint","sandbox.starters":"Starter Templates","sandbox.newStarter":"New Starter","sandbox.starterTitle":"Starter title","sandbox.firstMessage":"First message","sandbox.starterSaved":"Starter saved","sandbox.starterDeleted":"Starter deleted","sandbox.useStarter":"Use","sandbox.generating":"Generating...","sandbox.childBranches":"Branches","sandbox.tabRegression":"Regression","sandbox.regression":"Regression Tests","sandbox.replay":"Replay","sandbox.replayHint":"Replay conversation with a different prompt","sandbox.selectPromptVersion":"Select prompt version","sandbox.runRegression":"Run Regression","sandbox.regressionStarted":"Regression started","sandbox.regressionFailed":"Regression failed: {error}","sandbox.noRegressions":"No regression tests","sandbox.turnsCompared":"Turns compared","sandbox.sourceRating":"Avg rating (source)","sandbox.newRating":"Avg rating (new)","sandbox.scoreDiff":"Difference","sandbox.sourceResponse":"Source response","sandbox.newResponse":"New response","sandbox.diffView":"Comparison","sandbox.baseline":"Baseline","sandbox.markBaseline":"Mark as baseline","sandbox.unmarkBaseline":"Unmark baseline","sandbox.pending":"Pending","sandbox.running":"Running","sandbox.completed":"Completed","sandbox.failed":"Failed","sandbox.exportDialogue":"Export to training","sandbox.exported":"Exported to training data","sandbox.markingMode":"Marking mode","sandbox.createGroup":"Create group","sandbox.intentLabel":"Intent","sandbox.patternType":"Pattern type","sandbox.positive":"Positive","sandbox.negative":"Negative","sandbox.correction":"Correction","sandbox.correctionHint":"How the agent should have responded...","sandbox.groupCreated":"Group created","sandbox.groupUpdated":"Group updated","sandbox.groupDeleted":"Group deleted","sandbox.turnGroups":"Turn groups","sandbox.noGroups":"No groups","sandbox.turnsSelected":"{count} turns selected","sandbox.exportToPatterns":"Export to patterns","sandbox.alreadyExported":"Exported","sandbox.patterns":"Patterns","sandbox.guidanceNote":"Guidance note","sandbox.guidanceHint":"What to inject into the agent system prompt...","sandbox.exportSuccess":"Pattern exported","sandbox.patternActive":"Active","sandbox.patternInactive":"Inactive","sandbox.timesUsed":"Times used","sandbox.testSearch":"Test search","sandbox.testSearchHint":"Enter text to search for similar patterns...","sandbox.similarity":"Results","sandbox.noPatterns":"No patterns","sandbox.customerMessages":"Customer messages","sandbox.agentMessages":"Agent messages","sandbox.sending":"Sending...","sandbox.exitMarking":"Exit marking","sandbox.markingHint":"Select turns to create a group","sandbox.error":"Error","sandbox.openNewConversation":"Open new conversation","sandbox.intentRequired":"Enter an intent label","sandbox.guidanceRequired":"Enter a guidance note","sandbox.titleRequired":"Enter a conversation title","sandbox.ratingCommentPlaceholder":"Comment (Enter to save)","sandbox.convInfo":"Conversation details","sandbox.routerModel":"router","sandbox.tabPhrases":"Agent Phrases","sandbox.phrasesTitle":"Agent Phrases (TTS, no LLM)","sandbox.phrasesDescription":"These phrases are spoken by TTS directly, bypassing the LLM. DB templates override hardcoded ones — a random variant is picked per call.","sandbox.phrasesCategory":"Category","sandbox.phrasesKey":"Context","sandbox.phrasesText":"Phrase text","sandbox.phrasesSource":"Source","sandbox.phrasesStatus":"Status","sandbox.phrasesSourceCode":"code (prompts.py)","sandbox.phrasesSourceLLM":"LLM (generated)","sandbox.phrasesActive":"active","sandbox.phrasesOverridden":"overridden by DB","sandbox.phrasesInactive":"off","sandbox.phrasesCatFixed":"Hardcoded (fallback)","sandbox.phrasesCatWait":"Wait pools (hardcoded)","sandbox.phrasesPoolLabel":"pool ({count} variants, rotation)","sandbox.phrasesLoadFailed":"Failed to load phrases: {error}","sandbox.phrasesLlmNote":"All other agent responses are generated by the LLM in real time.","sandbox.phrasesDbTitle":"DB Templates (actually used)","sandbox.phrasesDbDescription":"These phrases are loaded from response_templates table and override hardcoded ones. A random active variant is picked per key on each call. Manage in: Scenarios → Templates.","sandbox.phrasesDbVariants":"{active} active of {total}","sandbox.branchMessage":"Branch message","sandbox.branchFromTurn":"Branch from turn {turn}","sandbox.submitBranch":"Send","sandbox.selectPromptForReplay":"Select prompt version for replay","sandbox.submitReplay":"Run","sandbox.personaRushed":"Rushed","sandbox.personaDetailed":"Detailed","sandbox.tabStarters":"Starters","sandbox.quickStart":"Quick Start","sandbox.manageStarters":"Manage Starters","sandbox.starterFirstMessage":"First message","sandbox.starterDescription":"Description","sandbox.starterPersona":"Persona","sandbox.noStarters":"No starter templates","sandbox.deleteStarterConfirm":'Delete starter "{title}"?',"sandbox.starterTitleRequired":"Title and first message are required","sandbox.editStarter":"Edit Starter","sandbox.bulkMode":"Bulk delete","sandbox.selectAll":"Select all","sandbox.deselectAll":"Deselect all","sandbox.bulkDelete":"Delete selected ({count})","sandbox.bulkDeleted":"Deleted: {deleted}, skipped: {skipped}","sandbox.bulkDeleteConfirm":"Delete {count} conversations? All data will be lost.","sandbox.bulkSkipped":"Some conversations are protected by regression runs and were not deleted.","help.close":"Close help","help.tipsTitle":"Useful tips","help.scenarios.title":"Help: Agent Training","help.scenarios.overview":"<p>Manage the AI agent's training data. Configure <strong>response templates</strong> (ready-made phrases), <strong>example dialogues</strong> (few-shot learning), and <strong>safety rules</strong> (restrictions). All changes apply <strong>instantly</strong> — the agent uses updated data on the next call.</p>","help.scenarios.templates.title":"What are response templates","help.scenarios.templates.content":"<p>Templates are ready-made Ukrainian phrases the agent uses in common situations. Each template belongs to a category:</p><ul><li><strong>greeting</strong> — greeting at call start</li><li><strong>farewell</strong> — goodbye at call end</li><li><strong>silence_prompt</strong> — phrase when customer is silent</li><li><strong>transfer</strong> — message when transferring to operator</li><li><strong>error</strong> — phrase on technical error</li><li><strong>wait</strong> — asking customer to wait</li><li><strong>order_cancelled</strong> — order cancellation message</li></ul><p>Each category can have <strong>multiple variants</strong> — the agent randomly picks one of the active variants for natural-sounding speech.</p>","help.scenarios.templates.steps":"Step-by-step: Templates","help.scenarios.templates.stepsContent":`<p><strong>Creating a new template:</strong></p><ol><li>Click <strong>"New template"</strong></li><li>Select a <strong>category</strong> (greeting, farewell, etc.)</li><li>Enter a <strong>title</strong> — for your reference, customers don't see it</li><li>Enter the <strong>text</strong> — the Ukrainian phrase the agent will speak</li><li>Click <strong>"Save"</strong></li></ol><p><strong>Adding a variant to an existing category:</strong></p><ol><li>Find the category in the table</li><li>Click <strong>"Add variant"</strong> next to the category name</li><li>Fill in the title and text for the new variant</li><li>Save — the variant is immediately available to the agent</li></ol><p><strong>Editing / deleting:</strong></p><ol><li>Click the <strong>three dots (⋮)</strong> to the right of a template</li><li>Select <strong>"Edit"</strong> or <strong>"Delete"</strong></li><li>Deletion is only available if the category has more than one variant</li></ol>`,"help.scenarios.dialogues.title":"What are dialogue scenarios","help.scenarios.dialogues.content":'<p>Scenarios are <strong>example conversations</strong> between customer and agent (few-shot). The agent analyzes the current conversation and picks the most similar example to shape its response.</p><ul><li><strong>Scenario type</strong> — tire search, order, fitting, consultation, etc.</li><li><strong>Phase</strong> — development stage (mvp, orders, services)</li><li><strong>Format</strong> — JSON array of turns: <code>[{"role": "user", "text": "..."}, {"role": "assistant", "text": "..."}]</code></li><li>Tools are auto-extracted from <code>tool_calls</code> fields in turns</li></ul>',"help.scenarios.dialogues.steps":"Step-by-step: Dialogues","help.scenarios.dialogues.stepsContent":`<p><strong>Creating a new dialogue:</strong></p><ol><li>Click <strong>"New dialogue"</strong></li><li>Enter a <strong>title</strong> — describe the scenario (e.g., "Customer looking for winter tires 205/55 R16")</li><li>Select <strong>scenario type</strong> (tire_search, order_creation, etc.)</li><li>Select <strong>phase</strong> (mvp, orders, services)</li><li>Edit the <strong>JSON dialogue</strong> — alternate <code>user</code> and <code>assistant</code> turns</li><li>Click <strong>"Save"</strong></li></ol><p><strong>JSON turn format:</strong></p><ul><li><code>{"role": "user", "text": "Hello, I need tires"}</code></li><li><code>{"role": "assistant", "text": "Good day! I'll help you choose. What tire size do you need?"}</code></li></ul><p><strong>Filtering:</strong> use the dropdowns above the table to filter by scenario type, phase, and active status.</p>`,"help.scenarios.safety.title":"What are safety rules","help.scenarios.safety.content":"<p>Safety rules define <strong>restrictions and boundaries</strong> for the agent. They are always included in the system prompt and have the highest priority.</p><ul><li><strong>Rule type</strong> — prompt_injection, data_validation, off_topic, language, behavioral, escalation</li><li><strong>Severity</strong> — critical (red), high (yellow), medium (blue), low (gray)</li><li><strong>Trigger</strong> — a customer message that should activate the rule</li><li><strong>Expected behavior</strong> — how the agent should respond to the trigger</li></ul>","help.scenarios.safety.steps":"Step-by-step: Safety Rules","help.scenarios.safety.stepsContent":'<p><strong>Creating a rule:</strong></p><ol><li>Click <strong>"New rule"</strong></li><li>Enter a <strong>title</strong> (e.g., "Prohibit discussing competitors")</li><li>Select <strong>type</strong> and <strong>severity</strong></li><li>In the <strong>"Trigger"</strong> field, enter an example customer message that should activate the rule</li><li>In the <strong>"Expected behavior"</strong> field, describe how the agent should respond</li><li>Save</li></ol><p><strong>Regression test:</strong></p><ol><li>Click <strong>"Regression Test"</strong> next to the create button</li><li>The system sends triggers from all active rules to the agent</li><li>Results show: passed / failed, expected vs actual behavior</li><li>Fix rules that failed the test</li></ol>',"help.scenarios.affects.title":"What changes affect","help.scenarios.affects.content":`<div class="help-affects"><p><strong>Response templates:</strong> affect the agent's <strong>specific phrases</strong> in standard situations. Change a greeting template — all new calls start with the new text.</p><p><strong>Dialogue scenarios:</strong> affect <strong>conversation style</strong>. The agent finds the most similar example and imitates it. More good examples = better dialogue quality.</p><p><strong>Safety rules:</strong> affect <strong>restrictions and boundaries</strong>. Critical rules cannot be violated. If a rule is deleted — the restriction is lifted.</p></div><p><strong>Important:</strong> all changes apply instantly. We recommend testing in the <strong>Sandbox</strong> first.</p>`,"help.scenarios.tips":"<ul><li>Start by reviewing existing templates and dialogues — they cover the main scenarios</li><li>Add 2-3 variants per template category — this makes the agent sound more natural</li><li>New dialogues are <strong>instantly</strong> available for the agent's few-shot selection</li><li>Before major changes, run the <strong>regression test</strong> for safety rules</li><li>Rules with <strong>critical</strong> and <strong>high</strong> severity have absolute priority</li></ul>","help.knowledge.title":"Help: Knowledge Base","help.knowledge.overview":"<p>The knowledge base contains articles the agent uses to consult customers. When a customer asks about delivery, warranty, returns, etc., the agent searches these articles via <strong>RAG search</strong> (semantic, not keyword-based). More quality articles = more accurate consultations.</p>","help.knowledge.articles.title":"What are articles","help.knowledge.articles.content":'<p>Articles are the main knowledge base content. Each article has:</p><ul><li><strong>Category</strong> — faq, guides, brands, comparisons, delivery, warranty, returns, policies, general, etc.</li><li><strong>Content</strong> — Markdown text (supports headings, lists, links)</li><li><strong>Embedding</strong> — vector representation for semantic search. Status:<ul><li>Green <strong>"indexed"</strong> — article is searchable</li><li>Yellow <strong>"pending"</strong> — awaiting generation (every 5 minutes)</li><li>Red <strong>"error"</strong> — error, needs reindexing</li></ul></li><li><strong>Expires at</strong> — optional date after which the article is auto-hidden (useful for promotions)</li></ul>',"help.knowledge.articles.steps":"Step-by-step: Articles","help.knowledge.articles.stepsContent":'<p><strong>Creating an article manually:</strong></p><ol><li>Click <strong>"+ New article"</strong></li><li>Enter a <strong>title</strong> — clear and descriptive (e.g., "Delivery terms across Ukraine")</li><li>Select a <strong>category</strong></li><li>Write <strong>content</strong> in Markdown format</li><li>Optionally set an <strong>expiration date</strong></li><li>Click <strong>"Save"</strong> — the article will be indexed within 5 minutes</li></ol><p><strong>Importing from files (quick population):</strong></p><ol><li>Click <strong>"Import documents"</strong></li><li>Select files (.md, .pdf, .docx) — multiple allowed</li><li>Optionally select a category (if not selected — detected from filename)</li><li>Click <strong>"Import"</strong> — articles are created automatically</li></ol><p><strong>Reindexing:</strong></p><ul><li><strong>Single article:</strong> menu ⋮ → "Reindex"</li><li><strong>All articles:</strong> "Reindex all" button (takes time, use for bulk issues)</li></ul>',"help.knowledge.sources.title":"What are source configurations","help.knowledge.sources.content":"<p>Sources are external websites from which the system automatically collects articles for the knowledge base.</p><ul><li><strong>Type</strong>:<ul><li><strong>HTML</strong> — regular web pages (text extraction via trafilatura)</li><li><strong>RSS</strong> — RSS/Atom feeds (feedparser + trafilatura)</li><li><strong>ProKoleso</strong> — specialized parser for prokoleso.ua</li></ul></li><li><strong>Language</strong> — source language (UK, DE, EN, FR). Foreign content is <strong>automatically translated</strong> to Ukrainian via LLM</li><li><strong>Schedule</strong> — day and hour for automatic runs</li><li><strong>Auto-approve</strong> — if enabled, articles are activated immediately; otherwise, manual approval required</li></ul>","help.knowledge.sources.steps":"Step-by-step: Sources","help.knowledge.sources.stepsContent":'<p><strong>Adding a source:</strong></p><ol><li>Go to the <strong>"Configurations"</strong> tab</li><li>Click <strong>"Add source"</strong></li><li>Fill in:<ol><li><strong>Name</strong> — for your reference</li><li><strong>Type</strong> — HTML, RSS, or ProKoleso</li><li><strong>Language</strong> — source language (articles will be translated to Ukrainian)</li><li><strong>URL</strong> — website or RSS feed address</li><li><strong>Max articles per run</strong> — limit per iteration</li><li><strong>Schedule</strong> — day of week and hour</li></ol></li><li>Click <strong>"Save"</strong></li></ol><p><strong>Manual run:</strong> menu ⋮ → "Run source" — immediate article fetch from this source.</p><p><strong>Enable/disable:</strong> toggle in the "Enabled" column — saves immediately.</p>',"help.knowledge.scraper.title":'"Scraper" tab',"help.knowledge.scraper.content":'<p>Scraper settings management and import results overview.</p><p><strong>Settings:</strong></p><ul><li><strong>Enabled</strong> — enable/disable scraper globally</li><li><strong>Auto-approve</strong> — automatically activate imported articles</li><li><strong>Dedup LLM check</strong> — LLM duplicate checking (prevents repeat articles)</li><li><strong>"Run now"</strong> — immediate run of all active sources</li></ul><p><strong>Results table:</strong> shows each imported page with status:</p><ul><li>Green <strong>processed</strong> — successfully processed</li><li>Yellow <strong>new</strong> — not yet processed</li><li>Gray <strong>skipped</strong> — skipped (duplicate or irrelevant)</li><li>Red <strong>error</strong> — import/processing error</li></ul><p>For processed articles: menu ⋮ → "View article" or "Approve" / "Reject".</p>',"help.knowledge.watched.title":"What are watched pages","help.knowledge.watched.content":'<p>Watched pages are URLs that the system periodically re-scans. When content changes are detected, the article is <strong>automatically updated</strong>.</p><ul><li><strong>Interval</strong> — check frequency: 6h, 12h, 24h, or 1 week</li><li><strong>Discovery</strong> — "discovery" mode: scans the page for nested links and auto-adds child pages</li><li><strong>Bulk import</strong> — upload a URL list (one per line)</li><li><strong>Tenant binding</strong> — articles can belong to a specific network (ProKoleso / Tvoya Shina)</li></ul>',"help.knowledge.watched.steps":"Step-by-step: Watched Pages","help.knowledge.watched.stepsContent":'<p><strong>Adding a page:</strong></p><ol><li>Go to the <strong>"Watched"</strong> tab</li><li>Enter the page <strong>URL</strong></li><li>Select a <strong>category</strong> and check <strong>interval</strong></li><li>Optionally select a <strong>tenant</strong></li><li>Check <strong>Discovery</strong> to auto-discover child pages</li><li>Click <strong>"Add"</strong></li></ol><p><strong>Bulk import:</strong></p><ol><li>Click <strong>"Bulk import"</strong></li><li>Paste URLs (one per line)</li><li>Select category, interval, and tenant</li><li>Click <strong>"Import"</strong> — duplicates are automatically skipped</li></ol><p><strong>Immediate scan:</strong> menu ⋮ → "Scrape now". Result: content unchanged / updated.</p>',"help.knowledge.affects.title":"What changes affect","help.knowledge.affects.content":'<div class="help-affects"><p><strong>Articles</strong> — the content the agent quotes when answering customer questions. If an article is deleted or deactivated — the agent <strong>cannot answer</strong> related questions.</p><p><strong>Embeddings</strong> — without them, the article is <strong>invisible</strong> to RAG search. New articles are indexed automatically every 5 minutes.</p><p><strong>Sources and watched pages</strong> — affect <strong>automatic updates</strong> of the knowledge base. If a source is disabled — new articles from that site are not fetched.</p></div>',"help.knowledge.tips":'<ul><li>For quick population, use <strong>.md file import</strong> or <strong>bulk URL import</strong></li><li>Check the <strong>"Embedding"</strong> column — articles with "pending" status are not yet searchable</li><li>Set <strong>expiration dates</strong> for promotional articles — they auto-hide</li><li>Use <strong>Discovery</strong> mode to automatically find new pages on a website</li><li>Watched pages with <strong>24h</strong> interval — optimal balance between freshness and load</li></ul>',"help.prompts.title":"Help: Prompts","help.prompts.overview":"<p>The prompt is the AI agent's <strong>main instruction</strong>: the text defining its behavior, communication style, competencies, and restrictions. The prompt is the most influential parameter — even a small change can dramatically alter dialogue quality.</p>","help.prompts.versions.title":"What are prompt versions","help.prompts.versions.content":'<p>The system stores a <strong>history of all prompt versions</strong>. At any time, only one version is <strong>active</strong> (used in real calls). Others are drafts or archived.</p><ul><li><strong>Version name</strong> — unique identifier (e.g., <code>v3.5-natural</code>)</li><li><strong>Active status</strong> — green badge = currently in use</li><li><strong>"Load default"</strong> — fills the text field with the built-in prompt (convenient as a base for a new version)</li></ul>',"help.prompts.versions.steps":"Step-by-step: Prompts","help.prompts.versions.stepsContent":`<p><strong>Creating a new version:</strong></p><ol><li>Click <strong>"New version"</strong></li><li>Enter a <strong>name</strong> (e.g., <code>v4.0-concise</code>)</li><li>Click <strong>"Load default"</strong> to start from the base prompt</li><li>Edit the <strong>prompt text</strong> — this is the agent's instruction in Ukrainian</li><li>Click <strong>"Create"</strong></li></ol><p><strong>Activating a version:</strong></p><ol><li>Find the version in the table</li><li>Menu ⋮ → <strong>"Activate"</strong></li><li>Confirm — <strong>all new calls</strong> will immediately use this version</li></ol><p><strong>Safe prompt update process:</strong></p><ol><li>Create a new version</li><li>Test in the <strong>Sandbox</strong> (select the version when creating a conversation)</li><li>Verify quality — check several scenarios</li><li>Activate or run an <strong>A/B test</strong></li></ol>`,"help.prompts.ab.title":"What are A/B tests","help.prompts.ab.content":"<p>A/B tests let you <strong>compare two prompt versions</strong> on real traffic. Calls are automatically distributed between variants, and the system collects quality metrics.</p><ul><li><strong>Traffic split</strong> — slider from 10% to 90% (recommend starting at 50/50)</li><li><strong>Metrics</strong> — quality, duration, operator transfer rate</li><li><strong>Statistical significance</strong> — the system calculates p-value and z-score</li><li><strong>Report</strong> — detailed comparison across 8 criteria, scenario breakdown, daily trend</li></ul>","help.prompts.ab.steps":"Step-by-step: A/B Tests","help.prompts.ab.stepsContent":'<p><strong>Starting an A/B test:</strong></p><ol><li>Make sure you have <strong>at least 2 prompt versions</strong></li><li>Click <strong>"New A/B test"</strong></li><li>Enter a test <strong>name</strong></li><li>Select <strong>Variant A</strong> and <strong>Variant B</strong></li><li>Adjust the <strong>traffic split</strong> with the slider</li><li>Click <strong>"Create"</strong> — the test starts immediately</li></ol><p><strong>Analyzing results:</strong></p><ol><li>Click the <strong>test name</strong> in the table to view the report</li><li>Check <strong>overall metrics</strong>: calls, quality, duration, transfers</li><li>Study the <strong>criteria breakdown</strong>: greeting, intent detection, tool usage, etc.</li><li>Wait for statistical significance (significance badge)</li></ol><p><strong>Completing the test:</strong></p><ol><li>Menu ⋮ → <strong>"Stop"</strong></li><li>Activate the winning version via the prompts table</li></ol>',"help.prompts.affects.title":"What changes affect","help.prompts.affects.content":'<div class="help-affects"><p><strong>Activating a prompt</strong> — instantly changes agent behavior for <strong>all new calls</strong>. Current calls use the version they started with.</p><p><strong>A/B test</strong> — splits traffic between two versions. During the test, the agent may behave differently for different customers.</p><p><strong>The prompt is the most influential parameter.</strong> A small wording change can dramatically alter communication style, response accuracy, and tool usage.</p></div>',"help.prompts.tips":`<ul><li><strong>Never</strong> activate a prompt without testing it in the Sandbox first</li><li>Use A/B tests to validate hypotheses — don't change prompts by guesswork</li><li>Versioning allows <strong>instant rollback</strong> to a previous version if issues arise</li><li>The <strong>"Reset to default"</strong> button creates a new version from the built-in prompt — useful for recovery</li><li>Export A/B test reports to CSV for detailed analysis</li></ul>`,"help.sandbox.title":"Help: Sandbox","help.sandbox.overview":"<p>The Sandbox is an environment for <strong>testing the AI agent</strong> without real calls. Chat with the agent, rate response quality, run regression tests, and export behavior patterns. This is the primary <strong>quality control</strong> tool.</p>","help.sandbox.chat.title":'"Chat" tab',"help.sandbox.chat.content":'<p>Interactive dialogue with the AI agent. Left panel — conversation list, right — chat.</p><p><strong>Features:</strong></p><ul><li><strong>Tool mode:</strong> Mock (test data) or Live (real data from Store API)</li><li><strong>Prompt selection:</strong> test any version, not just the active one</li><li><strong>Model selection:</strong> different LLM models (speed / quality)</li><li><strong>Scenario type:</strong> tire_search, order_creation, fitting_booking, etc.</li><li><strong>Customer persona:</strong> neutral, angry, confused, rushed, detailed — affects auto-generated messages</li><li><strong>Auto customer:</strong> "Auto customer" button — LLM generates a realistic customer message</li><li><strong>Rating:</strong> stars on each agent response (1-5) with comment</li><li><strong>Branching:</strong> "Branch" button — try an alternative customer message from a specific point</li></ul>',"help.sandbox.chat.steps":"Step-by-step: Chat","help.sandbox.chat.stepsContent":`<p><strong>Starting a test:</strong></p><ol><li>Click <strong>"+ New conversation"</strong></li><li>If quick start templates exist — pick one (conversation starts automatically)</li><li>Or fill in manually:<ol><li><strong>Title</strong> — for identification (e.g., "Winter tire test")</li><li><strong>Prompt version</strong> — select one (active marked with *)</li><li><strong>Model</strong> — LLM model</li><li><strong>Tool mode</strong> — Mock for tests, Live for real data checks</li><li><strong>Scenario</strong> — dialogue type (optional)</li></ol></li><li>Click <strong>"Create"</strong></li></ol><p><strong>Rating response quality:</strong></p><ol><li>Read the agent's response</li><li>Click the <strong>stars</strong> (1-5) to rate</li><li>Add a <strong>comment</strong> — what's good / what needs improvement</li></ol><p><strong>Marking turn groups (for pattern export):</strong></p><ol><li>Enable <strong>"Marking mode"</strong> in the chat header</li><li>Check the turns you want to group</li><li>Click <strong>"Create group"</strong></li><li>Enter <strong>intent</strong>, <strong>type</strong> (positive/negative), and <strong>rating</strong></li><li>For negative groups, enter <strong>correction</strong> — the correct response</li><li>Save — the group can be exported to patterns</li></ol>`,"help.sandbox.regression.title":'"Regression" tab',"help.sandbox.regression.content":"<p>Automatically replay a saved conversation with a new prompt — to verify changes haven't degraded quality.</p><ul><li>The system takes <strong>customer messages</strong> from a baseline conversation</li><li>Sends them to the agent with a <strong>new prompt version</strong></li><li>Compares responses: <strong>original</strong> vs <strong>new</strong> — shows differences</li></ul>","help.sandbox.regression.steps":"Step-by-step: Regression","help.sandbox.regression.stepsContent":`<p><strong>Preparation:</strong></p><ol><li>Go to the <strong>"Chat"</strong> tab</li><li>Find a quality conversation with good ratings</li><li>Click <strong>"Mark as baseline"</strong> in the chat header</li></ol><p><strong>Running a regression test:</strong></p><ol><li>Go to the <strong>"Regression"</strong> tab</li><li>Click <strong>"Replay"</strong> next to a baseline conversation</li><li>Select the <strong>prompt version</strong> to test</li><li>Wait for completion (status: pending → running → completed)</li></ol><p><strong>Analyzing results:</strong></p><ol><li>Click the row in the table to view details</li><li>Compare responses <strong>side by side</strong>: original on the left, new on the right</li><li>Differences are highlighted — quickly see what changed</li><li>If quality dropped — don't activate the new prompt</li></ol>`,"help.sandbox.patterns.title":'"Patterns" tab',"help.sandbox.patterns.content":'<p>Patterns are exported turn groups from chats. Used for automatic evaluation and training.</p><ul><li><strong>Creation:</strong> patterns are created by exporting groups from the "Chat" tab (not here)</li><li><strong>Search:</strong> semantic pattern search — enter a query and click "Test search"</li><li><strong>Management:</strong> activate/deactivate, delete via menu ⋮</li></ul>',"help.sandbox.phrases.title":'"Agent Phrases" tab',"help.sandbox.phrases.content":'<p>Reference tab (read-only) — shows <strong>all phrases</strong> the agent can use.</p><ul><li><strong>DB templates</strong> (purple) — overrides from "Scenarios → Templates"</li><li><strong>Built-in phrases</strong> — hardcoded fallback phrases (used when no templates exist)</li><li><strong>Phrase pools</strong> — variant sets for random selection (waiting, clarification, etc.)</li></ul><p>To edit phrases, go to <strong>Scenarios → Response Templates</strong>.</p>',"help.sandbox.starters.title":'"Starter Templates" tab',"help.sandbox.starters.content":'<p>Ready-made scenarios for quickly starting a test conversation. Starters appear as cards when creating a new conversation.</p><ul><li><strong>Title</strong> — brief scenario description</li><li><strong>First message</strong> — initial customer message (sent automatically)</li><li><strong>Scenario</strong> — type (tire_search, order_creation, etc.)</li><li><strong>Persona</strong> — customer type (neutral, angry, confused, rushed, detailed)</li></ul><p>Create: <strong>"New starter"</strong> button. Edit / delete via row buttons.</p>',"help.sandbox.workflow.title":"Recommended workflow","help.sandbox.workflow.content":'<p>Complete prompt quality control cycle:</p><ol><li><strong>Create starter templates</strong> for typical scenarios ("Starters" tab)</li><li><strong>Run a series of test dialogues</strong> with the old prompt, rate responses with stars</li><li><strong>Mark the best conversations as baseline</strong> (button in chat header)</li><li><strong>Create a new prompt version</strong> ("Prompts" section)</li><li><strong>Run regression tests</strong> — compare new prompt responses with baseline</li><li><strong>Run new test dialogues</strong> with the new prompt</li><li><strong>If quality is satisfactory</strong> — activate the prompt or start an A/B test</li></ol>',"help.sandbox.tips":`<ul><li>Before changing a prompt, <strong>mark the best conversations as baseline</strong> — that's your reference point</li><li>Use <strong>"Auto customer"</strong> for quick generation of realistic customer messages</li><li><strong>Live Tools</strong> mode provides real data — useful for final pre-production checks</li><li><strong>Branching</strong> lets you try "what if the customer asked differently?"</li><li>Export <strong>negative groups</strong> to patterns — this improves automatic evaluation</li></ul>`,"help.tools.title":"Help: Agent Tools","help.tools.overview":"<p>Tools are <strong>actions</strong> the AI agent can perform during conversations: search tires, check availability, create orders, book fitting, etc. Here you can <strong>change the description</strong> of any tool to influence when and how the agent uses it.</p>","help.tools.overrides.title":"What are description overrides","help.tools.overrides.content":'<p>Each tool has a <strong>default description</strong> (hardcoded). The LLM reads this description and decides when to invoke the tool.</p><ul><li><strong>Override</strong> — replaces the default description with custom text</li><li><strong>"Overridden"</strong> badge (yellow) — description has been changed</li><li><strong>"Default"</strong> badge (gray) — using standard description</li><li><strong>Reset</strong> — red button removes the override and restores the default</li></ul>',"help.tools.overrides.steps":"Step-by-step: Changing descriptions","help.tools.overrides.stepsContent":'<p><strong>Changing a tool description:</strong></p><ol><li>Find the tool in the table</li><li>Click <strong>"Edit"</strong></li><li>The modal shows the <strong>original description</strong> at the top (for reference)</li><li>Edit the <strong>description text</strong> in the field below</li><li>Click <strong>"Save"</strong></li></ol><p><strong>Resetting to default:</strong></p><ol><li>Click the red <strong>"Reset"</strong> button next to the tool</li><li>Confirm — the description reverts to the code default</li></ol><p><strong>Verifying changes:</strong></p><ol><li>Go to the <strong>Sandbox</strong></li><li>Create a test conversation</li><li>Ask the agent to perform the action related to the tool</li><li>Verify the agent selects the correct tool</li></ol>',"help.tools.list.title":"Tool list","help.tools.list.content":"<p>Available agent tools:</p><ul><li><code>get_vehicle_tire_sizes</code> — determine tire size by vehicle make/model</li><li><code>search_tires</code> — search tires by parameters (size, brand, season)</li><li><code>check_availability</code> — check stock for a specific tire</li><li><code>get_order_status</code> — check order status by number</li><li><code>create_order_draft</code> — create an order draft</li><li><code>update_order_delivery</code> — select delivery method</li><li><code>confirm_order</code> — confirm the order</li><li><code>get_fitting_stations</code> — list tire fitting stations</li><li><code>get_fitting_slots</code> — available booking slots</li><li><code>book_fitting</code> — book a fitting appointment</li><li><code>get_pickup_points</code> — pickup locations</li><li><code>search_knowledge_base</code> — knowledge base search (RAG)</li><li><code>transfer_to_operator</code> — transfer to a live operator</li></ul>","help.tools.affects.title":"What changes affect","help.tools.affects.content":`<div class="help-affects"><p><strong>Tool description</strong> is a hint for the LLM. The agent <strong>doesn't know</strong> what a tool does — it relies solely on the description.</p><p>If the description is <strong>too vague</strong> — the agent may invoke the tool in inappropriate situations.</p><p>If the description is <strong>too narrow</strong> — the agent may miss situations where the tool is needed.</p><p><strong>Example:</strong> if the agent confuses <code>search_tires</code> and <code>check_availability</code>, clarify in the description: "use search_tires for parameter-based search, check_availability — only to check a specific SKU."</p></div>`,"help.tools.tips":`<ul><li>Change descriptions <strong>carefully</strong> — they directly affect the agent's tool selection</li><li><strong>Always</strong> test changes in the Sandbox before applying</li><li>If the agent confuses two tools — add <strong>explicit disambiguation</strong> to the description</li><li>Write descriptions in <strong>English</strong> — the LLM understands English instructions better</li><li>Use the <strong>"Reset"</strong> button if a change degraded quality</li></ul>`},ps="admin_lang",is={ru:ca,en:ua};let re="ru";function pa(){re=localStorage.getItem(ps)||"ru",document.documentElement.lang=re;const t=document.getElementById("langLabel");t&&(t.textContent=re==="ru"?"EN":"RU")}function e(t,s){var n,r;let a=((n=is[re])==null?void 0:n[t])??((r=is.ru)==null?void 0:r[t])??t;if(s)for(const[o,i]of Object.entries(s))a=a.replace(`{${o}}`,i);return a}function ga(){re=re==="ru"?"en":"ru",localStorage.setItem(ps,re),document.documentElement.lang=re,gs();const t=document.getElementById("langLabel");t&&(t.textContent=re==="ru"?"EN":"RU"),window.dispatchEvent(new CustomEvent("langchange"))}function gs(){document.querySelectorAll("[data-i18n]").forEach(t=>{t.textContent=e(t.dataset.i18n)}),document.querySelectorAll("[data-i18n-placeholder]").forEach(t=>{t.placeholder=e(t.dataset.i18nPlaceholder)})}function ma(){return re==="ru"?"ru-RU":"en-US"}const Wt="",ba=3e4;let pe=localStorage.getItem("admin_token"),ot=null;function Ue(){return pe}function ha(t){pe=t,localStorage.setItem("admin_token",t)}function va(){pe=null,localStorage.removeItem("admin_token")}function fa(t){ot=t}function ms(t){return t.name==="AbortError"?new Error(e("api.requestTimeout")):t instanceof TypeError&&t.message==="Failed to fetch"?new Error(e("api.networkError")):t}async function p(t,s={}){const a={"Content-Type":"application/json"};pe&&(a.Authorization=`Bearer ${pe}`);const n=s.timeout||ba,r=new AbortController,o=setTimeout(()=>r.abort(),n);let i;try{const{timeout:u,...b}=s;i=await fetch(`${Wt}${t}`,{...b,headers:a,signal:r.signal})}catch(u){throw ms(u)}finally{clearTimeout(o)}if(i.status===401)throw d(e("api.sessionExpired"),"error"),ot&&ot(),new Error(e("api.unauthorized"));if(!i.ok){const u=await i.json().catch(()=>({}));throw new Error(u.detail||`HTTP ${i.status}`)}return i.json()}async function ya(t,s){const a={};pe&&(a.Authorization=`Bearer ${pe}`);const n=new AbortController,r=setTimeout(()=>n.abort(),12e4);let o;try{o=await fetch(`${Wt}${t}`,{method:"POST",headers:a,body:s,signal:n.signal})}catch(i){throw ms(i)}finally{clearTimeout(r)}if(o.status===401)throw d(e("api.sessionExpired"),"error"),ot&&ot(),new Error(e("api.unauthorized"));if(!o.ok){const i=await o.json().catch(()=>({}));throw new Error(i.detail||`HTTP ${o.status}`)}return o.json()}async function lt(t){const s={};return pe&&(s.Authorization=`Bearer ${pe}`),fetch(`${Wt}${t}`,{headers:s})}let Z=null,yt=1e3;const $a=3e4;let Ht=null;function xa(t){Ht=t}function Qt(){const t=Ue();if(!t)return;const a=`${location.protocol==="https:"?"wss:":"ws:"}//${location.host}/ws?token=${t}`;try{Z=new WebSocket(a)}catch{return}Z.onopen=()=>{yt=1e3,Ze("connected")},Z.onclose=()=>{Ze("disconnected"),ka()},Z.onerror=()=>{Ze("disconnected")},Z.onmessage=n=>{try{const r=JSON.parse(n.data);if(r.type==="ping"){Z&&Z.readyState===WebSocket.OPEN&&Z.send("pong");return}if(r.type==="pong")return;Ht&&Ht(r)}catch{}}}function wa(){Z&&(Z.close(),Z=null)}function ka(){Ue()&&(Ze("reconnecting"),setTimeout(()=>{Ue()&&Qt()},yt),yt=Math.min(yt*2,$a))}let bs="disconnected";function Ze(t){bs=t;const s=document.getElementById("wsDot"),a=document.getElementById("wsLabel");if(!s||!a)return;const n={connected:"bg-green-500",reconnecting:"bg-yellow-500",disconnected:"bg-red-500"};s.className=`w-2 h-2 rounded-full ${n[t]||"bg-red-500"}`;const r={connected:e("ws.live"),reconnecting:e("ws.reconnecting"),disconnected:e("ws.offline")};a.textContent=r[t]||e("ws.offline")}function Ta(){Ze(bs)}setInterval(()=>{Z&&Z.readyState===WebSocket.OPEN&&Z.send("ping")},25e3);let $t=null,hs={},Ot=null;function Y(t,s){hs[t]=s}function Yt(){$t&&(clearInterval($t),$t=null)}function _a(t){const s=document.querySelector(`.nav-group[data-group="${t}"]`);s&&s.classList.toggle("open")}function rt(){return location.hash.replace(/^#\/?/,"")||null}function _e(t){document.querySelectorAll('[id^="page-"]').forEach(o=>o.style.display="none");const s=document.getElementById(`page-${t}`);s&&(s.style.display="block"),document.querySelectorAll(".nav-item[data-page], .nav-flyout-link[data-page]").forEach(o=>o.classList.remove("active")),document.querySelectorAll(".nav-group-trigger").forEach(o=>o.classList.remove("active"));const a=document.querySelector(`.nav-item[data-page="${t}"], .nav-flyout-link[data-page="${t}"]`);a&&a.classList.add("active");const n=a==null?void 0:a.closest(".nav-group");if(n){const o=n.querySelector(".nav-group-trigger");o&&o.classList.add("active")}Ot=t,rt()!==t&&history.pushState(null,"","#/"+t),localStorage.setItem("admin_active_page",t),Yt();const r=hs[t];r&&r()}function Sa(){window.addEventListener("hashchange",()=>{const t=rt();t&&t!==Ot&&_e(t)}),window.addEventListener("popstate",()=>{const t=rt();t&&t!==Ot&&_e(t)})}function Tt(t,s){Yt(),$t=setInterval(t,s)}let xe=[];function ge(t){return xe.includes("*")||xe.includes(t)}async function vs(){try{xe=(await p("/auth/me")).permissions||[],localStorage.setItem("admin_permissions",JSON.stringify(xe))}catch{try{xe=JSON.parse(localStorage.getItem("admin_permissions")||"[]")}catch{xe=[]}}}const Ca={dashboard:null,calls:"analytics:read",prompts:"prompts:read",knowledge:"knowledge:read",scenarios:"training:read",tools:"training:read",sandbox:"sandbox:read",operators:"operators:read",monitoring:"system:read",configuration:"system:read",tenants:"tenants:read",notifications:"notifications:read",users:"users:read",audit:"audit:read",vehicles:"vehicles:read"};function fs(){document.querySelectorAll("[data-page]").forEach(t=>{const s=t.getAttribute("data-page"),a=Ca[s];a!=null&&(t.style.display=ge(a)?"":"none")}),document.querySelectorAll(".admin-only").forEach(t=>{t.hasAttribute("data-page")||(t.style.display=ge("*")?"":"none")})}async function ys(){const t=document.getElementById("loginUsername").value,s=document.getElementById("loginPassword").value;if(!t||!s){document.getElementById("loginError").textContent=e("login.error"),document.getElementById("loginError").style.display="block";return}try{const a=await p("/auth/login",{method:"POST",body:JSON.stringify({username:t,password:s})});ha(a.token),document.getElementById("loginContainer").style.display="none",document.getElementById("app").style.display="block",document.getElementById("loginError").style.display="none",await vs(),fs(),Qt();const n=rt(),r=localStorage.getItem("admin_active_page")||"dashboard";_e(n||r)}catch{document.getElementById("loginError").textContent=e("login.error"),document.getElementById("loginError").style.display="block"}}function Xt(){va(),xe=[],localStorage.removeItem("admin_permissions"),Yt(),wa(),document.getElementById("app").style.display="none",document.getElementById("loginContainer").style.display="flex"}function $s(){const t=Ue();if(t)try{const s=JSON.parse(atob(t.split(".")[1]));s.exp&&s.exp<Date.now()/1e3&&(d(e("api.sessionExpired"),"error"),Xt())}catch{}}fa(Xt);const Ce="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium",A=`${Ce} bg-neutral-100 text-neutral-600 dark:bg-neutral-800 dark:text-neutral-400`,B=`${Ce} bg-emerald-50 text-emerald-700 dark:bg-emerald-950 dark:text-emerald-400`,H=`${Ce} bg-amber-50 text-amber-700 dark:bg-amber-950 dark:text-amber-400`,M=`${Ce} bg-red-50 text-red-700 dark:bg-red-950 dark:text-red-400`,F=`${Ce} bg-blue-50 text-blue-700 dark:bg-blue-950 dark:text-blue-400`,ds=`${Ce} bg-violet-50 text-violet-700 dark:bg-violet-950 dark:text-violet-400`,Ae=`${Ce} bg-neutral-100 text-neutral-600 dark:bg-neutral-800 dark:text-neutral-400`,Bt="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer max-md:min-h-11",E=`${Bt} bg-blue-600 text-white hover:bg-blue-700`,it=`${Bt} bg-red-600 text-white hover:bg-red-700`,q=`${Bt} bg-neutral-500 text-white hover:bg-neutral-600 dark:bg-neutral-600 dark:hover:bg-neutral-500`,Ea=`${Bt} bg-violet-600 text-white hover:bg-violet-700`,C="text-xs px-2 py-1",K="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-5 mb-4",J="text-2xl font-bold text-blue-600 dark:text-blue-400",G="text-xs text-neutral-500 dark:text-neutral-400 mt-1",L="w-full text-sm responsive-table",m="px-3 py-2.5 text-left text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider border-b border-neutral-200 dark:border-neutral-700",S=`${m} cursor-pointer select-none hover:text-neutral-700 dark:hover:text-neutral-300`,c="px-3 py-2.5 border-b border-neutral-100 dark:border-neutral-800 text-neutral-700 dark:text-neutral-300",U="px-3 py-2.5 border-b border-neutral-100 dark:border-neutral-800 text-neutral-700 dark:text-neutral-300 td-actions",_="hover:bg-neutral-50 dark:hover:bg-neutral-800/50 transition-colors",Ba="pagination flex justify-center gap-1 mt-4",Pe="px-3 py-1.5 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-50 dark:hover:bg-neutral-700 cursor-pointer transition-colors max-md:min-h-11 max-md:min-w-11",T="text-center py-8 text-neutral-400 dark:text-neutral-500 text-sm",D="flex justify-center py-8",Zt="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500",es="text-xs px-1.5 py-1 border border-neutral-300 dark:border-neutral-700 rounded bg-white dark:bg-neutral-800 text-neutral-700 dark:text-neutral-300",Ia="py-2 border-b border-neutral-100 dark:border-neutral-800",xs="font-semibold text-xs text-blue-600 dark:text-blue-400",ws="font-semibold text-xs text-emerald-600 dark:text-emerald-400",ks="text-sm text-neutral-700 dark:text-neutral-300 mt-0.5",cs="text-blue-600 dark:text-blue-400 hover:underline",xt="text-sm font-semibold text-neutral-900 dark:text-neutral-50 mb-3",La="grid grid-cols-[repeat(auto-fill,minmax(180px,1fr))] gap-4 mb-6 max-md:grid-cols-2 max-[480px]:grid-cols-1",w="text-xs text-neutral-500 dark:text-neutral-400";function we(t){if(t==null)return`<span class="${A}">N/A</span>`;const s=parseFloat(t).toFixed(2);return t>=.8?`<span class="${B}">${s}</span>`:t>=.5?`<span class="${H}">${s}</span>`:`<span class="${M}">${s}</span>`}function j(t){return t?new Date(t).toLocaleString(ma(),{dateStyle:"short",timeStyle:"short"}):"-"}function O(t){document.getElementById(t).classList.remove("show")}function l(t){if(!t)return"";const s=document.createElement("div");return s.textContent=t,s.innerHTML}function Aa(t){return t?`<span class="${{online:B,offline:Ae,busy:H,break:F}[t]||Ae}">${l(t)}</span>`:`<span class="${Ae}">unknown</span>`}function dt(t,s){const a=URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download=s,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a)}const Ts="admin_theme",Pa='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>',Ra='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>';function Ma(){_t(),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",t=>{localStorage.getItem(Ts)||(document.documentElement.classList.toggle("dark",t.matches),_t())})}function Da(){const t=document.documentElement.classList.toggle("dark");localStorage.setItem(Ts,t?"dark":"light"),_t()}function _t(){const t=document.documentElement.classList.contains("dark"),s=document.getElementById("themeIcon"),a=document.getElementById("themeLabel");s&&(s.innerHTML=t?Pa:Ra),a&&(a.textContent=e(t?"theme.light":"theme.dark"))}function Fa(){_t()}const _s={scenarios:{titleKey:"help.scenarios.title",overviewKey:"help.scenarios.overview",sections:[{titleKey:"help.scenarios.templates.title",contentKey:"help.scenarios.templates.content"},{titleKey:"help.scenarios.templates.steps",contentKey:"help.scenarios.templates.stepsContent"},{titleKey:"help.scenarios.dialogues.title",contentKey:"help.scenarios.dialogues.content"},{titleKey:"help.scenarios.dialogues.steps",contentKey:"help.scenarios.dialogues.stepsContent"},{titleKey:"help.scenarios.safety.title",contentKey:"help.scenarios.safety.content"},{titleKey:"help.scenarios.safety.steps",contentKey:"help.scenarios.safety.stepsContent"},{titleKey:"help.scenarios.affects.title",contentKey:"help.scenarios.affects.content"}],tipsKey:"help.scenarios.tips"},knowledge:{titleKey:"help.knowledge.title",overviewKey:"help.knowledge.overview",sections:[{titleKey:"help.knowledge.articles.title",contentKey:"help.knowledge.articles.content"},{titleKey:"help.knowledge.articles.steps",contentKey:"help.knowledge.articles.stepsContent"},{titleKey:"help.knowledge.sources.title",contentKey:"help.knowledge.sources.content"},{titleKey:"help.knowledge.sources.steps",contentKey:"help.knowledge.sources.stepsContent"},{titleKey:"help.knowledge.scraper.title",contentKey:"help.knowledge.scraper.content"},{titleKey:"help.knowledge.watched.title",contentKey:"help.knowledge.watched.content"},{titleKey:"help.knowledge.watched.steps",contentKey:"help.knowledge.watched.stepsContent"},{titleKey:"help.knowledge.affects.title",contentKey:"help.knowledge.affects.content"}],tipsKey:"help.knowledge.tips"},prompts:{titleKey:"help.prompts.title",overviewKey:"help.prompts.overview",sections:[{titleKey:"help.prompts.versions.title",contentKey:"help.prompts.versions.content"},{titleKey:"help.prompts.versions.steps",contentKey:"help.prompts.versions.stepsContent"},{titleKey:"help.prompts.ab.title",contentKey:"help.prompts.ab.content"},{titleKey:"help.prompts.ab.steps",contentKey:"help.prompts.ab.stepsContent"},{titleKey:"help.prompts.affects.title",contentKey:"help.prompts.affects.content"}],tipsKey:"help.prompts.tips"},sandbox:{titleKey:"help.sandbox.title",overviewKey:"help.sandbox.overview",sections:[{titleKey:"help.sandbox.chat.title",contentKey:"help.sandbox.chat.content"},{titleKey:"help.sandbox.chat.steps",contentKey:"help.sandbox.chat.stepsContent"},{titleKey:"help.sandbox.regression.title",contentKey:"help.sandbox.regression.content"},{titleKey:"help.sandbox.regression.steps",contentKey:"help.sandbox.regression.stepsContent"},{titleKey:"help.sandbox.patterns.title",contentKey:"help.sandbox.patterns.content"},{titleKey:"help.sandbox.phrases.title",contentKey:"help.sandbox.phrases.content"},{titleKey:"help.sandbox.starters.title",contentKey:"help.sandbox.starters.content"},{titleKey:"help.sandbox.workflow.title",contentKey:"help.sandbox.workflow.content"}],tipsKey:"help.sandbox.tips"},tools:{titleKey:"help.tools.title",overviewKey:"help.tools.overview",sections:[{titleKey:"help.tools.overrides.title",contentKey:"help.tools.overrides.content"},{titleKey:"help.tools.overrides.steps",contentKey:"help.tools.overrides.stepsContent"},{titleKey:"help.tools.list.title",contentKey:"help.tools.list.content"},{titleKey:"help.tools.affects.title",contentKey:"help.tools.affects.content"}],tipsKey:"help.tools.tips"}};let te=null,Ss=null,St=null;function Na(){te=document.createElement("div"),te.className="help-overlay",te.innerHTML=`
        <div class="help-drawer">
            <div class="flex items-center justify-between px-5 py-4 border-b border-neutral-200 dark:border-neutral-700">
                <h2 class="text-base font-semibold text-neutral-900 dark:text-neutral-50 help-drawer-title"></h2>
                <button onclick="window._app.closeHelp()" class="text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-200" aria-label="Close">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                </button>
            </div>
            <div class="help-drawer-content flex-1 overflow-y-auto px-5 py-4 text-sm text-neutral-700 dark:text-neutral-300 space-y-4"></div>
        </div>`,te.addEventListener("click",t=>{t.target===te&&qt()}),document.body.appendChild(te),Ss=te.querySelector(".help-drawer-content"),document.addEventListener("keydown",t=>{t.key==="Escape"&&te.classList.contains("open")&&qt()}),window.addEventListener("langchange",()=>{St&&te.classList.contains("open")&&Cs(St)})}function Ha(t){_s[t]&&(St=t,Cs(t),te.classList.add("open"))}function qt(){te.classList.remove("open"),St=null}function Cs(t){const s=_s[t];te.querySelector(".help-drawer-title").textContent=e(s.titleKey);let a=`<div class="text-neutral-600 dark:text-neutral-400">${e(s.overviewKey)}</div>`;for(const n of s.sections)a+=`
        <details class="help-section border border-neutral-200 dark:border-neutral-700 rounded-lg">
            <summary class="flex items-center gap-2 px-4 py-3 text-sm font-medium text-neutral-800 dark:text-neutral-200 hover:bg-neutral-50 dark:hover:bg-neutral-800 rounded-lg">
                <svg class="help-chevron w-4 h-4 text-neutral-400 transition-transform duration-200 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                ${e(n.titleKey)}
            </summary>
            <div class="px-4 pb-3 text-sm text-neutral-600 dark:text-neutral-400 [&_ul]:list-disc [&_ul]:pl-5 [&_ul]:mt-1 [&_ul]:space-y-1 [&_code]:bg-neutral-100 [&_code]:dark:bg-neutral-800 [&_code]:px-1 [&_code]:rounded [&_code]:text-xs">${e(n.contentKey)}</div>
        </details>`;s.tipsKey&&(a+=`
        <div class="bg-blue-50 dark:bg-blue-950 border border-blue-200 dark:border-blue-800 rounded-lg p-4">
            <div class="text-sm font-medium text-blue-800 dark:text-blue-300 mb-2">${e("help.tipsTitle")}</div>
            <div class="text-sm text-blue-700 dark:text-blue-400 [&_ul]:list-disc [&_ul]:pl-5 [&_ul]:space-y-1">${e(s.tipsKey)}</div>
        </div>`),Ss.innerHTML=a}const Ut=3e4,Oa=3e5;let Ie=Ut,ze="",wt=[];async function qa(){if(!ge("tenants:read")){wt=[];return}try{wt=(await p("/admin/tenants?is_active=true&limit=100")).tenants||[]}catch{wt=[]}}function Es(){const t=document.getElementById("dashboardTenantFilter");if(!t)return;let s=`<label class="text-sm font-medium text-neutral-600 dark:text-neutral-400 mr-2">${e("dashboard.filterByNetwork")}</label>`;s+=`<select id="dashboardTenantSelect" class="${es} w-auto" onchange="window._pages.dashboard.onTenantChange(this.value)">`,s+=`<option value="">${e("dashboard.allNetworks")}</option>`;for(const a of wt){const n=a.id===ze?" selected":"";s+=`<option value="${l(a.id)}"${n}>${l(a.name)}</option>`}s+="</select>",t.innerHTML=s}function Ua(t){ze=t,Ke()}async function Ke(){if(!ge("analytics:read")){document.getElementById("dashboardStats").innerHTML=`
            <div class="${T}">${e("dashboard.noAnalyticsAccess")}</div>
        `;return}try{const t=ze?`?tenant_id=${ze}`:"",n=((await p(`/analytics/summary${t}`)).daily_stats||[])[0]||{},r=n.total_calls||0,o=n.resolved_by_bot||0,i=r>0?(o/r*100).toFixed(1):"0.0";Es(),document.getElementById("dashboardStats").innerHTML=`
            <div class="${K} text-center"><div class="${J}">${r}</div><div class="${G}">${e("dashboard.callsToday")}</div></div>
            <div class="${K} text-center"><div class="${J}">${o}<small class="text-xs text-neutral-500 dark:text-neutral-400"> (${i}%)</small></div><div class="${G}">${e("dashboard.resolvedByBot")}</div></div>
            <div class="${K} text-center"><div class="${J}">${n.transferred||0}</div><div class="${G}">${e("dashboard.transferred")}</div></div>
            <div class="${K} text-center"><div class="${J}">${(n.avg_quality_score||0).toFixed(2)}</div><div class="${G}">${e("dashboard.avgQuality")}</div></div>
            <div class="${K} text-center"><div class="${J}">$${(n.total_cost_usd||0).toFixed(2)}</div><div class="${G}">${e("dashboard.costToday")}</div></div>
        `,Ie!==Ut&&(Ie=Ut,Tt(Ke,Ie))}catch(t){document.getElementById("dashboardStats").innerHTML=`
            <div class="${T}">${e("dashboard.failedToLoad",{error:l(t.message)})}
            <br><button class="${E} ${C} mt-2" onclick="window._pages.dashboard.loadDashboard()">${e("common.retry")}</button></div>
        `,Ie=Math.min(Ie*2,Oa),Tt(Ke,Ie)}}async function za(){try{const t=ze?`?tenant_id=${ze}`:"",s=await lt(`/analytics/summary/export${t}`);if(!s.ok)throw new Error(`HTTP ${s.status}`);const a=await s.blob(),r=(s.headers.get("Content-Disposition")||"").match(/filename="(.+)"/),o=r?r[1]:"daily_stats_export.csv";dt(a,o),d(e("dashboard.csvExported"))}catch(t){d(e("dashboard.exportFailed",{error:t.message}),"error")}}async function Ka(){const t=new Date,s=new Date(t);s.setDate(s.getDate()-7);const a=s.toISOString().split("T")[0],n=t.toISOString().split("T")[0];try{const r=await lt(`/analytics/report/pdf?date_from=${a}&date_to=${n}`);if(!r.ok)throw new Error(`HTTP ${r.status}`);const o=await r.blob(),u=(r.headers.get("Content-Disposition")||"").match(/filename="(.+)"/),b=u?u[1]:`report_${a}_${n}.pdf`;dt(o,b),d(e("dashboard.pdfDownloaded"))}catch(r){d(e("dashboard.pdfFailed",{error:r.message}),"error")}}function ja(){Y("dashboard",async()=>{const t=document.querySelectorAll("#page-dashboard .flex.gap-2 button"),s=ge("analytics:read");t.forEach(a=>{a.style.display=s?"":"none"}),await qa(),Es(),Ke(),s&&Tt(Ke,3e4)})}window._pages=window._pages||{};window._pages.dashboard={loadDashboard:Ke,exportStatsCSV:za,downloadPdfReport:Ka,onTenantChange:Ua};const Va=" ▲",Ja=" ▼";function W(t){const s=typeof t=="string"?document.getElementById(t):t;if(!s)return;const a=s.querySelector("thead"),n=s.querySelector("tbody");if(!a||!n)return;const r=Array.from(a.querySelectorAll("th"));r.forEach((o,i)=>{o.hasAttribute("data-sortable")&&(o.dataset.sortInit||(o.dataset.sortInit="1",o.style.cursor="pointer",o.style.userSelect="none",o.addEventListener("click",()=>{Ga(n,r,o,i)})))})}function Ga(t,s,a,n){const o=a.dataset.sortDir==="asc"?"desc":"asc";s.forEach(v=>{delete v.dataset.sortDir;const h=v.querySelector(".sort-arrow");h&&(h.textContent="")}),a.dataset.sortDir=o;let i=a.querySelector(".sort-arrow");i||(i=document.createElement("span"),i.className="sort-arrow",i.style.opacity="0.6",i.style.fontSize="0.65em",a.appendChild(i)),i.textContent=o==="asc"?Va:Ja;const u=Array.from(t.querySelectorAll("tr"));if(u.some(v=>Array.from(v.cells).some(h=>h.rowSpan>1)))return;const b=s.length,g=[];for(const v of u)v.cells.length<b&&g.length>0?g[g.length-1].detail.push(v):g.push({data:v,detail:[]});g.sort((v,h)=>{const f=v.data.cells[n],y=h.data.cells[n];if(!f||!y)return 0;const x=(f.dataset.sortValue??f.textContent??"").trim(),k=(y.dataset.sortValue??y.textContent??"").trim(),P=x.replace(/[^0-9.\-]/g,""),I=k.replace(/[^0-9.\-]/g,""),ne=Number(P),oe=Number(I);if(P!==""&&I!==""&&!isNaN(ne)&&!isNaN(oe))return o==="asc"?ne-oe:oe-ne;const N=x.localeCompare(k,void 0,{numeric:!0,sensitivity:"base"});return o==="asc"?N:-N});const $=document.createDocumentFragment();for(const v of g){$.appendChild(v.data);for(const h of v.detail)$.appendChild(h)}t.appendChild($)}let Bs=0,Ct=[];async function Wa(){try{Ct=(await p("/admin/tenants?is_active=true&limit=100")).tenants||[]}catch{Ct=[]}}function Qa(){const t=document.getElementById("filterTenant");if(!t||Ct.length===0)return;const s=t.value;t.innerHTML=`<option value="">${e("dashboard.allNetworks")}</option>`;for(const a of Ct){const n=document.createElement("option");n.value=a.id,n.textContent=a.name,a.id===s&&(n.selected=!0),t.appendChild(n)}}async function Is(t=0){var v,h,f,y,x,k,P;Bs=t;const s=document.getElementById("callsLoading"),a=document.querySelector("#callsTable tbody");s&&(s.style.display="flex");const n=new URLSearchParams({limit:20,offset:t}),r=(v=document.getElementById("filterDateFrom"))==null?void 0:v.value,o=(h=document.getElementById("filterDateTo"))==null?void 0:h.value,i=(f=document.getElementById("filterScenario"))==null?void 0:f.value,u=(y=document.getElementById("filterTransferred"))==null?void 0:y.value,b=(x=document.getElementById("filterQualityBelow"))==null?void 0:x.value,g=(k=document.getElementById("filterSearch"))==null?void 0:k.value,$=(P=document.getElementById("filterTenant"))==null?void 0:P.value;r&&n.set("date_from",r),o&&n.set("date_to",o),i&&n.set("scenario",i),u&&n.set("transferred",u),b&&n.set("quality_below",b),g&&n.set("search",g),$&&n.set("tenant_id",$);try{const I=await p(`/analytics/calls?${n}`);if(s&&(s.style.display="none"),!I.calls||I.calls.length===0){a&&(a.innerHTML=`<tr><td colspan="7" class="${T}">${e("calls.noCalls")}</td></tr>`);const N=document.getElementById("callsPagination");N&&(N.innerHTML="");return}a.innerHTML=I.calls.map(N=>`
            <tr class="${_} cursor-pointer" data-id="${l(N.id)}" onclick="window._pages.calls.showCallDetail(this.dataset.id)">
                <td class="${c}" data-label="${e("calls.date")}" data-sort-value="${N.started_at||""}">${j(N.started_at)}</td>
                <td class="${c}" data-label="${e("calls.caller")}">${l(N.caller_id)||"-"}</td>
                <td class="${c}" data-label="${e("calls.scenario")}">${l(N.scenario)||"-"}</td>
                <td class="${c}" data-label="${e("calls.duration")}">${N.duration_seconds||0}s</td>
                <td class="${c}" data-label="${e("calls.quality")}">${we(N.quality_score)}</td>
                <td class="${c}" data-label="${e("calls.cost")}">$${(N.total_cost_usd||0).toFixed(3)}</td>
                <td class="${c}" data-label="${e("calls.status")}">${N.transferred_to_operator?`<span class="${H}">${e("calls.statusTransferred")}</span>`:`<span class="${B}">${e("calls.statusResolved")}</span>`}</td>
            </tr>
        `).join("");const ne=Math.ceil(I.total/20),oe=Math.floor(t/20);document.getElementById("callsPagination").innerHTML=Array.from({length:Math.min(ne,10)},(N,ye)=>`<button class="${Pe}${ye===oe?" active":""}" onclick="window._pages.calls.loadCalls(${ye*20})">${ye+1}</button>`).join(""),W("callsTable")}catch(I){s.style.display="none",a.innerHTML=`<tr><td colspan="7" class="${T}">${e("calls.failedToLoad",{error:l(I.message)})}
            <br><button class="${E} ${C} mt-2" onclick="window._pages.calls.loadCalls(${t})">${e("common.retry")}</button></td></tr>`}}async function Ya(){var u,b,g,$,v,h;const t=new URLSearchParams,s=(u=document.getElementById("filterDateFrom"))==null?void 0:u.value,a=(b=document.getElementById("filterDateTo"))==null?void 0:b.value,n=(g=document.getElementById("filterScenario"))==null?void 0:g.value,r=($=document.getElementById("filterTransferred"))==null?void 0:$.value,o=(v=document.getElementById("filterQualityBelow"))==null?void 0:v.value,i=(h=document.getElementById("filterTenant"))==null?void 0:h.value;s&&t.set("date_from",s),a&&t.set("date_to",a),n&&t.set("scenario",n),r&&t.set("transferred",r),o&&t.set("min_quality",o),i&&t.set("tenant_id",i);try{const f=await lt(`/analytics/calls/export?${t}`);if(!f.ok)throw new Error(`HTTP ${f.status}`);const y=await f.blob(),k=(f.headers.get("Content-Disposition")||"").match(/filename="(.+)"/),P=k?k[1]:"calls_export.csv";dt(y,P),d(e("calls.csvExported"))}catch(f){d(e("calls.exportFailed",{error:f.message}),"error")}}async function Xa(t){try{const s=await p(`/analytics/calls/${t}`),a=s.call,n=s.turns||[],r=s.tool_calls||[];let o=`
            <div class="grid grid-cols-2 gap-3 mb-4 text-sm">
                <div><span class="font-medium text-neutral-500 dark:text-neutral-400">${e("calls.detailCaller")}</span> <span class="text-neutral-900 dark:text-neutral-100">${l(a.caller_id)||"-"}</span></div>
                <div><span class="font-medium text-neutral-500 dark:text-neutral-400">${e("calls.detailScenario")}</span> <span class="text-neutral-900 dark:text-neutral-100">${l(a.scenario)||"-"}</span></div>
                <div><span class="font-medium text-neutral-500 dark:text-neutral-400">${e("calls.detailDuration")}</span> <span class="text-neutral-900 dark:text-neutral-100">${a.duration_seconds||0}s</span></div>
                <div><span class="font-medium text-neutral-500 dark:text-neutral-400">${e("calls.detailQuality")}</span> ${we(a.quality_score)}</div>
                <div><span class="font-medium text-neutral-500 dark:text-neutral-400">${e("calls.detailCost")}</span> <span class="text-neutral-900 dark:text-neutral-100">$${(a.total_cost_usd||0).toFixed(3)}</span></div>
                <div><span class="font-medium text-neutral-500 dark:text-neutral-400">${e("calls.detailPrompt")}</span> <span class="text-neutral-900 dark:text-neutral-100">${l(a.prompt_version)||"-"}</span></div>
            </div>
        `;if(a.quality_details){o+=`<h3 class="${xt} mt-4">${e("calls.qualityBreakdown")}</h3><div class="overflow-x-auto"><table class="${L}">`;for(const[i,u]of Object.entries(a.quality_details))i!=="comment"&&(o+=`<tr class="${_}"><td class="${c}">${l(i)}</td><td class="${c}">${we(u)}</td></tr>`);a.quality_details.comment&&(o+=`<tr><td colspan="2" class="${c} italic">${l(a.quality_details.comment)}</td></tr>`),o+="</table></div>"}o+=`<div class="flex items-center justify-between mt-4"><h3 class="${xt}">${e("calls.transcription")}</h3><button class="${E} ${C}" data-id="${l(t)}" onclick="window._pages.calls.downloadTranscript(this.dataset.id)">${e("calls.downloadTranscript")}</button></div>`,n.length===0?o+=`<div class="${T}">${e("calls.noTranscription")}</div>`:n.forEach(i=>{o+=`<div class="${Ia}"><span class="${i.speaker==="customer"?xs:ws}">${i.speaker==="customer"?e("calls.customer"):e("calls.bot")}</span>`,o+=`<div class="${ks}">${l(i.text)}</div></div>`}),r.length&&(o+=`<h3 class="${xt} mt-4">${e("calls.toolCalls")}</h3><div class="overflow-x-auto"><table class="${L}"><tr><th class="${m}">${e("calls.toolName")}</th><th class="${m}">${e("calls.toolSuccess")}</th><th class="${m}">${e("calls.toolDuration")}</th></tr>`,r.forEach(i=>{o+=`<tr class="${_}"><td class="${c}">${l(i.tool_name)}</td><td class="${c}">${i.success?`<span class="${B}">${e("common.yes")}</span>`:`<span class="${M}">${e("common.no")}</span>`}</td><td class="${c}">${i.duration_ms||0}ms</td></tr>`}),o+="</table></div>"),document.getElementById("callDetailContent").innerHTML=o,document.getElementById("callModal").classList.add("show")}catch(s){d(e("calls.failedToLoadDetail",{error:s.message}),"error")}}async function Za(t){try{const s=await lt(`/analytics/calls/${t}/transcript`);if(!s.ok)throw new Error(`HTTP ${s.status}`);const a=await s.blob(),r=(s.headers.get("Content-Disposition")||"").match(/filename="(.+)"/),o=r?r[1]:`transcript_${t}.txt`;dt(a,o),d(e("calls.transcriptDownloaded"))}catch(s){d(e("calls.transcriptFailed",{error:s.message}),"error")}}function en(){document.getElementById("callModal").classList.remove("show")}function tn(){return Bs}function sn(){Y("calls",async()=>{await Wa(),Qa(),Is()})}window._pages=window._pages||{};window._pages.calls={loadCalls:Is,exportCallsCSV:Ya,showCallDetail:Xa,closeCallModal:en,downloadTranscript:Za};const zt=25;function z({containerId:t,total:s,offset:a,pageSize:n=zt,onPage:r}){const o=document.getElementById(t);if(!o)return;const i=n||zt,u=Math.max(1,Math.ceil(s/i)),b=Math.floor(a/i);if(u<=1){o.innerHTML="";return}const g=window.innerWidth<768,$=[],v=k=>{$.includes(k)||$.push(k)};v(0),v(u-1);const h=g?0:1;for(let k=Math.max(0,b-h);k<=Math.min(u-1,b+h);k++)v(k);$.sort((k,P)=>k-P);const f=e("common.pageInfo",{current:b+1,total:u});let y=`<div class="${Ba}">`;y+=`<button class="${Pe}" data-page-offset="${Math.max(0,(b-1)*i)}" ${b===0?'disabled style="opacity:0.4;cursor:default"':""}>«</button>`;let x=-1;for(const k of $)x>=0&&k-x>1&&(y+='<span class="px-2 py-1.5 text-sm text-neutral-400">…</span>'),y+=`<button class="${Pe}${k===b?" active":""}" data-page-offset="${k*i}">${k+1}</button>`,x=k;y+=`<button class="${Pe}" data-page-offset="${Math.min((u-1)*i,(b+1)*i)}" ${b>=u-1?'disabled style="opacity:0.4;cursor:default"':""}>»</button>`,y+=`<span class="px-2 py-1.5 text-xs text-neutral-500 dark:text-neutral-400 self-center max-md:hidden">${f}</span>`,y+="</div>",o.innerHTML=y,o.querySelectorAll("[data-page-offset]").forEach(k=>{k.disabled||k.addEventListener("click",()=>{const P=parseInt(k.dataset.pageOffset,10);!isNaN(P)&&r&&r(P)})})}function ae({limit:t=zt,offset:s=0,filters:a={}}={}){var r;const n=new URLSearchParams;n.set("limit",String(t)),n.set("offset",String(s));for(const[o,i]of Object.entries(a)){const u=document.getElementById(i);if(!u)continue;const b=(r=u.value)==null?void 0:r.trim();b&&n.set(o,b)}return n}let Ls=[],Mt=0,Dt=0;async function Ee(t){t!==void 0&&(Mt=t);const s=document.getElementById("promptsContent"),a=ae({offset:Mt});try{const n=await p(`/prompts?${a}`),r=n.versions||[];if(Ls=r,r.length===0){s.innerHTML=`
                <div class="mb-4">
                    <button class="${E}" onclick="window._pages.prompts.showCreatePrompt()">${e("prompts.newVersion")}</button>
                    <button class="${q} ml-2" onclick="window._pages.prompts.resetToDefault()">${e("prompts.resetToDefault")}</button>
                </div>
                <div class="${T}">${e("prompts.noVersions")}</div>`,Se();return}s.innerHTML=`
            <div class="mb-4">
                <button class="${E}" onclick="window._pages.prompts.showCreatePrompt()">${e("prompts.newVersion")}</button>
                <button class="${q} ml-2" onclick="window._pages.prompts.resetToDefault()">${e("prompts.resetToDefault")}</button>
            </div>
            <div class="overflow-x-auto min-h-[480px]"><table class="${L}" id="promptsTable"><thead><tr><th class="${S}" data-sortable>${e("prompts.name")}</th><th class="${S}" data-sortable>${e("prompts.active")}</th><th class="${S}" data-sortable>${e("prompts.created")}</th><th class="${m}">${e("prompts.action")}</th></tr></thead><tbody>
            ${r.map(i=>`
                <tr class="${_}">
                    <td class="${c}" data-label="${e("prompts.name")}"><a href="#" class="text-blue-600 dark:text-blue-400 hover:underline" onclick="event.preventDefault(); window._pages.prompts.viewPrompt('${i.id}')">${l(i.name)}</a></td>
                    <td class="${c}" data-label="${e("prompts.active")}">${i.is_active?`<span class="${B}">${e("prompts.activeLabel")}</span>`:""}</td>
                    <td class="${c}" data-label="${e("prompts.created")}" data-sort-value="${i.created_at||""}">${j(i.created_at)}</td>
                    <td class="${U}">
                        ${i.is_active?"":`<div class="relative inline-block">
                            <button class="px-1.5 py-0.5 text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 text-sm cursor-pointer" onclick="this.nextElementSibling.classList.toggle('hidden')">&hellip;</button>
                            <div class="hidden absolute right-0 z-20 mt-1 w-36 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-md shadow-lg py-1">
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.prompts.activatePrompt('${i.id}')">${e("prompts.activateBtn")}</button>
                                <button class="w-full text-left px-3 py-1.5 text-xs text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950/30 cursor-pointer" data-id="${l(i.id)}" data-name="${l(i.name)}" onclick="window._pages.prompts.deletePrompt(this.dataset.id, this.dataset.name)">${e("common.delete")}</button>
                            </div>
                        </div>`}
                    </td>
                </tr>
            `).join("")}
            </tbody></table></div>`,W("promptsTable");let o=document.getElementById("promptsPagination");o||(o=document.createElement("div"),o.id="promptsPagination",s.appendChild(o)),z({containerId:"promptsPagination",total:n.total,offset:Mt,onPage:i=>Ee(i)}),Se()}catch(n){s.innerHTML=`<div class="${T}">${e("prompts.failedToLoad",{error:l(n.message)})}
            <br><button class="${E} ${C} mt-2" onclick="window._pages.prompts.loadPromptVersions()">${e("common.retry")}</button></div>`}}function an(){const t=document.getElementById("createPromptModalTitle");t&&(t.textContent=e("prompts.createTitle")),document.getElementById("promptName").value="",document.getElementById("promptName").disabled=!1,document.getElementById("promptSystemPrompt").value="",document.getElementById("promptSystemPrompt").disabled=!1,document.getElementById("createPromptBtn").style.display="",document.getElementById("loadDefaultBtn").style.display="",document.getElementById("createPromptModal").classList.add("show")}async function nn(){const t=document.getElementById("promptName").value.trim(),s=document.getElementById("promptSystemPrompt").value.trim();if(!t||!s){d(e("prompts.nameRequired"),"error");return}try{await p("/prompts",{method:"POST",body:JSON.stringify({name:t,system_prompt:s})}),O("createPromptModal"),d(e("prompts.created_toast")),Ee()}catch(a){d(e("prompts.createFailed",{error:a.message}),"error")}}async function on(t){if(confirm(e("prompts.activateConfirm")))try{await p(`/prompts/${t}/activate`,{method:"PATCH"}),d(e("prompts.activated")),Ee()}catch(s){d(e("prompts.activateFailed",{error:s.message}),"error")}}async function rn(t){try{const a=(await p(`/prompts/${t}`)).version,n=document.getElementById("createPromptModalTitle");n&&(n.textContent=e("prompts.viewTitle")),document.getElementById("promptName").value=a.name||"",document.getElementById("promptName").disabled=!0,document.getElementById("promptSystemPrompt").value=a.system_prompt||"",document.getElementById("promptSystemPrompt").disabled=!0,document.getElementById("createPromptBtn").style.display="none",document.getElementById("loadDefaultBtn").style.display="none",document.getElementById("createPromptModal").classList.add("show")}catch(s){d(e("prompts.failedToLoad",{error:s.message}),"error")}}async function ln(){try{const t=await p("/prompts/default");document.getElementById("promptSystemPrompt").value=t.system_prompt||""}catch(t){d(e("prompts.failedToLoad",{error:t.message}),"error")}}async function dn(){var t;if(confirm(e("prompts.resetConfirm")))try{const s=await p("/prompts/default"),n=(t=(await p("/prompts",{method:"POST",body:JSON.stringify({name:`${s.name} (reset)`,system_prompt:s.system_prompt})})).version)==null?void 0:t.id;n&&await p(`/prompts/${n}/activate`,{method:"PATCH"}),d(e("prompts.resetDone")),Ee()}catch(s){d(e("prompts.resetFailed",{error:s.message}),"error")}}async function cn(t,s){if(confirm(e("prompts.deleteConfirm",{name:s})))try{await p(`/prompts/${t}`,{method:"DELETE"}),d(e("prompts.deleted")),Ee()}catch(a){d(e("prompts.deleteFailed",{error:a.message}),"error")}}function un(t){switch(t){case"active":return`<span class="${B}">${l(t)}</span>`;case"completed":return`<span class="${F}">${l(t)}</span>`;case"stopped":return`<span class="${M}">${l(t)}</span>`;default:return`<span class="${A}">${l(t||"unknown")}</span>`}}function As(t){return t?t.min_samples_needed?`<span class="${A}">${e("prompts.notEnoughData")}</span>`:t.is_significant&&t.recommended_variant?`<span class="${B}">${e("prompts.recommended",{variant:t.recommended_variant})}</span>`:`<span class="${A}">${e("prompts.noSignificance")}</span>`:""}function pn(t){return t?t.min_samples_needed?e("prompts.notEnoughData"):t.is_significant&&t.recommended_variant?e("prompts.recommended",{variant:t.recommended_variant}):e("prompts.noSignificance"):""}async function Se(t){t!==void 0&&(Dt=t);const s=document.getElementById("promptsContent"),a=document.getElementById("abTestsSection");a&&a.remove();const n=document.createElement("div");n.id="abTestsSection",n.className="mt-6",s.appendChild(n);const r=ae({offset:Dt});try{const o=await p(`/prompts/ab-tests?${r}`),i=o.tests||[];let u=`<h3 class="text-base font-semibold text-neutral-900 dark:text-neutral-50 mb-3">${e("prompts.abTests")}</h3>`;if(u+=`<div class="mb-4"><button class="${E}" onclick="window._pages.prompts.showCreateABTest()">${e("prompts.newABTest")}</button></div>`,i.length===0)u+=`<div class="${T}">${e("prompts.noABTests")}</div>`;else{u+=`<div class="overflow-x-auto min-h-[480px]"><table class="${L}" id="abTestsTable"><thead><tr>
                <th class="${m}">${e("prompts.testName")}</th>
                <th class="${m}">${e("prompts.variantA")}</th>
                <th class="${m}">${e("prompts.variantB")}</th>
                <th class="${m}">${e("prompts.callsAB")}</th>
                <th class="${m}">${e("prompts.qualityAB")}</th>
                <th class="${m}">${e("prompts.abStatus")}</th>
                <th class="${m}">${e("prompts.abAction")}</th>
            </tr></thead><tbody>`;for(const g of i){const $=g.quality_a!=null?Number(g.quality_a).toFixed(2):"—",v=g.quality_b!=null?Number(g.quality_b).toFixed(2):"—";let h="";g.status==="active"?h=`<div class="relative inline-block">
                        <button class="px-1.5 py-0.5 text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 text-sm cursor-pointer" onclick="this.nextElementSibling.classList.toggle('hidden')">&hellip;</button>
                        <div class="hidden absolute right-0 z-20 mt-1 w-36 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-md shadow-lg py-1">
                            <button class="w-full text-left px-3 py-1.5 text-xs text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950/30 cursor-pointer" onclick="window._pages.prompts.stopABTest('${g.id}')">${e("prompts.stopBtn")}</button>
                        </div>
                    </div>`:h=(g.significance?As(g.significance)+" ":"")+`<div class="relative inline-block">
                        <button class="px-1.5 py-0.5 text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 text-sm cursor-pointer" onclick="this.nextElementSibling.classList.toggle('hidden')">&hellip;</button>
                        <div class="hidden absolute right-0 z-20 mt-1 w-36 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-md shadow-lg py-1">
                            <button class="w-full text-left px-3 py-1.5 text-xs text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950/30 cursor-pointer" data-id="${l(g.id)}" data-name="${l(g.test_name)}" onclick="window._pages.prompts.deleteABTest(this.dataset.id, this.dataset.name)">${e("common.delete")}</button>
                        </div>
                    </div>`,u+=`<tr class="${_}">
                    <td class="${c}" data-label="${e("prompts.testName")}"><a href="#" class="text-blue-600 dark:text-blue-400 hover:underline" onclick="event.preventDefault(); window._pages.prompts.showABReport('${g.id}')">${l(g.test_name)}</a></td>
                    <td class="${c}" data-label="${e("prompts.variantA")}">${l(g.variant_a_name||"")}</td>
                    <td class="${c}" data-label="${e("prompts.variantB")}">${l(g.variant_b_name||"")}</td>
                    <td class="${c}" data-label="${e("prompts.callsAB")}">${g.calls_a||0} / ${g.calls_b||0}</td>
                    <td class="${c}" data-label="${e("prompts.qualityAB")}">${$} / ${v}</td>
                    <td class="${c}" data-label="${e("prompts.abStatus")}">${un(g.status)}</td>
                    <td class="${U}">${h}</td>
                </tr>`}u+="</tbody></table></div>"}n.innerHTML=u;const b=document.createElement("div");b.id="abTestsPagination",n.appendChild(b),z({containerId:"abTestsPagination",total:o.total,offset:Dt,onPage:g=>Se(g)})}catch(o){n.innerHTML=`<div class="${T}">${e("prompts.failedToLoadAB",{error:l(o.message)})}</div>`}It(),Rs()}function gn(){document.getElementById("abTestName").value="",document.getElementById("abVariantA").value="",document.getElementById("abVariantB").value="",document.getElementById("abTrafficSplit").value="50",document.getElementById("abTrafficSplitValue").textContent="50%";const t=document.getElementById("abVariantA"),s=document.getElementById("abVariantB");t.innerHTML=`<option value="">${e("common.select")}</option>`,s.innerHTML=`<option value="">${e("common.select")}</option>`;for(const a of Ls){const n=`<option value="${a.id}">${l(a.name)}</option>`;t.innerHTML+=n,s.innerHTML+=n}document.getElementById("createABTestModal").classList.add("show")}async function mn(){const t=document.getElementById("abTestName").value.trim(),s=document.getElementById("abVariantA").value,a=document.getElementById("abVariantB").value,n=parseInt(document.getElementById("abTrafficSplit").value,10)/100;if(!t){d(e("prompts.testNameRequired"),"error");return}if(!s||!a){d(e("prompts.variantsRequired"),"error");return}if(s===a){d(e("prompts.variantsMustDiffer"),"error");return}try{await p("/prompts/ab-tests",{method:"POST",body:JSON.stringify({test_name:t,variant_a_id:s,variant_b_id:a,traffic_split:n})}),O("createABTestModal"),d(e("prompts.abTestCreated")),Se()}catch(r){d(e("prompts.abTestCreateFailed",{error:r.message}),"error")}}async function bn(t){var s;if(confirm(e("prompts.stopConfirm")))try{const a=await p(`/prompts/ab-tests/${t}/stop`,{method:"PATCH"}),n=pn((s=a.test)==null?void 0:s.significance);d(n?e("prompts.stoppedWithResult",{result:n}):e("prompts.stopped")),Se()}catch(a){d(e("prompts.stopFailed",{error:a.message}),"error")}}async function hn(t,s){if(confirm(e("prompts.deleteABTestConfirm",{name:s})))try{await p(`/prompts/ab-tests/${t}`,{method:"DELETE"}),d(e("prompts.abTestDeleted")),Se()}catch(a){d(e("prompts.abTestDeleteFailed",{error:a.message}),"error")}}const vn={bot_greeted_properly:"prompts.criterionGreeting",bot_understood_intent:"prompts.criterionIntent",bot_used_correct_tool:"prompts.criterionToolUsage",bot_provided_accurate_info:"prompts.criterionAccuracy",bot_confirmed_before_action:"prompts.criterionConfirmation",bot_was_concise:"prompts.criterionConciseness",call_resolved_without_human:"prompts.criterionResolution",customer_seemed_satisfied:"prompts.criterionSatisfaction"};async function fn(t){const s=document.getElementById("abReportContent");s.innerHTML=`<div class="${D}"><div class="spinner"></div></div>`,document.getElementById("abReportModal").classList.add("show");try{const a=await p(`/prompts/ab-tests/${t}/report`),n=a.test||{},r=a.summary||{},o=a.per_criterion||[],i=a.by_scenario||[],u=a.daily||[],b=document.getElementById("abReportModalTitle");b&&(b.textContent=`${e("prompts.abReportTitle")}: ${n.test_name||""}`);const g=f=>f!=null?(f*100).toFixed(1)+"%":"—",$=f=>f!=null?f.toFixed(0)+"s":"—",v=r.significance||{};let h="";if(h+=`<h3 class="text-sm font-semibold text-neutral-700 dark:text-neutral-300 mb-2">${e("prompts.reportSummary")}</h3>`,h+=`<div class="${La}">
            <div class="${K}">
                <div class="${J}">${r.calls_a||0} / ${r.calls_b||0}</div>
                <div class="${G}">${e("prompts.reportCalls")} (A / B)</div>
            </div>
            <div class="${K}">
                <div class="${J}">${g(r.quality_a)} / ${g(r.quality_b)}</div>
                <div class="${G}">${e("prompts.reportQuality")} (A / B)</div>
            </div>
            <div class="${K}">
                <div class="${J}">${$(r.avg_duration_a)} / ${$(r.avg_duration_b)}</div>
                <div class="${G}">${e("prompts.reportAvgDuration")} (A / B)</div>
            </div>
            <div class="${K}">
                <div class="${J}">${g(r.transfer_rate_a)} / ${g(r.transfer_rate_b)}</div>
                <div class="${G}">${e("prompts.reportTransferRate")} (A / B)</div>
            </div>
        </div>`,v.is_significant!=null&&(h+=`<div class="mb-4">${As(v)} <span class="${w} ml-2">p=${v.p_value_approx??"—"}, z=${v.z_score??"—"}</span></div>`),o.length>0){h+=`<h3 class="text-sm font-semibold text-neutral-700 dark:text-neutral-300 mb-2 mt-4">${e("prompts.reportCriteria")}</h3>`,h+=`<div class="overflow-x-auto mb-4"><table class="${L}"><thead><tr>
                <th class="${m}">${e("prompts.reportCriterion")}</th>
                <th class="${m}">${n.variant_a_name||"A"}</th>
                <th class="${m}">${n.variant_b_name||"B"}</th>
                <th class="${m}">${e("prompts.reportDelta")}</th>
            </tr></thead><tbody>`;for(const f of o){const y=f.avg_a!=null&&f.avg_b!=null?f.avg_a-f.avg_b:null,x=y!=null?(y>=0?"+":"")+(y*100).toFixed(1)+"%":"—",k=y!=null?y>0?"text-emerald-600 dark:text-emerald-400":y<0?"text-red-600 dark:text-red-400":"":"";h+=`<tr class="${_}">
                    <td class="${c}">${e(vn[f.criterion]||f.criterion)}</td>
                    <td class="${c}">${we(f.avg_a)}</td>
                    <td class="${c}">${we(f.avg_b)}</td>
                    <td class="${c}"><span class="${k} font-medium">${x}</span></td>
                </tr>`}h+="</tbody></table></div>"}if(i.length>0){h+=`<h3 class="text-sm font-semibold text-neutral-700 dark:text-neutral-300 mb-2 mt-4">${e("prompts.reportScenarios")}</h3>`,h+=`<div class="overflow-x-auto mb-4"><table class="${L}"><thead><tr>
                <th class="${m}">${e("prompts.reportScenario")}</th>
                <th class="${m}">${e("prompts.reportCalls")} A</th>
                <th class="${m}">${e("prompts.reportCalls")} B</th>
                <th class="${m}">${e("prompts.reportQuality")} A</th>
                <th class="${m}">${e("prompts.reportQuality")} B</th>
            </tr></thead><tbody>`;for(const f of i)h+=`<tr class="${_}">
                    <td class="${c}"><span class="${F}">${l(f.scenario)}</span></td>
                    <td class="${c}">${f.calls_a}</td>
                    <td class="${c}">${f.calls_b}</td>
                    <td class="${c}">${we(f.quality_a)}</td>
                    <td class="${c}">${we(f.quality_b)}</td>
                </tr>`;h+="</tbody></table></div>"}if(u.length>0){h+=`<h3 class="text-sm font-semibold text-neutral-700 dark:text-neutral-300 mb-2 mt-4">${e("prompts.reportDaily")}</h3>`,h+='<div class="space-y-2 mb-4">';for(const f of u){const y=f.quality_a!=null?f.quality_a:0,x=f.quality_b!=null?f.quality_b:0;h+=`<div class="flex items-center gap-2 text-xs">
                    <span class="w-20 text-neutral-500 dark:text-neutral-400 shrink-0">${l(f.date)}</span>
                    <div class="flex-1 flex flex-col gap-0.5">
                        <div class="flex items-center gap-1">
                            <span class="w-4 text-right text-neutral-400">A</span>
                            <div class="h-3 rounded bg-blue-500 dark:bg-blue-400" style="width:${Math.max(y*100,2)}%"></div>
                            <span class="${w}">${g(f.quality_a)} (${f.calls_a})</span>
                        </div>
                        <div class="flex items-center gap-1">
                            <span class="w-4 text-right text-neutral-400">B</span>
                            <div class="h-3 rounded bg-violet-500 dark:bg-violet-400" style="width:${Math.max(x*100,2)}%"></div>
                            <span class="${w}">${g(f.quality_b)} (${f.calls_b})</span>
                        </div>
                    </div>
                </div>`}h+="</div>"}h+=`<div class="mt-4"><button class="${E}" onclick="window._pages.prompts.exportABReportCSV('${t}')">${e("prompts.exportCSV")}</button></div>`,s.innerHTML=h}catch(a){s.innerHTML=`<div class="${T}">${e("prompts.reportFailedToLoad",{error:l(a.message)})}</div>`}}async function yn(t){try{const s=await lt(`/prompts/ab-tests/${t}/report/csv`);if(!s.ok)throw new Error(`HTTP ${s.status}`);const a=await s.blob();dt(a,`ab_report_${t}.csv`),d(e("prompts.csvExported"))}catch(s){d(e("prompts.exportFailed",{error:s.message}),"error")}}async function It(){if(!ge("pronunciation:read"))return;const t=document.getElementById("promptsContent"),s=document.getElementById("pronunciationRulesSection");s&&s.remove();const a=document.createElement("div");a.id="pronunciationRulesSection",a.className="mt-6",t.appendChild(a);try{const n=await p("/admin/agent/pronunciation-rules"),r=n.source==="redis"?e("prompts.pronunciationRulesSourceRedis"):e("prompts.pronunciationRulesSourceDefault");a.innerHTML=`
            <details id="pronunciationDetails">
                <summary class="cursor-pointer select-none flex items-center gap-2 text-base font-semibold text-neutral-900 dark:text-neutral-50 mb-1">
                    <svg class="w-4 h-4 transition-transform duration-200 details-chevron" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd"/></svg>
                    ${e("prompts.pronunciationRules")}
                    <span class="${A} ml-1">${e("prompts.pronunciationRulesSource",{source:r})}</span>
                </summary>
                <div class="mt-3">
                    <p class="text-sm text-neutral-500 dark:text-neutral-400 mb-3">${e("prompts.pronunciationRulesDesc")}</p>
                    <textarea id="pronunciationRulesText" rows="16"
                        class="w-full font-mono text-sm rounded border border-neutral-300 dark:border-neutral-600 bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    >${l(n.rules||"")}</textarea>
                    <div class="mt-3 flex gap-2">
                        <button class="${E}" onclick="window._pages.prompts.savePronunciationRules()">${e("prompts.pronunciationRulesSave")}</button>
                        <button class="${q}" onclick="window._pages.prompts.resetPronunciationRules()">${e("prompts.pronunciationRulesReset")}</button>
                    </div>
                </div>
            </details>`}catch(n){a.innerHTML=`<div class="${T}">${e("prompts.pronunciationRulesSaveFailed",{error:l(n.message)})}</div>`}}async function $n(){if(!ge("pronunciation:write"))return;const t=document.getElementById("pronunciationRulesText").value;try{await p("/admin/agent/pronunciation-rules",{method:"PATCH",body:JSON.stringify({rules:t})}),d(e("prompts.pronunciationRulesSaved")),await It(),Ps()}catch(s){d(e("prompts.pronunciationRulesSaveFailed",{error:s.message}),"error")}}async function xn(){if(ge("pronunciation:write")&&confirm(e("prompts.pronunciationRulesResetConfirm")))try{await p("/admin/agent/pronunciation-rules/reset",{method:"POST"}),d(e("prompts.pronunciationRulesResetDone")),await It(),Ps()}catch(t){d(e("prompts.pronunciationRulesSaveFailed",{error:t.message}),"error")}}function Ps(){const t=document.getElementById("pronunciationDetails");t&&(t.open=!0)}async function Rs(){const t=document.getElementById("promptsContent"),s=document.getElementById("optimizerSection");s&&s.remove();const a=document.createElement("div");a.id="optimizerSection",a.className="mt-6",t.appendChild(a);try{const r=(await p("/prompts/optimizer/results")).items||[];let o=`
            <details id="optimizerDetails">
                <summary class="cursor-pointer select-none flex items-center gap-2 text-base font-semibold text-neutral-900 dark:text-neutral-50 mb-1">
                    <svg class="w-4 h-4 transition-transform duration-200 details-chevron" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd"/></svg>
                    ${e("prompts.optimizer")}
                    <span class="${A} ml-1">${r.length} ${e("prompts.optimizerRuns")}</span>
                </summary>
                <div class="mt-3">
                    <p class="text-sm text-neutral-500 dark:text-neutral-400 mb-3">${e("prompts.optimizerDesc")}</p>
                    <div class="mb-3">
                        <button class="${E}" id="runOptimizerBtn" onclick="window._pages.prompts.runOptimizer()">${e("prompts.optimizerRun")}</button>
                    </div>`;if(r.length>0){o+=`<div class="overflow-x-auto"><table class="${L}"><thead><tr>
                <th class="${m}">${e("prompts.optimizerDate")}</th>
                <th class="${m}">${e("prompts.optimizerCalls")}</th>
                <th class="${m}">${e("prompts.optimizerPatterns")}</th>
                <th class="${m}">${e("prompts.optimizerStatus")}</th>
                <th class="${m}">${e("prompts.optimizerTriggered")}</th>
                <th class="${m}">${e("prompts.action")}</th>
            </tr></thead><tbody>`;for(const i of r){const u=i.patterns||[],b=i.status==="completed"?`<span class="${B}">${e("prompts.optimizerCompleted")}</span>`:`<span class="${M}">${e("prompts.optimizerError")}</span>`;o+=`<tr class="${_}">
                    <td class="${c}" data-label="${e("prompts.optimizerDate")}">${j(i.created_at)}</td>
                    <td class="${c}" data-label="${e("prompts.optimizerCalls")}">${i.calls_analyzed}</td>
                    <td class="${c}" data-label="${e("prompts.optimizerPatterns")}">${u.length}</td>
                    <td class="${c}" data-label="${e("prompts.optimizerStatus")}">${b}</td>
                    <td class="${c}" data-label="${e("prompts.optimizerTriggered")}"><span class="${A}">${l(i.triggered_by)}</span></td>
                    <td class="${U}">
                        <button class="${q} ${C}" onclick="window._pages.prompts.showOptimizerDetail('${i.id}')">${e("prompts.optimizerView")}</button>
                    </td>
                </tr>`}o+="</tbody></table></div>"}else o+=`<div class="${T}">${e("prompts.optimizerNoResults")}</div>`;o+="</div></details>",a.innerHTML=o}catch(n){a.innerHTML=`<div class="${T}">${e("prompts.optimizerLoadFailed",{error:l(n.message)})}</div>`}}async function wn(){const t=document.getElementById("runOptimizerBtn");t&&(t.disabled=!0,t.textContent=e("prompts.optimizerRunning"));try{const s=await p("/prompts/optimizer/run",{method:"POST"});d(e("prompts.optimizerStarted",{taskId:s.task_id||""}))}catch(s){d(e("prompts.optimizerRunFailed",{error:s.message}),"error")}finally{t&&(t.disabled=!1,t.textContent=e("prompts.optimizerRun"))}}function kn(t){p("/prompts/optimizer/results").then(s=>{const a=(s.items||[]).find(i=>i.id===t);if(!a)return;const n=a.patterns||[];let r=`<p class="mb-3"><strong>${e("prompts.optimizerRecommendation")}:</strong> ${l(a.overall_recommendation||"—")}</p>`;if(n.length>0){r+=`<div class="overflow-x-auto"><table class="${L}"><thead><tr>
                <th class="${m}">${e("prompts.optimizerPattern")}</th>
                <th class="${m}">${e("prompts.optimizerSeverity")}</th>
                <th class="${m}">${e("prompts.optimizerFrequency")}</th>
                <th class="${m}">${e("prompts.optimizerSuggestion")}</th>
            </tr></thead><tbody>`;for(const i of n){const u=i.severity==="high"?M:i.severity==="medium"?H:A;r+=`<tr class="${_}">
                    <td class="${c}"><div class="max-w-xs">${l(i.description||"")}</div></td>
                    <td class="${c}"><span class="${u}">${l(i.severity||"")}</span></td>
                    <td class="${c}">${i.frequency||0}</td>
                    <td class="${c}"><div class="max-w-md text-sm">${l(i.suggestion||"")}</div></td>
                </tr>`}r+="</tbody></table></div>"}const o=document.createElement("div");o.className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",o.id="optimizerDetailModal",o.onclick=i=>{i.target===o&&o.remove()},o.innerHTML=`
            <div class="bg-white dark:bg-neutral-800 rounded-lg shadow-xl max-w-3xl w-full max-h-[80vh] overflow-y-auto p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold">${e("prompts.optimizerDetailTitle")}</h3>
                    <button class="text-neutral-400 hover:text-neutral-600" onclick="document.getElementById('optimizerDetailModal').remove()">&#x2715;</button>
                </div>
                ${r}
            </div>`,document.body.appendChild(o)})}function Tn(){Y("prompts",Ee),document.addEventListener("click",t=>{t.target.closest(".relative")||document.querySelectorAll("#page-prompts .relative > div:not(.hidden)").forEach(s=>s.classList.add("hidden"))})}window._pages=window._pages||{};window._pages.prompts={loadPromptVersions:Ee,showCreatePrompt:an,createPrompt:nn,activatePrompt:on,viewPrompt:rn,loadDefaultPrompt:ln,resetToDefault:dn,deletePrompt:cn,loadABTests:Se,showCreateABTest:gn,createABTest:mn,stopABTest:bn,deleteABTest:hn,showABReport:fn,exportABReportCSV:yn,loadPronunciationRules:It,savePronunciationRules:$n,resetPronunciationRules:xn,loadOptimizerResults:Rs,runOptimizer:wn,showOptimizerDetail:kn};let $e=[],Ms="articles",le=0,Re=0,kt=0,et=0,Xe="",Le=[];function ts(t){Ms=t,["articles","source-configs","scraper","watched"].forEach(r=>{const o=document.getElementById(`knowledgeContent-${r}`);o&&(o.style.display=r===t?"block":"none")}),document.querySelectorAll("#page-knowledge .tab-bar button").forEach(r=>r.classList.remove("active"));const a=document.querySelector(`#page-knowledge .tab-bar button[data-tab="${t}"]`);a&&a.classList.add("active"),le=0,Re=0,kt=0,et=0;const n={articles:En,"source-configs":Je,scraper:()=>{Fs(),ct()},watched:ve};n[t]&&n[t]()}function _n(t){switch(t){case"indexed":return`<span class="${B}">indexed</span>`;case"pending":return`<span class="${H}">pending</span>`;case"processing":return`<span class="${F}">processing</span>`;case"error":return`<span class="${M}">error</span>`;default:return`<span class="${A}">${l(t||"unknown")}</span>`}}function Sn(t){if(!t)return`<span class="${w} text-xs">—</span>`;const s=new Date(t),a=new Date,n=j(t);return s<a?`<span class="${M}" title="${n}">${e("knowledge.expired")}</span>`:Math.ceil((s-a)/864e5)<=7?`<span class="${H}" title="${n}">${n}</span>`:`<span class="text-xs" title="${n}">${n}</span>`}function Ft(t,s,a){if(t.innerHTML="",a){const n=document.createElement("option");n.value="",n.textContent=e("knowledge.allCategories"),t.appendChild(n)}for(const n of s){const r=document.createElement("option");r.value=n.value,r.textContent=n.label,t.appendChild(r)}}async function Cn(){try{$e=(await p("/knowledge/article-categories")).categories||[]}catch{$e=[{value:"brands",label:"Brands"},{value:"guides",label:"Guides"},{value:"faq",label:"FAQ"},{value:"comparisons",label:"Comparisons"},{value:"general",label:"General"}]}const t=document.getElementById("kbCategory");t&&Ft(t,$e,!0);const s=document.getElementById("articleCategory");s&&Ft(s,$e,!1);const a=document.getElementById("importCategory");a&&Ft(a,$e,!0)}async function En(){await Cn(),await me()}async function me(t){t!==void 0&&(le=t);const s=document.getElementById("articlesContainer");s.innerHTML=`<div class="${D}"><div class="spinner"></div></div>`;const a=ae({offset:le,filters:{category:"kbCategory",search:"kbSearch",active:"kbActive"}});try{const n=await p(`/knowledge/articles?${a}`),r=n.articles||[];if(r.length===0){s.innerHTML=`<div class="${T}">${e("knowledge.noArticles")}</div>`,z({containerId:"articlesPagination",total:0,offset:0});return}s.innerHTML=`
            <div class="overflow-x-auto min-h-[480px]"><table class="${L}" id="articlesTable"><thead><tr><th class="${S}" data-sortable>${e("knowledge.articleTitle")}</th><th class="${S}" data-sortable>${e("knowledge.category")}</th><th class="${S}" data-sortable>${e("knowledge.embedding")}</th><th class="${S}" data-sortable>${e("knowledge.activeCol")}</th><th class="${S}" data-sortable>${e("knowledge.expiresAt")}</th><th class="${S}" data-sortable>${e("knowledge.updated")}</th><th class="${m}">${e("knowledge.actions")}</th></tr></thead><tbody>
            ${r.map(o=>`
                <tr class="${_}">
                    <td class="${c}" data-label="${e("knowledge.articleTitle")}">${l(o.title)}</td>
                    <td class="${c}" data-label="${e("knowledge.category")}"><span class="${F}">${l(o.category)}</span></td>
                    <td class="${c}" data-label="${e("knowledge.embedding")}">${_n(o.embedding_status)}</td>
                    <td class="${c}" data-label="${e("knowledge.activeCol")}">${o.active!==!1?`<span class="${B}">${e("common.yes")}</span>`:`<span class="${M}">${e("common.no")}</span>`}</td>
                    <td class="${c}" data-label="${e("knowledge.expiresAt")}" data-sort-value="${o.expires_at||""}">${Sn(o.expires_at)}</td>
                    <td class="${c}" data-label="${e("knowledge.updated")}" data-sort-value="${o.updated_at||o.created_at||""}">${j(o.updated_at||o.created_at)}</td>
                    <td class="${U}">
                        <div class="relative inline-block">
                            <button class="px-1.5 py-0.5 text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 text-sm cursor-pointer" onclick="this.nextElementSibling.classList.toggle('hidden')">&hellip;</button>
                            <div class="hidden absolute right-0 z-20 mt-1 w-40 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-md shadow-lg py-1">
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.knowledge.editArticle('${o.id}')">${e("knowledge.editBtn")}</button>
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.knowledge.reindexArticle('${o.id}')">${e("knowledge.reindexBtn")}</button>
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.knowledge.toggleArticle('${o.id}', ${o.active!==!1})">${o.active!==!1?e("common.deactivate"):e("common.activate")}</button>
                                <button class="w-full text-left px-3 py-1.5 text-xs text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950/30 cursor-pointer" data-id="${l(o.id)}" data-name="${l(o.title)}" onclick="window._pages.knowledge.deleteArticle(this.dataset.id, this.dataset.name)">${e("common.delete")}</button>
                            </div>
                        </div>
                    </td>
                </tr>
            `).join("")}
            </tbody></table></div>
            <p class="${w} mt-2">${e("knowledge.total",{count:n.total})}</p>`,W("articlesTable"),z({containerId:"articlesPagination",total:n.total,offset:le,onPage:o=>me(o)})}catch(n){s.innerHTML=`<div class="${T}">${e("knowledge.failedToLoad",{error:l(n.message)})}
            <br><button class="${E} ${C} mt-2" onclick="window._pages.knowledge.loadArticles()">${e("common.retry")}</button></div>`}}function Bn(){document.getElementById("articleModalTitle").textContent=e("knowledge.newArticleTitle"),document.getElementById("editArticleId").value="",document.getElementById("articleTitle").value="",document.getElementById("articleCategory").value="faq",document.getElementById("articleContent").value="",document.getElementById("articleExpiresAt").value="",document.getElementById("createArticleModal").classList.add("show")}async function Ds(t){try{const a=(await p(`/knowledge/articles/${t}`)).article;document.getElementById("articleModalTitle").textContent=e("knowledge.editArticleTitle"),document.getElementById("editArticleId").value=t,document.getElementById("articleTitle").value=a.title||"",document.getElementById("articleCategory").value=a.category||"faq",document.getElementById("articleContent").value=a.content||"";const n=document.getElementById("articleExpiresAt");if(a.expires_at){const r=new Date(a.expires_at);n.value=r.getFullYear()+"-"+String(r.getMonth()+1).padStart(2,"0")+"-"+String(r.getDate()).padStart(2,"0")+"T"+String(r.getHours()).padStart(2,"0")+":"+String(r.getMinutes()).padStart(2,"0")}else n.value="";document.getElementById("createArticleModal").classList.add("show")}catch(s){d(e("knowledge.loadFailed",{error:s.message}),"error")}}async function In(){const t=document.getElementById("editArticleId").value,s=document.getElementById("articleTitle").value.trim(),a=document.getElementById("articleCategory").value,n=document.getElementById("articleContent").value.trim(),r=document.getElementById("articleExpiresAt").value;if(!s||!n){d(e("knowledge.titleRequired"),"error");return}const o=r?new Date(r).toISOString():"";try{if(t)await p(`/knowledge/articles/${t}`,{method:"PATCH",body:JSON.stringify({title:s,category:a,content:n,expires_at:o})}),d(e("knowledge.articleUpdated"));else{const i={title:s,category:a,content:n};o&&(i.expires_at=o),await p("/knowledge/articles",{method:"POST",body:JSON.stringify(i)}),d(e("knowledge.articleCreated"))}O("createArticleModal"),me(le)}catch(i){d(e("knowledge.saveFailed",{error:i.message}),"error")}}async function Ln(t,s){try{await p(`/knowledge/articles/${t}`,{method:"PATCH",body:JSON.stringify({active:!s})}),d(e(s?"knowledge.articleDeactivated":"knowledge.articleActivated")),me(le)}catch(a){d(e("knowledge.toggleFailed",{error:a.message}),"error")}}async function An(t,s){if(confirm(e("knowledge.deleteConfirm",{title:s})))try{await p(`/knowledge/articles/${t}`,{method:"DELETE"}),d(e("knowledge.articleDeleted")),me(le)}catch(a){d(e("knowledge.deleteFailed",{error:a.message}),"error")}}async function Pn(t){try{const s=await p(`/knowledge/articles/${t}/reindex`,{method:"POST"});d(s.message||e("knowledge.reindexQueued")),me(le)}catch(s){d(e("knowledge.reindexFailed",{error:s.message}),"error")}}async function Rn(){if(confirm(e("knowledge.reindexAllConfirm")))try{const t=await p("/knowledge/reindex-all",{method:"POST"});d(t.message||e("knowledge.reindexAllDispatched")),me(le)}catch(t){d(e("knowledge.reindexAllFailed",{error:t.message}),"error")}}function Mn(){document.getElementById("importFiles").value="";const t=document.getElementById("importCategory");t&&(t.value=""),document.getElementById("importDocumentsModal").classList.add("show")}async function Dn(){const t=document.getElementById("importFiles"),s=document.getElementById("importCategory"),a=t.files;if(!a||a.length===0){d(e("knowledge.importNoFiles"),"error");return}const n=new FormData;for(const i of a)n.append("files",i);let r="/knowledge/articles/import";const o=s?s.value:"";o&&(r+=`?category=${encodeURIComponent(o)}`);try{const i=await ya(r,n),u=[e("knowledge.importResult",{imported:i.imported})];if(i.errors>0&&u.push(e("knowledge.importErrors",{errors:i.errors})),d(u.join(", "),i.errors>0?"warning":"success"),i.error_details&&i.error_details.length>0)for(const b of i.error_details)d(`${b.filename}: ${b.error}`,"error");O("importDocumentsModal"),me(le)}catch(i){d(e("knowledge.importFailed",{error:i.message}),"error")}}function Kt(t){switch(t){case"processed":return`<span class="${B}">${l(t)}</span>`;case"processing":return`<span class="${F}">${l(t)}</span>`;case"new":return`<span class="${H}">${l(t)}</span>`;case"skipped":return`<span class="${A}">${l(t)}</span>`;case"error":return`<span class="${M}">${l(t)}</span>`;case"duplicate":return`<span class="${A}">${e("sources.duplicate")}</span>`;case"duplicate_suspect":return`<span class="${H}">${e("sources.duplicateSuspect")}</span>`;default:return`<span class="${A}">${l(t||"unknown")}</span>`}}async function Fs(){const t=document.getElementById("scraperConfigCard");if(t)try{const a=(await p("/admin/scraper/config")).config||{};t.innerHTML=`
            <div class="flex flex-wrap items-center gap-4 mb-2">
                <label class="flex items-center gap-2 text-sm cursor-pointer">
                    <input type="checkbox" id="scraperEnabled" ${a.enabled?"checked":""} onchange="window._pages.knowledge.toggleScraperEnabled()">
                    <span>${e("sources.enabled")}</span>
                </label>
                <label class="flex items-center gap-2 text-sm cursor-pointer">
                    <input type="checkbox" id="scraperAutoApprove" ${a.auto_approve?"checked":""} onchange="window._pages.knowledge.toggleAutoApprove()">
                    <span>${e("sources.autoApprove")}</span>
                </label>
                <label class="flex items-center gap-2 text-sm cursor-pointer">
                    <input type="checkbox" id="scraperDedupLlm" ${a.dedup_llm_check?"checked":""} onchange="window._pages.knowledge.toggleDedupLlm()">
                    <span title="${e("sources.dedupLlmCheckHint")}">${e("sources.dedupLlmCheck")}</span>
                </label>
                <button class="${E} ${C}" onclick="window._pages.knowledge.runScraperNow()">${e("sources.runNow")}</button>
            </div>
            <div class="flex flex-wrap items-center gap-4">
                <label class="flex items-center gap-2 text-sm">
                    <span>${e("sources.minDate")}</span>
                    <input type="date" id="scraperMinDate" value="${l(a.min_date||"")}" class="border rounded px-2 py-1 text-sm dark:bg-gray-700 dark:border-gray-600" onchange="window._pages.knowledge.updateMinDate()">
                    <span class="${w} text-xs" title="${e("sources.minDateHint")}">?</span>
                </label>
                <label class="flex items-center gap-2 text-sm">
                    <span>${e("sources.maxDate")}</span>
                    <input type="date" id="scraperMaxDate" value="${l(a.max_date||"")}" class="border rounded px-2 py-1 text-sm dark:bg-gray-700 dark:border-gray-600" onchange="window._pages.knowledge.updateMaxDate()">
                    <span class="${w} text-xs" title="${e("sources.maxDateHint")}">?</span>
                </label>
            </div>`}catch(s){t.innerHTML=`<div class="${w}">${e("sources.configLoadFailed",{error:l(s.message)})}</div>`}}function Fn(t){switch(t){case"prokoleso":return`<span class="${F}">ProKoleso</span>`;case"rss":return`<span class="${H}">RSS</span>`;case"generic_html":return`<span class="${A}">HTML</span>`;default:return`<span class="${A}">${l(t)}</span>`}}function Nn(t){return`<span class="${A}">${{uk:"🇺🇦 UK",de:"🇩🇪 DE",en:"🇬🇧 EN",fr:"🇫🇷 FR"}[t]||t}</span>`}function Hn(t){if(!t)return`<span class="${w} text-xs">—</span>`;switch(t){case"ok":return`<span class="${B}">ok</span>`;case"error":return`<span class="${M}">error</span>`;case"disabled":return`<span class="${A}">disabled</span>`;default:return`<span class="${A}">${l(t)}</span>`}}async function Je(t){t!==void 0&&(kt=t);const s=document.getElementById("sourceConfigsContainer");if(!s)return;s.innerHTML=`<div class="${D}"><div class="spinner"></div></div>`;const a=ae({offset:kt});try{const n=await p(`/admin/scraper/source-configs?${a}`),r=n.configs||[];let o=`
            <div class="mb-4">
                <button class="${E}" onclick="window._pages.knowledge.showAddSourceConfig()">${e("sources.addSource")}</button>
            </div>`;if(r.length===0)o+=`<div class="${T}">${e("sources.noSourceConfigs")}</div>`;else{const i={monday:e("sources.scheduleDays.monday"),tuesday:e("sources.scheduleDays.tuesday"),wednesday:e("sources.scheduleDays.wednesday"),thursday:e("sources.scheduleDays.thursday"),friday:e("sources.scheduleDays.friday"),saturday:e("sources.scheduleDays.saturday"),sunday:e("sources.scheduleDays.sunday")};o+=`
            <div class="overflow-x-auto min-h-[480px]"><table class="${L}" id="sourceConfigsTable"><thead><tr>
                <th class="${S}" data-sortable>${e("sources.sourceName")}</th>
                <th class="${m}">${e("sources.sourceType")}</th>
                <th class="${m}">${e("sources.sourceLanguage")}</th>
                <th class="${S}" data-sortable>${e("sources.enabled")}</th>
                <th class="${m}">${e("sources.schedule")}</th>
                <th class="${S}" data-sortable>${e("sources.lastRun")}</th>
                <th class="${m}">${e("sources.actions")}</th>
            </tr></thead><tbody>
            ${r.map(u=>{const b=u.schedule_enabled?`${i[u.schedule_day_of_week]||u.schedule_day_of_week} ${String(u.schedule_hour).padStart(2,"0")}:00`:e("common.no"),g=u.last_run_stats?`${e("sources.processed")}: ${u.last_run_stats.processed||0}`:"";return`
                <tr class="${_}">
                    <td class="${c}" data-label="${e("sources.sourceName")}">
                        <div>${l(u.name)}</div>
                        <div class="${w} text-xs">${l((u.source_url||"").replace(/^https?:\/\//,"").substring(0,40))}</div>
                    </td>
                    <td class="${c}" data-label="${e("sources.sourceType")}">${Fn(u.source_type)}</td>
                    <td class="${c}" data-label="${e("sources.sourceLanguage")}">${Nn(u.language)}</td>
                    <td class="${c}" data-label="${e("sources.enabled")}" data-sort-value="${u.enabled?1:0}">
                        <label class="inline-flex items-center cursor-pointer">
                            <input type="checkbox" ${u.enabled?"checked":""} onchange="window._pages.knowledge.toggleSourceConfigEnabled('${u.id}', this.checked)">
                        </label>
                    </td>
                    <td class="${c}" data-label="${e("sources.schedule")}"><span class="text-xs">${l(b)}</span></td>
                    <td class="${c}" data-label="${e("sources.lastRun")}" data-sort-value="${u.last_run_at||""}">
                        ${Hn(u.last_run_status)}
                        ${u.last_run_at?`<br><span class="${w} text-xs">${j(u.last_run_at)}</span>`:""}
                        ${g?`<br><span class="${w} text-xs">${g}</span>`:""}
                    </td>
                    <td class="${U}">
                        <div class="relative inline-block">
                            <button class="px-1.5 py-0.5 text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 text-sm cursor-pointer" onclick="this.nextElementSibling.classList.toggle('hidden')">&hellip;</button>
                            <div class="hidden absolute right-0 z-20 mt-1 w-36 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-md shadow-lg py-1">
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.knowledge.runSourceConfig('${u.id}')">${e("sources.runSource")}</button>
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.knowledge.editSourceConfig('${u.id}')">${e("common.edit")}</button>
                                <button class="w-full text-left px-3 py-1.5 text-xs text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950/30 cursor-pointer" data-id="${l(u.id)}" data-name="${l(u.name)}" onclick="window._pages.knowledge.deleteSourceConfig(this.dataset.id, this.dataset.name)">${e("common.delete")}</button>
                            </div>
                        </div>
                    </td>
                </tr>`}).join("")}
            </tbody></table></div>`}s.innerHTML=o,W("sourceConfigsTable"),z({containerId:"sourceConfigsPagination",total:n.total,offset:kt,onPage:i=>Je(i)})}catch(n){s.innerHTML=`<div class="${T}">${e("sources.failedToLoad",{error:l(n.message)})}
            <br><button class="${E} ${C} mt-2" onclick="window._pages.knowledge.loadSourceConfigs()">${e("common.retry")}</button></div>`}}function On(){document.getElementById("sourceConfigModalTitle").textContent=e("sources.addSource"),document.getElementById("editSourceConfigId").value="",document.getElementById("sourceConfigName").value="",document.getElementById("sourceConfigType").value="generic_html",document.getElementById("sourceConfigLanguage").value="de",document.getElementById("sourceConfigUrl").value="",document.getElementById("sourceConfigMaxArticles").value="20",document.getElementById("sourceConfigDay").value="monday",document.getElementById("sourceConfigHour").value="6",document.getElementById("sourceConfigEnabled").checked=!1,document.getElementById("sourceConfigAutoApprove").checked=!1,document.getElementById("sourceConfigSettings").value="{}",document.getElementById("sourceConfigModal").classList.add("show")}async function qn(t){try{const a=((await p("/admin/scraper/source-configs")).configs||[]).find(n=>n.id===t);if(!a){d(e("sources.configLoadFailed",{error:"Not found"}),"error");return}document.getElementById("sourceConfigModalTitle").textContent=e("sources.editSource"),document.getElementById("editSourceConfigId").value=t,document.getElementById("sourceConfigName").value=a.name||"",document.getElementById("sourceConfigType").value=a.source_type||"generic_html",document.getElementById("sourceConfigLanguage").value=a.language||"uk",document.getElementById("sourceConfigUrl").value=a.source_url||"",document.getElementById("sourceConfigMaxArticles").value=String(a.max_articles_per_run||20),document.getElementById("sourceConfigDay").value=a.schedule_day_of_week||"monday",document.getElementById("sourceConfigHour").value=String(a.schedule_hour??6),document.getElementById("sourceConfigEnabled").checked=!!a.enabled,document.getElementById("sourceConfigAutoApprove").checked=!!a.auto_approve,document.getElementById("sourceConfigSettings").value=JSON.stringify(a.settings||{},null,2),document.getElementById("sourceConfigModal").classList.add("show")}catch(s){d(e("sources.configLoadFailed",{error:s.message}),"error")}}async function Un(){const t=document.getElementById("editSourceConfigId").value,s=document.getElementById("sourceConfigName").value.trim(),a=document.getElementById("sourceConfigType").value,n=document.getElementById("sourceConfigLanguage").value,r=document.getElementById("sourceConfigUrl").value.trim(),o=parseInt(document.getElementById("sourceConfigMaxArticles").value,10),i=document.getElementById("sourceConfigDay").value,u=parseInt(document.getElementById("sourceConfigHour").value,10),b=document.getElementById("sourceConfigEnabled").checked,g=document.getElementById("sourceConfigAutoApprove").checked;let $;try{$=JSON.parse(document.getElementById("sourceConfigSettings").value)}catch{d(e("sources.invalidSettingsJson"),"error");return}if(!s||!r){d(e("sources.nameUrlRequired"),"error");return}const v={name:s,source_type:a,source_url:r,language:n,max_articles_per_run:o,schedule_day_of_week:i,schedule_hour:u,enabled:b,auto_approve:g,settings:$};try{t?await p(`/admin/scraper/source-configs/${t}`,{method:"PATCH",body:JSON.stringify(v)}):await p("/admin/scraper/source-configs",{method:"POST",body:JSON.stringify(v)}),O("sourceConfigModal"),d(e("sources.sourceConfigSaved")),Je()}catch(h){d(e("sources.sourceConfigSaveFailed",{error:h.message}),"error")}}async function zn(t,s){try{await p(`/admin/scraper/source-configs/${t}`,{method:"PATCH",body:JSON.stringify({enabled:s})}),d(e("sources.configUpdated"))}catch(a){d(e("sources.configUpdateFailed",{error:a.message}),"error"),Je()}}async function Kn(t){try{await p(`/admin/scraper/source-configs/${t}/run`,{method:"POST"}),d(e("sources.runDispatched"))}catch(s){d(e("sources.runFailed",{error:s.message}),"error")}}async function jn(t,s){if(confirm(e("sources.deleteSourceConfirm",{name:s})))try{await p(`/admin/scraper/source-configs/${t}`,{method:"DELETE"}),d(e("sources.sourceConfigDeleted")),Je()}catch(a){d(e("sources.sourceConfigDeleteFailed",{error:a.message}),"error")}}async function ct(t){t!==void 0&&(Re=t);const s=document.getElementById("sourcesContainer");s.innerHTML=`<div class="${D}"><div class="spinner"></div></div>`;const a=ae({offset:Re,filters:{status:"sourcesStatusFilter"}});try{const n=await p(`/admin/scraper/sources?${a}`),r=n.sources||[];if(r.length===0){s.innerHTML=`<div class="${T}">${e("sources.noSources")}</div>`,z({containerId:"sourcesPagination",total:0,offset:0});return}s.innerHTML=`
            <div class="overflow-x-auto min-h-[480px]"><table class="${L}" id="sourcesTable"><thead><tr><th class="${S}" data-sortable>${e("sources.url")}</th><th class="${S}" data-sortable>${e("sources.originalTitle")}</th><th class="${S}" data-sortable>${e("sources.status")}</th><th class="${S}" data-sortable>${e("sources.date")}</th><th class="${m}">${e("sources.actions")}</th></tr></thead><tbody>
            ${r.map(o=>`
                <tr class="${_}">
                    <td class="${c}" data-label="${e("sources.url")}"><a href="${l(o.url)}" target="_blank" class="text-blue-600 dark:text-blue-400 hover:underline text-xs">${l((o.url||"").replace(/^https?:\/\//,"").substring(0,50))}${(o.url||"").length>60?"...":""}</a></td>
                    <td class="${c}" data-label="${e("sources.originalTitle")}">${l(o.original_title||"-")}</td>
                    <td class="${c}" data-label="${e("sources.status")}" data-sort-value="${l(o.status||"")}">${Kt(o.status)}${o.skip_reason?`<br><span class="${w} text-xs">${l(o.skip_reason)}</span>`:""}</td>
                    <td class="${c}" data-label="${e("sources.date")}" data-sort-value="${o.created_at||""}">${j(o.created_at)}</td>
                    <td class="${U}">
                        ${o.status==="processed"&&o.article_id?`
                        <div class="relative inline-block">
                            <button class="px-1.5 py-0.5 text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 text-sm cursor-pointer" onclick="this.nextElementSibling.classList.toggle('hidden')">&hellip;</button>
                            <div class="hidden absolute right-0 z-20 mt-1 w-36 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-md shadow-lg py-1">
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.knowledge.viewSourceArticle('${o.article_id}')">${e("sources.viewArticle")}</button>
                                ${o.article_active===!1?`<button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.knowledge.approveSource('${o.id}')">${e("sources.approve")}</button>`:""}
                                <button class="w-full text-left px-3 py-1.5 text-xs text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950/30 cursor-pointer" onclick="window._pages.knowledge.rejectSource('${o.id}')">${e("sources.reject")}</button>
                            </div>
                        </div>`:""}
                    </td>
                </tr>
            `).join("")}
            </tbody></table></div>
            <p class="${w} mt-2">${e("sources.total",{count:n.total})}</p>`,W("sourcesTable"),z({containerId:"sourcesPagination",total:n.total,offset:Re,onPage:o=>ct(o)})}catch(n){s.innerHTML=`<div class="${T}">${e("sources.failedToLoad",{error:l(n.message)})}
            <br><button class="${E} ${C} mt-2" onclick="window._pages.knowledge.loadSources()">${e("common.retry")}</button></div>`}}async function Vn(){const t=document.getElementById("scraperEnabled").checked;try{await p("/admin/scraper/config",{method:"PATCH",body:JSON.stringify({enabled:t})}),d(e("sources.configUpdated"))}catch(s){d(e("sources.configUpdateFailed",{error:s.message}),"error")}}async function Jn(){const t=document.getElementById("scraperAutoApprove").checked;try{await p("/admin/scraper/config",{method:"PATCH",body:JSON.stringify({auto_approve:t})}),d(e("sources.configUpdated"))}catch(s){d(e("sources.configUpdateFailed",{error:s.message}),"error")}}async function Gn(){const t=document.getElementById("scraperDedupLlm").checked;try{await p("/admin/scraper/config",{method:"PATCH",body:JSON.stringify({dedup_llm_check:t})}),d(e("sources.configUpdated"))}catch(s){d(e("sources.configUpdateFailed",{error:s.message}),"error")}}async function Wn(){const t=document.getElementById("scraperMinDate").value||"";try{await p("/admin/scraper/config",{method:"PATCH",body:JSON.stringify({min_date:t})}),d(e("sources.configUpdated"))}catch(s){d(e("sources.configUpdateFailed",{error:s.message}),"error")}}async function Qn(){const t=document.getElementById("scraperMaxDate").value||"";try{await p("/admin/scraper/config",{method:"PATCH",body:JSON.stringify({max_date:t})}),d(e("sources.configUpdated"))}catch(s){d(e("sources.configUpdateFailed",{error:s.message}),"error")}}async function Yn(){try{await p("/admin/scraper/run",{method:"POST"}),d(e("sources.runDispatched"))}catch(t){d(e("sources.runFailed",{error:t.message}),"error")}}async function Xn(t){try{await p(`/admin/scraper/sources/${t}/approve`,{method:"POST"}),d(e("sources.approved")),ct(Re)}catch(s){d(e("sources.approveFailed",{error:s.message}),"error")}}async function Zn(t){if(confirm(e("sources.rejectConfirm")))try{await p(`/admin/scraper/sources/${t}/reject`,{method:"POST"}),d(e("sources.rejected")),ct(Re)}catch(s){d(e("sources.rejectFailed",{error:s.message}),"error")}}function eo(t){ts("articles"),setTimeout(()=>Ds(t),500)}const jt=[{value:6,label:()=>e("sources.intervalHours.6")},{value:12,label:()=>e("sources.intervalHours.12")},{value:24,label:()=>e("sources.intervalHours.24")},{value:168,label:()=>e("sources.intervalHours.168")}];function to(t){const s=jt.find(a=>a.value===t);return s?s.label():`${t}h`}async function ve(t){t!==void 0&&(et=t);const s=document.getElementById("watchedPagesContainer");if(s){s.innerHTML=`<div class="${D}"><div class="spinner"></div></div>`;try{if(Le.length===0&&ge("tenants:read"))try{Le=((await p("/admin/tenants")).tenants||[]).filter(h=>h.is_active)}catch{Le=[]}const a=ae({offset:et});Xe&&a.set("tenant_id",Xe);const n=await p(`/admin/scraper/watched-pages?${a}`),r=n.pages||[],o=$e.length?$e:[{value:"delivery",label:"delivery"},{value:"warranty",label:"warranty"},{value:"returns",label:"returns"},{value:"policies",label:"policies"},{value:"general",label:"general"}],i=`<option value="" disabled selected>${e("common.select")}</option>`+o.map(v=>`<option value="${v.value}">${l(v.label)}</option>`).join(""),u=`<option value="" disabled selected>${e("common.select")}</option>`+jt.map(v=>`<option value="${v.value}">${v.label()}</option>`).join(""),b=`<option value="">${e("sources.allTenants")}</option>`+Le.map(v=>`<option value="${v.id}" ${v.id===Xe?"selected":""}>${l(v.name)}</option>`).join(""),g=`<option value="">${e("sources.noTenant")}</option>`+Le.map(v=>`<option value="${v.id}" ${v.id===Xe?"selected":""}>${l(v.name)}</option>`).join("");let $=`
            <div class="flex flex-wrap items-center gap-2 mb-3">
                <label class="text-xs ${w}">${e("sources.filterByTenant")}</label>
                <select id="watchedTenantFilter" class="border rounded px-2 py-1.5 text-sm dark:bg-gray-700 dark:border-gray-600"
                    onchange="window._pages.knowledge.filterWatchedByTenant(this.value)">${b}</select>
            </div>
            <div class="flex flex-wrap items-end gap-2 mb-4">
                <div class="flex-1 min-w-[250px]">
                    <label class="block text-xs ${w} mb-1">${e("sources.watchedUrl")}</label>
                    <input type="text" id="watchedPageUrl" placeholder="${e("sources.urlPlaceholder")}" class="w-full border rounded px-2 py-1.5 text-sm dark:bg-gray-700 dark:border-gray-600">
                </div>
                <div>
                    <label class="block text-xs ${w} mb-1">${e("sources.watchedCategory")}</label>
                    <select id="watchedPageCategory" class="border rounded px-2 py-1.5 text-sm dark:bg-gray-700 dark:border-gray-600">${i}</select>
                </div>
                <div>
                    <label class="block text-xs ${w} mb-1">${e("sources.watchedInterval")}</label>
                    <select id="watchedPageInterval" class="border rounded px-2 py-1.5 text-sm dark:bg-gray-700 dark:border-gray-600">${u}</select>
                </div>
                <div>
                    <label class="block text-xs ${w} mb-1">${e("sources.tenant")}</label>
                    <select id="watchedPageTenant" class="border rounded px-2 py-1.5 text-sm dark:bg-gray-700 dark:border-gray-600">${g}</select>
                </div>
                <div>
                    <label class="flex items-center gap-1.5 text-sm cursor-pointer pt-4">
                        <input type="checkbox" id="watchedPageDiscovery">
                        <span>${e("sources.discoveryLabel")}</span>
                        <span class="${w} text-xs cursor-help" title="${e("sources.discoveryHint")}">(?)</span>
                    </label>
                </div>
                <button class="${E} ${C}" onclick="window._pages.knowledge.addWatchedPage()">${e("sources.addWatchedPage")}</button>
                <button class="${E} ${C} ml-2" onclick="window._pages.knowledge.showBulkImportModal()">${e("sources.bulkImport")}</button>
            </div>`;if(r.length===0)$+=`<div class="${T}">${e("sources.noWatchedPages")}</div>`;else{const v=r.filter(x=>!x.parent_id),h=r.filter(x=>x.parent_id),f={};for(const x of h){const k=x.parent_id;f[k]||(f[k]=[]),f[k].push(x)}let y="";for(const x of v){const k=x.is_discovery,P=f[x.id]||[];y+=`
                <tr class="${_}">
                    <td class="${c}" data-label="${e("sources.watchedUrl")}">
                        <a href="${l(x.url)}" target="_blank" class="text-blue-600 dark:text-blue-400 hover:underline text-xs">${l((x.url||"").replace(/^https?:\/\//,"").substring(0,50))}</a>
                        ${k?`<br><span class="${H} text-xs">${e("sources.discoveryBadge")}</span> <span class="${w} text-xs">${e("sources.childCount",{count:x.child_count||0})}</span>`:""}
                    </td>
                    <td class="${c}" data-label="${e("sources.watchedCategory")}"><span class="${F}">${l(x.article_category||"-")}</span></td>
                    <td class="${c}" data-label="${e("sources.watchedInterval")}">
                        <select class="border rounded px-1 py-0.5 text-xs dark:bg-gray-700 dark:border-gray-600"
                            onchange="window._pages.knowledge.updateWatchedInterval('${x.id}', parseInt(this.value))">
                            ${jt.map(I=>`<option value="${I.value}" ${I.value===x.rescrape_interval_hours?"selected":""}>${I.label()}</option>`).join("")}
                        </select>
                    </td>
                    <td class="${c}" data-label="${e("sources.watchedStatus")}">${Kt(x.status)}</td>
                    <td class="${c}" data-label="${e("sources.watchedLastScraped")}">${x.fetched_at?j(x.fetched_at):`<span class="${w} text-xs">${e("sources.neverScraped")}</span>`}</td>
                    <td class="${c}" data-label="${e("sources.watchedNextScrape")}">${x.next_scrape_at?j(x.next_scrape_at):"-"}</td>
                    <td class="${U}">
                        <div class="relative inline-block">
                            <button class="px-1.5 py-0.5 text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 text-sm cursor-pointer" onclick="this.nextElementSibling.classList.toggle('hidden')">&hellip;</button>
                            <div class="hidden absolute right-0 z-20 mt-1 w-40 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-md shadow-lg py-1">
                                ${!k&&x.article_id?`<button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.knowledge.viewSourceArticle('${x.article_id}')">${e("sources.watchedArticle")}</button>`:""}
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.knowledge.scrapeWatchedNow('${x.id}')">${e("sources.scrapeNow")}</button>
                                <button class="w-full text-left px-3 py-1.5 text-xs text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950/30 cursor-pointer" onclick="window._pages.knowledge.deleteWatchedPage('${x.id}')">${e("sources.deleteWatched")}</button>
                            </div>
                        </div>
                    </td>
                </tr>`;for(const I of P)y+=`
                    <tr class="${_} opacity-80">
                        <td class="${c} pl-8" data-label="${e("sources.watchedUrl")}">
                            <span class="${w}">↳</span>
                            <a href="${l(I.url)}" target="_blank" class="text-blue-600 dark:text-blue-400 hover:underline text-xs">${l((I.url||"").replace(/^https?:\/\//,"").substring(0,50))}</a>
                        </td>
                        <td class="${c}" data-label="${e("sources.watchedCategory")}"><span class="${F}">${l(I.article_category||"-")}</span></td>
                        <td class="${c}" data-label="${e("sources.watchedInterval")}"><span class="text-xs">${to(I.rescrape_interval_hours)}</span></td>
                        <td class="${c}" data-label="${e("sources.watchedStatus")}">${Kt(I.status)}</td>
                        <td class="${c}" data-label="${e("sources.watchedLastScraped")}">${I.fetched_at?j(I.fetched_at):`<span class="${w} text-xs">${e("sources.neverScraped")}</span>`}</td>
                        <td class="${c}" data-label="${e("sources.watchedNextScrape")}">${I.next_scrape_at?j(I.next_scrape_at):"-"}</td>
                        <td class="${U}">
                            ${I.article_id?`<button class="text-xs text-blue-600 dark:text-blue-400 hover:underline cursor-pointer" onclick="window._pages.knowledge.viewSourceArticle('${I.article_id}')">${e("sources.watchedArticle")}</button>`:""}
                        </td>
                    </tr>`}$+=`
            <div class="overflow-x-auto min-h-[480px]"><table class="${L}" id="watchedPagesTable"><thead><tr>
                <th class="${m}">${e("sources.watchedUrl")}</th>
                <th class="${m}">${e("sources.watchedCategory")}</th>
                <th class="${m}">${e("sources.watchedInterval")}</th>
                <th class="${m}">${e("sources.watchedStatus")}</th>
                <th class="${m}">${e("sources.watchedLastScraped")}</th>
                <th class="${m}">${e("sources.watchedNextScrape")}</th>
                <th class="${m}">${e("sources.watchedActions")}</th>
            </tr></thead><tbody>
            ${y}
            </tbody></table></div>`}s.innerHTML=$,z({containerId:"watchedPagesPagination",total:n.total,offset:et,onPage:v=>ve(v)})}catch(a){s.innerHTML=`<div class="${T}">${e("sources.watchedFailedToLoad",{error:l(a.message)})}
            <br><button class="${E} ${C} mt-2" onclick="window._pages.knowledge.loadWatchedPages()">${e("common.retry")}</button></div>`}}}function so(t){Xe=t,et=0,ve()}async function ao(){var i,u,b,g,$,v;const t=(u=(i=document.getElementById("watchedPageUrl"))==null?void 0:i.value)==null?void 0:u.trim(),s=(b=document.getElementById("watchedPageCategory"))==null?void 0:b.value,a=(g=document.getElementById("watchedPageInterval"))==null?void 0:g.value,n=(($=document.getElementById("watchedPageDiscovery"))==null?void 0:$.checked)||!1,r=((v=document.getElementById("watchedPageTenant"))==null?void 0:v.value)||null;if(!t){d(e("sources.urlRequired"),"error");return}if(!s){d(e("sources.categoryRequired"),"error");return}if(!a){d(e("sources.intervalRequired"),"error");return}const o=parseInt(a,10);if(isNaN(o)||o<1){d(e("sources.intervalRequired"),"error");return}try{await p("/admin/scraper/watched-pages",{method:"POST",body:JSON.stringify({url:t,category:s,rescrape_interval_hours:o,is_discovery:n,tenant_id:r})}),d(e("sources.watchedPageAdded")),document.getElementById("watchedPageUrl").value="",ve()}catch(h){d(e("sources.watchedPageAddFailed",{error:h.message}),"error")}}async function no(t,s){try{await p(`/admin/scraper/watched-pages/${t}`,{method:"PATCH",body:JSON.stringify({rescrape_interval_hours:s})}),d(e("sources.watchedPageUpdated"))}catch(a){d(e("sources.watchedPageUpdateFailed",{error:a.message}),"error")}}async function oo(t){try{d(e("sources.scrapeNowRunning"),"info");const s=await p(`/admin/scraper/watched-pages/${t}/scrape-now`,{method:"POST"});s.status==="unchanged"?d(e("sources.scrapeNowUnchanged")):s.status==="ok"&&s.discovered!==void 0?d(e("sources.scrapeNowDiscoveryDone",{discovered:s.discovered,created:s.created||0,updated:s.updated||0})):d(e("sources.scrapeNowDone",{status:s.status||"ok"})),ve()}catch(s){d(e("sources.scrapeNowFailed",{error:s.message}),"error")}}async function ro(t){if(confirm(e("sources.watchedPageDeleteConfirm")))try{await p(`/admin/scraper/watched-pages/${t}`,{method:"DELETE"}),d(e("sources.watchedPageDeleted")),ve()}catch(s){d(e("sources.watchedPageDeleteFailed",{error:s.message}),"error")}}function lo(){let t='<option value="">—</option>';for(const a of Le)t+=`<option value="${l(a.id)}">${l(a.name)}</option>`;const s=`
        <div id="bulkImportOverlay" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center" onclick="if(event.target===this)this.remove()">
            <div class="bg-white dark:bg-neutral-800 rounded-lg shadow-xl w-full max-w-lg mx-4 p-6">
                <h3 class="text-lg font-semibold text-neutral-900 dark:text-neutral-50 mb-4">${e("sources.bulkImportTitle")}</h3>
                <textarea id="bulkUrls" rows="8" class="w-full border rounded px-3 py-2 text-sm dark:bg-neutral-700 dark:border-neutral-600 mb-3" placeholder="${e("sources.bulkUrlsPlaceholder")}"></textarea>
                <div class="grid grid-cols-3 gap-3 mb-4">
                    <div>
                        <label class="block text-xs ${w} mb-1">${e("sources.watchedCategory")}</label>
                        <select id="bulkCategory" class="w-full border rounded px-2 py-1.5 text-sm dark:bg-neutral-700 dark:border-neutral-600">
                            <option value="general">general</option>
                            <option value="faq">faq</option>
                            <option value="guides">guides</option>
                            <option value="comparisons">comparisons</option>
                            <option value="brands">brands</option>
                            <option value="procedures">procedures</option>
                            <option value="delivery">delivery</option>
                            <option value="warranty">warranty</option>
                            <option value="returns">returns</option>
                            <option value="policies">policies</option>
                            <option value="promotions">promotions</option>
                            <option value="news">news</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs ${w} mb-1">${e("sources.watchedInterval")}</label>
                        <select id="bulkInterval" class="w-full border rounded px-2 py-1.5 text-sm dark:bg-neutral-700 dark:border-neutral-600">
                            <option value="6">${e("sources.intervalHours.6")}</option>
                            <option value="12">${e("sources.intervalHours.12")}</option>
                            <option value="24">${e("sources.intervalHours.24")}</option>
                            <option value="168" selected>${e("sources.intervalHours.168")}</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs ${w} mb-1">${e("sources.tenant")}</label>
                        <select id="bulkTenant" class="w-full border rounded px-2 py-1.5 text-sm dark:bg-neutral-700 dark:border-neutral-600">${t}</select>
                    </div>
                </div>
                <div class="flex justify-end gap-2">
                    <button class="${q} ${C}" onclick="document.getElementById('bulkImportOverlay').remove()">${e("common.cancel")}</button>
                    <button class="${E} ${C}" onclick="window._pages.knowledge.submitBulkImport()">${e("sources.bulkImport")}</button>
                </div>
            </div>
        </div>`;document.body.insertAdjacentHTML("beforeend",s)}async function io(){var r,o,i,u,b;const s=(((r=document.getElementById("bulkUrls"))==null?void 0:r.value)||"").split(`
`).map(g=>g.trim()).filter(Boolean);if(s.length===0)return;const a=parseInt(((o=document.getElementById("bulkInterval"))==null?void 0:o.value)||"168",10),n=((i=document.getElementById("bulkTenant"))==null?void 0:i.value)||null;try{const g=await p("/admin/scraper/watched-pages/bulk",{method:"POST",body:JSON.stringify({urls:s,category:((u=document.getElementById("bulkCategory"))==null?void 0:u.value)||"general",rescrape_interval_hours:a,tenant_id:n})});d(e("sources.bulkImportResult",{added:g.added,skipped:g.skipped})),(b=document.getElementById("bulkImportOverlay"))==null||b.remove(),ve()}catch(g){d(e("sources.watchedPageAddFailed",{error:g.message}),"error")}}function co(){Y("knowledge",()=>ts(Ms)),document.addEventListener("click",t=>{t.target.closest(".relative")||document.querySelectorAll("#page-knowledge .relative > div:not(.hidden)").forEach(s=>s.classList.add("hidden"))})}window._pages=window._pages||{};window._pages.knowledge={showTab:ts,loadArticles:me,showCreateArticle:Bn,editArticle:Ds,saveArticle:In,toggleArticle:Ln,deleteArticle:An,reindexArticle:Pn,reindexAll:Rn,showImportModal:Mn,importDocuments:Dn,loadSourceConfigs:Je,showAddSourceConfig:On,editSourceConfig:qn,saveSourceConfig:Un,toggleSourceConfigEnabled:zn,runSourceConfig:Kn,deleteSourceConfig:jn,loadScraperConfig:Fs,loadSources:ct,toggleScraperEnabled:Vn,toggleAutoApprove:Jn,toggleDedupLlm:Gn,updateMinDate:Wn,updateMaxDate:Qn,runScraperNow:Yn,approveSource:Xn,rejectSource:Zn,viewSourceArticle:eo,loadWatchedPages:ve,addWatchedPage:ao,updateWatchedInterval:no,scrapeWatchedNow:oo,deleteWatchedPage:ro,filterWatchedByTenant:so,showBulkImportModal:lo,submitBulkImport:io};let Ns="templates",Me=0,De=0,Fe=0,ue=!1;function Hs(t){Ns=t,["templates","dialogues","safety"].forEach(r=>{const o=document.getElementById(`scenariosContent-${r}`);o&&(o.style.display=r===t?"block":"none")}),document.querySelectorAll("#page-scenarios .tab-bar button").forEach(r=>r.classList.remove("active"));const a=document.querySelector(`#page-scenarios .tab-bar button[data-tab="${t}"]`);a&&a.classList.add("active"),Me=0,De=0,Fe=0;const n={templates:ut,dialogues:pt,safety:gt};n[t]&&n[t]()}async function ut(t){var n,r;t!==void 0&&(Me=t);const s=document.getElementById("templatesContainer")||document.getElementById("scenariosContent-templates");s.innerHTML=`<div class="${D}"><div class="spinner"></div></div>`;const a=ae({offset:Me});try{const o=await p(`/training/templates/?${a}`);let i=o.items||[];const u=document.getElementById("templateFilterKey");if(u){const h=u.value,f=[...new Set(i.map(y=>y.template_key))].sort();u.innerHTML=`<option value="">${e("training.allTemplateKeys")}</option>`+f.map(y=>`<option value="${l(y)}"${y===h?" selected":""}>${l(y)}</option>`).join("")}const b=((n=document.getElementById("templateFilterKey"))==null?void 0:n.value)||"",g=(((r=document.getElementById("templateSearch"))==null?void 0:r.value)||"").toLowerCase().trim();if(b&&(i=i.filter(h=>h.template_key===b)),g&&(i=i.filter(h=>(h.title||"").toLowerCase().includes(g)||(h.content||"").toLowerCase().includes(g)||(h.template_key||"").toLowerCase().includes(g))),i.length===0){s.innerHTML=`
                <div class="mb-4"><button class="${E}" onclick="window._pages.scenarios.showCreateTemplate()">${e("training.newTemplate")}</button></div>
                <div class="${T}">${e("training.noTemplates")}</div>`,z({containerId:"templatesPagination",total:0,offset:0});return}const $={};for(const h of i)$[h.template_key]||($[h.template_key]=[]),$[h.template_key].push(h);let v="";for(const[h,f]of Object.entries($))for(let y=0;y<f.length;y++){const x=f[y],k=y===0,P=f.length;v+=`
                <tr class="${_}">
                    ${k?`<td class="${c}" data-label="${e("training.templateKey")}" rowspan="${P}"><span class="${F}">${l(h)}</span><br><span class="${w} text-xs">${P} ${e("training.variantCount",{count:P})}</span><br><button class="${E} ${C} mt-1" onclick="window._pages.scenarios.addVariant('${l(h)}')">${e("training.addVariant")}</button></td>`:`<td class="${c} mobile-only-cell" data-label="${e("training.templateKey")}"><span class="${F}">${l(h)}</span></td>`}
                    <td class="${c}" data-label="#"><span class="${A}">#${x.variant_number}</span></td>
                    <td class="${c}" data-label="${e("training.templateTitle")}">${l(x.title)}</td>
                    <td class="${c}" data-label="${e("training.content")}"><span class="${w}">${l((x.content||"").substring(0,80))}${(x.content||"").length>80?"...":""}</span></td>
                    <td class="${c}" data-label="${e("training.activeCol")}">${x.is_active!==!1?`<span class="${B}">${e("common.yes")}</span>`:`<span class="${M}">${e("common.no")}</span>`}</td>
                    <td class="${U}">
                        <div class="relative inline-block">
                            <button class="px-1.5 py-0.5 text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 text-sm cursor-pointer" onclick="this.nextElementSibling.classList.toggle('hidden')">&hellip;</button>
                            <div class="hidden absolute right-0 z-20 mt-1 w-36 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-md shadow-lg py-1">
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.scenarios.editTemplate('${x.id}')">${e("common.edit")}</button>
                                ${P>1?`<button class="w-full text-left px-3 py-1.5 text-xs text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950/30 cursor-pointer" data-id="${l(x.id)}" data-name="${l(x.title)}" onclick="window._pages.scenarios.deleteTemplate(this.dataset.id, this.dataset.name)">${e("common.delete")}</button>`:""}
                            </div>
                        </div>
                    </td>
                </tr>`}s.innerHTML=`
            <div class="mb-4">
                <button class="${E}" onclick="window._pages.scenarios.showCreateTemplate()">${e("training.newTemplate")}</button>
                <span class="${w} ml-3 text-sm">${e("training.variantsHint")}</span>
            </div>
            <div class="overflow-x-auto min-h-[480px]"><table class="${L}"><thead><tr><th class="${m}">${e("training.templateKey")}</th><th class="${m}">#</th><th class="${m}">${e("training.templateTitle")}</th><th class="${m}">${e("training.content")}</th><th class="${m}">${e("training.activeCol")}</th><th class="${m}">${e("training.actions")}</th></tr></thead><tbody>
            ${v}
            </tbody></table></div>`,z({containerId:"templatesPagination",total:o.total,offset:Me,onPage:h=>ut(h)})}catch(o){s.innerHTML=`<div class="${T}">${e("training.loadFailed",{error:l(o.message)})}</div>`}}function uo(){document.getElementById("templateModalTitle").textContent=e("training.newTemplate"),document.getElementById("editTemplateId").value="",document.getElementById("templateKey").value="",document.getElementById("templateKey").disabled=!1,document.getElementById("templateTitle").value="",document.getElementById("templateContent").value="",document.getElementById("templateDescription").value="",document.getElementById("responseTemplateModal").classList.add("show")}function po(t){document.getElementById("templateModalTitle").textContent=e("training.addVariantTitle"),document.getElementById("editTemplateId").value="",document.getElementById("templateKey").value=t,document.getElementById("templateKey").disabled=!0,document.getElementById("templateTitle").value="",document.getElementById("templateContent").value="",document.getElementById("templateDescription").value="",document.getElementById("responseTemplateModal").classList.add("show")}async function go(t){try{const a=(await p(`/training/templates/${t}`)).item;document.getElementById("templateModalTitle").textContent=e("training.editTemplate"),document.getElementById("editTemplateId").value=t,document.getElementById("templateKey").value=a.template_key||"",document.getElementById("templateKey").disabled=!0,document.getElementById("templateTitle").value=a.title||"",document.getElementById("templateContent").value=a.content||"",document.getElementById("templateDescription").value=a.description||"",document.getElementById("responseTemplateModal").classList.add("show")}catch(s){d(e("training.loadFailed",{error:s.message}),"error")}}async function mo(){if(ue)return;const t=document.getElementById("editTemplateId").value,s=document.getElementById("templateKey").value.trim(),a=document.getElementById("templateTitle").value.trim(),n=document.getElementById("templateContent").value.trim(),r=document.getElementById("templateDescription").value.trim();if(!a||!n){d(e("training.titleContentRequired"),"error");return}ue=!0;try{if(t)await p(`/training/templates/${t}`,{method:"PATCH",body:JSON.stringify({title:a,content:n,description:r||null})});else{if(!s){d(e("training.keyRequired"),"error");return}await p("/training/templates/",{method:"POST",body:JSON.stringify({template_key:s,title:a,content:n,description:r||null})})}O("responseTemplateModal"),d(e("training.templateSaved")),ut(Me)}catch(o){d(e("training.saveFailed",{error:o.message}),"error")}finally{ue=!1}}async function bo(t,s){if(confirm(e("training.deleteVariantConfirm",{title:s})))try{await p(`/training/templates/${t}`,{method:"DELETE"}),d(e("training.variantDeleted")),ut(Me)}catch(a){d(e("training.deleteFailed",{error:a.message}),"error")}}async function pt(t){t!==void 0&&(De=t);const s=document.getElementById("dialoguesContainer")||document.getElementById("scenariosContent-dialogues");s.innerHTML=`<div class="${D}"><div class="spinner"></div></div>`;const a=ae({offset:De,filters:{scenario_type:"dialogueFilterScenario",phase:"dialogueFilterPhase",is_active:"dialogueFilterActive"}});try{const n=await p(`/training/dialogues/?${a}`),r=n.items||[];if(r.length===0){s.innerHTML=`
                <div class="mb-4"><button class="${E}" onclick="window._pages.scenarios.showCreateDialogue()">${e("training.newDialogue")}</button></div>
                <div class="${T}">${e("training.noDialogues")}</div>`,z({containerId:"dialoguesPagination",total:0,offset:0});return}s.innerHTML=`
            <div class="mb-4"><button class="${E}" onclick="window._pages.scenarios.showCreateDialogue()">${e("training.newDialogue")}</button></div>
            <div class="overflow-x-auto min-h-[480px]"><table class="${L}" id="dialoguesTable"><thead><tr><th class="${S}" data-sortable>${e("training.dialogueTitle")}</th><th class="${S}" data-sortable>${e("training.scenario")}</th><th class="${S}" data-sortable>${e("training.phase")}</th><th class="${m}">${e("training.tools")}</th><th class="${S}" data-sortable>${e("training.activeCol")}</th><th class="${m}">${e("training.actions")}</th></tr></thead><tbody>
            ${r.map(o=>`
                <tr class="${_}">
                    <td class="${c}" data-label="${e("training.dialogueTitle")}">${l(o.title)}</td>
                    <td class="${c}" data-label="${e("training.scenario")}"><span class="${F}">${l(o.scenario_type)}</span></td>
                    <td class="${c}" data-label="${e("training.phase")}"><span class="${A}">${l(o.phase)}</span></td>
                    <td class="${c}" data-label="${e("training.tools")}">${(o.tools_used||[]).map(i=>`<span class="${Ae}">${l(i)}</span>`).join(" ")}</td>
                    <td class="${c}" data-label="${e("training.activeCol")}">${o.is_active!==!1?`<span class="${B}">${e("common.yes")}</span>`:`<span class="${M}">${e("common.no")}</span>`}</td>
                    <td class="${U}">
                        <div class="relative inline-block">
                            <button class="px-1.5 py-0.5 text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 text-sm cursor-pointer" onclick="this.nextElementSibling.classList.toggle('hidden')">&hellip;</button>
                            <div class="hidden absolute right-0 z-20 mt-1 w-36 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-md shadow-lg py-1">
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.scenarios.editDialogue('${o.id}')">${e("common.edit")}</button>
                                <button class="w-full text-left px-3 py-1.5 text-xs text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950/30 cursor-pointer" data-id="${l(o.id)}" data-name="${l(o.title)}" onclick="window._pages.scenarios.deleteDialogue(this.dataset.id, this.dataset.name)">${e("common.delete")}</button>
                            </div>
                        </div>
                    </td>
                </tr>
            `).join("")}
            </tbody></table></div>`,W("dialoguesTable"),z({containerId:"dialoguesPagination",total:n.total,offset:De,onPage:o=>pt(o)})}catch(n){s.innerHTML=`<div class="${T}">${e("training.loadFailed",{error:l(n.message)})}</div>`}}function ho(){document.getElementById("dialogueModalTitle").textContent=e("training.newDialogue"),document.getElementById("editDialogueId").value="",document.getElementById("dialogueTitle").value="",document.getElementById("dialogueScenarioType").value="tire_search",document.getElementById("dialoguePhase").value="mvp",document.getElementById("dialogueJSON").value=`[
  {"role": "customer", "text": ""},
  {"role": "agent", "text": ""}
]`,document.getElementById("dialogueDescription").value="",document.getElementById("dialogueModal").classList.add("show")}async function vo(t){try{const a=(await p(`/training/dialogues/${t}`)).item;document.getElementById("dialogueModalTitle").textContent=e("training.editDialogue"),document.getElementById("editDialogueId").value=t,document.getElementById("dialogueTitle").value=a.title||"",document.getElementById("dialogueScenarioType").value=a.scenario_type||"tire_search",document.getElementById("dialoguePhase").value=a.phase||"mvp",document.getElementById("dialogueJSON").value=JSON.stringify(a.dialogue||[],null,2),document.getElementById("dialogueDescription").value=a.description||"",document.getElementById("dialogueModal").classList.add("show")}catch(s){d(e("training.loadFailed",{error:s.message}),"error")}}async function fo(){if(ue)return;const t=document.getElementById("editDialogueId").value,s=document.getElementById("dialogueTitle").value.trim(),a=document.getElementById("dialogueScenarioType").value,n=document.getElementById("dialoguePhase").value,r=document.getElementById("dialogueDescription").value.trim();let o;try{o=JSON.parse(document.getElementById("dialogueJSON").value)}catch{d(e("training.invalidJSON"),"error");return}if(!s){d(e("training.titleRequired"),"error");return}const i=[...new Set(o.filter(b=>b.tool_calls).flatMap(b=>b.tool_calls.map(g=>g.name)))],u={title:s,scenario_type:a,phase:n,dialogue:o,tools_used:i,description:r||null};ue=!0;try{t?await p(`/training/dialogues/${t}`,{method:"PATCH",body:JSON.stringify(u)}):await p("/training/dialogues/",{method:"POST",body:JSON.stringify(u)}),O("dialogueModal"),d(e("training.dialogueSaved")),pt(De)}catch(b){d(e("training.saveFailed",{error:b.message}),"error")}finally{ue=!1}}async function yo(t,s){if(confirm(e("training.deleteConfirm",{title:s})))try{await p(`/training/dialogues/${t}`,{method:"DELETE"}),d(e("training.dialogueDeleted")),pt(De)}catch(a){d(e("training.deleteFailed",{error:a.message}),"error")}}const $o={critical:4,high:3,medium:2,low:1};function Os(t){switch(t){case"critical":return`<span class="${M}">${l(t)}</span>`;case"high":return`<span class="${H}">${l(t)}</span>`;case"medium":return`<span class="${F}">${l(t)}</span>`;default:return`<span class="${A}">${l(t)}</span>`}}async function gt(t){t!==void 0&&(Fe=t);const s=document.getElementById("safetyRulesContainer")||document.getElementById("scenariosContent-safety");s.innerHTML=`<div class="${D}"><div class="spinner"></div></div>`;const a=ae({offset:Fe,filters:{rule_type:"safetyFilterType",severity:"safetyFilterSeverity",is_active:"safetyFilterActive"}});try{const n=await p(`/training/safety-rules/?${a}`),r=n.items||[];if(r.length===0){s.innerHTML=`
                <div class="mb-4"><button class="${E}" onclick="window._pages.scenarios.showCreateSafetyRule()">${e("training.newSafetyRule")}</button></div>
                <div class="${T}">${e("training.noSafetyRules")}</div>`,z({containerId:"safetyPagination",total:0,offset:0});return}s.innerHTML=`
            <div class="mb-4">
                <button class="${E}" onclick="window._pages.scenarios.showCreateSafetyRule()">${e("training.newSafetyRule")}</button>
                <button class="${q} ml-2" id="regressionTestBtn" onclick="window._pages.scenarios.runSafetyRegressionTest()">${e("training.regressionTest")}</button>
            </div>
            <div class="overflow-x-auto min-h-[480px]"><table class="${L}" id="safetyRulesTable"><thead><tr><th class="${S}" data-sortable>${e("training.ruleTitle")}</th><th class="${S}" data-sortable>${e("training.ruleType")}</th><th class="${S}" data-sortable>${e("training.severity")}</th><th class="${m}">${e("training.triggerInput")}</th><th class="${S}" data-sortable>${e("training.activeCol")}</th><th class="${m}">${e("training.actions")}</th></tr></thead><tbody>
            ${r.map(o=>`
                <tr class="${_}">
                    <td class="${c}" data-label="${e("training.ruleTitle")}">${l(o.title)}</td>
                    <td class="${c}" data-label="${e("training.ruleType")}"><span class="${F}">${l(o.rule_type)}</span></td>
                    <td class="${c}" data-label="${e("training.severity")}" data-sort-value="${$o[o.severity]||0}">${Os(o.severity)}</td>
                    <td class="${c}" data-label="${e("training.triggerInput")}"><span class="${w}">${l((o.trigger_input||"").substring(0,60))}${(o.trigger_input||"").length>60?"...":""}</span></td>
                    <td class="${c}" data-label="${e("training.activeCol")}">${o.is_active!==!1?`<span class="${B}">${e("common.yes")}</span>`:`<span class="${M}">${e("common.no")}</span>`}</td>
                    <td class="${U}">
                        <div class="relative inline-block">
                            <button class="px-1.5 py-0.5 text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 text-sm cursor-pointer" onclick="this.nextElementSibling.classList.toggle('hidden')">&hellip;</button>
                            <div class="hidden absolute right-0 z-20 mt-1 w-36 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-md shadow-lg py-1">
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.scenarios.editSafetyRule('${o.id}')">${e("common.edit")}</button>
                                <button class="w-full text-left px-3 py-1.5 text-xs text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950/30 cursor-pointer" data-id="${l(o.id)}" data-name="${l(o.title)}" onclick="window._pages.scenarios.deleteSafetyRule(this.dataset.id, this.dataset.name)">${e("common.delete")}</button>
                            </div>
                        </div>
                    </td>
                </tr>
            `).join("")}
            </tbody></table></div>`,W("safetyRulesTable"),z({containerId:"safetyPagination",total:n.total,offset:Fe,onPage:o=>gt(o)})}catch(n){s.innerHTML=`<div class="${T}">${e("training.loadFailed",{error:l(n.message)})}</div>`}}function xo(){document.getElementById("safetyRuleModalTitle").textContent=e("training.newSafetyRule"),document.getElementById("editSafetyRuleId").value="",document.getElementById("safetyRuleTitle").value="",document.getElementById("safetyRuleType").value="behavioral",document.getElementById("safetyRuleSeverity").value="medium",document.getElementById("safetyTriggerInput").value="",document.getElementById("safetyExpectedBehavior").value="",document.getElementById("safetyRuleModal").classList.add("show")}async function wo(t){try{const a=(await p(`/training/safety-rules/${t}`)).item;document.getElementById("safetyRuleModalTitle").textContent=e("training.editSafetyRule"),document.getElementById("editSafetyRuleId").value=t,document.getElementById("safetyRuleTitle").value=a.title||"",document.getElementById("safetyRuleType").value=a.rule_type||"behavioral",document.getElementById("safetyRuleSeverity").value=a.severity||"medium",document.getElementById("safetyTriggerInput").value=a.trigger_input||"",document.getElementById("safetyExpectedBehavior").value=a.expected_behavior||"",document.getElementById("safetyRuleModal").classList.add("show")}catch(s){d(e("training.loadFailed",{error:s.message}),"error")}}async function ko(){if(ue)return;const t=document.getElementById("editSafetyRuleId").value,s=document.getElementById("safetyRuleTitle").value.trim(),a=document.getElementById("safetyRuleType").value,n=document.getElementById("safetyRuleSeverity").value,r=document.getElementById("safetyTriggerInput").value.trim(),o=document.getElementById("safetyExpectedBehavior").value.trim();if(!s||!r||!o){d(e("training.fieldsRequired"),"error");return}const i={title:s,rule_type:a,severity:n,trigger_input:r,expected_behavior:o};ue=!0;try{t?await p(`/training/safety-rules/${t}`,{method:"PATCH",body:JSON.stringify(i)}):await p("/training/safety-rules/",{method:"POST",body:JSON.stringify(i)}),O("safetyRuleModal"),d(e("training.safetyRuleSaved")),gt(Fe)}catch(u){d(e("training.saveFailed",{error:u.message}),"error")}finally{ue=!1}}async function To(t,s){if(confirm(e("training.deleteConfirm",{title:s})))try{await p(`/training/safety-rules/${t}`,{method:"DELETE"}),d(e("training.safetyRuleDeleted")),gt(Fe)}catch(a){d(e("training.deleteFailed",{error:a.message}),"error")}}async function _o(){const t=document.getElementById("regressionTestBtn");t&&(t.disabled=!0,t.textContent=e("training.regressionRunning"));try{const s=await p("/training/safety-rules/regression-test",{method:"POST"});So(s)}catch(s){d(e("training.regressionFailed",{error:s.message}),"error")}finally{t&&(t.disabled=!1,t.textContent=e("training.regressionTest"))}}function So(t){const a=(t.results||[]).map(o=>`
        <tr class="${_}">
            <td class="${c}">
                ${o.passed?`<span class="${B}">${e("training.regressionPassed")}</span>`:`<span class="${M}">${e("training.regressionFailed_label")}</span>`}
            </td>
            <td class="${c}">${l(o.title)}</td>
            <td class="${c}">${Os(o.severity)}</td>
            <td class="${c}"><span class="${w}">${l((o.trigger_input||"").substring(0,80))}</span></td>
            <td class="${c}"><span class="${w}">${l((o.expected||"").substring(0,80))}</span></td>
            <td class="${c}"><span class="${w}">${l((o.actual||"").substring(0,120))}</span></td>
            <td class="${c}"><span class="${w}">${l((o.reason||"").substring(0,80))}</span></td>
        </tr>
    `).join("");if(!document.getElementById("regressionResultsModal")){const o=document.createElement("div");o.id="regressionResultsModal",o.className="modal",o.innerHTML=`
            <div class="modal-content" style="max-width:900px">
                <div class="modal-header">
                    <h3>${e("training.regressionResults")}</h3>
                    <button class="modal-close" onclick="window._pages.scenarios.closeRegressionModal()">&times;</button>
                </div>
                <div class="modal-body" id="regressionResultsBody"></div>
            </div>`,document.body.appendChild(o)}const r=document.getElementById("regressionResultsBody");r.innerHTML=`
        <div class="mb-4">
            <span class="${B} mr-2">${e("training.regressionPassedCount",{count:t.passed})}</span>
            <span class="${M}">${e("training.regressionFailedCount",{count:t.failed})}</span>
            <span class="${w} ml-2">${e("training.regressionTotal",{count:t.total})}</span>
        </div>
        <div class="overflow-x-auto"><table class="${L}"><thead><tr>
            <th class="${m}">${e("training.regressionStatus")}</th>
            <th class="${m}">${e("training.ruleTitle")}</th>
            <th class="${m}">${e("training.severity")}</th>
            <th class="${m}">${e("training.triggerInput")}</th>
            <th class="${m}">${e("training.expectedBehavior")}</th>
            <th class="${m}">${e("training.regressionActual")}</th>
            <th class="${m}">${e("training.regressionReason")}</th>
        </tr></thead><tbody>${a}</tbody></table></div>`,document.getElementById("regressionResultsModal").classList.add("show")}function Co(){O("regressionResultsModal")}function Eo(){Y("scenarios",()=>Hs(Ns)),document.addEventListener("click",t=>{t.target.closest(".relative")||document.querySelectorAll("#page-scenarios .relative > div:not(.hidden)").forEach(s=>s.classList.add("hidden"))})}window._pages=window._pages||{};window._pages.scenarios={showTab:Hs,loadTemplates:ut,showCreateTemplate:uo,addVariant:po,editTemplate:go,saveTemplate:mo,deleteTemplate:bo,loadDialogues:pt,showCreateDialogue:ho,editDialogue:vo,saveDialogue:fo,deleteDialogue:yo,loadSafetyRules:gt,showCreateSafetyRule:xo,editSafetyRule:wo,saveSafetyRule:ko,deleteSafetyRule:To,runSafetyRegressionTest:_o,closeRegressionModal:Co};const qs=25;let ie=0,tt=[];async function Lt(t){t!==void 0&&(ie=t);const s=document.getElementById("toolsContent");s.innerHTML=`<div class="${D}"><div class="spinner"></div></div>`;try{tt=(await p("/training/tools/")).items||[];const n=tt.slice(ie,ie+qs);s.innerHTML=`
            <div class="overflow-x-auto min-h-[480px]"><table class="${L}" id="toolsTable"><thead><tr><th class="${S}" data-sortable>${e("training.toolName")}</th><th class="${m}">${e("training.description")}</th><th class="${S}" data-sortable>${e("training.override")}</th><th class="${m}">${e("training.actions")}</th></tr></thead><tbody>
            ${n.map(r=>`
                <tr class="${_}">
                    <td class="${c}" data-label="${e("training.toolName")}"><span class="${F}">${l(r.name)}</span></td>
                    <td class="${c}" data-label="${e("training.description")}"><span class="${w}">${l((r.effective_description||"").substring(0,100))}${(r.effective_description||"").length>100?"...":""}</span></td>
                    <td class="${c}" data-label="${e("training.override")}">${r.has_override?`<span class="${H}">${e("training.overridden")}</span>`:`<span class="${A}">${e("training.default")}</span>`}</td>
                    <td class="${U}" data-label="${e("training.actions")}">
                        <div class="flex flex-wrap gap-1">
                            <button class="${E} ${C}" onclick="window._pages.tools.editToolOverride('${l(r.name)}')">${e("common.edit")}</button>
                            ${r.has_override?`<button class="${it} ${C}" onclick="window._pages.tools.resetToolOverride('${l(r.name)}')">${e("training.reset")}</button>`:""}
                        </div>
                    </td>
                </tr>
            `).join("")}
            </tbody></table></div>`,W("toolsTable"),z({containerId:"toolsPagination",total:tt.length,offset:ie,onPage:r=>{ie=r,Us()}})}catch(a){s.innerHTML=`<div class="${T}">${e("training.loadFailed",{error:l(a.message)})}</div>`}}function Us(){const t=document.getElementById("toolsContent"),s=tt.slice(ie,ie+qs);t.innerHTML=`
        <div class="overflow-x-auto min-h-[480px]"><table class="${L}" id="toolsTable"><thead><tr><th class="${S}" data-sortable>${e("training.toolName")}</th><th class="${m}">${e("training.description")}</th><th class="${S}" data-sortable>${e("training.override")}</th><th class="${m}">${e("training.actions")}</th></tr></thead><tbody>
        ${s.map(a=>`
            <tr class="${_}">
                <td class="${c}" data-label="${e("training.toolName")}"><span class="${F}">${l(a.name)}</span></td>
                <td class="${c}" data-label="${e("training.description")}"><span class="${w}">${l((a.effective_description||"").substring(0,100))}${(a.effective_description||"").length>100?"...":""}</span></td>
                <td class="${c}" data-label="${e("training.override")}">${a.has_override?`<span class="${H}">${e("training.overridden")}</span>`:`<span class="${A}">${e("training.default")}</span>`}</td>
                <td class="${U}" data-label="${e("training.actions")}">
                    <div class="flex flex-wrap gap-1">
                        <button class="${E} ${C}" onclick="window._pages.tools.editToolOverride('${l(a.name)}')">${e("common.edit")}</button>
                        ${a.has_override?`<button class="${it} ${C}" onclick="window._pages.tools.resetToolOverride('${l(a.name)}')">${e("training.reset")}</button>`:""}
                    </div>
                </td>
            </tr>
        `).join("")}
        </tbody></table></div>`,W("toolsTable"),z({containerId:"toolsPagination",total:tt.length,offset:ie,onPage:a=>{ie=a,Us()}})}async function Bo(t){try{const a=((await p("/training/tools/")).items||[]).find(n=>n.name===t);if(!a){d(e("training.toolNotFound"),"error");return}document.getElementById("toolOverrideModalTitle").textContent=`${e("training.editTool")}: ${t}`,document.getElementById("editToolName").value=t,document.getElementById("toolOriginalDescription").textContent=a.description,document.getElementById("toolOverrideDescription").value=a.override&&a.override.description||a.description,document.getElementById("toolOverrideModal").classList.add("show")}catch(s){d(e("training.loadFailed",{error:s.message}),"error")}}async function Io(){const t=document.getElementById("editToolName").value,s=document.getElementById("toolOverrideDescription").value.trim();if(!s){d(e("training.descriptionRequired"),"error");return}try{await p(`/training/tools/${t}`,{method:"PATCH",body:JSON.stringify({description:s})}),O("toolOverrideModal"),d(e("training.toolOverrideSaved")),Lt()}catch(a){d(e("training.saveFailed",{error:a.message}),"error")}}async function Lo(t){if(confirm(e("training.resetConfirm",{name:t})))try{await p(`/training/tools/${t}`,{method:"DELETE"}),d(e("training.toolOverrideReset")),Lt()}catch(s){d(e("training.resetFailed",{error:s.message}),"error")}}function Ao(){Y("tools",Lt)}window._pages=window._pages||{};window._pages.tools={loadTools:Lt,editToolOverride:Bo,saveToolOverride:Io,resetToolOverride:Lo};async function je(){var a,n;const t=document.getElementById("operatorsLoading"),s=document.querySelector("#operatorsTable tbody");t.style.display="flex";try{const r=await p("/operators");t.style.display="none";let o=r.operators||[];const i=o.length,u=(((a=document.getElementById("operatorSearch"))==null?void 0:a.value)||"").toLowerCase().trim(),b=((n=document.getElementById("operatorFilterStatus"))==null?void 0:n.value)||"";if(u&&(o=o.filter(g=>(g.name||"").toLowerCase().includes(u)||(g.extension||"").toLowerCase().includes(u))),b&&(o=o.filter(g=>g.current_status===b)),o.length===0){s.innerHTML=`<tr><td colspan="7" class="${T}">${e("operators.noOperators")}</td></tr>`;return}s.innerHTML=o.map(g=>`
            <tr class="${_}">
                <td class="${c}" data-label="${e("operators.name")}">${l(g.name)}</td>
                <td class="${c}" data-label="${e("operators.extension")}">${l(g.extension)}</td>
                <td class="${c}" data-label="${e("operators.status")}">${Aa(g.current_status)}</td>
                <td class="${c}" data-label="${e("operators.skills")}">${(g.skills||[]).map($=>`<span class="${F}">${l($)}</span>`).join(" ")}</td>
                <td class="${c}" data-label="${e("operators.shift")}">${g.shift_start||"09:00"} - ${g.shift_end||"18:00"}</td>
                <td class="${c}" data-label="${e("operators.activeCol")}">${g.is_active?`<span class="${B}">${e("common.yes")}</span>`:`<span class="${M}">${e("common.no")}</span>`}</td>
                <td class="${U}">
                    <div class="relative inline-block">
                        <button class="px-1.5 py-0.5 text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 text-sm cursor-pointer" onclick="this.nextElementSibling.classList.toggle('hidden')">&hellip;</button>
                        <div class="hidden absolute right-0 z-20 mt-1 w-44 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-md shadow-lg py-1">
                            <div class="px-3 py-1 text-xs text-neutral-400 uppercase">${e("operators.statusSelect")}</div>
                            <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.operators.changeOperatorStatus('${g.id}', 'online')">${e("operators.statusOnline")}</button>
                            <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.operators.changeOperatorStatus('${g.id}', 'offline')">${e("operators.statusOffline")}</button>
                            <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.operators.changeOperatorStatus('${g.id}', 'busy')">${e("operators.statusBusy")}</button>
                            <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.operators.changeOperatorStatus('${g.id}', 'break')">${e("operators.statusBreak")}</button>
                            <div class="border-t border-neutral-200 dark:border-neutral-700 my-1"></div>
                            <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.operators.editOperator('${g.id}')">${e("operators.editBtn")}</button>
                            ${g.is_active?`<button class="w-full text-left px-3 py-1.5 text-xs text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950/30 cursor-pointer" data-id="${l(g.id)}" data-name="${l(g.name)}" onclick="window._pages.operators.deactivateOperator(this.dataset.id, this.dataset.name)">${e("common.deactivate")}</button>`:""}
                        </div>
                    </div>
                </td>
            </tr>
        `).join(""),o.length<i&&(s.innerHTML+=`<tr><td colspan="7" class="${w} text-center py-2">${e("common.showing",{shown:o.length,total:i})}</td></tr>`),W("operatorsTable")}catch(r){t.style.display="none",s.innerHTML=`<tr><td colspan="7" class="${T}">${e("operators.failedToLoad",{error:l(r.message)})}
            <br><button class="${E} ${C} mt-2" onclick="window._pages.operators.loadOperators()">${e("common.retry")}</button></td></tr>`}}async function Vt(){try{const t=await p("/operators/queue");document.getElementById("operatorQueueStats").innerHTML=`
            <div class="${K} text-center"><div class="${J}">${t.operators_online||0}</div><div class="${G}">${e("operators.online")}</div></div>
            <div class="${K} text-center"><div class="${J}">${t.transfers_last_hour||0}</div><div class="${G}">${e("operators.transfers1h")}</div></div>
        `}catch{document.getElementById("operatorQueueStats").innerHTML=`<div class="${T}">${e("operators.queueUnavailable")}</div>`}}function Po(){document.getElementById("operatorModalTitle").textContent=e("operators.newOperatorTitle"),document.getElementById("editOperatorId").value="",document.getElementById("operatorName").value="",document.getElementById("operatorExtension").value="",document.getElementById("operatorSkills").value="",document.getElementById("operatorShiftStart").value="09:00",document.getElementById("operatorShiftEnd").value="18:00",document.getElementById("operatorModal").classList.add("show")}async function Ro(t){try{const a=((await p("/operators")).operators||[]).find(n=>n.id===t);if(!a){d(e("operators.notFound"),"error");return}document.getElementById("operatorModalTitle").textContent=e("operators.editOperatorTitle"),document.getElementById("editOperatorId").value=t,document.getElementById("operatorName").value=a.name||"",document.getElementById("operatorExtension").value=a.extension||"",document.getElementById("operatorSkills").value=(a.skills||[]).join(", "),document.getElementById("operatorShiftStart").value=a.shift_start||"09:00",document.getElementById("operatorShiftEnd").value=a.shift_end||"18:00",document.getElementById("operatorModal").classList.add("show")}catch(s){d(e("operators.loadFailed",{error:s.message}),"error")}}async function Mo(){const t=document.getElementById("editOperatorId").value,s=document.getElementById("operatorName").value.trim(),a=document.getElementById("operatorExtension").value.trim(),n=document.getElementById("operatorSkills").value.trim(),r=n?n.split(",").map(u=>u.trim()).filter(Boolean):[],o=document.getElementById("operatorShiftStart").value,i=document.getElementById("operatorShiftEnd").value;if(!s||!a){d(e("operators.nameRequired"),"error");return}try{t?(await p(`/operators/${t}`,{method:"PATCH",body:JSON.stringify({name:s,extension:a,skills:r,shift_start:o,shift_end:i})}),d(e("operators.operatorUpdated"))):(await p("/operators",{method:"POST",body:JSON.stringify({name:s,extension:a,skills:r,shift_start:o,shift_end:i})}),d(e("operators.operatorCreated"))),O("operatorModal"),je()}catch(u){d(e("operators.saveFailed",{error:u.message}),"error")}}async function Do(t,s){if(s)try{await p(`/operators/${t}/status`,{method:"PATCH",body:JSON.stringify({status:s})}),d(e("operators.statusChanged",{status:s})),je()}catch(a){d(e("operators.statusFailed",{error:a.message}),"error")}}async function Fo(t,s){if(confirm(e("operators.deactivateConfirm",{name:s})))try{await p(`/operators/${t}`,{method:"DELETE"}),d(e("operators.operatorDeactivated")),je()}catch(a){d(e("operators.deactivateFailed",{error:a.message}),"error")}}function No(){Y("operators",()=>{je(),Vt(),Tt(()=>{je(),Vt()},1e4)}),document.addEventListener("click",t=>{t.target.closest(".relative")||document.querySelectorAll("#page-operators .relative > div:not(.hidden)").forEach(s=>s.classList.add("hidden"))})}window._pages=window._pages||{};window._pages.operators={loadOperators:je,loadQueueStatus:Vt,showCreateOperator:Po,editOperator:Ro,saveOperator:Mo,changeOperatorStatus:Do,deactivateOperator:Fo};async function zs(){const t=document.getElementById("systemInfo");t.innerHTML=`<div class="${D}"><div class="spinner"></div></div>`;try{const[s,a]=await Promise.all([fetch("/health").then(r=>r.json()),fetch("/health/ready").then(r=>r.json()).catch(()=>null)]);let n=`<div class="overflow-x-auto"><table class="${L}">
            <tr class="${_}"><td class="${c}">${e("settings.status")}</td><td class="${c}"><span class="${B}">${s.status}</span></td></tr>
            <tr class="${_}"><td class="${c}">${e("settings.activeCalls")}</td><td class="${c}">${s.active_calls}</td></tr>
            <tr class="${_}"><td class="${c}">${e("settings.redis")}</td><td class="${c}"><span class="${s.redis==="connected"?B:M}">${s.redis}</span></td></tr>
        `;a&&(a.store_api&&(n+=`<tr class="${_}"><td class="${c}">${e("settings.storeAPI")}</td><td class="${c}"><span class="${a.store_api==="reachable"?B:M}">${a.store_api}</span></td></tr>`),a.claude_api&&(n+=`<tr class="${_}"><td class="${c}">${e("settings.claudeAPI")}</td><td class="${c}"><span class="${a.claude_api==="reachable"?B:M}">${a.claude_api}</span></td></tr>`),a.google_stt&&(n+=`<tr class="${_}"><td class="${c}">${e("settings.googleSTT")}</td><td class="${c}"><span class="${a.google_stt==="credentials_present"?B:H}">${a.google_stt}</span></td></tr>`),a.tts_engine&&(n+=`<tr class="${_}"><td class="${c}">${e("settings.ttsEngine")}</td><td class="${c}"><span class="${a.tts_engine==="initialized"?B:H}">${a.tts_engine}</span></td></tr>`)),n+="</table></div>",t.innerHTML=n}catch(s){t.innerHTML=`<div class="${T}">${e("settings.failedToLoad",{error:l(s.message)})}
            <br><button class="${E} ${C} mt-2" onclick="window._pages.monitoring.loadSettings()">${e("common.retry")}</button></div>`}}async function Ho(){const t=document.getElementById("extendedStatus");t.innerHTML=`<div class="${D}"><div class="spinner"></div></div>`;try{const s=await p("/admin/system-status"),a=Math.floor(s.uptime_seconds/3600),n=Math.floor(s.uptime_seconds%3600/60);let r=`<div class="overflow-x-auto"><table class="${L}">`;if(r+=`<tr class="${_}"><td class="${c}">${e("settings.extVersion")}</td><td class="${c}">${l(s.version||"unknown")}</td></tr>`,r+=`<tr class="${_}"><td class="${c}">${e("settings.uptime")}</td><td class="${c}">${e("settings.uptimeValue",{hours:a,minutes:n})}</td></tr>`,s.postgres_db_size_bytes){const o=(s.postgres_db_size_bytes/1048576).toFixed(1);r+=`<tr class="${_}"><td class="${c}">${e("settings.pgDbSize")}</td><td class="${c}">${o} MB</td></tr>`}if(s.postgres_connections!==void 0&&(r+=`<tr class="${_}"><td class="${c}">${e("settings.pgConnections")}</td><td class="${c}">${s.postgres_connections}</td></tr>`),s.redis_used_memory&&(r+=`<tr class="${_}"><td class="${c}">${e("settings.redisMemory")}</td><td class="${c}">${l(s.redis_used_memory)}</td></tr>`),r+=`<tr class="${_}"><td class="${c}">${e("settings.celeryWorkers")}</td><td class="${c}"><span class="${s.celery_workers_online>0?B:M}">${s.celery_workers_online}</span></td></tr>`,s.last_backup){const o=(s.last_backup.size_bytes/1048576).toFixed(1);r+=`<tr class="${_}"><td class="${c}">${e("settings.lastBackup")}</td><td class="${c}">${l(s.last_backup.file)} (${o} MB, ${l(s.last_backup.modified)})</td></tr>`}r+="</table></div>",t.innerHTML=r}catch(s){t.innerHTML=`<div class="${T}">${e("settings.extFailed",{error:l(s.message)})}</div>`}}function Oo(){const t=window.location.hostname,s=window.location.protocol;document.querySelectorAll("#externalToolsTable a[data-tool-port]").forEach(a=>{a.href=`${s}//${t}:${a.dataset.toolPort}`})}function qo(){Oo(),Y("monitoring",()=>zs())}window._pages=window._pages||{};window._pages.monitoring={loadSettings:zs,loadSystemStatus:Ho};let V=null;async function Uo(){if(confirm(e("settings.reloadConfirm")))try{const t=await p("/admin/config/reload",{method:"POST"});let s=e("settings.configReloaded");if(t.changes)for(const[a,n]of Object.entries(t.changes))s+=`${a}: ${n}
`;d(s,"success")}catch(t){d(e("settings.reloadFailed",{error:t.message}),"error")}}async function Ge(){const t=document.getElementById("llmProvidersContainer"),s=document.getElementById("llmTasksContainer");t.innerHTML=`<div class="${D}"><div class="spinner"></div></div>`,s.innerHTML="";try{const[a,n]=await Promise.all([p("/admin/llm/config"),p("/admin/llm/providers")]);V=a.config;const r={};for(const o of n.providers)r[o.key]=o;zo(V,r),Ks(V)}catch(a){t.innerHTML=`<div class="${T}">${e("settings.llmLoadFailed",{error:l(a.message)})}</div>`}}function zo(t,s){const a=document.getElementById("llmProvidersContainer"),n=t.providers||{};let r=`<div class="overflow-x-auto"><table class="${L}">
        <thead><tr>
            <th class="${m}">${e("settings.llmProvider")}</th>
            <th class="${m}">${e("settings.llmType")}</th>
            <th class="${m}">${e("settings.llmModel")}</th>
            <th class="${m}">${e("settings.llmApiKey")}</th>
            <th class="${m}">${e("settings.llmEnabled")}</th>
            <th class="${m}">${e("settings.llmHealth")}</th>
            <th class="${m}">${e("settings.llmActions")}</th>
        </tr></thead><tbody>`;for(const[o,i]of Object.entries(n)){const u=s[o]||{},b=i.enabled?"checked":"",g=u.healthy===!0?`<span class="${B}">OK</span>`:u.healthy===!1?`<span class="${M}">DOWN</span>`:`<span class="${A}">—</span>`,$=i.api_key_set?`<span class="${B}">set</span>`:`<span class="${H}">missing</span>`;r+=`<tr class="${_}">
            <td class="${c}" data-label="${e("settings.llmProvider")}"><strong>${l(o)}</strong></td>
            <td class="${c}" data-label="${e("settings.llmType")}">${l(i.type||"")}</td>
            <td class="${c}" data-label="${e("settings.llmModel")}"><input type="text" value="${l(i.model||"")}" class="text-xs font-mono bg-transparent border border-neutral-300 dark:border-neutral-700 rounded px-1.5 py-0.5 w-48 focus:outline-none focus:border-blue-500" onchange="window._pages.configuration.updateLLMModel('${l(o)}', this.value)"></td>
            <td class="${c}" data-label="${e("settings.llmApiKey")}">${$}</td>
            <td class="${c}" data-label="${e("settings.llmEnabled")}"><input type="checkbox" ${b} onchange="window._pages.configuration.toggleLLMProvider('${l(o)}', this.checked)"></td>
            <td class="${c}" data-label="${e("settings.llmHealth")}">${g}</td>
            <td class="${U}" data-label="${e("settings.llmActions")}"><button class="${E} ${C}" onclick="window._pages.configuration.testLLMProvider('${l(o)}')">${e("settings.llmTest")}</button></td>
        </tr>`}r+=`<tr id="llm-add-row" style="display:none" class="${_}">
            <td class="${c}" data-label="${e("settings.llmProvider")}"><span id="llm-add-key-preview" class="text-xs font-mono text-neutral-400">—</span></td>
            <td class="${c}" data-label="${e("settings.llmType")}"><select id="llm-add-type" class="${es}" onchange="window._pages.configuration.onAddTypeChange(this.value)">
                <option value="anthropic">anthropic</option>
                <option value="openai">openai</option>
                <option value="deepseek">deepseek</option>
                <option value="gemini">gemini</option>
            </select></td>
            <td class="${c}" data-label="${e("settings.llmModel")}"><input id="llm-add-model" type="text" placeholder="claude-opus-4-20250115" class="text-xs font-mono bg-transparent border border-neutral-300 dark:border-neutral-700 rounded px-1.5 py-0.5 w-48 focus:outline-none focus:border-blue-500" oninput="window._pages.configuration.onAddModelInput()"></td>
            <td class="${c}" data-label="${e("settings.llmApiKey")}"><span id="llm-add-env-preview" class="text-xs font-mono text-neutral-500">ANTHROPIC_API_KEY</span></td>
            <td colspan="3" class="${U}" data-label="${e("settings.llmActions")}">
                <button class="${E} ${C}" onclick="window._pages.configuration.saveNewProvider()">${e("common.save")}</button>
                <button class="${C} ml-1 text-neutral-500" onclick="document.getElementById('llm-add-row').style.display='none'">${e("common.cancel")}</button>
            </td>
        </tr>`,r+="</tbody></table></div>",r+=`<button class="${E} ${C} mt-2" onclick="document.getElementById('llm-add-row').style.display=''">${e("settings.llmAddProvider")}</button>`,a.innerHTML=r}function Ko(t){const s=`settings.llmTaskDesc_${t}`,a=`settings.llmTaskRec_${t}`,n=e(s),r=e(a);return n===s?"":`<span class="relative group ml-1 cursor-help">
        <span class="inline-flex items-center justify-center w-4 h-4 rounded-full border border-neutral-400 dark:border-neutral-500 text-neutral-400 dark:text-neutral-500 text-[10px] font-bold leading-none">?</span>
        <span class="pointer-events-none absolute z-50 left-5 -top-1 w-64 p-2 rounded shadow-lg border text-xs bg-white dark:bg-neutral-800 text-neutral-700 dark:text-neutral-200 border-neutral-200 dark:border-neutral-700 opacity-0 group-hover:opacity-100 transition-opacity">
            <span class="block font-semibold mb-1">${l(n)}</span>
            ${r!==a?`<span class="block text-neutral-500 dark:text-neutral-400">${l(r)}</span>`:""}
        </span>
    </span>`}function Ks(t){const s=document.getElementById("llmTasksContainer"),a=t.tasks||{},n=Object.keys(t.providers||{});let r=`<h4 class="${xt}">${e("settings.llmTaskRouting")}</h4>`;r+=`<div class="overflow-x-auto"><table class="${L}">
        <thead><tr>
            <th class="${m}">${e("settings.llmTask")}</th>
            <th class="${m}">${e("settings.llmPrimary")}</th>
            <th class="${m}">${e("settings.llmFallbacks")}</th>
        </tr></thead><tbody>`;for(const[o,i]of Object.entries(a)){const u=i.primary||"",b=i.fallbacks||[],g=n.map(h=>`<option value="${l(h)}" ${h===u?"selected":""}>${l(h)}</option>`).join("");let $='<div class="space-y-1">';b.length>0&&($+='<ol class="list-none p-0 m-0 space-y-1">',b.forEach((h,f)=>{const y=f===0,x=f===b.length-1;$+=`<li class="flex items-center gap-1 text-xs">
                    <span class="inline-flex items-center justify-center w-4 h-4 rounded-full bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 text-[10px] font-bold flex-shrink-0">${f+1}</span>
                    <span class="font-mono text-neutral-700 dark:text-neutral-300">${l(h)}</span>
                    <span class="inline-flex gap-0.5 ml-auto flex-shrink-0">
                        <button class="px-0.5 text-neutral-400 hover:text-blue-600 disabled:opacity-30 disabled:cursor-default" ${y?"disabled":""} onclick="window._pages.configuration.moveFallback('${l(o)}', ${f}, -1)" title="${e("settings.llmFbMoveUp")}">&#9650;</button>
                        <button class="px-0.5 text-neutral-400 hover:text-blue-600 disabled:opacity-30 disabled:cursor-default" ${x?"disabled":""} onclick="window._pages.configuration.moveFallback('${l(o)}', ${f}, 1)" title="${e("settings.llmFbMoveDown")}">&#9660;</button>
                        <button class="px-0.5 text-neutral-400 hover:text-red-600" onclick="window._pages.configuration.removeFallback('${l(o)}', '${l(h)}')" title="${e("common.delete")}">&#10005;</button>
                    </span>
                </li>`}),$+="</ol>");const v=n.filter(h=>h!==u&&!b.includes(h));if(v.length>0){const h=v.map(f=>`<option value="${l(f)}">${l(f)}</option>`).join("");$+=`<div class="flex items-center gap-1 mt-1">
                <select id="fb-add-${l(o)}" class="text-xs bg-white dark:bg-neutral-800 text-neutral-800 dark:text-neutral-200 border border-neutral-300 dark:border-neutral-600 rounded px-1 py-0.5">
                    <option value="" disabled selected>${e("settings.llmFbSelect")}</option>
                    ${h}
                </select>
                <button class="text-xs text-blue-600 hover:text-blue-800 dark:text-blue-400" onclick="window._pages.configuration.addFallback('${l(o)}')">+ ${e("common.add")}</button>
            </div>`}$+="</div>",r+=`<tr class="${_}">
            <td class="${c}" data-label="${e("settings.llmTask")}"><strong>${l(o)}</strong>${Ko(o)}</td>
            <td class="${c}" data-label="${e("settings.llmPrimary")}"><select class="${es}" onchange="window._pages.configuration.updateTaskRoute('${l(o)}', this.value)">${g}</select></td>
            <td class="${c}" data-label="${e("settings.llmFallbacks")}">${$}</td>
        </tr>`}r+="</tbody></table></div>",s.innerHTML=r}const Jt={anthropic:{api_key_env:"ANTHROPIC_API_KEY"},openai:{api_key_env:"OPENAI_API_KEY",base_url:"https://api.openai.com/v1"},deepseek:{api_key_env:"DEEPSEEK_API_KEY",base_url:"https://api.deepseek.com/v1"},gemini:{api_key_env:"GEMINI_API_KEY",base_url:"https://generativelanguage.googleapis.com/v1beta/openai"}};function js(){const t=document.getElementById("llm-add-type").value,s=document.getElementById("llm-add-model").value.trim();if(!s)return"";const a=s.replace(/^claude-/,"").replace(/^gpt-/,"gpt").split("-")[0]||s;return`${t}-${a}`}function Vs(){const t=js(),s=document.getElementById("llm-add-type").value,a=Jt[s]||{};document.getElementById("llm-add-key-preview").textContent=t||"—",document.getElementById("llm-add-env-preview").textContent=a.api_key_env||""}function jo(){Vs()}function Vo(){Vs()}async function Jo(){var i;const t=document.getElementById("llm-add-type").value,s=document.getElementById("llm-add-model").value.trim(),a=js(),n=((i=Jt[t])==null?void 0:i.api_key_env)||"";if(!s){d(e("settings.llmAddFillRequired"),"error");return}const r={type:t,model:s,api_key_env:n,enabled:!1},o=Jt[t];o!=null&&o.base_url&&(r.base_url=o.base_url);try{await p("/admin/llm/config",{method:"PATCH",body:JSON.stringify({providers:{[a]:r}})}),d(e("settings.llmProviderAdded",{key:a}),"success"),Ge()}catch(u){d(e("settings.llmConfigFailed",{error:u.message}),"error")}}async function Go(t,s){if(s.trim())try{await p("/admin/llm/config",{method:"PATCH",body:JSON.stringify({providers:{[t]:{model:s.trim()}}})}),d(e("settings.llmModelUpdated",{key:t,model:s.trim()}),"success")}catch(a){d(e("settings.llmConfigFailed",{error:a.message}),"error"),Ge()}}async function Wo(t,s){try{await p("/admin/llm/config",{method:"PATCH",body:JSON.stringify({providers:{[t]:{enabled:s}}})}),d(e("settings.llmProviderToggled",{key:t,state:s?"ON":"OFF"}),"success")}catch(a){d(e("settings.llmConfigFailed",{error:a.message}),"error"),Ge()}}async function Qo(t,s){try{await p("/admin/llm/config",{method:"PATCH",body:JSON.stringify({tasks:{[t]:{primary:s,fallbacks:[]}}})}),d(e("settings.llmRouteUpdated",{task:t,provider:s}),"success"),Ge()}catch(a){d(e("settings.llmConfigFailed",{error:a.message}),"error")}}async function ss(t,s){try{await p("/admin/llm/config",{method:"PATCH",body:JSON.stringify({tasks:{[t]:{fallbacks:s}}})}),V&&V.tasks&&V.tasks[t]&&(V.tasks[t].fallbacks=s),Ks(V),d(e("settings.llmFallbacksUpdated",{task:t,count:s.length}),"success")}catch(a){d(e("settings.llmConfigFailed",{error:a.message}),"error")}}async function Yo(t){var r,o;const s=document.getElementById(`fb-add-${t}`);if(!s)return;const a=s.value;if(!a)return;const n=(((o=(r=V==null?void 0:V.tasks)==null?void 0:r[t])==null?void 0:o.fallbacks)||[]).slice();n.includes(a)||(n.push(a),await ss(t,n))}async function Xo(t,s){var n,r;const a=(((r=(n=V==null?void 0:V.tasks)==null?void 0:n[t])==null?void 0:r.fallbacks)||[]).filter(o=>o!==s);await ss(t,a)}async function Zo(t,s,a){var o,i;const n=(((i=(o=V==null?void 0:V.tasks)==null?void 0:o[t])==null?void 0:i.fallbacks)||[]).slice(),r=s+a;r<0||r>=n.length||([n[s],n[r]]=[n[r],n[s]],await ss(t,n))}async function er(t){d(e("settings.llmTesting",{key:t}),"info");try{const s=await p(`/admin/llm/providers/${encodeURIComponent(t)}/test`,{method:"POST"});s.success?d(e("settings.llmTestSuccess",{key:t,latency:s.latency_ms}),"success"):d(e("settings.llmTestFailed",{key:t,error:s.error||"Unknown"}),"error")}catch(s){d(e("settings.llmTestFailed",{key:t,error:s.message}),"error")}}function tr(){Y("configuration",Ge)}window._pages=window._pages||{};window._pages.configuration={reloadConfig:Uo,loadLLMConfig:Ge,toggleLLMProvider:Wo,updateLLMModel:Go,onAddTypeChange:jo,onAddModelInput:Vo,saveNewProvider:Jo,updateTaskRoute:Qo,addFallback:Yo,removeFallback:Xo,moveFallback:Zo,testLLMProvider:er};let Ne=0,st=[];const Js=["get_vehicle_tire_sizes","search_tires","check_availability","transfer_to_operator","get_order_status","create_order_draft","update_order_delivery","confirm_order","get_fitting_stations","get_fitting_slots","book_fitting","search_knowledge_base"];async function Gs(){if(!(st.length>0))try{st=((await p("/admin/training/tools")).tools||[]).map(s=>s.name)}catch{st=Js}}async function We(t){t!==void 0&&(Ne=t);const s=document.getElementById("tenantsContainer");if(!s)return;s.innerHTML=`<div class="${D}"><div class="spinner"></div></div>`;const a=ae({offset:Ne,filters:{is_active:"tenantsActiveFilter"}});try{const n=await p(`/admin/tenants?${a}`),r=n.tenants||[];if(r.length===0){s.innerHTML=`<div class="${T}">${e("tenants.noTenants")}</div>`,z({containerId:"tenantsPagination",total:0,offset:0});return}s.innerHTML=`
            <div class="overflow-x-auto min-h-[480px]"><table class="${L}" id="tenantsTable"><thead><tr>
                <th class="${S}" data-sortable>${e("tenants.slug")}</th>
                <th class="${S}" data-sortable>${e("tenants.name")}</th>
                <th class="${S}" data-sortable>${e("tenants.networkId")}</th>
                <th class="${m}">${e("tenants.agentName")}</th>
                <th class="${m}">${e("tenants.enabledTools")}</th>
                <th class="${S}" data-sortable>${e("tenants.statusCol")}</th>
                <th class="${m}">${e("tenants.actions")}</th>
            </tr></thead><tbody>
            ${r.map(o=>{const i=(o.enabled_tools||[]).length,u=i>0?`<span class="${A}">${i} tools</span>`:`<span class="${w} text-xs">${e("common.all")}</span>`,b=o.is_active?`<span class="${B}">${e("tenants.active")}</span>`:`<span class="${M}">${e("tenants.inactive")}</span>`;return`
                <tr class="${_}">
                    <td class="${c}"><span class="font-mono text-xs">${l(o.slug)}</span></td>
                    <td class="${c}">${l(o.name)}</td>
                    <td class="${c}"><span class="font-mono text-xs">${l(o.network_id)}</span></td>
                    <td class="${c}">${l(o.agent_name||"Олена")}</td>
                    <td class="${c}">${u}</td>
                    <td class="${c}" data-sort-value="${o.is_active?1:0}">${b}</td>
                    <td class="${c}">
                        <div class="relative inline-block">
                            <button class="px-1.5 py-0.5 text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 text-sm cursor-pointer" onclick="this.nextElementSibling.classList.toggle('hidden')">&hellip;</button>
                            <div class="hidden absolute right-0 z-20 mt-1 w-40 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-md shadow-lg py-1">
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.tenants.editTenant('${o.id}')">${e("common.edit")}</button>
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.tenants.toggleTenant('${o.id}', ${o.is_active})">${o.is_active?e("common.deactivate"):e("common.activate")}</button>
                                <button class="w-full text-left px-3 py-1.5 text-xs text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950/30 cursor-pointer" data-id="${l(o.id)}" data-name="${l(o.name)}" onclick="window._pages.tenants.deleteTenant(this.dataset.id, this.dataset.name)">${e("common.delete")}</button>
                            </div>
                        </div>
                    </td>
                </tr>`}).join("")}
            </tbody></table></div>
            <p class="${w} mt-2">${e("common.showing",{shown:r.length,total:n.total})}</p>`,W("tenantsTable"),z({containerId:"tenantsPagination",total:n.total,offset:Ne,onPage:o=>We(o)})}catch(n){s.innerHTML=`<div class="${T}">${e("tenants.loadFailed",{error:l(n.message)})}
            <br><button class="${E} ${C} mt-2" onclick="window._pages.tenants.loadTenants()">${e("common.retry")}</button></div>`}}function Ws(t){const s=st.length>0?st:Js,a=new Set(t||[]);return s.map(n=>`
        <label class="flex items-center gap-1.5 text-xs cursor-pointer">
            <input type="checkbox" value="${l(n)}" ${a.has(n)?"checked":""} class="tenant-tool-cb">
            <span class="font-mono">${l(n)}</span>
        </label>
    `).join("")}async function sr(){await Gs(),document.getElementById("tenantModalTitle").textContent=e("tenants.newTenant"),document.getElementById("editTenantId").value="",document.getElementById("tenantSlug").value="",document.getElementById("tenantSlug").removeAttribute("readonly"),document.getElementById("tenantName").value="",document.getElementById("tenantNetworkId").value="",document.getElementById("tenantAgentName").value="Олена",document.getElementById("tenantGreeting").value="",document.getElementById("tenantPromptSuffix").value="",document.getElementById("tenantConfig").value="{}",document.getElementById("tenantIsActive").checked=!0,document.getElementById("tenantToolsContainer").innerHTML=Ws([]),document.getElementById("tenantModal").classList.add("show")}async function ar(t){await Gs();try{const a=(await p(`/admin/tenants/${t}`)).tenant;document.getElementById("tenantModalTitle").textContent=e("tenants.editTenant"),document.getElementById("editTenantId").value=t,document.getElementById("tenantSlug").value=a.slug||"",document.getElementById("tenantSlug").setAttribute("readonly","readonly"),document.getElementById("tenantName").value=a.name||"",document.getElementById("tenantNetworkId").value=a.network_id||"",document.getElementById("tenantAgentName").value=a.agent_name||"Олена",document.getElementById("tenantGreeting").value=a.greeting||"",document.getElementById("tenantPromptSuffix").value=a.prompt_suffix||"",document.getElementById("tenantConfig").value=JSON.stringify(a.config||{},null,2),document.getElementById("tenantIsActive").checked=a.is_active!==!1,document.getElementById("tenantToolsContainer").innerHTML=Ws(a.enabled_tools||[]),document.getElementById("tenantModal").classList.add("show")}catch(s){d(e("tenants.loadFailed",{error:s.message}),"error")}}async function nr(){const t=document.getElementById("editTenantId").value,s=document.getElementById("tenantSlug").value.trim(),a=document.getElementById("tenantName").value.trim(),n=document.getElementById("tenantNetworkId").value.trim(),r=document.getElementById("tenantAgentName").value.trim()||"Олена",o=document.getElementById("tenantGreeting").value.trim()||null,i=document.getElementById("tenantPromptSuffix").value.trim()||null,u=document.getElementById("tenantIsActive").checked;let b;try{b=JSON.parse(document.getElementById("tenantConfig").value)}catch{d(e("tenants.invalidConfigJson"),"error");return}const g=Array.from(document.querySelectorAll(".tenant-tool-cb:checked")).map(v=>v.value);if(!a||!n){d(e("tenants.nameRequired"),"error");return}if(!t&&!s){d(e("tenants.slugRequired"),"error");return}const $={name:a,network_id:n,agent_name:r,greeting:o,enabled_tools:g,prompt_suffix:i,config:b,is_active:u};t||($.slug=s);try{t?(await p(`/admin/tenants/${t}`,{method:"PATCH",body:JSON.stringify($)}),d(e("tenants.updated"))):(await p("/admin/tenants",{method:"POST",body:JSON.stringify($)}),d(e("tenants.created"))),O("tenantModal"),We(Ne)}catch(v){d(e("tenants.saveFailed",{error:v.message}),"error")}}async function or(t,s){try{await p(`/admin/tenants/${t}`,{method:"PATCH",body:JSON.stringify({is_active:!s})}),d(e(s?"tenants.deactivated":"tenants.activated")),We(Ne)}catch(a){d(e("tenants.saveFailed",{error:a.message}),"error")}}async function rr(t,s){if(confirm(e("tenants.deleteConfirm",{name:s})))try{await p(`/admin/tenants/${t}`,{method:"DELETE"}),d(e("tenants.deleted")),We(Ne)}catch(a){d(e("tenants.saveFailed",{error:a.message}),"error")}}function lr(){Y("tenants",()=>We()),document.addEventListener("click",t=>{t.target.closest(".relative")||document.querySelectorAll("#page-tenants .relative > div:not(.hidden)").forEach(s=>s.classList.add("hidden"))})}window._pages=window._pages||{};window._pages.tenants={loadTenants:We,showCreateTenant:sr,editTenant:ar,saveTenant:nr,toggleTenant:or,deleteTenant:rr};async function as(){const t=document.getElementById("telegramConfigContainer");t.innerHTML=`<div class="${D}"><div class="spinner"></div></div>`;try{const s=await p("/admin/notifications/telegram");let a;s.token_set?(a=`<span class="${B}">${e("settings.telegramTokenSet")}</span>`,s.token_hint&&(a+=` <span class="text-xs text-neutral-400 font-mono">...${l(s.token_hint)}</span>`)):a=`<span class="${H}">${e("settings.telegramTokenMissing")}</span>`;const n=s.source==="redis"?"Redis":s.source==="env"?"ENV":"—";let r=`<div class="space-y-3">
            <div class="flex items-center gap-2 text-sm">
                <span class="text-neutral-500 dark:text-neutral-400">${e("settings.telegramStatus")}:</span>
                ${a}
                <span class="${A}">${n}</span>
            </div>
            <div>
                <label class="block text-xs font-medium text-neutral-600 dark:text-neutral-400 mb-1">${e("settings.telegramBotToken")}</label>
                <input id="tgBotToken" type="password" placeholder="${e("settings.telegramBotTokenPlaceholder")}" class="w-full text-sm font-mono bg-white dark:bg-neutral-800 text-neutral-800 dark:text-neutral-200 border border-neutral-300 dark:border-neutral-600 rounded px-2 py-1.5 focus:outline-none focus:border-blue-500">
            </div>
            <div>
                <label class="block text-xs font-medium text-neutral-600 dark:text-neutral-400 mb-1">${e("settings.telegramChatId")}</label>
                <input id="tgChatId" type="text" value="${l(s.chat_id||"")}" placeholder="${e("settings.telegramChatIdPlaceholder")}" class="w-full text-sm font-mono bg-white dark:bg-neutral-800 text-neutral-800 dark:text-neutral-200 border border-neutral-300 dark:border-neutral-600 rounded px-2 py-1.5 focus:outline-none focus:border-blue-500">
            </div>
            <div class="flex gap-2">
                <button class="${E} ${C}" onclick="window._pages.notifications.saveTelegramConfig()">${e("common.save")}</button>
                <button class="${C} border border-neutral-300 dark:border-neutral-600 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-800" onclick="window._pages.notifications.testTelegram()">${e("settings.telegramTestBtn")}</button>
            </div>
        </div>`;t.innerHTML=r}catch(s){t.innerHTML=`<div class="${T}">${e("settings.telegramLoadFailed",{error:l(s.message)})}</div>`}}async function ir(){var n,r,o,i;const t=((r=(n=document.getElementById("tgBotToken"))==null?void 0:n.value)==null?void 0:r.trim())||"",s=((i=(o=document.getElementById("tgChatId"))==null?void 0:o.value)==null?void 0:i.trim())||"";if(!t&&!s){d(e("settings.telegramFillFields"),"error");return}const a={};t&&(a.bot_token=t),s&&(a.chat_id=s);try{await p("/admin/notifications/telegram",{method:"PATCH",body:JSON.stringify(a)}),d(e("settings.telegramSaved"),"success"),as()}catch(u){d(e("settings.telegramSaveFailed",{error:u.message}),"error")}}async function dr(){d(e("settings.telegramTesting"),"info");try{const t=await p("/admin/notifications/telegram/test",{method:"POST"});t.success?d(e("settings.telegramTestSuccess",{latency:t.latency_ms}),"success"):d(e("settings.telegramTestFailed",{error:t.error||"Unknown"}),"error")}catch(t){d(e("settings.telegramTestFailed",{error:t.message}),"error")}}function cr(){Y("notifications",as)}window._pages=window._pages||{};window._pages.notifications={loadTelegramConfig:as,saveTelegramConfig:ir,testTelegram:dr};let Nt=0;const ur={sandbox:["sandbox:read","sandbox:write","sandbox:delete"],knowledge:["knowledge:read","knowledge:write","knowledge:delete"],scraper:["scraper:read","scraper:write","scraper:delete","scraper:execute"],training:["training:read","training:write","training:delete","training:execute"],prompts:["prompts:read","prompts:write","prompts:delete"],users:["users:read","users:write"],audit:["audit:read"],tenants:["tenants:read","tenants:write","tenants:delete"],operators:["operators:read","operators:write"],analytics:["analytics:read","analytics:export"],llm_config:["llm_config:read","llm_config:write"],notifications:["notifications:read","notifications:write"],system:["system:read","system:write"],vehicles:["vehicles:read","vehicles:write"],pronunciation:["pronunciation:read","pronunciation:write"]},pr={admin:["*"],analyst:["analytics:read","analytics:export","knowledge:read","training:read","prompts:read","vehicles:read","operators:read"],operator:["operators:read"],content_manager:["sandbox:read","sandbox:write","sandbox:delete","knowledge:read","knowledge:write","knowledge:delete","scraper:read","scraper:write","scraper:delete","scraper:execute","training:read","training:write","training:delete","training:execute","prompts:read","prompts:write","prompts:delete"]};function Qs(t){const s=`users.role${t.charAt(0).toUpperCase()}${t.slice(1).replace(/_(\w)/g,(a,n)=>n.toUpperCase())}`;return e(s)||t}async function Be(t){t!==void 0&&(Nt=t);const s=document.getElementById("usersContainer");s.innerHTML=`<div class="${D}"><div class="spinner"></div></div>`;const a=ae({offset:Nt});try{const n=await p(`/admin/users?${a}`),r=n.users||[];if(r.length===0){s.innerHTML=`<div class="${T}">${e("users.noUsers")}</div>`,z({containerId:"usersPagination",total:0,offset:0});return}s.innerHTML=`
            <div class="overflow-x-auto min-h-[480px]"><table class="${L}" id="usersTable"><thead><tr><th class="${S}" data-sortable>${e("users.username")}</th><th class="${S}" data-sortable>${e("users.role")}</th><th class="${S}" data-sortable>${e("users.permissions")}</th><th class="${S}" data-sortable>${e("users.activeCol")}</th><th class="${S}" data-sortable>${e("users.lastLogin")}</th><th class="${m}">${e("users.actionsCol")}</th></tr></thead><tbody>
            ${r.map(o=>{const i=o.permissions!==null&&o.permissions!==void 0?`<span class="${H}">${e("users.customPermissions")}</span>`:`<span class="${Ae}">${e("users.useRoleDefaults")}</span>`;return`
                <tr class="${_}">
                    <td class="${c}" data-label="${e("users.username")}">${l(o.username)}</td>
                    <td class="${c}" data-label="${e("users.role")}"><span class="${F}">${l(Qs(o.role))}</span></td>
                    <td class="${c}" data-label="${e("users.permissions")}">${i}</td>
                    <td class="${c}" data-label="${e("users.activeCol")}">${o.is_active?`<span class="${B}">${e("common.yes")}</span>`:`<span class="${M}">${e("common.no")}</span>`}</td>
                    <td class="${c}" data-label="${e("users.lastLogin")}" data-sort-value="${o.last_login_at||""}">${j(o.last_login_at)}</td>
                    <td class="${U}">
                        <div class="relative inline-block">
                            <button class="px-1.5 py-0.5 text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 text-sm cursor-pointer" onclick="this.nextElementSibling.classList.toggle('hidden')">&hellip;</button>
                            <div class="hidden absolute right-0 z-20 mt-1 w-44 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-md shadow-lg py-1">
                                <div class="px-3 py-1 text-xs text-neutral-400 uppercase">${e("users.changeRole")}</div>
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.users.changeRole('${o.id}', 'admin')">${e("users.roleAdmin")}</button>
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.users.changeRole('${o.id}', 'analyst')">${e("users.roleAnalyst")}</button>
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.users.changeRole('${o.id}', 'operator')">${e("users.roleOperator")}</button>
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.users.changeRole('${o.id}', 'content_manager')">${e("users.roleContentManager")}</button>
                                <div class="border-t border-neutral-200 dark:border-neutral-700 my-1"></div>
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" data-id="${l(o.id)}" data-role="${l(o.role)}" data-perms="${l(JSON.stringify(o.permissions))}" onclick="window._pages.users.showPermissionsEditor(this.dataset.id, this.dataset.role, this.dataset.perms)">${e("users.editPermissions")}</button>
                                <div class="border-t border-neutral-200 dark:border-neutral-700 my-1"></div>
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="window._pages.users.toggleUser('${o.id}', ${o.is_active})">${o.is_active?e("common.deactivate"):e("common.activate")}</button>
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" data-id="${l(o.id)}" data-name="${l(o.username)}" onclick="window._pages.users.resetUserPassword(this.dataset.id, this.dataset.name)">${e("users.resetPwd")}</button>
                            </div>
                        </div>
                    </td>
                </tr>
            `}).join("")}
            </tbody></table></div>
        `,W("usersTable"),z({containerId:"usersPagination",total:n.total,offset:Nt,onPage:o=>Be(o)})}catch(n){s.innerHTML=`<div class="${T}">${e("users.failedToLoad",{error:l(n.message)})}</div>`}}function gr(){document.getElementById("newUsername").value="",document.getElementById("newPassword").value="",document.getElementById("newRole").value="operator",document.getElementById("createUserModal").classList.add("show")}async function mr(){const t=document.getElementById("newUsername").value.trim(),s=document.getElementById("newPassword").value,a=document.getElementById("newRole").value;if(!t||!s){d(e("users.usernameRequired"),"error");return}try{await p("/admin/users",{method:"POST",body:JSON.stringify({username:t,password:s,role:a})}),O("createUserModal"),d(e("users.userCreated")),Be()}catch(n){d(e("users.createFailed",{error:n.message}),"error")}}async function br(t,s){if(s)try{await p(`/admin/users/${t}`,{method:"PATCH",body:JSON.stringify({role:s})}),d(e("users.roleUpdated")),Be()}catch(a){d(e("users.roleFailed",{error:a.message}),"error")}}async function hr(t,s){try{await p(`/admin/users/${t}`,{method:"PATCH",body:JSON.stringify({is_active:!s})}),d(e(s?"users.userDeactivated":"users.userActivated")),Be()}catch(a){d(e("users.toggleFailed",{error:a.message}),"error")}}async function vr(t,s){const a=prompt(e("users.newPasswordPrompt",{username:s}));if(a)try{await p(`/admin/users/${t}/reset-password`,{method:"POST",body:JSON.stringify({new_password:a})}),d(e("users.passwordReset"))}catch(n){d(e("users.resetFailed",{error:n.message}),"error")}}function fr(t,s,a){let n=null;try{n=JSON.parse(a)}catch{n=null}(n==="null"||a==="null")&&(n=null);const r=n!==null,o=pr[s]||[],i=r?n:o,u=i.includes("*");let b=`
        <div class="fixed inset-0 bg-black/40 z-50 flex items-center justify-center" id="permissionsOverlay" onclick="if(event.target===this) window._pages.users.closePermissions()">
            <div class="bg-white dark:bg-neutral-900 rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] overflow-y-auto p-6">
                <h3 class="text-lg font-semibold mb-4">${e("users.editPermissions")}</h3>
                <label class="flex items-center gap-2 mb-4 cursor-pointer">
                    <input type="checkbox" id="permUseDefaults" ${r?"":"checked"} onchange="window._pages.users.togglePermDefaults()">
                    <span class="text-sm">${e("users.useRoleDefaults")} (${l(Qs(s))})</span>
                </label>
                <div id="permGrid" class="${r?"":"opacity-40 pointer-events-none"}">
    `;for(const[$,v]of Object.entries(ur)){b+=`<div class="mb-3"><div class="text-xs font-semibold text-neutral-500 uppercase mb-1">${l($)}</div><div class="flex flex-wrap gap-x-4 gap-y-1">`;for(const h of v){const f=h.split(":")[1],y=u||i.includes(h)?"checked":"";b+=`<label class="flex items-center gap-1 text-sm cursor-pointer"><input type="checkbox" class="perm-cb" value="${l(h)}" ${y}><span>${l(f)}</span></label>`}b+="</div></div>"}b+=`
                </div>
                <div class="flex justify-end gap-2 mt-6">
                    <button class="px-4 py-2 text-sm rounded-md border border-neutral-300 dark:border-neutral-600 cursor-pointer" onclick="window._pages.users.closePermissions()">${e("common.cancel")}</button>
                    <button class="px-4 py-2 text-sm rounded-md bg-violet-600 text-white hover:bg-violet-700 cursor-pointer" onclick="window._pages.users.savePermissions('${l(t)}')">${e("common.save")}</button>
                </div>
            </div>
        </div>
    `;const g=document.getElementById("permissionsOverlay");g&&g.remove(),document.body.insertAdjacentHTML("beforeend",b)}function yr(){const t=document.getElementById("permUseDefaults").checked,s=document.getElementById("permGrid");s.className=t?"opacity-40 pointer-events-none":""}async function $r(t){const s=document.getElementById("permUseDefaults").checked;let a=null;s||(a=[],document.querySelectorAll(".perm-cb:checked").forEach(n=>{a.push(n.value)}));try{await p(`/admin/users/${t}`,{method:"PATCH",body:JSON.stringify({permissions:a})}),d(e("users.permissionsUpdated")),Ys(),Be()}catch(n){d(e("users.permissionsFailed",{error:n.message}),"error")}}function Ys(){const t=document.getElementById("permissionsOverlay");t&&t.remove()}function xr(){Y("users",()=>Be()),document.addEventListener("click",t=>{t.target.closest(".relative")||document.querySelectorAll("#page-users .relative > div:not(.hidden)").forEach(s=>s.classList.add("hidden"))})}window._pages=window._pages||{};window._pages.users={loadUsers:Be,showCreateUser:gr,createUser:mr,changeRole:br,toggleUser:hr,resetUserPassword:vr,showPermissionsEditor:fr,togglePermDefaults:yr,savePermissions:$r,closePermissions:Ys};async function Xs(t=0){const s=document.getElementById("auditContainer");s.innerHTML=`<div class="${D}"><div class="spinner"></div></div>`;const a=new URLSearchParams({limit:50,offset:t}),n=document.getElementById("auditDateFrom").value,r=document.getElementById("auditDateTo").value,o=document.getElementById("auditAction").value;n&&a.set("date_from",n),r&&a.set("date_to",r),o&&a.set("action",o);try{const i=await p(`/admin/audit-log?${a}`),u=i.entries||[];if(u.length===0){s.innerHTML=`<div class="${T}">${e("audit.noEntries")}</div>`,document.getElementById("auditPagination").innerHTML="";return}s.innerHTML=`
            <div class="overflow-x-auto min-h-[480px]"><table class="${L}" id="auditTable"><thead><tr><th class="${S}" data-sortable>${e("audit.date")}</th><th class="${S}" data-sortable>${e("audit.user")}</th><th class="${S}" data-sortable>${e("audit.action")}</th><th class="${S}" data-sortable>${e("audit.resource")}</th><th class="${m}">${e("audit.ip")}</th></tr></thead><tbody>
            ${u.map($=>`
                <tr class="${_}">
                    <td class="${c}" data-label="${e("audit.date")}" data-sort-value="${$.created_at||""}">${j($.created_at)}</td>
                    <td class="${c}" data-label="${e("audit.user")}">${l($.username)||"-"}</td>
                    <td class="${c}" data-label="${e("audit.action")}"><span class="${F}">${l($.action)}</span></td>
                    <td class="${c}" data-label="${e("audit.resource")}">${l($.resource_type||"")}${$.resource_id?"/"+l($.resource_id):""}</td>
                    <td class="${c}" data-label="${e("audit.ip")}">${l($.ip_address)||"-"}</td>
                </tr>
            `).join("")}
            </tbody></table></div>
        `,W("auditTable");const b=Math.ceil(i.total/50),g=Math.floor(t/50);document.getElementById("auditPagination").innerHTML=Array.from({length:Math.min(b,10)},($,v)=>`<button class="${Pe}${v===g?" active":""}" onclick="window._pages.audit.loadAuditLog(${v*50})">${v+1}</button>`).join("")}catch(i){s.innerHTML=`<div class="${T}">${e("audit.failedToLoad",{error:l(i.message)})}</div>`}}function wr(){Y("audit",()=>Xs())}window._pages=window._pages||{};window._pages.audit={loadAuditLog:Xs};let de="brands",At=null,Ve="",Zs=null,Et="";const He=50;async function ea(){const t=document.getElementById("vehiclesStats");t.innerHTML=`<div class="${D}"><div class="spinner"></div></div>`;try{const s=await p("/admin/vehicles/stats");s.source_path&&(t.dataset.lastSourcePath=s.source_path),t.innerHTML=`
            <div class="${K}"><div class="${J}">${s.brand_count??0}</div><div class="${G}">${e("vehicles.brands")}</div></div>
            <div class="${K}"><div class="${J}">${s.model_count??0}</div><div class="${G}">${e("vehicles.models")}</div></div>
            <div class="${K}"><div class="${J}">${s.kit_count??0}</div><div class="${G}">${e("vehicles.kits")}</div></div>
            <div class="${K}"><div class="${J}">${s.tire_size_count??0}</div><div class="${G}">${e("vehicles.tireSizes")}</div></div>
            <div class="${K}"><div class="${J}">${s.imported_at?j(s.imported_at):e("vehicles.neverImported")}</div><div class="${G}">${e("vehicles.lastImport")}</div></div>
        `}catch(s){t.innerHTML=`<div class="${T}">${e("vehicles.failedToLoad",{error:l(s.message)})}</div>`}}function ns(){const t=document.getElementById("vehiclesBreadcrumb");if(de==="brands"){t.style.display="none";return}t.style.display="";let s=`<a href="#" class="${cs}" onclick="window._pages.vehicles.goToBrands()">${e("vehicles.brands")}</a>`;(de==="models"||de==="kits")&&(s+=` / <span>${l(Ve)}</span>`),de==="kits"&&(s+=` / <a href="#" class="${cs}" onclick="window._pages.vehicles.goToModels()">${e("vehicles.models")}</a>`,s+=` / <span>${l(Et)}</span>`),t.innerHTML=s}async function mt(t=0){de="brands",ns();const s=document.getElementById("vehiclesContainer");s.innerHTML=`<div class="${D}"><div class="spinner"></div></div>`;const a=new URLSearchParams({limit:He,offset:t}),n=document.getElementById("vehiclesSearch").value.trim();n&&a.set("search",n);try{const r=await p(`/admin/vehicles/brands?${a}`),o=r.items||[];if(o.length===0){s.innerHTML=`<div class="${T}">${e("vehicles.noData")}</div>`,document.getElementById("vehiclesPagination").innerHTML="";return}s.innerHTML=`
            <div class="overflow-x-auto min-h-[480px]"><table class="${L}" id="brandsTable">
            <thead><tr>
                <th class="${S}" data-sortable>${e("vehicles.brand")}</th>
                <th class="${S}" data-sortable>${e("vehicles.models")}</th>
            </tr></thead>
            <tbody>
            ${o.map(i=>`
                <tr class="${_} cursor-pointer" data-id="${i.id}" data-name="${l(i.name)}" onclick="window._pages.vehicles.selectBrand(+this.dataset.id, this.dataset.name)">
                    <td class="${c}" data-label="${e("vehicles.brand")}">${l(i.name)}</td>
                    <td class="${c}" data-label="${e("vehicles.models")}">${i.model_count}</td>
                </tr>
            `).join("")}
            </tbody></table></div>
        `,W("brandsTable"),rs(r.total,t,"loadBrands")}catch(r){s.innerHTML=`<div class="${T}">${e("vehicles.failedToLoad",{error:l(r.message)})}</div>`}}async function bt(t,s,a=0){At=t,Ve=s||Ve,de="models",ns();const n=document.getElementById("vehiclesContainer");n.innerHTML=`<div class="${D}"><div class="spinner"></div></div>`;const r=new URLSearchParams({limit:He,offset:a}),o=document.getElementById("vehiclesSearch").value.trim();o&&r.set("search",o);try{const i=await p(`/admin/vehicles/brands/${t}/models?${r}`),u=i.items||[];if(u.length===0){n.innerHTML=`
                <button class="${q} mb-3" onclick="window._pages.vehicles.goToBrands()">${e("vehicles.back")}</button>
                <div class="${T}">${e("vehicles.noData")}</div>
            `,document.getElementById("vehiclesPagination").innerHTML="";return}n.innerHTML=`
            <button class="${q} mb-3" onclick="window._pages.vehicles.goToBrands()">${e("vehicles.back")}</button>
            <div class="overflow-x-auto"><table class="${L}" id="modelsTable">
            <thead><tr>
                <th class="${S}" data-sortable>${e("vehicles.model")}</th>
                <th class="${S}" data-sortable>${e("vehicles.kits")}</th>
            </tr></thead>
            <tbody>
            ${u.map(b=>`
                <tr class="${_} cursor-pointer" data-id="${b.id}" data-name="${l(b.name)}" onclick="window._pages.vehicles.selectModel(+this.dataset.id, this.dataset.name)">
                    <td class="${c}" data-label="${e("vehicles.model")}">${l(b.name)}</td>
                    <td class="${c}" data-label="${e("vehicles.kits")}">${b.kit_count}</td>
                </tr>
            `).join("")}
            </tbody></table></div>
        `,W("modelsTable"),rs(i.total,a,"loadModelsPage")}catch(i){n.innerHTML=`<div class="${T}">${e("vehicles.failedToLoad",{error:l(i.message)})}</div>`}}async function os(t,s,a=0){Zs=t,Et=s||Et,de="kits",ns();const n=document.getElementById("vehiclesContainer");n.innerHTML=`<div class="${D}"><div class="spinner"></div></div>`;const r=new URLSearchParams({limit:He,offset:a});try{const o=await p(`/admin/vehicles/models/${t}/kits?${r}`),i=o.items||[];if(i.length===0){n.innerHTML=`
                <button class="${q} mb-3" onclick="window._pages.vehicles.goToModels()">${e("vehicles.back")}</button>
                <div class="${T}">${e("vehicles.noData")}</div>
            `,document.getElementById("vehiclesPagination").innerHTML="";return}n.innerHTML=`
            <button class="${q} mb-3" onclick="window._pages.vehicles.goToModels()">${e("vehicles.back")}</button>
            <div class="overflow-x-auto"><table class="${L}" id="kitsTable">
            <thead><tr>
                <th class="${S}" data-sortable>${e("vehicles.year")}</th>
                <th class="${S}" data-sortable>${e("vehicles.trim")}</th>
                <th class="${S}" data-sortable>${e("vehicles.pcd")}</th>
                <th class="${S}" data-sortable>${e("vehicles.bolts")}</th>
                <th class="${S}" data-sortable>${e("vehicles.dia")}</th>
                <th class="${S}" data-sortable>${e("vehicles.tireSizes")}</th>
                <th class="${m}"></th>
            </tr></thead>
            <tbody>
            ${i.map(u=>`
                <tr class="${_}">
                    <td class="${c}" data-label="${e("vehicles.year")}">${u.year}</td>
                    <td class="${c}" data-label="${e("vehicles.trim")}">${l(u.name||"-")}</td>
                    <td class="${c}" data-label="${e("vehicles.pcd")}">${u.pcd??"-"}</td>
                    <td class="${c}" data-label="${e("vehicles.bolts")}" data-sort-value="${u.bolt_count??0}">${u.bolt_count??"-"}${u.bolt_size?" / "+l(u.bolt_size):""}</td>
                    <td class="${c}" data-label="${e("vehicles.dia")}">${u.dia??"-"}</td>
                    <td class="${c}" data-label="${e("vehicles.tireSizes")}">${u.tire_size_count}</td>
                    <td class="${U}">
                        <button class="${E} ${C}" onclick="window._pages.vehicles.toggleTireSizes(this, ${u.id})">${e("vehicles.tireSizes")}</button>
                    </td>
                </tr>
                <tr class="tire-sizes-row" id="tire-sizes-${u.id}" style="display:none">
                    <td colspan="7" class="${c} bg-neutral-50 dark:bg-neutral-800/50"></td>
                </tr>
            `).join("")}
            </tbody></table></div>
        `,W("kitsTable"),rs(o.total,a,"loadKitsPage")}catch(o){n.innerHTML=`<div class="${T}">${e("vehicles.failedToLoad",{error:l(o.message)})}</div>`}}async function kr(t,s){const a=document.getElementById(`tire-sizes-${s}`);if(!a)return;if(a.style.display!=="none"){a.style.display="none";return}a.style.display="";const n=a.querySelector("td");n.innerHTML=`<div class="${D}"><div class="spinner"></div></div>`;try{const o=(await p(`/admin/vehicles/kits/${s}/tire-sizes`)).items||[];if(o.length===0){n.innerHTML=`<div class="${T}">${e("vehicles.noData")}</div>`;return}const i=g=>e(g===1?"vehicles.stock":"vehicles.tuning"),u=g=>g===1?B:F,b=g=>e(g===1?"vehicles.front":g===2?"vehicles.rear":"vehicles.all");n.innerHTML=`
            <table class="${L}">
            <thead><tr>
                <th class="${m}">${e("vehicles.size")}</th>
                <th class="${m}">${e("vehicles.type")}</th>
                <th class="${m}">${e("vehicles.axle")}</th>
            </tr></thead>
            <tbody>
            ${o.map(g=>`
                <tr class="${_}">
                    <td class="${c}" data-label="${e("vehicles.size")}">${g.width}/${g.height} R${g.diameter}</td>
                    <td class="${c}" data-label="${e("vehicles.type")}"><span class="${u(g.type)}">${i(g.type)}</span></td>
                    <td class="${c}" data-label="${e("vehicles.axle")}">${b(g.axle)}</td>
                </tr>
            `).join("")}
            </tbody></table>
        `}catch(r){n.innerHTML=`<div class="${T}">${e("vehicles.failedToLoad",{error:l(r.message)})}</div>`}}function rs(t,s,a){const n=Math.ceil(t/He),r=Math.floor(s/He);document.getElementById("vehiclesPagination").innerHTML=Array.from({length:Math.min(n,10)},(o,i)=>`<button class="${Pe}${i===r?" active":""}" onclick="window._pages.vehicles.${a}(${i*He})">${i+1}</button>`).join("")}function Tr(t,s){document.getElementById("vehiclesSearch").value="",bt(t,s)}function _r(t,s){document.getElementById("vehiclesSearch").value="",os(t,s)}function Sr(){document.getElementById("vehiclesSearch").value="",mt()}function Cr(){document.getElementById("vehiclesSearch").value="",bt(At,Ve)}function Er(t){bt(At,Ve,t)}function Br(t){os(Zs,Et,t)}function Ir(){de==="brands"?mt():de==="models"&&bt(At,Ve)}function Lr(){var n;const t=document.getElementById("vehiclesStats"),s=(n=t==null?void 0:t.dataset)==null?void 0:n.lastSourcePath,a=document.getElementById("vehicleImportPath");a&&s&&(a.value=s),document.getElementById("vehicleImportModal").classList.add("show")}async function Ar(){const t=document.getElementById("vehicleImportPath").value.trim();if(!t){d(e("vehicles.importPathRequired"),"error");return}const s=document.getElementById("vehicleImportBtn"),a=s.textContent;s.disabled=!0,s.textContent=e("common.loading");try{const n=await p("/admin/vehicles/import",{method:"POST",body:JSON.stringify({csv_dir:t})});O("vehicleImportModal"),d(e("vehicles.importSuccess",{brands:n.brand_count??0,models:n.model_count??0,kits:n.kit_count??0,tireSizes:n.tire_size_count??0})),ea(),mt()}catch(n){d(e("vehicles.importFailed",{error:l(n.message)}),"error")}finally{s.disabled=!1,s.textContent=a}}function Pr(){Y("vehicles",()=>{ea(),mt()})}window._pages=window._pages||{};window._pages.vehicles={loadBrands:mt,loadModels:bt,loadKits:os,loadModelsPage:Er,loadKitsPage:Br,selectBrand:Tr,selectModel:_r,goToBrands:Sr,goToModels:Cr,toggleTireSizes:kr,search:Ir,openImportModal:Lr,runImport:Ar};let ls="chat",R=null,ce=null,ke=[],at=!1,he=!1,se=new Set,Oe=[],qe=null,nt=null,Gt=null,ta=[],be=!1,Q=new Set;function Qe(t){ls=t,["chat","regression","patterns","phrases","starters"].forEach(a=>{const n=document.getElementById(`sandboxContent-${a}`);n&&(n.style.display=a===t?"":"none")}),document.querySelectorAll("#page-sandbox .tab-bar button").forEach(a=>a.classList.remove("active"));const s=document.querySelector(`#page-sandbox .tab-bar button[data-tab="${t}"]`);s&&s.classList.add("active"),t==="chat"&&ht(),t==="regression"&&sa(),t==="patterns"&&Pt(),t==="phrases"&&aa(),t==="starters"&&Rt()}function ht(){const t=document.getElementById("sandboxChatContainer");if(!R){t.innerHTML=`
            <div class="flex items-center justify-center h-full">
                <p class="${T}">${e("sandbox.noConversation")}</p>
            </div>`;return}fe(R)}async function fe(t){const s=document.getElementById("sandboxChatContainer");s.innerHTML=`<div class="${D}"><div class="spinner"></div></div>`;try{const a=await p(`/admin/sandbox/conversations/${t}`);ce=a.item,ke=a.turns||[],R=t;try{Oe=(await p(`/admin/sandbox/conversations/${t}/turn-groups`)).items||[]}catch{Oe=[]}vt()}catch(a){s.innerHTML=`<div class="${T}">${e("sandbox.loadFailed",{error:l(a.message)})}</div>`}}function vt(){var ye;const t=document.getElementById("sandboxChatContainer"),s=ce,a=s.status==="active",n=s.tool_mode==="mock"?`<span class="${H}">${e("sandbox.mock")}</span>`:`<span class="${B}">${e("sandbox.live")}</span>`,r=s.prompt_version_name?`<span class="${F}">${l(s.prompt_version_name)}</span>`:`<span class="${A}">${e("sandbox.promptVersionDefault")}</span>`,o=s.model?l(s.model.replace("claude-","").replace(/-\d+$/,"")):e("sandbox.modelDefault"),i=a?`<select id="sandboxModelSwitch"
                class="text-[11px] px-1.5 py-0.5 rounded-md border border-neutral-300 dark:border-neutral-600 bg-white dark:bg-neutral-800 text-neutral-700 dark:text-neutral-200 cursor-pointer focus:outline-none focus:ring-1 focus:ring-blue-500"
                onchange="window._pages.sandbox.changeModel(this.value)"
                title="${e("sandbox.changeModel")}">
            </select>`:s.model?`<span class="${Ae}">${o}</span>`:"",u=s.scenario_type?`<span class="${A}">${l(s.scenario_type)}</span>`:"",b=(s.tags||[]).map(Ye=>`<span class="${A}">${l(Ye)}</span>`).join(" ");s.created_at&&j(s.created_at);const g=s.updated_at?j(s.updated_at):"-",$=s.avg_rating!=null?parseFloat(s.avg_rating).toFixed(1)+" &#9733;":"-",v=s.turns_count??ke.length,h=`
        <div class="mb-3 p-3 bg-neutral-50 dark:bg-neutral-800 rounded-md text-xs grid grid-cols-2 sm:grid-cols-4 gap-x-4 gap-y-2">
            <div><span class="text-neutral-500 dark:text-neutral-400">${e("sandbox.promptVersion")}:</span><br>${s.prompt_version_name?l(s.prompt_version_name):e("sandbox.promptVersionDefault")}</div>
            <div><span class="text-neutral-500 dark:text-neutral-400">${e("sandbox.model")}:</span><br>${s.model?l(s.model):e("sandbox.modelDefault")}</div>
            <div><span class="text-neutral-500 dark:text-neutral-400">${e("sandbox.toolMode")}:</span><br>${s.tool_mode==="mock"?e("sandbox.toolModeMock"):e("sandbox.toolModeLive")}</div>
            <div><span class="text-neutral-500 dark:text-neutral-400">${e("sandbox.scenarioType")}:</span><br>${s.scenario_type||e("sandbox.scenarioNone")}</div>
            <div><span class="text-neutral-500 dark:text-neutral-400">${e("sandbox.turnsCount")}:</span><br>${v}</div>
            <div><span class="text-neutral-500 dark:text-neutral-400">${e("sandbox.avgRating")}:</span><br>${$}</div>
            <div><span class="text-neutral-500 dark:text-neutral-400">${e("sandbox.status")}:</span><br>${s.status==="active"?e("sandbox.active"):e("sandbox.archivedStatus")}</div>
            <div><span class="text-neutral-500 dark:text-neutral-400">${e("sandbox.lastActivity")}:</span><br>${g}</div>
            ${b?`<div class="col-span-2 sm:col-span-4"><span class="text-neutral-500 dark:text-neutral-400">${e("sandbox.tags")}:</span> ${b}</div>`:""}
        </div>`,f=he?E:q,y=e(he?"sandbox.exitMarking":"sandbox.markingMode");let x="";ke.length===0?x=`<div class="${T} py-12">${e("sandbox.noMessages")}</div>`:x=ke.map(Ye=>Mr(Ye)).join("");let k="";he&&se.size>=1?k=`
            <div class="flex items-center gap-2 mb-2 p-2 bg-yellow-50 dark:bg-yellow-950/20 rounded border border-yellow-200 dark:border-yellow-800">
                <span class="text-sm">${e("sandbox.turnsSelected",{count:se.size})}</span>
                <button class="${E} ${C}" onclick="window._pages.sandbox.showGroupModal()">${e("sandbox.createGroup")}</button>
            </div>`:he&&se.size===0&&(k=`
            <div class="flex items-center gap-2 mb-2 p-2 bg-blue-50 dark:bg-blue-950/20 rounded border border-blue-200 dark:border-blue-800">
                <span class="text-sm text-blue-700 dark:text-blue-300">${e("sandbox.markingHint")}</span>
            </div>`);let P="";if(Oe.length>0){const Ye=Oe.map(X=>{const oa=X.pattern_type==="positive"?`<span class="${B}">positive</span>`:`<span class="${M}">negative</span>`,ra=X.is_exported?`<span class="${F}">${e("sandbox.alreadyExported")}</span>`:`<button class="${q} ${C}" onclick="window._pages.sandbox.showExportModal('${X.id}')">${e("sandbox.exportToPatterns")}</button>`,la=X.rating?"&#9733;".repeat(X.rating):"-",ia=(X.tags||[]).map(da=>`<span class="${A}">${l(da)}</span>`).join(" ");return`
                <div class="p-2 rounded border ${X.pattern_type==="positive"?"border-emerald-300 dark:border-emerald-800 bg-emerald-50/50 dark:bg-emerald-950/10":"border-red-300 dark:border-red-800 bg-red-50/50 dark:bg-red-950/10"} mb-2">
                    <div class="flex items-center gap-2 mb-1">
                        <span class="text-sm font-medium">${l(X.intent_label)}</span>
                        ${oa}
                        <span class="text-amber-400 text-sm">${la}</span>
                        <div class="ml-auto flex gap-1">
                            ${ra}
                            <button class="${it} ${C}" onclick="window._pages.sandbox.deleteGroup('${X.id}')">&times;</button>
                        </div>
                    </div>
                    <div class="${w}">${X.turn_ids.length} ${e("sandbox.turnsCount").toLowerCase()} ${ia}</div>
                    ${X.rating_comment?`<div class="${w}">${l(X.rating_comment)}</div>`:""}
                    ${X.correction?`<div class="text-xs text-red-600 dark:text-red-400 mt-1">${e("sandbox.correction")}: ${l(X.correction)}</div>`:""}
                </div>`}).join("");P=`
            <details class="mb-3" open>
                <summary class="text-sm font-semibold text-neutral-700 dark:text-neutral-300 cursor-pointer mb-2">${e("sandbox.turnGroups")} (${Oe.length})</summary>
                ${Ye}
            </details>`}const I=((ye=document.getElementById("sandboxInput"))==null?void 0:ye.value)||"";t.innerHTML=`
        <div class="flex flex-col h-full">
            <div class="mb-3 pb-3 border-b border-neutral-200 dark:border-neutral-700">
                <div class="flex flex-wrap items-center gap-2">
                    <h2 class="text-sm font-semibold text-neutral-900 dark:text-neutral-50 mr-2">${l(s.title)}</h2>
                    ${r} ${n} ${i} ${u}
                    <div class="ml-auto flex flex-wrap gap-2">
                        <button class="${q} ${C}" onclick="document.getElementById('sandboxConvInfo').toggleAttribute('open')" title="${e("sandbox.convInfo")}">&#9432;</button>
                        <button class="${f} ${C}" onclick="window._pages.sandbox.toggleMarking()">${y}</button>
                        <button class="${s.is_baseline?E:q} ${C}" onclick="window._pages.sandbox.toggleBaseline('${s.id}', ${!!s.is_baseline})">${s.is_baseline?e("sandbox.unmarkBaseline"):e("sandbox.markBaseline")}</button>
                        ${a?`<button class="${q} ${C}" onclick="window._pages.sandbox.archiveConversation()">${e("sandbox.archiveConversation")}</button>`:""}
                    </div>
                </div>
                <details id="sandboxConvInfo" class="mt-2">
                    <summary class="text-xs text-blue-600 dark:text-blue-400 cursor-pointer">${e("sandbox.convInfo")}</summary>
                    ${h}
                </details>
            </div>
            ${P}
            ${k}
            <div id="sandboxMessages" class="flex-1 overflow-y-auto mb-3 space-y-2">
                ${x}
            </div>
            ${a?`
            <div class="flex gap-2 pt-3 border-t border-neutral-200 dark:border-neutral-700">
                <input type="text" id="sandboxInput"
                    data-i18n-placeholder="sandbox.messagePlaceholder"
                    placeholder="${e("sandbox.messagePlaceholder")}"
                    class="${Zt} flex-1"
                    onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();window._pages.sandbox.sendMessage();}">
                <select id="sandboxPersonaSelect" class="px-1.5 py-1 text-xs border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500" title="${e("sandbox.persona")}">
                    <option value="neutral">${e("sandbox.personaNeutral")}</option>
                    <option value="impatient">${e("sandbox.personaImpatient")}</option>
                    <option value="confused">${e("sandbox.personaConfused")}</option>
                    <option value="angry">${e("sandbox.personaAngry")}</option>
                    <option value="expert">${e("sandbox.personaExpert")}</option>
                </select>
                <button id="sandboxAutoBtn" class="${Ea} ${C}" title="${e("sandbox.autoCustomerHint")}" onclick="window._pages.sandbox.autoCustomer()">${e("sandbox.autoCustomer")}</button>
                <button id="sandboxSendBtn" class="${E}" onclick="window._pages.sandbox.sendMessage()">${e("sandbox.sendMessage")}</button>
            </div>`:""}
        </div>`;const ne=document.getElementById("sandboxInput");ne&&I&&(ne.value=I);const oe=document.getElementById("sandboxModelSwitch");oe&&zr(oe,s.model);const N=document.getElementById("sandboxMessages");N&&(N.scrollTop=N.scrollHeight)}function Rr(t){return Oe.find(s=>s.turn_ids.includes(t))}function Mr(t){const s=t.speaker==="customer",a=s?xs:ws,n=e(s?"sandbox.customer":"sandbox.agent"),r=Rr(t.id);let o;r?o=r.pattern_type==="positive"?"bg-emerald-100 dark:bg-emerald-950/40 border-l-4 border-emerald-500":"bg-red-100 dark:bg-red-950/40 border-l-4 border-red-500":o=s?"bg-blue-50 dark:bg-blue-950/30":"bg-emerald-50 dark:bg-emerald-950/30";let i="";he&&(i=`<input type="checkbox" ${se.has(t.id)?"checked":""} onchange="window._pages.sandbox.toggleTurnSelect('${t.id}')" class="mr-2 mt-1 cursor-pointer">`);let u="";if(t.tool_calls&&t.tool_calls.length>0){const f=t.tool_calls.map(y=>{const x=JSON.stringify(y.tool_args),k=JSON.stringify(y.tool_result),P=x.length>60?`<details><summary class="text-xs cursor-pointer">${l(x.substring(0,60))}...</summary><pre class="text-xs bg-neutral-100 dark:bg-neutral-800 p-2 rounded mt-1 max-h-48 overflow-auto whitespace-pre-wrap">${l(JSON.stringify(y.tool_args,null,2))}</pre></details>`:`<code class="text-xs break-all">${l(x)}</code>`,I=k.length>60?`<details><summary class="text-xs cursor-pointer">${l(k.substring(0,60))}...</summary><pre class="text-xs bg-neutral-100 dark:bg-neutral-800 p-2 rounded mt-1 max-h-48 overflow-auto whitespace-pre-wrap">${l(JSON.stringify(y.tool_result,null,2))}</pre></details>`:`<code class="text-xs break-all">${l(k)}</code>`;return`
            <tr class="${_}">
                <td class="${c}"><span class="${F}">${l(y.tool_name)}</span></td>
                <td class="${c}">${P}</td>
                <td class="${c}">${I}</td>
                <td class="${c}">${y.duration_ms!=null?y.duration_ms+"ms":"-"}</td>
                <td class="${c}">${y.is_mock?`<span class="${H}">${e("sandbox.mock")}</span>`:`<span class="${B}">${e("sandbox.live")}</span>`}</td>
            </tr>`}).join("");u=`
            <details class="mt-1">
                <summary class="text-xs text-neutral-500 dark:text-neutral-400 cursor-pointer hover:text-neutral-700 dark:hover:text-neutral-200">
                    ${e("sandbox.toolCalls")} (${t.tool_calls.length})
                </summary>
                <div class="mt-1 overflow-x-auto">
                    <table class="${L}">
                        <thead><tr>
                            <th class="${m}">${e("sandbox.toolName")}</th>
                            <th class="${m}">${e("sandbox.toolArgs")}</th>
                            <th class="${m}">${e("sandbox.toolResult")}</th>
                            <th class="${m}">${e("sandbox.toolDuration")}</th>
                            <th class="${m}">${e("sandbox.toolMode")}</th>
                        </tr></thead>
                        <tbody>${f}</tbody>
                    </table>
                </div>
            </details>`}let b="";if(!s&&t.llm_latency_ms!=null){const f=!t.input_tokens&&!t.output_tokens;b=`<div class="${w} mt-1">${e("sandbox.metrics",{latency:t.llm_latency_ms,input:t.input_tokens||0,output:t.output_tokens||0,model:t.model||"-"})}</div>`,f&&(b+=`<div class="mt-1 text-xs text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-950/30 rounded px-2 py-1">${e("sandbox.llmErrorHint")}</div>`)}let g="",$="";if(!s){const f=[1,2,3,4,5].map(x=>`<span class="cursor-pointer ${t.rating&&x<=t.rating?"text-amber-400":"text-neutral-300 dark:text-neutral-600"} text-lg" onclick="window._pages.sandbox.rateTurn('${t.id}', ${x})">&#9733;</span>`).join("");let y="";t.id===qe?y=`
                <div class="flex items-center gap-2 mt-1">
                    <input type="text" id="ratingCommentInput" placeholder="${e("sandbox.ratingCommentPlaceholder")}" class="${Zt} text-xs flex-1"
                        onkeydown="if(event.key==='Enter'){event.preventDefault();window._pages.sandbox.saveRating();}">
                    <button class="${E} ${C}" onclick="window._pages.sandbox.saveRating()">OK</button>
                    <button class="${q} ${C}" onclick="window._pages.sandbox.cancelRating()">&times;</button>
                </div>`:t.rating_comment&&(y=`<span class="${w} ml-2">${l(t.rating_comment)}</span>`),g=`<div class="mt-1 flex items-center gap-1 flex-wrap">${f}${y}</div>`,$=`<button class="${q} ${C} mt-1" onclick="window._pages.sandbox.branchFrom('${t.id}', ${t.turn_number})">${e("sandbox.branch")}</button>`}let v="";return r&&(v=`<span class="text-xs ml-2">${r.pattern_type==="positive"?"&#9989;":"&#10060;"} ${l(r.intent_label)}</span>`),`
        <div class="${o} ${s?"ml-auto max-w-[80%]":"mr-auto max-w-[80%]"} rounded-lg px-3 py-2">
            <div class="flex items-start gap-1">
                ${i}
                <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-2">
                        <span class="${a}">${n}</span>
                        <span class="${w}">${j(t.created_at)}</span>
                        ${v}
                    </div>
                    <div class="${ks}">${l(t.content)}</div>
                    ${u}
                    ${b}
                    <div class="flex items-center gap-2 flex-wrap">
                        ${g}
                        ${$}
                    </div>
                </div>
            </div>
        </div>`}function Dr(){he=!he,se.clear(),vt()}function Fr(t){se.has(t)?se.delete(t):se.add(t),vt()}function Nr(){se.size<1||(document.getElementById("sandboxGroupIntent").value="",document.getElementById("sandboxGroupType").value="positive",document.getElementById("sandboxGroupRating").value="",document.getElementById("sandboxGroupComment").value="",document.getElementById("sandboxGroupCorrection").value="",document.getElementById("sandboxGroupTags").value="",document.getElementById("sandboxGroupCorrectionWrap").style.display="none",document.getElementById("sandboxGroupModal").classList.add("show"))}async function Hr(){const t=document.getElementById("sandboxGroupIntent").value.trim();if(!t){d(e("sandbox.intentRequired"),"error");return}const s=document.getElementById("sandboxGroupType").value,a=document.getElementById("sandboxGroupRating").value,n=a?parseInt(a):null,r=document.getElementById("sandboxGroupComment").value.trim()||null,o=document.getElementById("sandboxGroupCorrection").value.trim()||null,i=document.getElementById("sandboxGroupTags").value.trim(),u=i?i.split(",").map(b=>b.trim()).filter(Boolean):[];try{await p(`/admin/sandbox/conversations/${R}/turn-groups`,{method:"POST",body:JSON.stringify({turn_ids:Array.from(se),intent_label:t,pattern_type:s,rating:n,rating_comment:r,correction:o,tags:u})}),O("sandboxGroupModal"),d(e("sandbox.groupCreated")),se.clear(),he=!1,await fe(R)}catch(b){d(e("sandbox.loadFailed",{error:b.message}),"error")}}async function Or(t){if(!confirm(e("sandbox.deleteConfirm",{title:"group"})))return;const s=document.querySelector(`[onclick*="deleteGroup('${t}')"]`);s&&(s.disabled=!0,s.innerHTML='<span class="spinner-sm"></span>');try{await p(`/admin/sandbox/turn-groups/${t}`,{method:"DELETE"}),d(e("sandbox.groupDeleted")),await fe(R)}catch(a){d(e("sandbox.loadFailed",{error:a.message}),"error")}finally{s&&(s.disabled=!1,s.textContent="×")}}function qr(t){document.getElementById("sandboxExportGroupId").value=t,document.getElementById("sandboxExportGuidance").value="",document.getElementById("sandboxExportModal").classList.add("show")}async function Ur(){const t=document.getElementById("sandboxExportGroupId").value,s=document.getElementById("sandboxExportGuidance").value.trim();if(!s){d(e("sandbox.guidanceRequired"),"error");return}try{await p(`/admin/sandbox/turn-groups/${t}/export`,{method:"POST",body:JSON.stringify({guidance_note:s})}),O("sandboxExportModal"),d(e("sandbox.exportSuccess")),await fe(R)}catch(a){d(e("sandbox.loadFailed",{error:a.message}),"error")}}let ft=null;async function zr(t,s){if(!ft)try{ft=(await p("/admin/sandbox/models")).models||[]}catch{ft=[]}t.innerHTML=`<option value="">${e("sandbox.modelDefault")}</option>`;for(const a of ft){const n=a.label||a.id,r=a.source==="router"?` [${e("sandbox.routerModel")}]`:"",o=a.id===s?" selected":"";t.innerHTML+=`<option value="${l(a.id)}"${o}>${l(n)}${r}</option>`}}async function Kr(t){if(R)try{await p(`/admin/sandbox/conversations/${R}`,{method:"PATCH",body:JSON.stringify({model:t||""})}),ce&&(ce.model=t||null),d(e("sandbox.modelChanged"))}catch(s){d(e("sandbox.loadFailed",{error:s.message}),"error");const a=document.getElementById("sandboxModelSwitch");a&&ce&&(a.value=ce.model||"")}}async function jr(){var r;if(at)return;const t=document.getElementById("sandboxInput"),s=(r=t==null?void 0:t.value)==null?void 0:r.trim();if(!s||!R)return;at=!0;const a=document.getElementById("sandboxSendBtn");a&&(a.disabled=!0,a.textContent=e("sandbox.sending"));const n=s;t.value="";try{const o=await p(`/admin/sandbox/conversations/${R}/send`,{method:"POST",body:JSON.stringify({message:s})});o.error&&d(`${e("sandbox.llmError")}: ${o.error}`,"error"),await fe(R)}catch(o){d(e("sandbox.sendFailed",{error:o.message}),"error");const i=document.getElementById("sandboxInput");i&&(i.value=n)}finally{at=!1;const o=document.getElementById("sandboxSendBtn");o&&(o.disabled=!1,o.textContent=e("sandbox.sendMessage"));const i=document.getElementById("sandboxInput");i&&i.focus()}}function Vr(t,s){qe=t,nt=s,vt(),setTimeout(()=>{const a=document.getElementById("ratingCommentInput");a&&a.focus()},0)}async function Jr(){var a;if(!qe||!nt)return;const t=document.getElementById("ratingCommentInput"),s=((a=t==null?void 0:t.value)==null?void 0:a.trim())||"";try{const n={rating:nt};s&&(n.comment=s),await p(`/admin/sandbox/turns/${qe}/rate`,{method:"PATCH",body:JSON.stringify(n)}),d(e("sandbox.ratingSaved")),qe=null,nt=null,R&&await fe(R)}catch(n){d(e("sandbox.ratingFailed",{error:n.message}),"error")}}function Gr(){qe=null,nt=null,vt()}function Wr(t,s){Gt=t;const a=document.getElementById("sandboxBranchTitle");a&&(a.textContent=e("sandbox.branchFromTurn",{turn:s}));const n=document.getElementById("sandboxBranchInput");n&&(n.value=""),document.getElementById("sandboxBranchModal").classList.add("show"),setTimeout(()=>{n&&n.focus()},100)}async function Qr(){var a;const t=document.getElementById("sandboxBranchInput"),s=(a=t==null?void 0:t.value)==null?void 0:a.trim();if(!(!s||!Gt)){at=!0;try{await p(`/admin/sandbox/conversations/${R}/send`,{method:"POST",body:JSON.stringify({message:s,parent_turn_id:Gt})}),O("sandboxBranchModal"),await fe(R)}catch(n){d(e("sandbox.sendFailed",{error:n.message}),"error")}finally{at=!1}}}async function Yr(){var s;const t=document.getElementById("sandboxAutoBtn");t&&(t.disabled=!0,t.textContent=e("sandbox.generating"));try{const a=((s=document.getElementById("sandboxPersonaSelect"))==null?void 0:s.value)||"neutral",n=await p(`/admin/sandbox/conversations/${R}/auto-customer`,{method:"POST",body:JSON.stringify({persona:a})}),r=document.getElementById("sandboxInput");r&&n.suggested_message&&(r.value=n.suggested_message,r.focus())}catch(a){d(e("sandbox.sendFailed",{error:a.message}),"error")}finally{t&&(t.disabled=!1,t.textContent=e("sandbox.autoCustomer"))}}async function Xr(){if(!R)return;const t=document.querySelector('[onclick*="archiveConversation()"]');t&&(t.disabled=!0,t.textContent="...");try{await p(`/admin/sandbox/conversations/${R}`,{method:"PATCH",body:JSON.stringify({status:"archived"})}),d(e("sandbox.archived")),R=null,ce=null,ke=[],ht(),ee()}catch(s){d(e("sandbox.loadFailed",{error:s.message}),"error")}finally{t&&(t.disabled=!1,t.textContent=e("sandbox.archiveConversation"))}}async function Zr(){document.getElementById("sandboxConvTitle").value="",document.getElementById("sandboxConvTags").value="",document.getElementById("sandboxConvToolMode").value="live",document.getElementById("sandboxConvScenario").value="";try{const s=(await p("/admin/sandbox/scenario-starters?limit=20")).items||[];ta=s;const a=document.getElementById("sandboxStartersSection"),n=document.getElementById("sandboxStarterCards");s.length>0?(a.style.display="",n.innerHTML=s.map((r,o)=>{const i=r.scenario_type?`<span class="text-[10px] px-1 rounded bg-neutral-200 dark:bg-neutral-700 text-neutral-600 dark:text-neutral-300">${l(r.scenario_type)}</span>`:"";return`
                    <div class="p-2 rounded-md border border-neutral-200 dark:border-neutral-700 hover:border-blue-400 dark:hover:border-blue-600 cursor-pointer transition-colors bg-neutral-50 dark:bg-neutral-800"
                         onclick="window._pages.sandbox.useStarterByIndex(${o})">
                        <div class="text-xs font-medium text-neutral-900 dark:text-neutral-100 mb-1">${l(r.title)}</div>
                        <div class="text-[10px] text-neutral-500 dark:text-neutral-400 truncate mb-1">${l(r.first_message)}</div>
                        ${i}
                    </div>`}).join("")):a.style.display="none"}catch{const t=document.getElementById("sandboxStartersSection");t&&(t.style.display="none")}try{const t=await p("/prompts"),s=document.getElementById("sandboxConvPrompt");s.innerHTML=`<option value="">${e("sandbox.promptVersionDefault")}</option>`;const a=t.versions||t.items||[];for(const n of a){const r=n.is_active?" *":"";s.innerHTML+=`<option value="${n.id}">${l(n.name)}${r}</option>`}}catch{}try{const t=await p("/admin/sandbox/models"),s=document.getElementById("sandboxConvModel");s.innerHTML=`<option value="">${e("sandbox.modelDefault")}</option>`;for(const a of t.models||[]){const n=a.speed==="fast"?" ⚡":"",r=a.source==="router"?` [${e("sandbox.routerModel")}]`:"";s.innerHTML+=`<option value="${a.id}">${l(a.label)}${n}${r}</option>`}}catch{}document.getElementById("sandboxNewConvModal").classList.add("show")}async function el(){const t=document.getElementById("sandboxConvTitle").value.trim();if(!t){d(e("sandbox.titleRequired"),"error");return}const s=document.getElementById("sandboxConvPrompt").value||null,a=document.getElementById("sandboxConvModel").value||null,n=document.getElementById("sandboxConvToolMode").value,r=document.getElementById("sandboxConvScenario").value||null,o=document.getElementById("sandboxConvTags").value.trim(),i=o?o.split(",").map(u=>u.trim()).filter(Boolean):[];try{const u={title:t,tool_mode:n,tags:i};s&&(u.prompt_version_id=s),a&&(u.model=a),r&&(u.scenario_type=r);const b=await p("/admin/sandbox/conversations",{method:"POST",body:JSON.stringify(u)});O("sandboxNewConvModal"),d(e("sandbox.created")),R=b.item.id,ee(),Qe("chat")}catch(u){d(e("sandbox.loadFailed",{error:u.message}),"error")}}async function ee(){var i,u,b,g;const t=document.getElementById("sandboxSidebarList");if(!t)return;t.innerHTML='<div class="flex justify-center py-6"><div class="spinner"></div></div>';const s=document.getElementById("sandboxBulkToggle");s&&(be?(s.classList.add("bg-blue-600","text-white","border-blue-600"),s.classList.remove("text-neutral-600","dark:text-neutral-300","border-neutral-300","dark:border-neutral-600")):(s.classList.remove("bg-blue-600","text-white","border-blue-600"),s.classList.add("text-neutral-600","dark:text-neutral-300","border-neutral-300","dark:border-neutral-600")));const a=((u=(i=document.getElementById("sandboxSearch"))==null?void 0:i.value)==null?void 0:u.trim())||"",n=((b=document.getElementById("sandboxFilterStatus"))==null?void 0:b.value)||"",r=((g=document.getElementById("sandboxFilterScenario"))==null?void 0:g.value)||"",o=new URLSearchParams;a&&o.set("search",a),n&&o.set("status",n),r&&o.set("scenario_type",r),o.set("limit","50");try{const v=(await p(`/admin/sandbox/conversations?${o}`)).items||[];if(v.length===0){t.innerHTML=`<div class="p-4 text-center ${w}">${e("sandbox.noConversations")}</div>`;return}let h="";if(be){const y=v.map(I=>I.id),x=y.length>0&&y.every(I=>Q.has(I)),k=e(x?"sandbox.deselectAll":"sandbox.selectAll");h=`
                <div class="px-3 py-2 border-b border-neutral-200 dark:border-neutral-700 flex items-center gap-2 bg-neutral-50 dark:bg-neutral-800">
                    <button class="${q} ${C}" onclick="window._pages.sandbox.${x?"deselectAll":"selectAll"}()">${k}</button>
                    ${Q.size>0?`<button class="${it} ${C}" onclick="window._pages.sandbox.bulkDelete()">${e("sandbox.bulkDelete",{count:Q.size})}</button>`:""}
                </div>`}const f=v.map(y=>{const k=y.id===R?"bg-blue-50 dark:bg-blue-950/30 border-l-2 border-blue-500":"border-l-2 border-transparent hover:bg-neutral-50 dark:hover:bg-neutral-800",P=y.tool_mode==="mock"?`<span class="text-[10px] px-1 rounded bg-amber-100 dark:bg-amber-900/40 text-amber-700 dark:text-amber-300">${e("sandbox.mock")}</span>`:`<span class="text-[10px] px-1 rounded bg-emerald-100 dark:bg-emerald-900/40 text-emerald-700 dark:text-emerald-300">${e("sandbox.live")}</span>`,I=y.model?y.model.replace("claude-","").replace(/-\d+$/,""):"",ne=y.updated_at?new Date(y.updated_at).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit"}):"",oe=y.is_baseline?'<span class="text-[10px] px-1 rounded bg-indigo-100 dark:bg-indigo-900/40 text-indigo-700 dark:text-indigo-300 font-semibold">B</span>':"";let N="";return be&&(N=`<input type="checkbox" ${Q.has(y.id)?"checked":""} onclick="event.stopPropagation();window._pages.sandbox.toggleBulkSelect('${y.id}')" class="mr-1.5 mt-0.5 cursor-pointer flex-shrink-0">`),`
                <div class="px-3 py-2 cursor-pointer ${k} transition-colors" onclick="${be?`window._pages.sandbox.toggleBulkSelect('${y.id}')`:`window._pages.sandbox.openConversation('${y.id}')`}">
                    <div class="flex items-center gap-1">
                        ${N}
                        <span class="text-xs font-medium text-neutral-900 dark:text-neutral-100 truncate flex-1">${l(y.title)}</span>
                        ${oe}
                        ${be?"":`<button class="text-neutral-400 hover:text-red-500 text-xs leading-none flex-shrink-0" onclick="event.stopPropagation();window._pages.sandbox.deleteConversation('${y.id}', '${l(y.title).replace(/'/g,"\\'")}')" title="${e("common.delete")}">&times;</button>`}
                    </div>
                    <div class="flex items-center gap-1.5 mt-0.5 text-[10px] text-neutral-500 dark:text-neutral-400">
                        <span>${ne}</span>
                        <span>&middot;</span>
                        <span>${y.turns_count||0} ${e("sandbox.turnsCount").toLowerCase()}</span>
                        ${P}
                        ${I?`<span class="text-neutral-400">${l(I)}</span>`:""}
                    </div>
                </div>`}).join("");t.innerHTML=h+f}catch($){t.innerHTML=`<div class="p-4 text-center ${w}">${e("sandbox.loadFailed",{error:l($.message)})}</div>`}}function tl(t){R=t,ls!=="chat"?Qe("chat"):ht(),ee()}async function sl(t,s){if(!confirm(e("sandbox.deleteConfirm",{title:s})))return;const a=document.querySelector(`[onclick*="deleteConversation('${t}'"]`);a&&(a.disabled=!0,a.innerHTML="...");try{await p(`/admin/sandbox/conversations/${t}`,{method:"DELETE"}),d(e("sandbox.deleted")),R===t&&(R=null,ce=null,ke=[],ht()),ee()}catch(n){const r=n.status===409?e("sandbox.deleteBlockedByRegression"):e("sandbox.loadFailed",{error:n.message});d(r,"error"),a&&(a.disabled=!1,a.innerHTML="&times;")}}async function sa(){const t=document.getElementById("sandboxRegressionContainer");t.innerHTML=`<div class="${D}"><div class="spinner"></div></div>`;try{let r=function(i){const u={pending:A,running:H,completed:B,failed:M},b={pending:e("sandbox.pending"),running:e("sandbox.running"),completed:e("sandbox.completed"),failed:e("sandbox.failed")};return`<span class="${u[i]||A}">${b[i]||i}</span>`};var s=r;const n=(await p("/admin/sandbox/regression-runs?limit=50")).items||[];if(n.length===0){t.innerHTML=`<div class="${T}">${e("sandbox.noRegressions")}</div>`;return}const o=n.map(i=>`
            <tr class="${_} cursor-pointer" onclick="window._pages.sandbox.showRegressionDetail('${i.id}')">
                <td class="${c}" data-label="${e("sandbox.conversationTitle")}">${l(i.source_title||"-")}</td>
                <td class="${c}" data-label="${e("sandbox.promptVersion")}">${i.prompt_version_name?`<span class="${F}">${l(i.prompt_version_name)}</span>`:"-"}</td>
                <td class="${c}" data-label="${e("sandbox.status")}">${r(i.status)}</td>
                <td class="${c}" data-label="${e("sandbox.turnsCompared")}">${i.turns_compared||"-"}</td>
                <td class="${c}" data-label="${e("sandbox.sourceRating")}">${i.avg_source_rating!=null?parseFloat(i.avg_source_rating).toFixed(1):"-"}</td>
                <td class="${c}" data-label="${e("sandbox.error")}">${i.error_message?`<span class="${w}">${l(i.error_message.substring(0,50))}</span>`:"-"}</td>
                <td class="${c}" data-label="${e("sandbox.lastActivity")}">${j(i.created_at)}</td>
            </tr>`).join("");t.innerHTML=`
            <div class="overflow-x-auto min-h-[480px]"><table class="${L}"><thead><tr>
                <th class="${m}">${e("sandbox.conversationTitle")}</th>
                <th class="${m}">${e("sandbox.promptVersion")}</th>
                <th class="${m}">${e("sandbox.status")}</th>
                <th class="${m}">${e("sandbox.turnsCompared")}</th>
                <th class="${m}">${e("sandbox.sourceRating")}</th>
                <th class="${m}">${e("sandbox.error")}</th>
                <th class="${m}">${e("sandbox.lastActivity")}</th>
            </tr></thead><tbody>${o}</tbody></table></div>`}catch(a){t.innerHTML=`<div class="${T}">${e("sandbox.loadFailed",{error:l(a.message)})}</div>`}}async function al(t){const s=document.getElementById("sandboxRegressionContainer");s.innerHTML=`<div class="${D}"><div class="spinner"></div></div>`;try{const n=(await p(`/admin/sandbox/regression-runs/${t}`)).item,o=(n.summary||{}).turn_diffs||[];let i="";o.length>0&&(i=o.map(u=>`
                <div class="${K}">
                    <div class="${w} mb-1">Turn ${u.turn_number}: ${l(u.customer_message)}</div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <div class="text-xs font-semibold text-neutral-500 mb-1">${e("sandbox.sourceResponse")}</div>
                            <div class="text-sm bg-neutral-50 dark:bg-neutral-800 rounded p-2">${l(u.source_response)}</div>
                        </div>
                        <div>
                            <div class="text-xs font-semibold text-neutral-500 mb-1">${e("sandbox.newResponse")}</div>
                            <div class="text-sm bg-emerald-50 dark:bg-emerald-950/30 rounded p-2">${l(u.new_response)}</div>
                        </div>
                    </div>
                    ${u.diff_lines&&u.diff_lines.length>0?`
                        <details class="mt-2">
                            <summary class="${w} cursor-pointer">${e("sandbox.diffView")}</summary>
                            <pre class="text-xs bg-neutral-900 text-neutral-100 rounded p-2 mt-1 overflow-x-auto">${l(u.diff_lines.join(`
`))}</pre>
                        </details>`:""}
                </div>`).join("")),s.innerHTML=`
            <div class="mb-3">
                <button class="${q} ${C}" onclick="window._pages.sandbox.loadRegressionRuns()">&larr; ${e("sandbox.regression")}</button>
            </div>
            <div class="${K}">
                <div class="grid grid-cols-4 gap-4 mb-3">
                    <div><span class="${w}">${e("sandbox.status")}</span><br>${l(n.status)}</div>
                    <div><span class="${w}">${e("sandbox.turnsCompared")}</span><br>${n.turns_compared||0}</div>
                    <div><span class="${w}">${e("sandbox.sourceRating")}</span><br>${n.avg_source_rating!=null?parseFloat(n.avg_source_rating).toFixed(1):"-"}</div>
                    <div><span class="${w}">${e("sandbox.promptVersion")}</span><br>${l(n.prompt_version_name||"-")}</div>
                </div>
                ${n.error_message?`<div class="${M} mb-2">${l(n.error_message)}</div>`:""}
                ${n.new_conversation_id?`<button class="${E} ${C}" onclick="window._pages.sandbox.openConversation('${n.new_conversation_id}');window._pages.sandbox.showTab('chat')">${e("sandbox.openNewConversation")}</button>`:""}
            </div>
            ${i}`}catch(a){s.innerHTML=`<div class="${T}">${e("sandbox.loadFailed",{error:l(a.message)})}</div>`}}async function nl(t){document.getElementById("sandboxReplayConvId").value=t;const s=document.getElementById("sandboxReplayPrompt");s.innerHTML="";try{const a=await p("/prompts"),n=a.versions||a.items||[];if(n.length===0){d(e("sandbox.regressionFailed",{error:"No prompt versions available"}),"error");return}for(const r of n){const o=r.is_active?" *":"";s.innerHTML+=`<option value="${r.id}">${l(r.name)}${o}</option>`}}catch{d(e("sandbox.regressionFailed",{error:"Failed to load versions"}),"error");return}document.getElementById("sandboxReplayModal").classList.add("show")}async function ol(){const t=document.getElementById("sandboxReplayPrompt"),s=document.getElementById("sandboxReplayConvId").value,a=t==null?void 0:t.value;if(!a||!s)return;const n=document.querySelector('#sandboxReplayModal button[onclick*="submitReplay"]');n&&(n.disabled=!0,n.textContent="...");try{await p(`/admin/sandbox/conversations/${s}/replay`,{method:"POST",body:JSON.stringify({new_prompt_version_id:a})}),O("sandboxReplayModal"),d(e("sandbox.regressionStarted")),Qe("regression")}catch(r){d(e("sandbox.regressionFailed",{error:r.message}),"error")}finally{n&&(n.disabled=!1,n.textContent=e("sandbox.submitReplay"))}}async function rl(t,s){try{await p(`/admin/sandbox/conversations/${t}`,{method:"PATCH",body:JSON.stringify({is_baseline:!s})}),R===t?await fe(t):ee()}catch(a){d(e("sandbox.loadFailed",{error:a.message}),"error")}}async function Pt(){const t=document.getElementById("sandboxPatternsContainer");t.innerHTML=`<div class="${D}"><div class="spinner"></div></div>`;try{const a=(await p("/admin/sandbox/patterns?limit=100")).items||[];if(a.length===0){t.innerHTML=`<div class="${T}">${e("sandbox.noPatterns")}</div>`;return}const n=a.map(r=>{var $;const o=r.pattern_type==="positive"?`<span class="${B}">+</span>`:`<span class="${M}">&minus;</span>`,i=r.is_active?'<span class="inline-block w-2 h-2 rounded-full bg-emerald-500" title="Active"></span>':'<span class="inline-block w-2 h-2 rounded-full bg-neutral-300 dark:bg-neutral-600" title="Inactive"></span>',u=(r.tags||[]).join(", "),b=r.rating?"&#9733;".repeat(r.rating):"-",g=r.is_active?e("common.deactivate"):e("common.activate");return`
                <tr class="${_}">
                    <td class="${c}" data-label="${e("sandbox.intentLabel")}">
                        <div class="flex items-center gap-1.5">${i} ${o} <span class="truncate" title="${l(r.intent_label)}">${l(r.intent_label)}</span></div>
                    </td>
                    <td class="${c}" data-label="${e("sandbox.guidanceNote")}"><div class="truncate text-xs" title="${l(r.guidance_note)}">${l(r.guidance_note)}</div></td>
                    <td class="${c}" data-label="${e("sandbox.customerMessages")}"><div class="truncate text-xs" title="${l(r.customer_messages||"")}">${l((($=r.customer_messages)==null?void 0:$.substring(0,60))||"-")}</div></td>
                    <td class="${c} text-center" data-label="${e("sandbox.avgRating")}"><span class="text-amber-400 text-xs">${b}</span></td>
                    <td class="${c} text-center text-xs" data-label="#">${r.times_used}${u?` <span class="text-neutral-400" title="${l(u)}">&#128196;</span>`:""}</td>
                    <td class="${U}">
                        <div class="relative inline-block">
                            <button class="px-1.5 py-0.5 text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 text-sm cursor-pointer" onclick="this.nextElementSibling.classList.toggle('hidden')">&hellip;</button>
                            <div class="hidden absolute right-0 z-20 mt-1 w-36 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-md shadow-lg py-1">
                                <button class="w-full text-left px-3 py-1.5 text-xs hover:bg-neutral-100 dark:hover:bg-neutral-700 cursor-pointer" onclick="this.closest('.relative').querySelector('.hidden')||this.parentElement.classList.add('hidden');window._pages.sandbox.togglePatternActive('${r.id}', ${r.is_active})">${g}</button>
                                <button class="w-full text-left px-3 py-1.5 text-xs text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950/30 cursor-pointer" onclick="this.closest('.relative').querySelector('.hidden')||this.parentElement.classList.add('hidden');window._pages.sandbox.deletePattern('${r.id}')">${e("common.delete")}</button>
                            </div>
                        </div>
                    </td>
                </tr>`}).join("");t.innerHTML=`
            <div class="mb-4 flex flex-wrap items-center gap-2">
                <input type="text" id="patternSearchQuery" placeholder="${e("sandbox.testSearchHint")}"
                    class="${Zt} flex-1"
                    onkeydown="if(event.key==='Enter')window._pages.sandbox.testSearch()">
                <button class="${E} ${C}" onclick="window._pages.sandbox.testSearch()">${e("sandbox.testSearch")}</button>
            </div>
            <div id="patternSearchResults" class="mb-4"></div>
            <table class="${L} table-fixed w-full"><thead><tr>
                <th class="${m}" style="width:20%">${e("sandbox.intentLabel")}</th>
                <th class="${m}" style="width:30%">${e("sandbox.guidanceNote")}</th>
                <th class="${m}" style="width:25%">${e("sandbox.customerMessages")}</th>
                <th class="${m} text-center" style="width:8%">${e("sandbox.avgRating")}</th>
                <th class="${m} text-center" style="width:9%">#</th>
                <th class="${m} text-right" style="width:8%"></th>
            </tr></thead><tbody>${n}</tbody></table>`}catch(s){t.innerHTML=`<div class="${T}">${e("sandbox.loadFailed",{error:l(s.message)})}</div>`}}async function ll(t,s){try{await p(`/admin/sandbox/patterns/${t}`,{method:"PATCH",body:JSON.stringify({is_active:!s})}),Pt()}catch(a){d(e("sandbox.loadFailed",{error:a.message}),"error")}}async function il(t){if(!confirm(e("sandbox.deleteConfirm",{title:"pattern"})))return;const s=document.querySelector(`[onclick*="deletePattern('${t}')"]`);s&&(s.disabled=!0,s.innerHTML="...");try{await p(`/admin/sandbox/patterns/${t}`,{method:"DELETE"}),Pt()}catch(a){d(e("sandbox.loadFailed",{error:a.message}),"error"),s&&(s.disabled=!1,s.innerHTML="&times;")}}async function dl(){var a,n;const t=(n=(a=document.getElementById("patternSearchQuery"))==null?void 0:a.value)==null?void 0:n.trim();if(!t)return;const s=document.getElementById("patternSearchResults");s.innerHTML=`<div class="${D}"><div class="spinner"></div></div>`;try{const r=new URLSearchParams({query:t,top_k:"5",min_similarity:"0.5"}),i=(await p(`/admin/sandbox/patterns/search-test?${r}`,{method:"POST"})).results||[];if(i.length===0){s.innerHTML=`<div class="${w} p-2">${e("sandbox.noPatterns")}</div>`;return}const u=i.map(b=>{const g=(parseFloat(b.similarity)*100).toFixed(1);return`
                <div class="flex items-center gap-2 p-2 rounded bg-neutral-50 dark:bg-neutral-800 mb-1">
                    ${b.pattern_type==="positive"?`<span class="${B}">+</span>`:`<span class="${M}">&minus;</span>`}
                    <span class="text-sm font-medium">${l(b.intent_label)}</span>
                    <span class="${F}">${g}%</span>
                    <span class="${w} text-xs truncate flex-1">${l(b.guidance_note)}</span>
                </div>`}).join("");s.innerHTML=`
            <div class="text-xs font-semibold text-neutral-500 mb-1">${e("sandbox.similarity")} (${i.length})</div>
            ${u}`}catch(r){s.innerHTML=`<div class="${w} p-2">${l(r.message)}</div>`}}async function aa(){const t=document.getElementById("sandboxPhrasesContainer");t.innerHTML=`<div class="${D}"><div class="spinner"></div></div>`;try{const s=await p("/admin/sandbox/agent-phrases"),a=s.fixed||[],n=s.wait_pools||[],r=s.db_templates||{},o=Object.keys(r).length>0;let i="";if(o){const g=Object.entries(r).map(([$,v])=>{var y,x;const h=v.filter(k=>k.is_active).length,f=v.map((k,P)=>`
                    <div class="py-1.5 ${P>0?"border-t border-neutral-100 dark:border-neutral-800":""}">
                        <div class="flex items-center gap-2">
                            <span class="${w} text-xs">#${k.variant_number}</span>
                            ${k.is_active?"":`<span class="text-[10px] px-1.5 py-0.5 rounded bg-neutral-200 dark:bg-neutral-700 text-neutral-500 dark:text-neutral-400">${e("sandbox.phrasesInactive")}</span>`}
                            <span class="text-xs text-neutral-600 dark:text-neutral-400">${l(k.title)}</span>
                        </div>
                        <div class="font-mono text-xs mt-0.5 ${k.is_active?"":"opacity-40 line-through"}">${l(k.content)}</div>
                    </div>`).join("");return`
                    <tr class="${_}">
                        <td class="${c}" data-label="${e("sandbox.phrasesKey")}">
                            <span class="${ds}">${l($)}</span>
                            <div class="${w} text-xs mt-1">${e("sandbox.phrasesDbVariants",{active:h,total:v.length})}</div>
                        </td>
                        <td class="${c}" data-label="${e("sandbox.phrasesText")}">
                            <details>
                                <summary class="cursor-pointer text-xs text-blue-600 dark:text-blue-400">${l(((y=v.find(k=>k.is_active))==null?void 0:y.content)||((x=v[0])==null?void 0:x.content)||"")}</summary>
                                <div class="mt-1 pl-2 border-l-2 border-purple-200 dark:border-purple-800">${f}</div>
                            </details>
                        </td>
                    </tr>`}).join("");i=`
                <div class="mb-6 p-3 bg-purple-50 dark:bg-purple-950/20 rounded-md border border-purple-200 dark:border-purple-800">
                    <h2 class="text-sm font-semibold text-purple-900 dark:text-purple-100 mb-1">${e("sandbox.phrasesDbTitle")}</h2>
                    <p class="text-xs text-purple-700 dark:text-purple-300 mb-3">${e("sandbox.phrasesDbDescription")}</p>
                    <div class="overflow-x-auto">
                        <table class="${L}">
                            <thead><tr>
                                <th class="${m}" style="width:200px">${e("sandbox.phrasesKey")}</th>
                                <th class="${m}">${e("sandbox.phrasesText")}</th>
                            </tr></thead>
                            <tbody>${g}</tbody>
                        </table>
                    </div>
                </div>`}const u=a.map(g=>{const $=!!r[g.key];return`
            <tr class="${_} ${$?"opacity-50":""}">
                <td class="${c}" data-label="${e("sandbox.phrasesKey")}"><span class="${F}">${l(g.label)}</span></td>
                <td class="${c} font-mono text-xs whitespace-pre-wrap" data-label="${e("sandbox.phrasesText")}">${l(g.text)}</td>
                <td class="${c}" data-label="${e("sandbox.phrasesStatus")}">
                    ${$?`<span class="${ds}">${e("sandbox.phrasesOverridden")}</span>`:`<span class="${B}">${e("sandbox.phrasesActive")}</span>`}
                </td>
            </tr>`}).join(""),b=n.map(g=>{const $=g.phrases.map((v,h)=>`
                <div class="py-1 ${h>0?"border-t border-neutral-100 dark:border-neutral-800":""}">
                    <span class="${w} text-xs mr-2">#${h+1}</span>
                    <span class="font-mono text-xs">${l(v)}</span>
                </div>`).join("");return`
                <tr class="${_}">
                    <td class="${c}" data-label="${e("sandbox.phrasesKey")}">
                        <span class="${H}">${l(g.label)}</span>
                        <div class="${w} text-xs mt-1">${e("sandbox.phrasesPoolLabel",{count:g.phrases.length})}</div>
                    </td>
                    <td class="${c}" data-label="${e("sandbox.phrasesText")}">
                        <details>
                            <summary class="cursor-pointer text-xs text-blue-600 dark:text-blue-400">${l(g.phrases[0])}</summary>
                            <div class="mt-1 pl-2 border-l-2 border-blue-200 dark:border-blue-800">${$}</div>
                        </details>
                    </td>
                    <td class="${c}" data-label="${e("sandbox.phrasesStatus")}"><span class="${B}">${e("sandbox.phrasesActive")}</span></td>
                </tr>`}).join("");t.innerHTML=`
            <div class="mb-4">
                <h2 class="text-sm font-semibold text-neutral-900 dark:text-neutral-50 mb-1">${e("sandbox.phrasesTitle")}</h2>
                <p class="${w} text-xs mb-4">${e("sandbox.phrasesDescription")}</p>
            </div>

            ${i}

            <h3 class="text-xs font-semibold text-neutral-700 dark:text-neutral-300 mb-2">${e("sandbox.phrasesCatFixed")}</h3>
            <div class="overflow-x-auto mb-6">
                <table class="${L}">
                    <thead><tr>
                        <th class="${m}" style="width:200px">${e("sandbox.phrasesKey")}</th>
                        <th class="${m}">${e("sandbox.phrasesText")}</th>
                        <th class="${m}" style="width:140px">${e("sandbox.phrasesStatus")}</th>
                    </tr></thead>
                    <tbody>${u}</tbody>
                </table>
            </div>

            <h3 class="text-xs font-semibold text-neutral-700 dark:text-neutral-300 mb-2">${e("sandbox.phrasesCatWait")}</h3>
            <div class="overflow-x-auto mb-6">
                <table class="${L}">
                    <thead><tr>
                        <th class="${m}" style="width:200px">${e("sandbox.phrasesKey")}</th>
                        <th class="${m}">${e("sandbox.phrasesText")}</th>
                        <th class="${m}" style="width:140px">${e("sandbox.phrasesStatus")}</th>
                    </tr></thead>
                    <tbody>${b}</tbody>
                </table>
            </div>

            <div class="p-3 bg-amber-50 dark:bg-amber-950/20 rounded-md border border-amber-200 dark:border-amber-800">
                <p class="text-xs text-amber-700 dark:text-amber-300">${e("sandbox.phrasesLlmNote")}</p>
            </div>`}catch(s){t.innerHTML=`<div class="${T}">${e("sandbox.phrasesLoadFailed",{error:l(s.message)})}</div>`}}async function Rt(){const t=document.getElementById("sandboxStartersContainer");t.innerHTML=`<div class="${D}"><div class="spinner"></div></div>`;try{const a=(await p("/admin/sandbox/scenario-starters?limit=100")).items||[];if(a.length===0){t.innerHTML=`
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-sm font-semibold text-neutral-900 dark:text-neutral-50">${e("sandbox.starters")}</h2>
                    <button class="${E} ${C}" onclick="window._pages.sandbox.showStarterModal()">${e("sandbox.newStarter")}</button>
                </div>
                <div class="${T}">${e("sandbox.noStarters")}</div>`;return}const n=a.map(r=>{const o=r.scenario_type?`<span class="${A}">${l(r.scenario_type)}</span>`:"",i=r.customer_persona?`<span class="${F}">${l(r.customer_persona)}</span>`:"";return`
                <tr class="${_}">
                    <td class="${c}" data-label="${e("sandbox.starterTitle")}"><span class="font-medium">${l(r.title)}</span></td>
                    <td class="${c}" data-label="${e("sandbox.starterFirstMessage")}"><div class="max-w-xs truncate text-xs">${l(r.first_message)}</div></td>
                    <td class="${c}" data-label="${e("sandbox.scenarioType")}">${o}</td>
                    <td class="${c}" data-label="${e("sandbox.starterPersona")}">${i}</td>
                    <td class="${c}" data-label="${e("sandbox.starterDescription")}"><div class="max-w-xs truncate text-xs">${l(r.description||"")}</div></td>
                    <td class="${U}">
                        <div class="flex gap-1">
                            <button class="${q} ${C}" onclick="window._pages.sandbox.showStarterModal('${r.id}')">${e("common.edit")}</button>
                            <button class="${it} ${C}" onclick="window._pages.sandbox.deleteStarter('${r.id}', '${l(r.title).replace(/'/g,"\\'")}')">&times;</button>
                        </div>
                    </td>
                </tr>`}).join("");t.innerHTML=`
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-sm font-semibold text-neutral-900 dark:text-neutral-50">${e("sandbox.starters")} (${a.length})</h2>
                <button class="${E} ${C}" onclick="window._pages.sandbox.showStarterModal()">${e("sandbox.newStarter")}</button>
            </div>
            <div class="overflow-x-auto"><table class="${L}"><thead><tr>
                <th class="${m}">${e("sandbox.starterTitle")}</th>
                <th class="${m}">${e("sandbox.starterFirstMessage")}</th>
                <th class="${m}">${e("sandbox.scenarioType")}</th>
                <th class="${m}">${e("sandbox.starterPersona")}</th>
                <th class="${m}">${e("sandbox.starterDescription")}</th>
                <th class="${m}"></th>
            </tr></thead><tbody>${n}</tbody></table></div>`}catch(s){t.innerHTML=`<div class="${T}">${e("sandbox.loadFailed",{error:l(s.message)})}</div>`}}async function cl(t){document.getElementById("sandboxStarterEditId").value=t||"",document.getElementById("sandboxStarterTitle").value="",document.getElementById("sandboxStarterFirstMsg").value="",document.getElementById("sandboxStarterDesc").value="",document.getElementById("sandboxStarterScenario").value="",document.getElementById("sandboxStarterPersona").value="neutral";const s=document.getElementById("sandboxStarterModalTitle");if(t){s.textContent=e("sandbox.editStarter");try{const a=await p(`/admin/sandbox/scenario-starters/${t}`),n=a.item||a;document.getElementById("sandboxStarterTitle").value=n.title||"",document.getElementById("sandboxStarterFirstMsg").value=n.first_message||"",document.getElementById("sandboxStarterDesc").value=n.description||"",document.getElementById("sandboxStarterScenario").value=n.scenario_type||"",document.getElementById("sandboxStarterPersona").value=n.customer_persona||"neutral"}catch{}}else s.textContent=e("sandbox.newStarter");document.getElementById("sandboxStarterModal").classList.add("show")}async function ul(){const t=document.getElementById("sandboxStarterEditId").value,s=document.getElementById("sandboxStarterTitle").value.trim(),a=document.getElementById("sandboxStarterFirstMsg").value.trim();if(!s||!a){d(e("sandbox.starterTitleRequired"),"error");return}const n={title:s,first_message:a,description:document.getElementById("sandboxStarterDesc").value.trim()||null,scenario_type:document.getElementById("sandboxStarterScenario").value||null,customer_persona:document.getElementById("sandboxStarterPersona").value||"neutral"};try{t?await p(`/admin/sandbox/scenario-starters/${t}`,{method:"PATCH",body:JSON.stringify(n)}):await p("/admin/sandbox/scenario-starters",{method:"POST",body:JSON.stringify(n)}),O("sandboxStarterModal"),d(e("sandbox.starterSaved")),Rt()}catch(r){d(e("sandbox.loadFailed",{error:r.message}),"error")}}async function pl(t,s){if(!confirm(e("sandbox.deleteStarterConfirm",{title:s})))return;const a=document.querySelector(`[onclick*="deleteStarter('${t}'"]`);a&&(a.disabled=!0,a.innerHTML="...");try{await p(`/admin/sandbox/scenario-starters/${t}`,{method:"DELETE"}),d(e("sandbox.starterDeleted")),Rt()}catch(n){d(e("sandbox.loadFailed",{error:n.message}),"error"),a&&(a.disabled=!1,a.innerHTML="&times;")}}function gl(t){const s=ta[t];s&&na(s)}async function na(t){var r,o;const s=((r=document.getElementById("sandboxConvModel"))==null?void 0:r.value)||null,a=((o=document.getElementById("sandboxConvToolMode"))==null?void 0:o.value)||"mock",n={title:t.title,tool_mode:a,tags:[]};s&&(n.model=s),t.scenario_type&&(n.scenario_type=t.scenario_type);try{const u=(await p("/admin/sandbox/conversations",{method:"POST",body:JSON.stringify(n)})).item.id;R=u,await p(`/admin/sandbox/conversations/${u}/send`,{method:"POST",body:JSON.stringify({message:t.first_message})}),O("sandboxNewConvModal"),d(e("sandbox.created")),ee(),Qe("chat")}catch(i){d(e("sandbox.loadFailed",{error:i.message}),"error")}}function ml(){be=!be,Q.clear(),ee()}function bl(t){Q.has(t)?Q.delete(t):Q.add(t),ee()}function hl(){document.querySelectorAll('#sandboxSidebarList input[type="checkbox"]').forEach(t=>{const a=(t.getAttribute("onclick")||"").match(/toggleBulkSelect\('([^']+)'\)/);a&&Q.add(a[1])}),ee()}function vl(){Q.clear(),ee()}async function fl(){var t;if(Q.size!==0&&confirm(e("sandbox.bulkDeleteConfirm",{count:Q.size})))try{const s=await p("/admin/sandbox/conversations/bulk-delete",{method:"POST",body:JSON.stringify({conversation_ids:Array.from(Q)})}),a=e("sandbox.bulkDeleted",{deleted:s.deleted,skipped:s.skipped});d(a),s.skipped>0&&d(e("sandbox.bulkSkipped"),"warning"),R&&Q.has(R)&&!((t=s.skipped_ids)!=null&&t.includes(R))&&(R=null,ce=null,ke=[],ht()),Q.clear(),be=!1,ee()}catch(s){d(e("sandbox.loadFailed",{error:s.message}),"error")}}function yl(){Y("sandbox",()=>{ee(),Qe(ls)}),document.addEventListener("click",t=>{t.target.closest(".relative")||document.querySelectorAll("#page-sandbox .relative > div:not(.hidden)").forEach(s=>s.classList.add("hidden"))})}window._pages=window._pages||{};window._pages.sandbox={showTab:Qe,loadSidebar:ee,openConversation:tl,showNewConvModal:Zr,createConversation:el,sendMessage:jr,rateTurn:Vr,saveRating:Jr,cancelRating:Gr,archiveConversation:Xr,deleteConversation:sl,branchFrom:Wr,submitBranch:Qr,autoCustomer:Yr,loadRegressionRuns:sa,showRegressionDetail:al,replayConversation:nl,submitReplay:ol,toggleBaseline:rl,toggleMarking:Dr,toggleTurnSelect:Fr,showGroupModal:Nr,submitGroup:Hr,deleteGroup:Or,showExportModal:qr,submitExport:Ur,loadPatterns:Pt,togglePatternActive:ll,deletePattern:il,testSearch:dl,changeModel:Kr,loadPhrases:aa,toggleBulkMode:ml,toggleBulkSelect:bl,selectAll:hl,deselectAll:vl,bulkDelete:fl,loadStarters:Rt,showStarterModal:cl,saveStarter:ul,deleteStarter:pl,useStarter:na,useStarterByIndex:gl};pa();Ma();gs();Sa();Na();ja();sn();Tn();co();Eo();Ao();No();qo();tr();lr();cr();xr();wr();Pr();yl();xa(t=>{const s=localStorage.getItem("admin_active_page")||"dashboard";(t.type==="call:started"||t.type==="call:ended"||t.type==="call:transferred")&&(s==="dashboard"&&window._pages.dashboard.loadDashboard(),s==="calls"&&window._pages.calls.loadCalls(tn())),t.type==="operator:status_changed"&&s==="operators"&&(window._pages.operators.loadOperators(),window._pages.operators.loadQueueStatus()),t.type==="dashboard:metrics_updated"&&s==="dashboard"&&window._pages.dashboard.loadDashboard()});setInterval($s,6e4);let Te=localStorage.getItem("admin_active_page");Te==="training"&&(Te="prompts",localStorage.setItem("admin_active_page",Te));Te==="settings"&&(Te="monitoring",localStorage.setItem("admin_active_page",Te));Ue()&&($s(),Ue()&&(document.getElementById("loginContainer").style.display="none",document.getElementById("app").style.display="block",vs().then(()=>{fs(),Qt();const t=rt();_e(t||Te||"dashboard")})));document.getElementById("loginPassword").addEventListener("keypress",t=>{t.key==="Enter"&&ys()});document.addEventListener("keydown",t=>{t.key==="Escape"&&document.querySelectorAll(".modal-overlay.show").forEach(s=>s.classList.remove("show"))});function $l(){document.getElementById("sidebar").classList.toggle("open")}function xl(){const t=document.getElementById("sidebar"),s=document.querySelector(".main-content"),a=t.classList.toggle("expanded");s&&(s.style.marginLeft=a?"14rem":""),localStorage.setItem("sidebar_expanded",a?"1":"0")}var us;if(localStorage.getItem("sidebar_expanded")==="1"){(us=document.getElementById("sidebar"))==null||us.classList.add("expanded");const t=document.querySelector(".main-content");t&&(t.style.marginLeft="14rem")}document.querySelectorAll("a[data-page]").forEach(t=>{const s=t.dataset.page;t.href="#/"+s,t.removeAttribute("onclick"),t.addEventListener("click",a=>{a.preventDefault(),_e(s),window.innerWidth<=768&&document.getElementById("sidebar").classList.remove("open")})});window.addEventListener("langchange",()=>{Fa(),Ta();const t=localStorage.getItem("admin_active_page")||"dashboard";_e(t)});window._app={login:ys,logout:Xt,showPage:_e,closeModal:O,toggleSidebar:$l,toggleSidebarExpand:xl,toggleTheme:Da,toggleLang:ga,toggleSidebarGroup:_a,openHelp:Ha,closeHelp:qt};
