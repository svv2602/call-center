<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Call Center AI — Admin</title>
    <script>
        // Prevent FOUC: apply dark class before first paint
        (function() {
            var t = localStorage.getItem('admin_theme');
            if (t === 'dark' || (!t && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            }
        })();
    </script>
</head>
<body class="bg-neutral-50 dark:bg-neutral-950 text-neutral-900 dark:text-neutral-50 font-sans antialiased">
    <!-- Toast container -->
    <div class="fixed top-4 right-4 z-[200] flex flex-col gap-2" id="toastContainer"></div>

    <!-- Login -->
    <div class="flex justify-center items-center min-h-screen" id="loginContainer">
        <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 p-8 rounded-xl shadow-lg w-80">
            <h1 class="text-lg font-semibold text-center mb-6 text-neutral-900 dark:text-neutral-50">Call Center AI</h1>
            <div class="text-red-500 text-sm mb-2 hidden" id="loginError" data-i18n="login.error">Неверные учётные данные</div>
            <input type="text" id="loginUsername" data-i18n-placeholder="login.username" placeholder="Имя пользователя"
                class="w-full px-3 py-2 mb-3 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <input type="password" id="loginPassword" data-i18n-placeholder="login.password" placeholder="Пароль"
                class="w-full px-3 py-2 mb-4 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <button onclick="window._app.login()"
                class="w-full py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 transition-colors cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-500" data-i18n="login.submit">Войти</button>
        </div>
    </div>

    <!-- App -->
    <div class="hidden" id="app">
        <!-- Hamburger (mobile) -->
        <button class="hidden max-md:block fixed top-3 left-3 z-50 bg-zinc-900 text-white border-none rounded-md px-2.5 py-1.5 cursor-pointer text-xl"
            id="hamburgerBtn" onclick="window._app.toggleSidebar()">&#9776;</button>

        <!-- Sidebar -->
        <nav class="sidebar fixed left-0 top-0 bottom-0 w-56 max-md:w-64 bg-zinc-950 text-neutral-300 flex flex-col z-40" id="sidebar">
            <div class="flex items-center px-4 py-4 border-b border-zinc-800">
                <h2 class="text-sm font-semibold text-white tracking-wide">Call Center AI</h2>
            </div>
            <div class="flex-1 py-2 overflow-y-auto">
                <a href="#" onclick="window._app.showPage('dashboard')" class="active flex items-center px-4 py-2 text-sm text-neutral-400 hover:text-white hover:bg-zinc-800 transition-colors" data-page="dashboard" data-i18n="nav.dashboard">Дашборд</a>
                <a href="#" onclick="window._app.showPage('calls')" class="flex items-center px-4 py-2 text-sm text-neutral-400 hover:text-white hover:bg-zinc-800 transition-colors" data-page="calls" data-i18n="nav.calls">Журнал звонков</a>
                <!-- Обучение агента group -->
                <div class="sidebar-group" data-group="training">
                    <a href="#" class="sidebar-group-toggle flex items-center px-4 py-2 text-sm text-neutral-400 hover:text-white hover:bg-zinc-800 transition-colors"
                       onclick="event.preventDefault(); window._app.toggleSidebarGroup('training')">
                        <span class="flex-1" data-i18n="nav.training">Обучение агента</span>
                        <svg class="chevron w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                    </a>
                    <div class="sidebar-sub-links">
                        <a href="#" onclick="window._app.showPage('prompts')" data-page="prompts" data-i18n="nav.prompts" class="flex items-center px-4 py-2 text-sm text-neutral-400 hover:text-white hover:bg-zinc-800 transition-colors">Промпты</a>
                        <a href="#" onclick="window._app.showPage('knowledge')" data-page="knowledge" data-i18n="nav.knowledge" class="flex items-center px-4 py-2 text-sm text-neutral-400 hover:text-white hover:bg-zinc-800 transition-colors">База знаний</a>
                        <a href="#" onclick="window._app.showPage('scenarios')" data-page="scenarios" data-i18n="nav.scenarios" class="flex items-center px-4 py-2 text-sm text-neutral-400 hover:text-white hover:bg-zinc-800 transition-colors">Сценарии</a>
                        <a href="#" onclick="window._app.showPage('tools')" data-page="tools" data-i18n="nav.tools" class="flex items-center px-4 py-2 text-sm text-neutral-400 hover:text-white hover:bg-zinc-800 transition-colors">Инструменты</a>
                        <a href="#" onclick="window._app.showPage('sandbox')" data-page="sandbox" data-i18n="nav.sandbox" class="flex items-center px-4 py-2 text-sm text-neutral-400 hover:text-white hover:bg-zinc-800 transition-colors">Песочница</a>
                    </div>
                </div>
                <a href="#" onclick="window._app.showPage('operators')" class="flex items-center px-4 py-2 text-sm text-neutral-400 hover:text-white hover:bg-zinc-800 transition-colors" data-page="operators" data-i18n="nav.operators">Операторы</a>
                <!-- Система group -->
                <div class="sidebar-group" data-group="settings">
                    <a href="#" class="sidebar-group-toggle flex items-center px-4 py-2 text-sm text-neutral-400 hover:text-white hover:bg-zinc-800 transition-colors"
                       onclick="event.preventDefault(); window._app.toggleSidebarGroup('settings')">
                        <span class="flex-1" data-i18n="nav.system">Система</span>
                        <svg class="chevron w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                    </a>
                    <div class="sidebar-sub-links">
                        <a href="#" onclick="window._app.showPage('monitoring')" data-page="monitoring" data-i18n="nav.monitoring" class="flex items-center px-4 py-2 text-sm text-neutral-400 hover:text-white hover:bg-zinc-800 transition-colors">Мониторинг</a>
                        <a href="#" onclick="window._app.showPage('configuration')" data-page="configuration" data-i18n="nav.configuration" class="flex items-center px-4 py-2 text-sm text-neutral-400 hover:text-white hover:bg-zinc-800 transition-colors">Конфигурация</a>
                        <a href="#" onclick="window._app.showPage('notifications')" data-page="notifications" data-i18n="nav.notifications" class="flex items-center px-4 py-2 text-sm text-neutral-400 hover:text-white hover:bg-zinc-800 transition-colors">Уведомления</a>
                    </div>
                </div>
                <a href="#" onclick="window._app.showPage('users')" class="admin-only flex items-center px-4 py-2 text-sm text-neutral-400 hover:text-white hover:bg-zinc-800 transition-colors" data-page="users" data-i18n="nav.users">Пользователи</a>
                <a href="#" onclick="window._app.showPage('audit')" class="admin-only flex items-center px-4 py-2 text-sm text-neutral-400 hover:text-white hover:bg-zinc-800 transition-colors" data-page="audit" data-i18n="nav.audit">Аудит</a>
                <a href="#" onclick="window._app.showPage('vehicles')" class="flex items-center px-4 py-2 text-sm text-neutral-400 hover:text-white hover:bg-zinc-800 transition-colors" data-page="vehicles" data-i18n="nav.vehicles">База авто</a>
            </div>
            <div class="border-t border-zinc-800 px-4 py-3 space-y-2">
                <button onclick="window._app.toggleTheme()" id="themeToggle"
                    class="flex items-center gap-2 w-full px-2 py-1.5 text-xs text-neutral-400 hover:text-white hover:bg-zinc-800 rounded transition-colors cursor-pointer">
                    <span id="themeIcon"></span>
                    <span id="themeLabel">Тёмная</span>
                </button>
                <button onclick="window._app.toggleLang()"
                    class="flex items-center gap-2 w-full px-2 py-1.5 text-xs text-neutral-400 hover:text-white hover:bg-zinc-800 rounded transition-colors cursor-pointer">
                    <span>&#127760;</span>
                    <span id="langLabel">EN</span>
                </button>
                <div class="flex items-center gap-2 text-xs text-neutral-500" id="wsStatus">
                    <span class="w-2 h-2 rounded-full bg-red-500" id="wsDot"></span>
                    <span id="wsLabel">Оффлайн</span>
                </div>
            </div>
            <div class="border-t border-zinc-800 px-4 py-3">
                <span class="text-xs text-red-400 cursor-pointer hover:text-red-300 transition-colors" onclick="window._app.logout()" data-i18n="nav.logout">Выход</span>
            </div>
        </nav>

        <!-- Main content -->
        <div class="ml-56 max-md:ml-0 p-6 max-md:p-4 min-h-screen">
            <!-- Dashboard -->
            <div id="page-dashboard">
                <div class="text-xs text-neutral-500 dark:text-neutral-400 mb-3"><a href="#" onclick="window._app.showPage('dashboard')" class="text-blue-600 dark:text-blue-400 hover:underline">Home</a> / <span data-i18n="dashboard.breadcrumb">Дашборд</span></div>
                <h1 class="text-lg font-semibold text-neutral-900 dark:text-neutral-50 mb-4" data-i18n="dashboard.title">Дашборд</h1>
                <div class="grid grid-cols-[repeat(auto-fill,minmax(180px,1fr))] gap-4 mb-6 max-md:grid-cols-2 max-[480px]:grid-cols-1" id="dashboardStats">
                    <div class="flex justify-center py-8"><div class="spinner"></div></div>
                </div>
                <div class="flex gap-2 mb-4 flex-wrap">
                    <button class="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer bg-emerald-600 text-white hover:bg-emerald-700" onclick="window._pages.dashboard.exportStatsCSV()" data-i18n="dashboard.exportCSV">Экспорт CSV</button>
                    <button class="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer bg-violet-600 text-white hover:bg-violet-700" onclick="window._pages.dashboard.downloadPdfReport()" data-i18n="dashboard.downloadPDF">Скачать PDF</button>
                </div>
                <!-- Grafana iframe — hidden until Grafana is configured (Phase 4) -->
                <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-5 mb-4" id="grafanaBlock" style="display:none">
                    <h3 class="text-sm font-semibold text-neutral-900 dark:text-neutral-50 mb-3" data-i18n="dashboard.grafana">Grafana в реальном времени</h3>
                    <iframe class="w-full h-[600px] max-md:h-[350px] border-none rounded-lg" id="grafanaFrame" src=""></iframe>
                </div>
            </div>

            <!-- Calls -->
            <div id="page-calls" style="display:none">
                <div class="text-xs text-neutral-500 dark:text-neutral-400 mb-3"><a href="#" onclick="window._app.showPage('dashboard')" class="text-blue-600 dark:text-blue-400 hover:underline">Home</a> / <span data-i18n="calls.breadcrumb">Журнал звонков</span></div>
                <h1 class="text-lg font-semibold text-neutral-900 dark:text-neutral-50 mb-4" data-i18n="calls.title">Журнал звонков</h1>
                <div class="flex flex-wrap items-center gap-2 mb-4">
                    <input type="date" id="filterDateFrom" onchange="window._pages.calls.loadCalls()" class="px-2.5 py-1.5 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500 max-md:w-full">
                    <input type="date" id="filterDateTo" onchange="window._pages.calls.loadCalls()" class="px-2.5 py-1.5 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500 max-md:w-full">
                    <select id="filterScenario" onchange="window._pages.calls.loadCalls()" class="px-2.5 py-1.5 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500 max-md:w-full">
                        <option value="" data-i18n="calls.allScenarios">Все сценарии</option>
                        <option value="tire_search" data-i18n="calls.tireSearch">Поиск шин</option>
                        <option value="availability" data-i18n="calls.availability">Наличие</option>
                        <option value="order" data-i18n="calls.order">Заказ</option>
                        <option value="fitting" data-i18n="calls.fitting">Шиномонтаж</option>
                        <option value="consultation" data-i18n="calls.consultation">Консультация</option>
                    </select>
                    <select id="filterTransferred" onchange="window._pages.calls.loadCalls()" class="px-2.5 py-1.5 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500 max-md:w-full">
                        <option value="" data-i18n="calls.all">Все</option>
                        <option value="true" data-i18n="calls.transferred">Переведено</option>
                        <option value="false" data-i18n="calls.resolvedByBot">Решено ботом</option>
                    </select>
                    <input type="text" id="filterSearch" data-i18n-placeholder="calls.searchPlaceholder" placeholder="Поиск в транскрипции..."
                        onkeydown="if(event.key==='Enter')window._pages.calls.loadCalls()"
                        class="px-2.5 py-1.5 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500 max-md:w-full">
                    <input type="number" id="filterQualityBelow" data-i18n-placeholder="calls.qualityBelow" placeholder="Качество ниже" step="0.1" min="0" max="1"
                        onchange="window._pages.calls.loadCalls()"
                        class="px-2.5 py-1.5 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500 max-md:w-full">
                    <button onclick="window._pages.calls.loadCalls()"
                        class="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer bg-blue-600 text-white hover:bg-blue-700 max-md:w-full" data-i18n="common.filter">Фильтровать</button>
                    <button onclick="window._pages.calls.exportCallsCSV()"
                        class="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer bg-emerald-600 text-white hover:bg-emerald-700 max-md:w-full" data-i18n="calls.exportCSV">Экспорт CSV</button>
                </div>
                <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-5 mb-4 relative">
                    <div id="callsLoading" class="flex justify-center py-8" style="display:none"><div class="spinner"></div></div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm" id="callsTable">
                            <thead>
                                <tr>
                                    <th class="px-3 py-2.5 text-left text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider border-b border-neutral-200 dark:border-neutral-700" data-i18n="calls.date" data-sortable>Дата</th>
                                    <th class="px-3 py-2.5 text-left text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider border-b border-neutral-200 dark:border-neutral-700" data-i18n="calls.caller" data-sortable>Звонящий</th>
                                    <th class="px-3 py-2.5 text-left text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider border-b border-neutral-200 dark:border-neutral-700" data-i18n="calls.scenario" data-sortable>Сценарий</th>
                                    <th class="px-3 py-2.5 text-left text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider border-b border-neutral-200 dark:border-neutral-700" data-i18n="calls.duration" data-sortable>Длительность</th>
                                    <th class="px-3 py-2.5 text-left text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider border-b border-neutral-200 dark:border-neutral-700" data-i18n="calls.quality" data-sortable>Качество</th>
                                    <th class="px-3 py-2.5 text-left text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider border-b border-neutral-200 dark:border-neutral-700" data-i18n="calls.cost" data-sortable>Стоимость</th>
                                    <th class="px-3 py-2.5 text-left text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider border-b border-neutral-200 dark:border-neutral-700" data-i18n="calls.status" data-sortable>Статус</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <div class="pagination flex justify-center gap-1 mt-4" id="callsPagination"></div>
                </div>
            </div>

            <!-- Prompts -->
            <div id="page-prompts" style="display:none">
                <div class="text-xs text-neutral-500 dark:text-neutral-400 mb-3"><a href="#" onclick="window._app.showPage('dashboard')" class="text-blue-600 dark:text-blue-400 hover:underline">Home</a> / <span data-i18n="nav.training">Обучение</span> / <span data-i18n="nav.prompts">Промпты</span></div>
                <h1 class="text-lg font-semibold text-neutral-900 dark:text-neutral-50 mb-4" data-i18n="nav.prompts">Промпты</h1>
                <div id="promptsContent" class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-5 mb-4"></div>
            </div>

            <!-- Knowledge (Articles + Sources) -->
            <div id="page-knowledge" style="display:none">
                <div class="text-xs text-neutral-500 dark:text-neutral-400 mb-3"><a href="#" onclick="window._app.showPage('dashboard')" class="text-blue-600 dark:text-blue-400 hover:underline">Home</a> / <span data-i18n="nav.training">Обучение</span> / <span data-i18n="nav.knowledge">База знаний</span></div>
                <h1 class="text-lg font-semibold text-neutral-900 dark:text-neutral-50 mb-4" data-i18n="nav.knowledge">База знаний</h1>
                <div class="tab-bar flex border-b border-neutral-200 dark:border-neutral-700 mb-4 flex-wrap">
                    <button class="active px-4 py-2 text-sm text-neutral-500 dark:text-neutral-400 border-b-2 border-transparent -mb-px cursor-pointer transition-colors hover:text-neutral-700 dark:hover:text-neutral-200" data-tab="articles" onclick="window._pages.knowledge.showTab('articles')" data-i18n="training.tabKnowledge">Статьи</button>
                    <button class="px-4 py-2 text-sm text-neutral-500 dark:text-neutral-400 border-b-2 border-transparent -mb-px cursor-pointer transition-colors hover:text-neutral-700 dark:hover:text-neutral-200" data-tab="source-configs" onclick="window._pages.knowledge.showTab('source-configs')" data-i18n="sources.tabConfigs">Конфигурации</button>
                    <button class="px-4 py-2 text-sm text-neutral-500 dark:text-neutral-400 border-b-2 border-transparent -mb-px cursor-pointer transition-colors hover:text-neutral-700 dark:hover:text-neutral-200" data-tab="scraper" onclick="window._pages.knowledge.showTab('scraper')" data-i18n="sources.tabScraper">Скрапер</button>
                    <button class="px-4 py-2 text-sm text-neutral-500 dark:text-neutral-400 border-b-2 border-transparent -mb-px cursor-pointer transition-colors hover:text-neutral-700 dark:hover:text-neutral-200" data-tab="watched" onclick="window._pages.knowledge.showTab('watched')" data-i18n="sources.tabWatched">Отслеживаемые</button>
                </div>

                <!-- Tab: Articles -->
                <div id="knowledgeContent-articles">
                    <div class="flex flex-wrap items-center gap-2 mb-4">
                        <select id="kbCategory" onchange="window._pages.knowledge.loadArticles(0)" class="px-2.5 py-1.5 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500 max-md:w-full">
                            <option value="" data-i18n="knowledge.allCategories">Все категории</option>
                        </select>
                        <select id="kbActive" onchange="window._pages.knowledge.loadArticles(0)" class="px-2.5 py-1.5 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500 max-md:w-full">
                            <option value="" data-i18n="knowledge.allActive">Все</option>
                            <option value="true" data-i18n="knowledge.activeOnly">Активные</option>
                            <option value="false" data-i18n="knowledge.inactiveOnly">Неактивные</option>
                        </select>
                        <input type="text" id="kbSearch" data-i18n-placeholder="knowledge.searchPlaceholder" placeholder="Поиск..."
                            onkeydown="if(event.key==='Enter')window._pages.knowledge.loadArticles(0)"
                            class="px-2.5 py-1.5 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500 max-md:w-full">
                        <button onclick="window._pages.knowledge.loadArticles(0)"
                            class="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer bg-blue-600 text-white hover:bg-blue-700 max-md:w-full" data-i18n="common.filter">Фильтровать</button>
                        <button onclick="window._pages.knowledge.showCreateArticle()"
                            class="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer bg-blue-600 text-white hover:bg-blue-700 max-md:w-full" data-i18n="knowledge.newArticle">+ Новая статья</button>
                        <button onclick="window._pages.knowledge.reindexAll()"
                            class="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer bg-emerald-600 text-white hover:bg-emerald-700 max-md:w-full" data-i18n="knowledge.reindexAll">Переиндексировать всё</button>
                        <button onclick="window._pages.knowledge.showImportModal()"
                            class="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer bg-violet-600 text-white hover:bg-violet-700 max-md:w-full" data-i18n="knowledge.importDocuments">Импорт документов</button>
                    </div>
                    <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-5 mb-4" id="articlesContainer"></div>
                    <div id="articlesPagination"></div>
                </div>

                <!-- Tab: Source Configs -->
                <div id="knowledgeContent-source-configs" style="display:none">
                    <h3 class="text-lg font-semibold text-neutral-900 dark:text-neutral-100 mb-3" data-i18n="sources.sourceConfigsTitle">Источники контента</h3>
                    <p class="text-sm text-neutral-500 dark:text-neutral-400 mb-3" data-i18n="sources.sourceConfigsHint">Внешние сайты для сбора статей в базу знаний.</p>
                    <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-5 mb-4" id="sourceConfigsContainer"></div>
                </div>

                <!-- Tab: Scraper -->
                <div id="knowledgeContent-scraper" style="display:none">
                    <h3 class="text-lg font-semibold text-neutral-900 dark:text-neutral-100 mb-3" data-i18n="sources.scraperConfigTitle">ProKoleso — ручной импорт</h3>
                    <div id="scraperConfigCard" class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-5 mb-4"></div>
                    <div class="flex flex-wrap items-center gap-2 mb-4">
                        <select id="sourcesStatusFilter" onchange="window._pages.knowledge.loadSources(0)" class="px-2.5 py-1.5 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500 max-md:w-full">
                            <option value="" data-i18n="sources.allStatuses">Все статусы</option>
                            <option value="new">new</option>
                            <option value="processing">processing</option>
                            <option value="processed">processed</option>
                            <option value="skipped">skipped</option>
                            <option value="error">error</option>
                        </select>
                        <button onclick="window._pages.knowledge.loadSources(0)"
                            class="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer bg-blue-600 text-white hover:bg-blue-700 max-md:w-full" data-i18n="common.filter">Фильтровать</button>
                    </div>
                    <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-5 mb-4" id="sourcesContainer"></div>
                    <div id="sourcesPagination"></div>
                </div>

                <!-- Tab: Watched Pages -->
                <div id="knowledgeContent-watched" style="display:none">
                    <h3 class="text-lg font-semibold text-neutral-900 dark:text-neutral-100 mb-3" data-i18n="sources.watchedPagesTitle">Отслеживаемые страницы</h3>
                    <p class="text-sm text-neutral-500 dark:text-neutral-400 mb-3" data-i18n="sources.watchedPagesHint">Страницы сайта, которые периодически пересканируются для обновления базы знаний агента.</p>
                    <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-5 mb-4" id="watchedPagesContainer"></div>
                </div>
            </div>

            <!-- Scenarios (Templates + Dialogues + Safety) -->
            <div id="page-scenarios" style="display:none">
                <div class="text-xs text-neutral-500 dark:text-neutral-400 mb-3"><a href="#" onclick="window._app.showPage('dashboard')" class="text-blue-600 dark:text-blue-400 hover:underline">Home</a> / <span data-i18n="nav.training">Обучение</span> / <span data-i18n="nav.scenarios">Сценарии</span></div>
                <h1 class="text-lg font-semibold text-neutral-900 dark:text-neutral-50 mb-4" data-i18n="nav.scenarios">Сценарии</h1>
                <div class="tab-bar flex border-b border-neutral-200 dark:border-neutral-700 mb-4 flex-wrap">
                    <button class="active px-4 py-2 text-sm text-neutral-500 dark:text-neutral-400 border-b-2 border-transparent -mb-px cursor-pointer transition-colors hover:text-neutral-700 dark:hover:text-neutral-200" data-tab="templates" onclick="window._pages.scenarios.showTab('templates')" data-i18n="training.tabTemplates">Шаблоны ответов</button>
                    <button class="px-4 py-2 text-sm text-neutral-500 dark:text-neutral-400 border-b-2 border-transparent -mb-px cursor-pointer transition-colors hover:text-neutral-700 dark:hover:text-neutral-200" data-tab="dialogues" onclick="window._pages.scenarios.showTab('dialogues')" data-i18n="training.tabDialogues">Сценарии диалогов</button>
                    <button class="px-4 py-2 text-sm text-neutral-500 dark:text-neutral-400 border-b-2 border-transparent -mb-px cursor-pointer transition-colors hover:text-neutral-700 dark:hover:text-neutral-200" data-tab="safety" onclick="window._pages.scenarios.showTab('safety')" data-i18n="training.tabSafety">Правила безопасности</button>
                </div>

                <!-- Tab: Templates -->
                <div id="scenariosContent-templates">
                    <div class="flex flex-wrap items-center gap-2 mb-4">
                        <select id="templateFilterKey" onchange="window._pages.scenarios.loadTemplates()" class="px-2.5 py-1.5 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500 max-md:w-full">
                            <option value="" data-i18n="training.allTemplateKeys">Все ключи</option>
                        </select>
                        <input type="text" id="templateSearch" data-i18n-placeholder="training.searchTemplates" placeholder="Поиск шаблонов..."
                            onkeydown="if(event.key==='Enter')window._pages.scenarios.loadTemplates()"
                            class="px-2.5 py-1.5 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500 max-md:w-full">
                        <button onclick="window._pages.scenarios.loadTemplates()"
                            class="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer bg-blue-600 text-white hover:bg-blue-700 max-md:w-full" data-i18n="common.filter">Фильтровать</button>
                    </div>
                    <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-5 mb-4" id="templatesContainer"></div>
                </div>

                <!-- Tab: Dialogues -->
                <div id="scenariosContent-dialogues" style="display:none">
                    <div class="flex flex-wrap items-center gap-2 mb-4">
                        <select id="dialogueFilterScenario" onchange="window._pages.scenarios.loadDialogues(0)" class="px-2.5 py-1.5 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500 max-md:w-full">
                            <option value="" data-i18n="training.allScenarios">Все сценарии</option>
                            <option value="tire_search">tire_search</option>
                            <option value="order_status">order_status</option>
                            <option value="order_creation">order_creation</option>
                            <option value="fitting_booking">fitting_booking</option>
                            <option value="consultation">consultation</option>
                            <option value="transfer">transfer</option>
                        </select>
                        <select id="dialogueFilterPhase" onchange="window._pages.scenarios.loadDialogues(0)" class="px-2.5 py-1.5 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500 max-md:w-full">
                            <option value="" data-i18n="training.allPhases">Все фазы</option>
                            <option value="mvp">mvp</option>
                            <option value="orders">orders</option>
                            <option value="services">services</option>
                            <option value="analytics">analytics</option>
                        </select>
                        <select id="dialogueFilterActive" onchange="window._pages.scenarios.loadDialogues(0)" class="px-2.5 py-1.5 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500 max-md:w-full">
                            <option value="" data-i18n="training.allActive">Все</option>
                            <option value="true" data-i18n="training.activeOnly">Активные</option>
                            <option value="false" data-i18n="training.inactiveOnly">Неактивные</option>
                        </select>
                        <button onclick="window._pages.scenarios.loadDialogues(0)"
                            class="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer bg-blue-600 text-white hover:bg-blue-700 max-md:w-full" data-i18n="common.filter">Фильтровать</button>
                    </div>
                    <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-5 mb-4" id="dialoguesContainer"></div>
                    <div id="dialoguesPagination"></div>
                </div>

                <!-- Tab: Safety Rules -->
                <div id="scenariosContent-safety" style="display:none">
                    <div class="flex flex-wrap items-center gap-2 mb-4">
                        <select id="safetyFilterType" onchange="window._pages.scenarios.loadSafetyRules(0)" class="px-2.5 py-1.5 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500 max-md:w-full">
                            <option value="" data-i18n="training.allRuleTypes">Все типы</option>
                            <option value="behavioral">behavioral</option>
                            <option value="content">content</option>
                            <option value="language">language</option>
                            <option value="privacy">privacy</option>
                            <option value="boundary">boundary</option>
                        </select>
                        <select id="safetyFilterSeverity" onchange="window._pages.scenarios.loadSafetyRules(0)" class="px-2.5 py-1.5 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500 max-md:w-full">
                            <option value="" data-i18n="training.allSeverities">Все</option>
                            <option value="critical">critical</option>
                            <option value="high">high</option>
                            <option value="medium">medium</option>
                            <option value="low">low</option>
                        </select>
                        <select id="safetyFilterActive" onchange="window._pages.scenarios.loadSafetyRules(0)" class="px-2.5 py-1.5 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500 max-md:w-full">
                            <option value="" data-i18n="training.allActive">Все</option>
                            <option value="true" data-i18n="training.activeOnly">Активные</option>
                            <option value="false" data-i18n="training.inactiveOnly">Неактивные</option>
                        </select>
                        <button onclick="window._pages.scenarios.loadSafetyRules(0)"
                            class="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer bg-blue-600 text-white hover:bg-blue-700 max-md:w-full" data-i18n="common.filter">Фильтровать</button>
                    </div>
                    <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-5 mb-4" id="safetyRulesContainer"></div>
                    <div id="safetyPagination"></div>
                </div>
            </div>

            <!-- Tools -->
            <div id="page-tools" style="display:none">
                <div class="text-xs text-neutral-500 dark:text-neutral-400 mb-3"><a href="#" onclick="window._app.showPage('dashboard')" class="text-blue-600 dark:text-blue-400 hover:underline">Home</a> / <span data-i18n="nav.training">Обучение</span> / <span data-i18n="nav.tools">Инструменты</span></div>
                <h1 class="text-lg font-semibold text-neutral-900 dark:text-neutral-50 mb-4" data-i18n="nav.tools">Инструменты</h1>
                <div id="toolsContent" class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-5 mb-4"></div>
            </div>

            <!-- Sandbox -->
            <div id="page-sandbox" style="display:none">
                <div class="text-xs text-neutral-500 dark:text-neutral-400 mb-3"><a href="#" onclick="window._app.showPage('dashboard')" class="text-blue-600 dark:text-blue-400 hover:underline">Home</a> / <span data-i18n="nav.training">Обучение</span> / <span data-i18n="nav.sandbox">Песочница</span></div>
                <h1 class="text-lg font-semibold text-neutral-900 dark:text-neutral-50 mb-4" data-i18n="sandbox.title">Песочница агента</h1>
                <div class="flex gap-4" style="height: calc(100vh - 140px);">
                    <!-- LEFT: Sidebar -->
                    <div class="w-72 flex-shrink-0 flex flex-col border border-neutral-200 dark:border-neutral-800 rounded-lg bg-white dark:bg-neutral-900 overflow-hidden">
                        <div class="p-3 border-b border-neutral-200 dark:border-neutral-700 space-y-2">
                            <button class="w-full inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer bg-blue-600 text-white hover:bg-blue-700" onclick="window._pages.sandbox.showNewConvModal()" data-i18n="sandbox.newConversation">+ Новый диалог</button>
                            <input type="text" id="sandboxSearch" data-i18n-placeholder="sandbox.searchPlaceholder" placeholder="Поиск по названию..."
                                onkeydown="if(event.key==='Enter')window._pages.sandbox.loadSidebar()"
                                class="w-full px-2 py-1 text-xs border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <div class="flex gap-1">
                                <select id="sandboxFilterStatus" onchange="window._pages.sandbox.loadSidebar()"
                                    class="flex-1 px-1.5 py-1 text-xs border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="" data-i18n="common.allStatuses">Все статусы</option>
                                    <option value="active" data-i18n="sandbox.active">Активный</option>
                                    <option value="archived" data-i18n="sandbox.archivedStatus">Архив</option>
                                </select>
                                <select id="sandboxFilterScenario" onchange="window._pages.sandbox.loadSidebar()"
                                    class="flex-1 px-1.5 py-1 text-xs border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="" data-i18n="common.all">Все</option>
                                    <option value="tire_search">tire_search</option>
                                    <option value="order_creation">order_creation</option>
                                    <option value="fitting_booking">fitting_booking</option>
                                    <option value="expert_consultation">expert_consultation</option>
                                    <option value="operator_transfer">operator_transfer</option>
                                </select>
                            </div>
                        </div>
                        <div id="sandboxSidebarList" class="flex-1 overflow-y-auto"></div>
                    </div>
                    <!-- RIGHT: Main area -->
                    <div class="flex-1 flex flex-col min-w-0">
                        <div class="tab-bar flex border-b border-neutral-200 dark:border-neutral-700 mb-3">
                            <button class="active px-4 py-2 text-sm text-neutral-500 dark:text-neutral-400 border-b-2 border-transparent -mb-px cursor-pointer transition-colors hover:text-neutral-700 dark:hover:text-neutral-200" data-tab="chat" onclick="window._pages.sandbox.showTab('chat')" data-i18n="sandbox.tabChat">Чат</button>
                            <button class="px-4 py-2 text-sm text-neutral-500 dark:text-neutral-400 border-b-2 border-transparent -mb-px cursor-pointer transition-colors hover:text-neutral-700 dark:hover:text-neutral-200" data-tab="regression" onclick="window._pages.sandbox.showTab('regression')" data-i18n="sandbox.tabRegression">Регрессия</button>
                            <button class="px-4 py-2 text-sm text-neutral-500 dark:text-neutral-400 border-b-2 border-transparent -mb-px cursor-pointer transition-colors hover:text-neutral-700 dark:hover:text-neutral-200" data-tab="patterns" onclick="window._pages.sandbox.showTab('patterns')" data-i18n="sandbox.patterns">Паттерны</button>
                        </div>
                        <div id="sandboxContent-chat" class="flex-1 overflow-hidden">
                            <div id="sandboxChatContainer" class="h-full bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-5 overflow-y-auto"></div>
                        </div>
                        <div id="sandboxContent-regression" style="display:none" class="flex-1 overflow-auto">
                            <div id="sandboxRegressionContainer" class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-5"></div>
                        </div>
                        <div id="sandboxContent-patterns" style="display:none" class="flex-1 overflow-auto">
                            <div id="sandboxPatternsContainer" class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-5"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- New Conversation Modal -->
            <div class="modal-overlay" id="sandboxNewConvModal">
                <div class="modal-content max-w-md">
                    <span class="float-right cursor-pointer text-lg text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-200 transition-colors leading-none" onclick="window._app.closeModal('sandboxNewConvModal')">&times;</span>
                    <h3 class="text-base font-semibold text-neutral-900 dark:text-neutral-50 mb-4" data-i18n="sandbox.newConversation">Новый диалог</h3>
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="sandbox.conversationTitle">Название</label>
                        <input type="text" id="sandboxConvTitle" class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="sandbox.promptVersion">Версия промпта</label>
                        <select id="sandboxConvPrompt" class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="" data-i18n="sandbox.promptVersionDefault">Активная версия</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="sandbox.model">Модель</label>
                        <select id="sandboxConvModel" class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="" data-i18n="sandbox.modelDefault">По умолчанию</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="sandbox.toolMode">Режим инструментов</label>
                        <select id="sandboxConvToolMode" class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="mock" data-i18n="sandbox.toolModeMock">Мок (тестовые данные)</option>
                            <option value="live" data-i18n="sandbox.toolModeLive">Живой (Store API)</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="sandbox.scenarioType">Тип сценария</label>
                        <select id="sandboxConvScenario" class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="" data-i18n="sandbox.scenarioNone">Без типа</option>
                            <option value="tire_search">tire_search</option>
                            <option value="order_creation">order_creation</option>
                            <option value="fitting_booking">fitting_booking</option>
                            <option value="expert_consultation">expert_consultation</option>
                            <option value="operator_transfer">operator_transfer</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="sandbox.tags">Теги</label>
                        <input type="text" id="sandboxConvTags" placeholder="tag1, tag2" class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <button onclick="window._pages.sandbox.createConversation()" class="w-full py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 transition-colors cursor-pointer" data-i18n="sandbox.createConversation">Создать диалог</button>
                </div>
            </div>

            <!-- Turn Group Modal -->
            <div class="modal-overlay" id="sandboxGroupModal">
                <div class="modal-content max-w-md">
                    <span class="float-right cursor-pointer text-lg text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-200 transition-colors leading-none" onclick="window._app.closeModal('sandboxGroupModal')">&times;</span>
                    <h3 class="text-base font-semibold text-neutral-900 dark:text-neutral-50 mb-4" data-i18n="sandbox.createGroup">Создать группу</h3>
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="sandbox.intentLabel">Интент</label>
                        <input type="text" id="sandboxGroupIntent" placeholder="tire_search_clarification" class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="sandbox.patternType">Тип паттерна</label>
                        <select id="sandboxGroupType" onchange="document.getElementById('sandboxGroupCorrectionWrap').style.display=this.value==='negative'?'block':'none'" class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="positive">Positive</option>
                            <option value="negative">Negative</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="sandbox.avgRating">Оценка</label>
                        <select id="sandboxGroupRating" class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">-</option>
                            <option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="sandbox.rateComment">Комментарий</label>
                        <textarea id="sandboxGroupComment" rows="2" class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>
                    <div class="mb-3" id="sandboxGroupCorrectionWrap" style="display:none">
                        <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="sandbox.correction">Исправление</label>
                        <textarea id="sandboxGroupCorrection" rows="3" placeholder="" data-i18n-placeholder="sandbox.correctionHint" class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="sandbox.tags">Теги</label>
                        <input type="text" id="sandboxGroupTags" placeholder="tag1, tag2" class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <button onclick="window._pages.sandbox.submitGroup()" class="w-full py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 transition-colors cursor-pointer" data-i18n="sandbox.createGroup">Создать группу</button>
                </div>
            </div>

            <!-- Export Pattern Modal -->
            <div class="modal-overlay" id="sandboxExportModal">
                <div class="modal-content max-w-md">
                    <span class="float-right cursor-pointer text-lg text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-200 transition-colors leading-none" onclick="window._app.closeModal('sandboxExportModal')">&times;</span>
                    <h3 class="text-base font-semibold text-neutral-900 dark:text-neutral-50 mb-4" data-i18n="sandbox.exportToPatterns">Экспорт в паттерны</h3>
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="sandbox.guidanceNote">Инструкция для промпта</label>
                        <textarea id="sandboxExportGuidance" rows="4" placeholder="" data-i18n-placeholder="sandbox.guidanceHint" class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>
                    <input type="hidden" id="sandboxExportGroupId">
                    <button onclick="window._pages.sandbox.submitExport()" class="w-full py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 transition-colors cursor-pointer" data-i18n="sandbox.exportToPatterns">Экспорт в паттерны</button>
                </div>
            </div>

            <!-- Operators -->
            <div id="page-operators" style="display:none">
                <div class="text-xs text-neutral-500 dark:text-neutral-400 mb-3"><a href="#" onclick="window._app.showPage('dashboard')" class="text-blue-600 dark:text-blue-400 hover:underline">Home</a> / <span data-i18n="operators.breadcrumb">Операторы</span></div>
                <h1 class="text-lg font-semibold text-neutral-900 dark:text-neutral-50 mb-4" data-i18n="operators.title">Операторы</h1>
                <div class="grid grid-cols-[repeat(auto-fill,minmax(180px,1fr))] gap-4 mb-6 max-md:grid-cols-2 max-[480px]:grid-cols-1" id="operatorQueueStats"></div>
                <div class="flex flex-wrap items-center gap-2 mb-4">
                    <input type="text" id="operatorSearch" data-i18n-placeholder="operators.searchPlaceholder" placeholder="Поиск по имени/номеру..."
                        onkeydown="if(event.key==='Enter')window._pages.operators.loadOperators()"
                        class="px-2.5 py-1.5 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500 max-md:w-full">
                    <select id="operatorFilterStatus" onchange="window._pages.operators.loadOperators()" class="px-2.5 py-1.5 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500 max-md:w-full">
                        <option value="" data-i18n="operators.allStatuses">Все статусы</option>
                        <option value="online">online</option>
                        <option value="offline">offline</option>
                        <option value="busy">busy</option>
                        <option value="break">break</option>
                    </select>
                    <button onclick="window._pages.operators.showCreateOperator()"
                        class="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer bg-blue-600 text-white hover:bg-blue-700 max-md:w-full" data-i18n="operators.newOperator">+ Новый оператор</button>
                </div>
                <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-5 mb-4 relative">
                    <div id="operatorsLoading" class="flex justify-center py-8" style="display:none"><div class="spinner"></div></div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm" id="operatorsTable">
                            <thead>
                                <tr>
                                    <th class="px-3 py-2.5 text-left text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider border-b border-neutral-200 dark:border-neutral-700" data-i18n="operators.name" data-sortable>Имя</th>
                                    <th class="px-3 py-2.5 text-left text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider border-b border-neutral-200 dark:border-neutral-700" data-i18n="operators.extension" data-sortable>Внутр. номер</th>
                                    <th class="px-3 py-2.5 text-left text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider border-b border-neutral-200 dark:border-neutral-700" data-i18n="operators.status" data-sortable>Статус</th>
                                    <th class="px-3 py-2.5 text-left text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider border-b border-neutral-200 dark:border-neutral-700" data-i18n="operators.skills">Навыки</th>
                                    <th class="px-3 py-2.5 text-left text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider border-b border-neutral-200 dark:border-neutral-700" data-i18n="operators.shift" data-sortable>Смена</th>
                                    <th class="px-3 py-2.5 text-left text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider border-b border-neutral-200 dark:border-neutral-700" data-i18n="operators.activeCol" data-sortable>Активен</th>
                                    <th class="px-3 py-2.5 text-left text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider border-b border-neutral-200 dark:border-neutral-700" data-i18n="operators.actionsCol">Действия</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Monitoring -->
            <div id="page-monitoring" style="display:none">
                <div class="text-xs text-neutral-500 dark:text-neutral-400 mb-3"><a href="#" onclick="window._app.showPage('dashboard')" class="text-blue-600 dark:text-blue-400 hover:underline">Home</a> / <span data-i18n="nav.system">Система</span> / <span data-i18n="nav.monitoring">Мониторинг</span></div>
                <h1 class="text-lg font-semibold text-neutral-900 dark:text-neutral-50 mb-4" data-i18n="nav.monitoring">Мониторинг</h1>
                <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-5 mb-4">
                    <h3 class="text-sm font-semibold text-neutral-900 dark:text-neutral-50 mb-3" data-i18n="settings.healthCheck">Проверка здоровья</h3>
                    <div id="systemInfo"><div class="flex justify-center py-8"><div class="spinner"></div></div></div>
                    <button class="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer bg-blue-600 text-white hover:bg-blue-700 mt-3" onclick="window._pages.monitoring.loadSettings()" data-i18n="settings.refresh">Обновить</button>
                </div>
                <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-5 mb-4 admin-only">
                    <h3 class="text-sm font-semibold text-neutral-900 dark:text-neutral-50 mb-3" data-i18n="settings.extendedStatus">Расширенный статус</h3>
                    <div id="extendedStatus"><div class="text-center py-8 text-neutral-400 dark:text-neutral-500 text-sm" data-i18n="settings.clickToLoad">Нажмите для загрузки</div></div>
                    <button class="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer bg-blue-600 text-white hover:bg-blue-700 mt-3" onclick="window._pages.monitoring.loadSystemStatus()" data-i18n="settings.loadStatus">Загрузить статус</button>
                </div>
                <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-5 mb-4">
                    <h3 class="text-sm font-semibold text-neutral-900 dark:text-neutral-50 mb-3" data-i18n="settings.externalTools">Внешние инструменты</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <tr class="hover:bg-neutral-50 dark:hover:bg-neutral-800/50 transition-colors"><td class="px-3 py-2.5 border-b border-neutral-100 dark:border-neutral-800 text-neutral-700 dark:text-neutral-300">Grafana</td><td class="px-3 py-2.5 border-b border-neutral-100 dark:border-neutral-800"><a href="http://localhost:3000" target="_blank" class="text-blue-600 dark:text-blue-400 hover:underline" data-i18n="settings.openGrafana">Открыть Grafana</a></td></tr>
                            <tr class="hover:bg-neutral-50 dark:hover:bg-neutral-800/50 transition-colors"><td class="px-3 py-2.5 border-b border-neutral-100 dark:border-neutral-800 text-neutral-700 dark:text-neutral-300">Prometheus</td><td class="px-3 py-2.5 border-b border-neutral-100 dark:border-neutral-800"><a href="http://localhost:9090" target="_blank" class="text-blue-600 dark:text-blue-400 hover:underline" data-i18n="settings.openPrometheus">Открыть Prometheus</a></td></tr>
                            <tr class="hover:bg-neutral-50 dark:hover:bg-neutral-800/50 transition-colors"><td class="px-3 py-2.5 border-b border-neutral-100 dark:border-neutral-800 text-neutral-700 dark:text-neutral-300">Flower (Celery)</td><td class="px-3 py-2.5 border-b border-neutral-100 dark:border-neutral-800"><a href="http://localhost:5555" target="_blank" class="text-blue-600 dark:text-blue-400 hover:underline" data-i18n="settings.openFlower">Открыть Flower</a></td></tr>
                        </table>
                    </div>
                </div>
                <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-5 mb-4">
                    <h3 class="text-sm font-semibold text-neutral-900 dark:text-neutral-50 mb-3" data-i18n="settings.appInfo">Информация о приложении</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <tr><td class="px-3 py-2.5 border-b border-neutral-100 dark:border-neutral-800 text-neutral-700 dark:text-neutral-300" data-i18n="settings.version">Версия</td><td class="px-3 py-2.5 border-b border-neutral-100 dark:border-neutral-800 text-neutral-700 dark:text-neutral-300">v0.1.0</td></tr>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Configuration -->
            <div id="page-configuration" style="display:none">
                <div class="text-xs text-neutral-500 dark:text-neutral-400 mb-3"><a href="#" onclick="window._app.showPage('dashboard')" class="text-blue-600 dark:text-blue-400 hover:underline">Home</a> / <span data-i18n="nav.system">Система</span> / <span data-i18n="nav.configuration">Конфигурация</span></div>
                <h1 class="text-lg font-semibold text-neutral-900 dark:text-neutral-50 mb-4" data-i18n="nav.configuration">Конфигурация</h1>
                <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-5 mb-4 admin-only">
                    <h3 class="text-sm font-semibold text-neutral-900 dark:text-neutral-50 mb-3" data-i18n="settings.configuration">Конфигурация</h3>
                    <p class="text-sm text-neutral-500 dark:text-neutral-400 mb-3" data-i18n="settings.configDescription">Перезагрузить безопасные параметры конфигурации (качество, фича-флаги, логирование) без перезапуска.</p>
                    <button class="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer bg-blue-600 text-white hover:bg-blue-700" onclick="window._pages.configuration.reloadConfig()" data-i18n="settings.reloadConfig">Перезагрузить конфиг</button>
                </div>
                <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-5 mb-4 admin-only">
                    <h3 class="text-sm font-semibold text-neutral-900 dark:text-neutral-50 mb-3" data-i18n="settings.llmRouting">Маршрутизация LLM</h3>
                    <p class="text-sm text-neutral-500 dark:text-neutral-400 mb-3" data-i18n="settings.llmRoutingDesc">Мультипровайдерный роутинг LLM: управление провайдерами, задачами и fallback-цепочками.</p>
                    <div id="llmProvidersContainer"><div class="text-center py-4 text-neutral-400 dark:text-neutral-500 text-sm" data-i18n="settings.clickToLoad">Нажмите для загрузки</div></div>
                    <div id="llmTasksContainer" class="mt-4"></div>
                    <button class="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer bg-blue-600 text-white hover:bg-blue-700 mt-3" onclick="window._pages.configuration.loadLLMConfig()" data-i18n="settings.llmLoadConfig">Загрузить конфигурацию</button>
                </div>
            </div>

            <!-- Notifications -->
            <div id="page-notifications" style="display:none">
                <div class="text-xs text-neutral-500 dark:text-neutral-400 mb-3"><a href="#" onclick="window._app.showPage('dashboard')" class="text-blue-600 dark:text-blue-400 hover:underline">Home</a> / <span data-i18n="nav.system">Система</span> / <span data-i18n="nav.notifications">Уведомления</span></div>
                <h1 class="text-lg font-semibold text-neutral-900 dark:text-neutral-50 mb-4" data-i18n="nav.notifications">Уведомления</h1>
                <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-5 mb-4 admin-only">
                    <h3 class="text-sm font-semibold text-neutral-900 dark:text-neutral-50 mb-3" data-i18n="settings.telegram">Уведомления Telegram</h3>
                    <p class="text-sm text-neutral-500 dark:text-neutral-400 mb-3" data-i18n="settings.telegramDesc">Настройка Telegram-бота для получения алертов от Alertmanager.</p>
                    <div id="telegramConfigContainer"><div class="text-center py-4 text-neutral-400 dark:text-neutral-500 text-sm" data-i18n="settings.clickToLoad">Нажмите для загрузки</div></div>
                </div>
            </div>

            <!-- Users -->
            <div id="page-users" style="display:none">
                <div class="text-xs text-neutral-500 dark:text-neutral-400 mb-3"><a href="#" onclick="window._app.showPage('dashboard')" class="text-blue-600 dark:text-blue-400 hover:underline">Home</a> / <span data-i18n="users.breadcrumb">Пользователи</span></div>
                <h1 class="text-lg font-semibold text-neutral-900 dark:text-neutral-50 mb-4" data-i18n="users.title">Управление пользователями</h1>
                <div class="flex flex-wrap items-center gap-2 mb-4">
                    <button onclick="window._pages.users.showCreateUser()"
                        class="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer bg-blue-600 text-white hover:bg-blue-700 max-md:w-full" data-i18n="users.newUser">+ Новый пользователь</button>
                </div>
                <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-5 mb-4" id="usersContainer">
                    <div class="flex justify-center py-8"><div class="spinner"></div></div>
                </div>
            </div>

            <!-- Audit Log -->
            <div id="page-audit" style="display:none">
                <div class="text-xs text-neutral-500 dark:text-neutral-400 mb-3"><a href="#" onclick="window._app.showPage('dashboard')" class="text-blue-600 dark:text-blue-400 hover:underline">Home</a> / <span data-i18n="audit.breadcrumb">Аудит</span></div>
                <h1 class="text-lg font-semibold text-neutral-900 dark:text-neutral-50 mb-4" data-i18n="audit.title">Журнал аудита</h1>
                <div class="flex flex-wrap items-center gap-2 mb-4">
                    <input type="date" id="auditDateFrom" onchange="window._pages.audit.loadAuditLog()" class="px-2.5 py-1.5 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500 max-md:w-full">
                    <input type="date" id="auditDateTo" onchange="window._pages.audit.loadAuditLog()" class="px-2.5 py-1.5 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500 max-md:w-full">
                    <select id="auditAction" onchange="window._pages.audit.loadAuditLog()" class="px-2.5 py-1.5 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500 max-md:w-full">
                        <option value="" data-i18n="audit.allActions">Все действия</option>
                        <option value="POST">POST</option>
                        <option value="PATCH">PATCH</option>
                        <option value="DELETE">DELETE</option>
                    </select>
                    <button onclick="window._pages.audit.loadAuditLog()"
                        class="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer bg-blue-600 text-white hover:bg-blue-700 max-md:w-full" data-i18n="common.filter">Фильтровать</button>
                </div>
                <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-5 mb-4" id="auditContainer">
                    <div class="flex justify-center py-8"><div class="spinner"></div></div>
                </div>
                <div class="pagination flex justify-center gap-1 mt-4" id="auditPagination"></div>
            </div>

            <!-- Vehicles -->
            <div id="page-vehicles" style="display:none">
                <div class="text-xs text-neutral-500 dark:text-neutral-400 mb-3">
                    <a href="#" onclick="window._app.showPage('dashboard')" class="text-blue-600 dark:text-blue-400 hover:underline">Home</a> /
                    <span data-i18n="vehicles.breadcrumb">База авто</span>
                </div>
                <h1 class="text-lg font-semibold text-neutral-900 dark:text-neutral-50 mb-4" data-i18n="vehicles.title">База автомобилей</h1>
                <div id="vehiclesStats" class="grid grid-cols-[repeat(auto-fill,minmax(180px,1fr))] gap-4 mb-6 max-md:grid-cols-2 max-[480px]:grid-cols-1"></div>
                <div class="flex flex-wrap items-center gap-2 mb-4">
                    <input type="text" id="vehiclesSearch" placeholder="Поиск по названию..."
                        onkeydown="if(event.key==='Enter')window._pages.vehicles.search()"
                        class="px-2.5 py-1.5 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500 max-md:w-full"
                        data-i18n-placeholder="vehicles.searchPlaceholder">
                    <button onclick="window._pages.vehicles.search()"
                        class="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer bg-blue-600 text-white hover:bg-blue-700 max-md:w-full" data-i18n="common.search">Поиск</button>
                    <button onclick="window._pages.vehicles.openImportModal()"
                        class="admin-only inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer bg-violet-600 text-white hover:bg-violet-700 max-md:w-full" data-i18n="vehicles.importButton">Обновить БД</button>
                </div>
                <div id="vehiclesBreadcrumb" class="text-xs text-neutral-500 dark:text-neutral-400 mb-3" style="display:none"></div>
                <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-5 mb-4" id="vehiclesContainer">
                    <div class="flex justify-center py-8"><div class="spinner"></div></div>
                </div>
                <div class="pagination flex justify-center gap-1 mt-4" id="vehiclesPagination"></div>
            </div>
        </div>
    </div>

    <!-- Vehicle Import Modal -->
    <div class="modal-overlay fixed inset-0 bg-black/50 z-[100] justify-center items-center" id="vehicleImportModal">
        <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-xl p-6 max-w-[700px] w-[90%] max-h-[80vh] overflow-y-auto max-md:w-[95%]">
            <span class="float-right cursor-pointer text-lg text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-200 transition-colors leading-none" onclick="window._app.closeModal('vehicleImportModal')">&times;</span>
            <h2 class="text-base font-semibold text-neutral-900 dark:text-neutral-50 mb-4" data-i18n="vehicles.importTitle">Обновление базы автомобилей</h2>
            <div class="mb-3 p-3 bg-neutral-50 dark:bg-neutral-800 rounded-md text-sm text-neutral-600 dark:text-neutral-400">
                <p class="mb-2 font-medium text-neutral-700 dark:text-neutral-300" data-i18n="vehicles.importInstructions">Разместите 4 CSV-файла в директории на сервере:</p>
                <ul class="list-disc ml-5 mb-2 space-y-0.5 font-mono text-xs">
                    <li>test_table_car2_brand.csv</li>
                    <li>test_table_car2_model.csv</li>
                    <li>test_table_car2_kit.csv <span class="text-neutral-400">(latin-1)</span></li>
                    <li>test_table_car2_kit_tyre_size.csv</li>
                </ul>
                <p class="text-xs text-neutral-500 dark:text-neutral-500" data-i18n="vehicles.importWarning">Импорт удалит текущие данные и загрузит новые. Операция занимает ~30-60 секунд.</p>
            </div>
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="vehicles.importPathLabel">Путь к директории с CSV</label>
                <input type="text" id="vehicleImportPath" placeholder="/path/to/csv/files"
                    class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <button class="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer bg-violet-600 text-white hover:bg-violet-700"
                id="vehicleImportBtn" onclick="window._pages.vehicles.runImport()" data-i18n="vehicles.importBtn">Импортировать</button>
        </div>
    </div>

    <!-- Create User Modal -->
    <div class="modal-overlay fixed inset-0 bg-black/50 z-[100] justify-center items-center" id="createUserModal">
        <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-xl p-6 max-w-[700px] w-[90%] max-h-[80vh] overflow-y-auto max-md:w-[95%]">
            <span class="float-right cursor-pointer text-lg text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-200 transition-colors leading-none" onclick="window._app.closeModal('createUserModal')">&times;</span>
            <h2 class="text-base font-semibold text-neutral-900 dark:text-neutral-50 mb-4" data-i18n="users.createTitle">Создание нового пользователя</h2>
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="users.usernameLabel">Имя пользователя</label>
                <input type="text" id="newUsername" data-i18n-placeholder="users.usernamePlaceholder" placeholder="имя пользователя"
                    class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="users.passwordLabel">Пароль</label>
                <input type="password" id="newPassword" data-i18n-placeholder="users.passwordPlaceholder" placeholder="пароль"
                    class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="users.roleLabel">Роль</label>
                <select id="newRole"
                    class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="operator" data-i18n="users.roleOperator">Оператор</option>
                    <option value="analyst" data-i18n="users.roleAnalyst">Аналитик</option>
                    <option value="admin" data-i18n="users.roleAdmin">Админ</option>
                </select>
            </div>
            <button class="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer bg-blue-600 text-white hover:bg-blue-700" onclick="window._pages.users.createUser()" data-i18n="common.create">Создать</button>
        </div>
    </div>

    <!-- Call Detail Modal -->
    <div class="modal-overlay fixed inset-0 bg-black/50 z-[100] justify-center items-center" id="callModal">
        <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-xl p-6 max-w-[700px] w-[90%] max-h-[80vh] overflow-y-auto max-md:w-[95%]">
            <span class="float-right cursor-pointer text-lg text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-200 transition-colors leading-none" onclick="window._pages.calls.closeCallModal()">&times;</span>
            <h2 class="text-base font-semibold text-neutral-900 dark:text-neutral-50 mb-4" data-i18n="calls.detailTitle">Детали звонка</h2>
            <div id="callDetailContent"></div>
        </div>
    </div>

    <!-- Create Prompt Modal -->
    <div class="modal-overlay fixed inset-0 bg-black/50 z-[100] justify-center items-center" id="createPromptModal">
        <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-xl p-6 max-w-[700px] w-[90%] max-h-[80vh] overflow-y-auto max-md:w-[95%]">
            <span class="float-right cursor-pointer text-lg text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-200 transition-colors leading-none" onclick="window._app.closeModal('createPromptModal')">&times;</span>
            <h2 id="createPromptModalTitle" class="text-base font-semibold text-neutral-900 dark:text-neutral-50 mb-4" data-i18n="prompts.createTitle">Создание новой версии промпта</h2>
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="prompts.nameLabel">Название</label>
                <input type="text" id="promptName" data-i18n-placeholder="prompts.namePlaceholder" placeholder="напр. v2.0-improved-search"
                    class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div class="mb-3">
                <div class="flex items-center justify-between mb-1">
                    <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300" data-i18n="prompts.systemPromptLabel">Системный промпт</label>
                    <button id="loadDefaultBtn" class="inline-flex items-center px-2 py-1 text-xs font-medium rounded transition-colors cursor-pointer bg-neutral-500 text-white hover:bg-neutral-600 dark:bg-neutral-600 dark:hover:bg-neutral-500" onclick="window._pages.prompts.loadDefaultPrompt()" data-i18n="prompts.loadDefault">Загрузить системный</button>
                </div>
                <textarea id="promptSystemPrompt" data-i18n-placeholder="prompts.systemPromptPlaceholder" placeholder="Введите текст системного промпта..."
                    class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500 min-h-30 font-mono resize-y"></textarea>
            </div>
            <button id="createPromptBtn" class="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer bg-blue-600 text-white hover:bg-blue-700" onclick="window._pages.prompts.createPrompt()" data-i18n="common.create">Создать</button>
        </div>
    </div>

    <!-- Create A/B Test Modal -->
    <div class="modal-overlay fixed inset-0 bg-black/50 z-[100] justify-center items-center" id="createABTestModal">
        <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-xl p-6 max-w-[500px] w-[90%] max-h-[80vh] overflow-y-auto max-md:w-[95%]">
            <span class="float-right cursor-pointer text-lg text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-200 transition-colors leading-none" onclick="window._app.closeModal('createABTestModal')">&times;</span>
            <h2 class="text-base font-semibold text-neutral-900 dark:text-neutral-50 mb-4" data-i18n="prompts.createABTestTitle">Создание A/B-теста</h2>
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="prompts.testNameLabel">Название теста</label>
                <input type="text" id="abTestName" placeholder="напр. test-v3-vs-v4"
                    class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="prompts.variantALabel">Вариант A</label>
                <select id="abVariantA"
                    class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </select>
            </div>
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="prompts.variantBLabel">Вариант B</label>
                <select id="abVariantB"
                    class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </select>
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="prompts.trafficSplitLabel">Разделение трафика (% вариант A)</label>
                <div class="flex items-center gap-3">
                    <input type="range" id="abTrafficSplit" min="10" max="90" value="50" step="5"
                        oninput="document.getElementById('abTrafficSplitValue').textContent = this.value + '%'"
                        class="flex-1 accent-blue-600">
                    <span id="abTrafficSplitValue" class="text-sm font-medium text-neutral-700 dark:text-neutral-300 w-10 text-right">50%</span>
                </div>
            </div>
            <button class="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer bg-blue-600 text-white hover:bg-blue-700" onclick="window._pages.prompts.createABTest()" data-i18n="common.create">Создать</button>
        </div>
    </div>

    <!-- A/B Test Report Modal -->
    <div class="modal-overlay fixed inset-0 bg-black/50 z-[100] justify-center items-center" id="abReportModal">
        <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-xl p-6 max-w-[900px] w-[90%] max-h-[80vh] overflow-y-auto max-md:w-[95%]">
            <span class="float-right cursor-pointer text-lg text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-200 transition-colors leading-none" onclick="window._app.closeModal('abReportModal')">&times;</span>
            <h2 class="text-base font-semibold text-neutral-900 dark:text-neutral-50 mb-4" id="abReportModalTitle" data-i18n="prompts.abReportTitle">Отчёт A/B-теста</h2>
            <div id="abReportContent"></div>
        </div>
    </div>

    <!-- Create/Edit Article Modal -->
    <div class="modal-overlay fixed inset-0 bg-black/50 z-[100] justify-center items-center" id="createArticleModal">
        <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-xl p-6 max-w-[700px] w-[90%] max-h-[80vh] overflow-y-auto max-md:w-[95%]">
            <span class="float-right cursor-pointer text-lg text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-200 transition-colors leading-none" onclick="window._app.closeModal('createArticleModal')">&times;</span>
            <h2 class="text-base font-semibold text-neutral-900 dark:text-neutral-50 mb-4" id="articleModalTitle" data-i18n="knowledge.newArticleTitle">Новая статья</h2>
            <input type="hidden" id="editArticleId">
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="knowledge.titleLabel">Название</label>
                <input type="text" id="articleTitle" data-i18n-placeholder="knowledge.titlePlaceholder" placeholder="Название статьи"
                    class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="knowledge.categoryLabel">Категория</label>
                <select id="articleCategory"
                    class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </select>
            </div>
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="knowledge.contentLabel">Содержание (Markdown)</label>
                <textarea id="articleContent" data-i18n-placeholder="knowledge.contentPlaceholder" placeholder="Содержание статьи в формате Markdown..."
                    class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500 min-h-30 font-mono resize-y"></textarea>
            </div>
            <button class="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer bg-blue-600 text-white hover:bg-blue-700" onclick="window._pages.knowledge.saveArticle()" data-i18n="common.save">Сохранить</button>
        </div>
    </div>

    <!-- Create/Edit Operator Modal -->
    <div class="modal-overlay fixed inset-0 bg-black/50 z-[100] justify-center items-center" id="operatorModal">
        <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-xl p-6 max-w-[700px] w-[90%] max-h-[80vh] overflow-y-auto max-md:w-[95%]">
            <span class="float-right cursor-pointer text-lg text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-200 transition-colors leading-none" onclick="window._app.closeModal('operatorModal')">&times;</span>
            <h2 class="text-base font-semibold text-neutral-900 dark:text-neutral-50 mb-4" id="operatorModalTitle" data-i18n="operators.newOperatorTitle">Новый оператор</h2>
            <input type="hidden" id="editOperatorId">
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="operators.nameLabel">Имя</label>
                <input type="text" id="operatorName" data-i18n-placeholder="operators.namePlaceholder" placeholder="ФИО"
                    class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="operators.extensionLabel">Внутр. номер (SIP)</label>
                <input type="text" id="operatorExtension" data-i18n-placeholder="operators.extensionPlaceholder" placeholder="напр. 101"
                    class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="operators.skillsLabel">Навыки (через запятую)</label>
                <input type="text" id="operatorSkills" data-i18n-placeholder="operators.skillsPlaceholder" placeholder="шины, заказы, шиномонтаж"
                    class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="operators.shiftStartLabel">Начало смены</label>
                <input type="time" id="operatorShiftStart" value="09:00"
                    class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="operators.shiftEndLabel">Конец смены</label>
                <input type="time" id="operatorShiftEnd" value="18:00"
                    class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <button class="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer bg-blue-600 text-white hover:bg-blue-700" onclick="window._pages.operators.saveOperator()" data-i18n="common.save">Сохранить</button>
        </div>
    </div>

    <!-- Import Documents Modal -->
    <div class="modal-overlay fixed inset-0 bg-black/50 z-[100] justify-center items-center" id="importDocumentsModal">
        <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-xl p-6 max-w-[700px] w-[90%] max-h-[80vh] overflow-y-auto max-md:w-[95%]">
            <span class="float-right cursor-pointer text-lg text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-200 transition-colors leading-none" onclick="window._app.closeModal('importDocumentsModal')">&times;</span>
            <h2 class="text-base font-semibold text-neutral-900 dark:text-neutral-50 mb-4" data-i18n="knowledge.importTitle">Импорт документов</h2>
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="knowledge.importFilesLabel">Файлы (MD, PDF, DOCX)</label>
                <input type="file" id="importFiles" multiple accept=".md,.markdown,.pdf,.docx"
                    class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="knowledge.importCategoryLabel">Категория (необязательно, авто-определение если пусто)</label>
                <select id="importCategory"
                    class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="" data-i18n="knowledge.importAutoDetect">Авто-определение по имени файла</option>
                </select>
            </div>
            <button class="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer bg-violet-600 text-white hover:bg-violet-700" onclick="window._pages.knowledge.importDocuments()" data-i18n="knowledge.importBtn">Импортировать</button>
        </div>
    </div>

    <!-- Dialogue Example Modal -->
    <div class="modal-overlay fixed inset-0 bg-black/50 z-[100] justify-center items-center" id="dialogueModal">
        <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-xl p-6 max-w-[700px] w-[90%] max-h-[80vh] overflow-y-auto max-md:w-[95%]">
            <span class="float-right cursor-pointer text-lg text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-200 transition-colors leading-none" onclick="window._app.closeModal('dialogueModal')">&times;</span>
            <h2 class="text-base font-semibold text-neutral-900 dark:text-neutral-50 mb-4" id="dialogueModalTitle" data-i18n="training.newDialogue">Новый сценарий</h2>
            <input type="hidden" id="editDialogueId">
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="training.dialogueTitle">Название</label>
                <input type="text" id="dialogueTitle" data-i18n-placeholder="training.dialogueTitlePlaceholder" placeholder="Название сценария"
                    class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="training.scenario">Тип сценария</label>
                <select id="dialogueScenarioType"
                    class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="tire_search">tire_search</option>
                    <option value="availability_check">availability_check</option>
                    <option value="order_creation">order_creation</option>
                    <option value="order_status">order_status</option>
                    <option value="fitting_booking">fitting_booking</option>
                    <option value="expert_consultation">expert_consultation</option>
                    <option value="operator_transfer">operator_transfer</option>
                </select>
            </div>
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="training.phase">Фаза</label>
                <select id="dialoguePhase"
                    class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="mvp">mvp</option>
                    <option value="orders">orders</option>
                    <option value="services">services</option>
                </select>
            </div>
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="training.dialogueJSON">Диалог (JSON)</label>
                <textarea id="dialogueJSON" placeholder='[{"role": "customer", "text": "..."}, ...]'
                    class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500 min-h-30 font-mono resize-y"></textarea>
            </div>
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="training.description">Описание</label>
                <input type="text" id="dialogueDescription"
                    class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <button class="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer bg-blue-600 text-white hover:bg-blue-700" onclick="window._pages.scenarios.saveDialogue()" data-i18n="common.save">Сохранить</button>
        </div>
    </div>

    <!-- Safety Rule Modal -->
    <div class="modal-overlay fixed inset-0 bg-black/50 z-[100] justify-center items-center" id="safetyRuleModal">
        <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-xl p-6 max-w-[700px] w-[90%] max-h-[80vh] overflow-y-auto max-md:w-[95%]">
            <span class="float-right cursor-pointer text-lg text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-200 transition-colors leading-none" onclick="window._app.closeModal('safetyRuleModal')">&times;</span>
            <h2 class="text-base font-semibold text-neutral-900 dark:text-neutral-50 mb-4" id="safetyRuleModalTitle" data-i18n="training.newSafetyRule">Новое правило</h2>
            <input type="hidden" id="editSafetyRuleId">
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="training.ruleTitle">Название</label>
                <input type="text" id="safetyRuleTitle"
                    class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="training.ruleType">Тип правила</label>
                <select id="safetyRuleType"
                    class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="prompt_injection">prompt_injection</option>
                    <option value="data_validation">data_validation</option>
                    <option value="off_topic">off_topic</option>
                    <option value="language">language</option>
                    <option value="behavioral">behavioral</option>
                    <option value="escalation">escalation</option>
                </select>
            </div>
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="training.severity">Серьёзность</label>
                <select id="safetyRuleSeverity"
                    class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="low">low</option>
                    <option value="medium" selected>medium</option>
                    <option value="high">high</option>
                    <option value="critical">critical</option>
                </select>
            </div>
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="training.triggerInput">Триггер (ввод клиента)</label>
                <textarea id="safetyTriggerInput"
                    class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500 min-h-20 resize-y"></textarea>
            </div>
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="training.expectedBehavior">Ожидаемое поведение</label>
                <textarea id="safetyExpectedBehavior"
                    class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500 min-h-20 resize-y"></textarea>
            </div>
            <button class="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer bg-blue-600 text-white hover:bg-blue-700" onclick="window._pages.scenarios.saveSafetyRule()" data-i18n="common.save">Сохранить</button>
        </div>
    </div>

    <!-- Response Template Modal -->
    <div class="modal-overlay fixed inset-0 bg-black/50 z-[100] justify-center items-center" id="responseTemplateModal">
        <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-xl p-6 max-w-[700px] w-[90%] max-h-[80vh] overflow-y-auto max-md:w-[95%]">
            <span class="float-right cursor-pointer text-lg text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-200 transition-colors leading-none" onclick="window._app.closeModal('responseTemplateModal')">&times;</span>
            <h2 class="text-base font-semibold text-neutral-900 dark:text-neutral-50 mb-4" id="templateModalTitle" data-i18n="training.newTemplate">Новый шаблон</h2>
            <input type="hidden" id="editTemplateId">
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="training.templateKey">Ключ</label>
                <select id="templateKey"
                    class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="greeting">greeting</option>
                    <option value="farewell">farewell</option>
                    <option value="silence_prompt">silence_prompt</option>
                    <option value="transfer">transfer</option>
                    <option value="error">error</option>
                    <option value="wait">wait</option>
                    <option value="order_cancelled">order_cancelled</option>
                </select>
            </div>
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="training.templateTitle">Название</label>
                <input type="text" id="templateTitle"
                    class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="training.content">Содержание</label>
                <textarea id="templateContent"
                    class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500 min-h-20 resize-y"></textarea>
            </div>
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="training.description">Описание</label>
                <input type="text" id="templateDescription"
                    class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <button class="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer bg-blue-600 text-white hover:bg-blue-700" onclick="window._pages.scenarios.saveTemplate()" data-i18n="common.save">Сохранить</button>
        </div>
    </div>

    <!-- Tool Override Modal -->
    <div class="modal-overlay fixed inset-0 bg-black/50 z-[100] justify-center items-center" id="toolOverrideModal">
        <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-xl p-6 max-w-[700px] w-[90%] max-h-[80vh] overflow-y-auto max-md:w-[95%]">
            <span class="float-right cursor-pointer text-lg text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-200 transition-colors leading-none" onclick="window._app.closeModal('toolOverrideModal')">&times;</span>
            <h2 class="text-base font-semibold text-neutral-900 dark:text-neutral-50 mb-4" id="toolOverrideModalTitle" data-i18n="training.editTool">Редактирование инструмента</h2>
            <input type="hidden" id="editToolName">
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="training.originalDescription">Описание по умолчанию</label>
                <p class="text-sm text-neutral-500 dark:text-neutral-400 bg-neutral-50 dark:bg-neutral-800 p-3 rounded" id="toolOriginalDescription"></p>
            </div>
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="training.overrideDescription">Переопределённое описание</label>
                <textarea id="toolOverrideDescription"
                    class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500 min-h-30 resize-y"></textarea>
            </div>
            <button class="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer bg-blue-600 text-white hover:bg-blue-700" onclick="window._pages.tools.saveToolOverride()" data-i18n="common.save">Сохранить</button>
        </div>
    </div>

    <!-- Source Config Modal -->
    <div class="modal-overlay fixed inset-0 bg-black/50 z-[100] justify-center items-center" id="sourceConfigModal">
        <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-xl p-6 max-w-[700px] w-[90%] max-h-[80vh] overflow-y-auto max-md:w-[95%]">
            <span class="float-right cursor-pointer text-lg text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-200 transition-colors leading-none" onclick="window._app.closeModal('sourceConfigModal')">&times;</span>
            <h2 id="sourceConfigModalTitle" class="text-base font-semibold text-neutral-900 dark:text-neutral-50 mb-4" data-i18n="sources.addSource">Добавить источник</h2>
            <input type="hidden" id="editSourceConfigId">
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="sources.sourceName">Название</label>
                <input type="text" id="sourceConfigName" class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="ADAC Reifentest">
            </div>
            <div class="grid grid-cols-2 gap-3 mb-3">
                <div>
                    <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="sources.sourceType">Тип</label>
                    <select id="sourceConfigType" class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="generic_html">HTML</option>
                        <option value="rss">RSS</option>
                        <option value="prokoleso">ProKoleso</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="sources.sourceLanguage">Язык</label>
                    <select id="sourceConfigLanguage" class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="uk">Українська</option>
                        <option value="de">Deutsch</option>
                        <option value="en">English</option>
                        <option value="fr">Français</option>
                    </select>
                </div>
            </div>
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="sources.sourceUrl">URL</label>
                <input type="text" id="sourceConfigUrl" class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="https://example.com">
            </div>
            <div class="grid grid-cols-3 gap-3 mb-3">
                <div>
                    <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="sources.maxArticles">Макс. статей</label>
                    <input type="number" id="sourceConfigMaxArticles" value="20" min="1" max="100" class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="sources.scheduleDay">День</label>
                    <select id="sourceConfigDay" class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="monday">Пн</option><option value="tuesday">Вт</option><option value="wednesday">Ср</option><option value="thursday">Чт</option><option value="friday">Пт</option><option value="saturday">Сб</option><option value="sunday">Вс</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="sources.scheduleHour">Час</label>
                    <input type="number" id="sourceConfigHour" value="6" min="0" max="23" class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
            </div>
            <div class="flex gap-4 mb-3">
                <label class="flex items-center gap-2 text-sm cursor-pointer">
                    <input type="checkbox" id="sourceConfigEnabled">
                    <span data-i18n="sources.enabled">Включён</span>
                </label>
                <label class="flex items-center gap-2 text-sm cursor-pointer">
                    <input type="checkbox" id="sourceConfigAutoApprove">
                    <span data-i18n="sources.autoApprove">Авто-публикация</span>
                </label>
            </div>
            <div class="mb-3">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1" data-i18n="sources.settingsJson">Настройки (JSON)</label>
                <textarea id="sourceConfigSettings" rows="3" class="w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono resize-y">{}</textarea>
            </div>
            <button class="inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md transition-colors cursor-pointer bg-blue-600 text-white hover:bg-blue-700" onclick="window._pages.knowledge.saveSourceConfig()" data-i18n="common.save">Сохранить</button>
        </div>
    </div>

    <script type="module" src="/src/main.js"></script>
</body>
</html>
